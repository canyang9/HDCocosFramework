window.__require=function t(e,i,o){function n(r,a){if(!i[r]){if(!e[r]){var h=r.split("/");if(h=h[h.length-1],!e[h]){var l="function"==typeof __require&&__require;if(!a&&l)return l(h,!0);if(s)return s(h,!0);throw new Error("Cannot find module '"+r+"'")}r=h}var c=i[r]={exports:{}};e[r][0].call(c.exports,function(t){return n(e[r][1][t]||t)},c,c.exports,t,e,i,o)}return i[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<o.length;r++)n(o[r]);return n}({AStar:[function(t,e,i){"use strict";cc._RF.push(e,"b30eeXbkf1Hy6yZgOqQk+WM","AStar"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../global_def"),n=function(){function t(t,e){this.r=-1,this.c=-1,this.costSum=0,this.costGrid=0,this.costToDest=0,this.costFactor=1,this.bReachable=!0,this.parent=null,this.bPath=!1,this.r=t,this.c=e}return t.prototype.isEqual=function(t){return this.r===t.r&&this.c===t.c},t.sortCompare=function(t,e){var i=0;return null==t&&null==e?i=0:null!=t&&null==e?i=1:null==t&&null!=e?i=-1:t.costSum>e.costSum?i=1:t.costSum==e.costSum?i=t.costGrid>e.costGrid?-1:t.costGrid<e.costGrid?1:t.costToDest>e.costToDest?-1:t.costToDest<e.costToDest?1:0:t.costSum<e.costSum&&(i=-1),i},t}();i.AStarNode=n;var s,r,a=function(){function t(t,e){this.startNode_=null,this.endNode_=null,this.nodes_=null,this.rows_=0,this.cols_=0,this.rows_=t,this.cols_=e,this.nodes_=new Array(t);for(var i=0;i<t;++i){this.nodes_[i]=new Array(e);for(var o=0;o<e;++o)this.nodes_[i][o]=new n(i,o)}}return t.prototype._isValidRC=function(t,e){return t>=0&&t<this.rows_&&e>=0&&e<=this.cols_},t.prototype.setNodeProp=function(t,e,i,o){void 0===o&&(o=!0),this._isValidRC(t,e)&&(this.nodes_[t][e].costFactor=i,this.nodes_[t][e].bReachable=o)},t.prototype.isNodeReachable=function(t,e){return!!this._isValidRC(t,e)&&this.nodes_[t][e].bReachable},t.prototype.getNode=function(t,e){return this.nodes_[t][e]},t.prototype.setStartNode=function(t,e){this._isValidRC(t,e)&&(this.startNode_=this.nodes_[t][e])},t.prototype.setEndNode=function(t,e){this._isValidRC(t,e)&&(this.endNode_=this.nodes_[t][e])},Object.defineProperty(t.prototype,"endNode",{get:function(){return this.endNode_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startNode",{get:function(){return this.startNode_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cols",{get:function(){return this.cols_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this.rows_},enumerable:!0,configurable:!0}),t}();i.AStarGrid=a,function(t){t[t.kMahattan=0]="kMahattan",t[t.kEuclidian=1]="kEuclidian",t[t.kDiagonal=2]="kDiagonal"}(s=i.HeuristicType||(i.HeuristicType={})),function(t){t[t.kFour=0]="kFour",t[t.kEight=1]="kEight"}(r=i.DirectionNum||(i.DirectionNum={}));var h=function(){function t(t){this.openLst_=null,this.closeLst_=null,this.grid_=null,this.pathLst_=null,this.type_=s.kEuclidian,this.defaultStraightCost_=1,this.defaultDiagCost_=0,this.dirNum_=r.kEight,this.dirNum_=t,this._init()}return t.prototype._init=function(){this.defaultDiagCost_=Math.sqrt(this.defaultStraightCost_*this.defaultStraightCost_+this.defaultStraightCost_*this.defaultStraightCost_),this.openLst_=new Array,this.closeLst_=new Array,this.pathLst_=new Array},t.prototype.findPath=function(t,e){void 0===e&&(e=!1),this.grid_=t,this.openLst_=[],this.closeLst_=[];var i=this.grid_.startNode;return i.costGrid=0,i.costToDest=this._heuristic(i),i.costSum=i.costGrid+i.costToDest,this.search(e)},Object.defineProperty(t.prototype,"path",{get:function(){return this.pathLst_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heuristicType",{set:function(t){this.type_=t},enumerable:!0,configurable:!0}),t.prototype.getVisitedNodes=function(){return this.closeLst_.concat(this.openLst_),this.closeLst_},t.prototype.search=function(t){var e=!0,i=this.grid_.startNode,s=this.grid_.endNode;for(i.bPath=!1,s.bPath=!1;!s.isEqual(i);){for(var a=Math.max(0,i.r-1),h=Math.min(this.grid_.rows-1,i.r+1),l=Math.max(0,i.c-1),c=Math.min(this.grid_.cols-1,i.c+1),u=a;u<=h;++u)for(var d=l;d<=c;++d){var _=this.grid_.getNode(u,d);if(_.bPath=!1,!_.isEqual(i)&&_.bReachable&&(this.dirNum_!=r.kEight||this.grid_.getNode(i.r,_.c).bReachable&&this.grid_.getNode(_.r,i.c).bReachable)){var p=this.defaultStraightCost_;if(this.dirNum_==r.kEight)i.r!==_.r&&i.c!=_.c&&(p=this.defaultDiagCost_);else if(this.dirNum_==r.kFour&&i.r!==_.r&&i.c!=_.c)continue;var f=i.costGrid+p*i.costFactor,g=this._heuristic(_),m=f+g;this._isOpen(_)||this.isClosed(_)?_.costSum>m&&(_.costSum=m,_.costGrid=f,_.costToDest=g,_.parent=i):(_.costSum=m,_.costGrid=f,_.costToDest=g,_.parent=i,this.openLst_.push(_))}}if(this.closeLst_.push(i),0===this.openLst_.length){o.G.log("can't find any path"),e=!1;break}this.openLst_.sort(n.sortCompare),i=this.openLst_[0],this.openLst_.shift()}return e&&!t&&this._buildPath(),e},t.prototype._buildPath=function(){this.pathLst_=[];var t=this.grid_.endNode;for(this.pathLst_.push(t);!t.isEqual(this.grid_.startNode);)t.bPath=!0,(t=t.parent).isEqual(this.grid_.startNode)||this.pathLst_.unshift(t)},t.prototype._isOpen=function(t){for(var e=!1,i=0;i<this.openLst_.length;++i)if(this.openLst_[i].isEqual(t)){e=!0;break}return e},t.prototype.isClosed=function(t){for(var e=!1,i=0;i<this.closeLst_.length;++i)if(this.closeLst_[i].isEqual(t)){e=!0;break}return e},t.prototype._heuristic=function(t){var e=0;return this.type_==s.kMahattan?e=this._manhattan(t):this.type_==s.kEuclidian?e=this._euclidian(t):this.type_==s.kDiagonal&&(e=this._diagonal(t)),e},t.prototype._manhattan=function(t){return Math.abs(t.r-this.grid_.endNode.r)*this.defaultStraightCost_+Math.abs(t.c-this.grid_.endNode.c)*this.defaultStraightCost_},t.prototype._euclidian=function(t){var e=t.r-this.grid_.endNode.r,i=t.c-this.grid_.endNode.c;return Math.sqrt(e*e+i*i)*this.defaultStraightCost_},t.prototype._diagonal=function(t){var e=Math.abs(t.r-this.grid_.endNode.r),i=Math.abs(t.c-this.grid_.endNode.c),o=Math.min(e,i),n=e+i;return this.defaultDiagCost_*o+this.defaultStraightCost_*n*(n-2*o)},t}();i.AStar=h,cc._RF.pop()},{"../global_def":"global_def"}],HDSDK:[function(t,e,i){"use strict";cc._RF.push(e,"3d38cqD/E5DcpJoiLp4Pi3q","HDSDK"),Object.defineProperty(i,"__esModule",{value:!0});var o="https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/HDSDK/NavList/Pub/",n="https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/HDSDK/NavList/QRCode/",s="https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/HDSDK/NavList/Banner/",r="https://login.joyfulh.com/comLogin",a="https://statistic.joyfulh.com/statistic",h="/jumpData/getJumpData",l="/data/updImportStat",c="/data/updExportStat",u=function(){return function(){this.url="",this.data=""}}(),d=function(){return function(){this.gridCb=null,this.likeCb=null,this.qrCb=null,this.bnrCb=null}}(),_=function(){return function(){this.sn=0,this.path="",this.img="",this.type=0,this.extra=null,this.appId="",this.id="",this.name="",this.alias="",this.qrUrl="",this.bnrUrl="",this.tag=0,this.verCode="",this.box=0,this.tmPosId="",this.tmCid=""}}();i.HDNavData=_;var p=function(){function t(){}return Object.defineProperty(t,"needUpdateNavData",{get:function(){return this.bUpdateNav_},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isDataExisted",{get:function(){return this.bDataExisted_},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getForceNavIds",{get:function(){return this.forceIds_},enumerable:!0,configurable:!0}),t.getForceNavData=function(t){var e=null;if(this.forceMap_[t]){var i=this.forceMap_[t];if(i){var o=i.length-1;e=i[Math.round(Math.random()*(o-0))+0]}}return e},t.register=function(t,e,i,o,n){this._readSave(),this.bRegister_=!0;var s=Date.now()-this.loginTime_;this.openID_&&""!==this.openID_&&"null"!=this.openID_&&s<=144e5?(this.init(this.openID_,t,e,i,o,n),console.log("[HDSDK] no need login",s,this.openID_)):this._isWechat?(console.log("[HDSDK] login for SDK"),this._login(t,e,i,o,n)):this.init("",t,e,i,o,n)},t.init=function(t,e,i,o,n,s){if(this.openID_=t||"",this.proName_=e,this.bRegister_||this._readSave(),console.log("[HDSDK] init",this.newUser_,e,this.openID_),Date.now()-this.lastRefreshTime_>9e5?(this.bDownloaded_=!1,this.loadNativeData(i,o,n,s),this._requstQueue(i,o,n,s)):(this.gridArr_.length>0&&i&&i(this.gridArr_),this.likeArr_.length>0&&o&&o(this.likeArr_),this.qrArr_.length>0&&n&&n(this.qrArr_),this.bnrArr_.length>0&&s&&s(this.bnrArr_)),this._isWechat){var r=wx.getLaunchOptionsSync();if(r.query&&(r.query.hdg&&""!=r.query.hdg||r.query.HDg_nav_0&&""!=r.query.HDg_nav_0)){var a=r.query.HDg_nav_0||r.query.hdg;this._reportImportStat(e,t,a)}}this.bRegister_=!1,this.newUser_=0,""!=this.openID_&&"null"!=this.openID_&&(this._isWechat?(wx.setStorageSync("user",this.openID_),wx.setStorageSync("login",this.loginTime_)):localStorage.setItem("user",this.openID_))},t.loadNativeData=function(t,e,i,o){var n=this;this.bLoadedNative_||(void 0!==window.Laya?window.Laya.loader.load("data/hd_nav.json",window.Laya.Handler.create(null,function(){var s=window.Laya.loader.getRes("data/hd_nav.json");s?(n._parseNavData(s,t,e,i,o),window.Laya.loader.clearRes("data/hd_nav.json")):console.log("no native data")}),null,window.Laya.Loader.JSON):void 0!==window.cc&&window.cc.loader.loadRes("data/hd_nav.json",window.cc.JsonAsset,function(n,s){n?console.log("no native data"):(this._parseNavData(s.json,t,e,i,o),window.cc.loader.release(s))}))},t.getGridArray=function(){return this.gridArr_},t.getLikeArray=function(){return this.likeArr_},t.getQRCodeArray=function(){return this.qrArr_},t.getBannerArray=function(){return this.bnrArr_},t.navigate=function(t,e,i){var o=this;if(this._isWechat){if(this.datMap_[t]){var n=this.datMap_[t];if(3===n.type)wx.previewImage({urls:[n.qrUrl],success:function(t){console.log("[HDSDK] navigate qr")}});else{var s=wx.getSystemInfoSync();if(1==this._compareVersionForWx(s.SDKVersion,"2.2.0")){if(1===n.box&&-1!==s.platform.indexOf("ios"))return void(i&&i());wx.navigateToMiniProgram({appId:n.appId,path:n.path,extraData:n.extra,success:function(){o._reportExportStat(n),e&&e()},fail:function(){i&&i()}})}else wx.showModal({title:"\u7248\u672c\u63d0\u793a",content:"\u5fae\u4fe1\u7248\u672c\u8f83\u4f4e\uff0c\u6682\u4e0d\u652f\u6301\u6e38\u620f\u8df3\u8f6c"})}}}else{var r=this.datMap_[t];console.log("[HDSDK] not wechat platform,navigate data is",r.sn,r.name,r)}},t.uploadImportData=function(t){1===this.newUser_&&this._reportImportStat(this.proName_,this.openID_,t)},t._fetchData=function(t,e,i,o,n){var s=this;t&&""!==t&&this._getNavData(t,function(r){if(console.log("[HDSDK] fetch data",r),r&&r.res){1===s.currPage_&&r.res.length>0&&(s.bUpdateNav_=!0,s.bDownloaded_=!0,s.datMap_={},s.forceMap_={},s.forceIds_=[],s.gridArr_=[],s.likeArr_=[],s.qrArr_=[],s.bnrArr_=[],s.reqQue_=[],s.bDataExisted_=!1,console.log("[HDSDK] page one clear flag")),r.res.length>0&&(++s.currPage_,s._fetchData(t,e,i,o,n));for(var a=r.res,h=0;h<a.length;++h)s._createNavData(a[h]);s.gridArr_.length>0||s.likeArr_.length>0?s.lastRefreshTime_=Date.now():s.lastRefreshTime_=0,0==r.res.length&&s.currPage_>=1&&(e&&e(s.gridArr_),i&&i(s.likeArr_),o&&o(s.qrArr_),n&&n(s.bnrArr_),s.bDataExisted_=!0)}})},t._readSave=function(){var t=null;if(this._isWechat)try{t=wx.getStorageSync("user");var e=wx.getStorageSync("login");this.loginTime_=Number(e)}catch(e){this.loginTime_=0,t=null}else t=localStorage.getItem("user");t?(this.newUser_=0,console.log("[HDSDK] read dat",t,this.loginTime_),""!=t&&"null"!=t&&(this.openID_=t)):this.newUser_=1},t._getNavData=function(t,e){var i=r+h,o={proName:t,page:this.currPage_,limit:20};this._common(i,o,e)},t._parseNavData=function(t,e,i,o,n){if(!this.bDownloaded_){for(var s in t)t.hasOwnProperty(s)&&this._createNavData(t[s],!0);e&&this.gridArr_.length>0&&e(this.gridArr_),i&&this.likeArr_.length>0&&i(this.likeArr_),o&&this.qrArr_.length>0&&o(this.qrArr_),n&&this.bnrArr_.length>0&&n(this.bnrArr_),this.bLoadedNative_=!0,this.bDataExisted_=!0,console.log("[HDSDK] load native data")}},t._checkUpdate=function(t){var e=!1,i=t.id+"_"+t.s;if(this.datMap_[i]){var o=this.datMap_[i],n=this._genVerificationCode(t);o.verCode!=n&&(e=!0)}return e},t._createNavData=function(t,e){void 0===e&&(e=!1);var i=new _;if(-1!==t.img.indexOf(".")?i.img=o+t.img:i.img=o+t.img+".png",i.sn=t.s,i.type=t.t,i.name=t.n,i.path=t.p,i.alias=t.a,""!==t.e&&(i.extra=JSON.parse(t.e)),i.appId=t.id,i.id=i.appId+"_"+i.sn,e&&(i.verCode=this._genVerificationCode(t)),i.extra){if(i.extra.bnr){var r=i.extra.bnr;-1!==r.indexOf(".")?i.bnrUrl=s+r:i.bnrUrl=s+r+".png",this.bnrArr_.push(i)}if(i.extra.tag&&(i.tag=1),i.extra.box&&(i.box=1),i.extra.force)if(this.forceMap_[i.appId])this.forceMap_[i.appId].push(i);else this.forceMap_[i.appId]=[],this.forceMap_[i.appId].push(i),this.forceIds_.push(i.appId)}if(1===t.t)this.gridArr_.push(i);else if(2===t.t)this.likeArr_.push(i);else if(3===t.t){if(i.extra&&i.extra.qr){var a=i.extra.qr;-1!==a.indexOf(".")?i.qrUrl=n+a:i.qrUrl=n+a+".png"}this.qrArr_.push(i)}else 4===t.t&&(this.gridArr_.push(i),this.likeArr_.push(i));this.datMap_[i.id]=i},t._genVerificationCode=function(t){var e=t.s+t.n+t.a,i=t.p,o=i.length+i.charAt(0)+i.charAt(Math.round(i.length/2))+i.charAt(i.length-1),n="";if(""!==t.e){var s=t.e;n=s.length+s.charAt(0)+s.charAt(Math.round(s.length/2))+s.charAt(s.length-1)}return e+o+n},t._reportImportStat=function(t,e,i){if(null!=e&&"null"!=e&&""!=e){var o=a+l,n={proName:t,openid:e,source:i};this._common(o,n,null),console.log("[HDSDK] import stat",e,i)}else this._login(t),console.error("[HDSDK] _reportImportStat openId\u4e0d\u5b58\u5728\uff0c\u8bf7\u4fdd\u8bc1openId\u7684\u83b7\u53d6")},t._reportExportStat=function(t){if(null!=this.openID_&&"null"!=this.openID_&&""!=this.openID_){var e=a+c,i="";""!==t.bnrUrl?i="banner"+t.sn:1==t.type?i="grid"+t.sn:2==t.type?i="like"+t.sn:4==t.type&&(i="all"+t.sn);var o={proName:this.proName_,openid:this.openID_,gameName:t.name,location:i,appid:t.appId,alias:t.alias};this._common(e,o,null),console.log("[HDSDK] export stat",this.openID_,t.appId,t.id,t.name)}else console.error("[HDSDK] _reportExportStat openId\u4e0d\u5b58\u5728\uff0c\u8bf7\u4fdd\u8bc1openId\u7684\u83b7\u53d6")},t._common=function(t,e,i,o){if(null!=e){var n=new u;if(n.url=t,"object"==typeof e){for(var s in e)if(e.hasOwnProperty(s)){var r=e[s];if(null==r)continue;if(""!=n.data&&(n.data+="&"),"object"==typeof r){var a=JSON.stringify(r);n.data+=s+"="+encodeURI(a)}else"string"==typeof r||"number"==typeof r||"boolean"==typeof r?n.data+=s+"="+encodeURI(r.toString()):(n.data+=s+"="+encodeURI(r.toString()),console.warn("[HttpRequest] please check your data type,only support object,string,number or boolean"))}}else n.data=encodeURI(e);this._send(n,i,o),n=null}else console.error("[HttpRequest] failed")},t._send=function(t,e,i){var o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&o.status>=200&&o.status<400?(console.log("[HDSDK] req succ",o.responseText),e&&e(JSON.parse(o.responseText))):(o.status<200||o.status>=400)&&console.log("[HDSDK] conn",o.readyState,o.status)},o.onerror=function(){console.log("[HDSDK] error",o.status),i&&i()};var n=t.url+"?"+t.data;o.open("GET",n,!0),o.send()},t._compareVersionForWx=function(t,e){for(var i=t.split("."),o=e.split("."),n=Math.max(i.length,o.length);i.length<n;)i.push("0");for(;o.length<n;)o.push("0");for(var s=0;s<n;s++){var r=parseInt(i[s]),a=parseInt(o[s]);if(r>a)return 1;if(r<a)return-1}return 0},t._requstQueue=function(t,e,i,o){if(this.reqLimited_<5&&!this.bDownloaded_){var n=new d;n.gridCb=t,n.likeCb=e,n.qrCb=i,n.bnrCb=o,this.reqQue_.push(n),console.log("[HDSDK] _requstQueue",this.reqQue_.length)}++this.reqLimited_,this._requestProc()},t._requestProc=function(){if(Date.now()-this.lastReqTime_>1e4){var t=this.reqQue_.shift();t&&(this.lastReqTime_=Date.now(),this.currPage_=1,this._fetchData(this.proName_,t.gridCb,t.likeCb,t.qrCb,t.bnrCb),clearTimeout(this.reqTimerId_),this.reqTimerId_=setTimeout(this._requestProc.bind(this),15e3),console.log("[HDSDK] _requestProc",this.reqQue_.length))}},t._login=function(t,e,i,o,n){var s=this;wx.login({success:function(a){a.code&&wx.request({url:r+"/user/getSessionKey",data:{code:a.code,proName:t,choose:"1"},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(r){if(r.statusCode>=200&&r.statusCode<=400){console.log("[HDSDK] login request succ",r),s.loginTime_=Date.now();var a=JSON.parse(r.data.res);a&&a.openId&&s.init(a.openId,t,e,i,o,n)}else console.log("[HDSDK] login request fail",r),s.init("",t,e,i,o,n)},fail:function(t){console.log("[HDSDK] login request error",t)}})},fail:function(r){console.log("[HDSDK] wx login error",r),s.init("",t,e,i,o,n)},complete:function(t){}})},Object.defineProperty(t,"_isWechat",{get:function(){return"undefined"!=typeof wx},enumerable:!0,configurable:!0}),t.gridArr_=[],t.likeArr_=[],t.qrArr_=[],t.bnrArr_=[],t.forceMap_={},t.forceIds_=[],t.datMap_={},t.openID_="",t.proName_="",t.lastRefreshTime_=0,t.lastReqTime_=0,t.reqQue_=[],t.reqLimited_=0,t.bDownloaded_=!1,t.reqTimerId_=0,t.autoTimerId_=0,t.newUser_=1,t.currPage_=1,t.loginTime_=0,t.dataLen_=0,t.bRegister_=!1,t.bLoadedNative_=!1,t.bUpdateNav_=!1,t.bDataExisted_=!1,t}();i.HDSDK=p,cc._RF.pop()},{}],ad_sim_ui:[function(t,e,i){"use strict";cc._RF.push(e,"7f907UpP6JEwp+Km+emU9aO","ad_sim_ui"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../../util/structure/hd_map"),n=t("../../data/data_hub"),s=t("./base_ui"),r=function(){function t(){}return t.addTestBannerHolder=function(t,e,i){if(void 0===i&&(i=1),!this.testBnrMap_.containsKey(t)){var o=fgui.UIPackage.createObject("CommUI","BnrTestHolder");if(o){e?o.setPosition(0,e.localToGlobal().y+n.DataHub.config.bnrGap):1===i?o.setPosition(0,cc.view.getVisibleSize().height-o.height):o.setPosition(0,0),o.visible=!1;var r=o.getChild("txt");r&&((r=r).text=t),o.sortingOrder=s.UIHierarchy.kTestBnr,s.BaseUI.root.addChild(o),this.testBnrMap_.put(t,o)}}},t.isTestBannerHolderShowed=function(t){var e=!1;this.testBnrMap_.containsKey(t)&&(e=this.testBnrMap_.get(t).visible);return e},t.isTestBannerLimited=function(t){},t.showTestBannerHolder=function(t){if(this.hideLastTestBanner(),this.testBnrMap_.containsKey(t)){var e=this.testBnrMap_.get(t);e.visible=!0,this.lastTestBnrStack_.push(e)}},t.hideTestBannerHolder=function(t){this.testBnrMap_.containsKey(t)&&(this.testBnrMap_.get(t).visible=!1,this.lastTestBnrStack_.pop(),this.lastTestBnrStack_.length>0&&(this.lastTestBnrStack_[this.lastTestBnrStack_.length-1].visible=!0))},t.showLastTestBanner=function(){this.lastTestBnrStack_.length>0&&(this.lastTestBnrStack_[this.lastTestBnrStack_.length-1].visible=!0)},t.hideLastTestBanner=function(){this.lastTestBnrStack_.length>0&&(this.lastTestBnrStack_[this.lastTestBnrStack_.length-1].visible=!1)},t.hideAllTestBanner=function(){var t=this;this.hideLastTestBanner(),this.testBnrMap_.each(function(e,i,o){t.hideTestBannerHolder(i)})},t.testBnrMap_=new o.HDMap,t.lastTestBnrStack_=[],t}();i.BannerSimUI=r,cc._RF.pop()},{"../../data/data_hub":"data_hub","../../util/structure/hd_map":"hd_map","./base_ui":"base_ui"}],ad_tools:[function(t,e,i){"use strict";cc._RF.push(e,"86bc7LuRgdHnrmTFaYrhkqI","ad_tools"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../util/mgp_util"),n=t("../game_ui/common/blocker_ui"),s=t("../util/global_def"),r=t("../data/data_hub"),a=t("../game_ui/common/tip_ui"),h=t("../game/user_info"),l=function(){function t(){}return t.watchOrShare=function(t,e,i,s){var r=this;if(this.succCallback_=e,this.failCallback_=s,h.GameUserInfo.isVideoLimited)this._shareAward(i);else{n.InputBlocker.instance.block(10),o.MgpUtil.watchVideoAds(t,function(){n.InputBlocker.instance.hide(),r.succCallback_&&(r.succCallback_(i),r.succCallback_=null)},function(){n.InputBlocker.instance.hide(),r.failCallback_&&(r.failCallback_(),r.failCallback_=null),a.TipUI.instance.show("\u8bf7\u89c2\u770b\u5b8c\u6574\u89c6\u9891\u83b7\u53d6\u5956\u52b1")},function(t){r._shareAward(i),n.InputBlocker.instance.hide(),r.failCallback_&&(r.failCallback_(),r.failCallback_=null)},null,this._videoClickBonus.bind(this),"\u70b9\u51fb\u5e95\u90e8\u6761\u5e45\u53ef\u83b7\u5f97\u5956\u52b1")}},t._shareAward=function(t){var e=this;if(1===r.DataHub.config.v2sh){var i=function(){e.succCallback_&&(e.succCallback_(t),e.succCallback_=null)},n=function(){a.TipUI.instance.show("\u53d1\u9001\u5230\u4e0d\u540c\u7fa4\u9886\u53d6\u5956\u52b1"),e.failCallback_&&(e.failCallback_(),e.failCallback_=null)};if(s.G.isTMSDK)o.MgpUtil.shareForTMSDK("share",i,n);else{var h=r.DataHub.getMessage;o.MgpUtil.shareNorm(h.title,h.img,i,n)}}else r.DataHub.config.directAward?this.succCallback_&&(this.succCallback_(t),this.succCallback_=null):(a.TipUI.instance.show("\u6682\u65e0\u5408\u9002\u7684\u89c6\u9891\u5e7f\u544a"),this.failCallback_&&(this.failCallback_(),this.failCallback_=null))},t._videoClickBonus=function(){},t.kSignIn="adunit-173c5e5d35b44266",t.kBox="adunit-d1fdb8baaf15e4cd",t.kResult="adunit-9eda1e1302d3932b",t.kTry="adunit-090b55dfa38539f5",t.kRevive="adunit-3e1ae1a358f740cf",t.succCallback_=null,t.failCallback_=null,t}();i.HDVideoAd=l;var c=function(){function t(){}return t.init=function(){this.index_=s.G.randRange(0,this.collection_.length-1)},t.switch=function(){var t=this.index_;this.kB1=this.collection_[this._index(t)],this.kB2=this.collection_[this._index(t+1)],this.kB3=this.collection_[this._index(t+2)],this.kB4=this.collection_[this._index(t+3)],console.log("banner switch",this.index_,this.kB1,this.kB2,this.kB3,this.kB4),++this.index_},t.errorCallback=function(){},t._index=function(t){var e=this.collection_.length;return t>=e?t%=e:t<0&&(t=e*Math.ceil(Math.abs(t)/e)+t),t},t.kB1="adunit-4db4041231cd0f13",t.kB2="adunit-0700e34420a2f0c5",t.kB3="adunit-dda6bd68cebba956",t.kB4="adunit-27eef0d564a6cfee",t.collection_=["adunit-4db4041231cd0f13","adunit-0700e34420a2f0c5","adunit-dda6bd68cebba956","adunit-27eef0d564a6cfee"],t.index_=0,t}();i.HDBannerAd=c;var u=function(){function t(){}return t.kResult="adunit-08ee7e14068356ac",t}();i.InterstitialAdIds=u,cc._RF.pop()},{"../data/data_hub":"data_hub","../game/user_info":"user_info","../game_ui/common/blocker_ui":"blocker_ui","../game_ui/common/tip_ui":"tip_ui","../util/global_def":"global_def","../util/mgp_util":"mgp_util"}],audio_mgr:[function(t,e,i){"use strict";cc._RF.push(e,"a3032yTr8hMuYzzfFM5cYC5","audio_mgr"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./global_def"),s=t("./structure/hd_map"),r=t("./game_storage"),a=t("./timed_task"),h=t("./event_mgr"),l=t("./mgp_util");(function(t){t[t.kMenu=0]="kMenu",t[t.kNone=9999]="kNone"})(o=i.BgmType||(i.BgmType={}));var c,u=["bgm_menu"];(function(t){t[t.kGoodClick=0]="kGoodClick",t[t.kLuckyBox=1]="kLuckyBox",t[t.kNone=9999]="kNone"})(c=i.SfxType||(i.SfxType={}));var d,_=["goodClick","luckybox"];(function(t){t[t.kNorm=0]="kNorm",t[t.kVideoAd=1]="kVideoAd",t[t.kBackend=2]="kBackend"})(d=i.AudioPauseType||(i.AudioPauseType={}));var p=function(){function t(){this.bMuteMusic_=!1,this.bMuteSound_=!1,this.pauseType_=d.kNorm,this.curBgmType_=o.kNone,this.bgmId_=0,this.maxBgmVol_=1,this.maxSfxVol_=1,this.maxFadeVol_=0,this.bgms_=new s.HDMap,this.sfxMap_=new s.HDMap,this.bgmRemoteDelayType_=o.kNone,this.fadeTimeTaskId_=0,this.bgmProcCb_=null,this.sfxProcCb_=null,this.bgmProcCnt_=0,this.bgmProcTotal_=0,this.sfxProcCnt_=0,this.sfxProcTotal_=0,this.url_="audio/"}return t.prototype.isStopMusic=function(){return this.bMuteMusic_},t.prototype.isStopSound=function(){return this.bMuteSound_},t.prototype.init=function(){this._readData(),h.GameEventMgrInst.addListener(h.EventType.kAudioPause,this._pauseCallback.bind(this),!0),h.GameEventMgrInst.addListener(h.EventType.kAudioResume,this._resumeCallback.bind(this),!0)},t.prototype.loadPackage=function(t,e){n.G.isMinigamePlat?(n.G.log("[AudioMgr loadPackage] start"),cc.loader.downloader.loadSubpackage("audio",function(i){i?(n.G.log("[AudioMgr loadPackage] fail",i),e&&e()):(n.G.log("[AudioMgr loadPackage] succ"),t&&t())})):t&&t()},t.prototype.preloadAll=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);for(var i=0;i<u.length;++i)this.bgms_.containsKey(i)||(++this.bgmProcTotal_,n.G.readAudio(this.url_+u[i],this._loadBgm.bind(this),i));for(i=0;i<_.length;++i)this.sfxMap_.containsKey(i)||(++this.sfxProcTotal_,n.G.readAudio(this.url_+_[i],this._loadSfx.bind(this),i));this.bgmProcCb_=t,this.sfxProcCb_=e},t.prototype.preloadBgmInEnumRange=function(t,e,i){if(void 0===e&&(e=o.kNone),void 0===i&&(i=null),e!=o.kNone)for(var s=t;s<=e;++s)this.bgms_.containsKey(s)||(++this.bgmProcTotal_,n.G.readAudio(this.url_+u[s],this._loadBgm.bind(this),s));else this.bgms_.containsKey(t)||(++this.bgmProcTotal_,n.G.readAudio(this.url_+u[t],this._loadBgm.bind(this),t));this.bgmProcCb_=i},t.prototype.releaseBgmInEnumRange=function(t,e){if(void 0===e&&(e=o.kNone),cc.audioEngine.stopMusic(),e==o.kNone)this.bgms_.containsKey(e)&&(cc.loader.release(this.bgms_.get(e)),this.bgms_.remove(e));else for(var i=t;i<=e;++i)this.bgms_.containsKey(i)&&(cc.loader.release(this.bgms_.get(i)),this.bgms_.remove(i))},t.prototype.preloadSfxInEnumRange=function(t,e,i){void 0===i&&(i=null);for(var o=t;o<=e;++o)this.sfxMap_.containsKey(o)||(++this.sfxProcTotal_,n.G.readAudio(this.url_+_[o],this._loadSfx.bind(this),o));this.sfxProcCb_=i},t.prototype.releaseSfxInEnumRange=function(t,e){cc.audioEngine.stopAllEffects();for(var i=t;i<=e;++i)this.sfxMap_.containsKey(i)||(cc.loader.release(this.sfxMap_.get(i)),this.sfxMap_.remove(i))},t.prototype.setIfMuteMusic=function(t){var e=this.bMuteMusic_;this.bMuteMusic_=t,t?n.G.isMinigamePlat?this.pauseMusic():cc.audioEngine.stopMusic():n.G.isMinigamePlat?this.resumeMusic():this.bgmId_=cc.audioEngine.playMusic(this.bgms_.get(this.curBgmType_),!0),e!=t&&this._saveData()},t.prototype.setIfMuteSound=function(t){var e=this.bMuteSound_;this.bMuteSound_=t,e!=t&&this._saveData()},t.prototype.setBgmVolume=function(t){this.maxBgmVol_=t,cc.audioEngine.setMusicVolume(t),n.G.isEqualF(t,this.maxBgmVol_)||this._saveData()},t.prototype.setSfxVolume=function(t){this.maxSfxVol_=t,cc.audioEngine.setEffectsVolume(t),n.G.isEqualF(t,this.maxSfxVol_)||this._saveData()},t.prototype._saveData=function(){var t={bMuteBgm:this.bMuteMusic_,bMuteSfx:this.bMuteSound_,maxBgmVol:this.maxBgmVol_,maxSfxVol:this.maxSfxVol_};r.GameStorage.writeJSON(r.SaveDef.kAudio,t)},t.prototype._readData=function(){var t=r.GameStorage.readJSON(r.SaveDef.kAudio);n.G.isExistObj(t)?(this.bMuteMusic_=t.bMuteBgm,this.bMuteSound_=t.bMuteSfx,this.maxBgmVol_=t.maxBgmVol,this.maxSfxVol_=t.maxSfxVol):this._saveData(),this.setBgmVolume(this.maxBgmVol_),this.setSfxVolume(this.maxSfxVol_)},t.prototype.playMusic=function(t,e){if(void 0===e&&(e=!1),cc.audioEngine.stopMusic(),t!==o.kNone)if(this.curBgmType_=t,this.bgms_.containsKey(t)){if(!this.bMuteMusic_)if(n.G.isMinigamePlat){var i=this.bgms_.get(t);l.MgpUtil.playAudio(i.url,!0)}else this.bgmId_=cc.audioEngine.playMusic(this.bgms_.get(t),!0)}else e?this.bgmRemoteDelayType_=t:n.G.readAudio(this.url_+u[t],this._loadBgm.bind(this),t,!this.bMuteMusic_)},t.prototype.replayMusic=function(){this.curBgmType_&&this.bgms_.containsKey(this.curBgmType_)&&(this.stopMusic(),this.playMusic(this.curBgmType_))},t.prototype.resumeMusic=function(t){if(void 0===t&&(t=d.kNorm),this.pauseType_==d.kVideoAd){if(t!=d.kVideoAd)return;this.pauseType_=d.kNorm}else this.pauseType_=t;if(!this.bMuteMusic_)if(n.G.isMinigamePlat){var e=this.bgms_.get(this.curBgmType_);e&&l.MgpUtil.resumeAudio(e)}else cc.audioEngine.resumeMusic()},t.prototype.pauseMusic=function(t){if(void 0===t&&(t=d.kNorm),this.pauseType_==d.kVideoAd||(this.pauseType_=t),n.G.isMinigamePlat){var e=this.bgms_.get(this.curBgmType_);e&&l.MgpUtil.pauseAudio(e)}else cc.audioEngine.pauseMusic()},t.prototype.stopMusic=function(){if(n.G.isMinigamePlat){var t=this.bgms_.get(this.curBgmType_);t&&l.MgpUtil.stopAudio(t.url)}else cc.audioEngine.stopMusic()},t.prototype.stopEffects=function(){cc.audioEngine.stopAllEffects()},t.prototype.changeBgmWithFade=function(t,e){var i=this;void 0===e&&(e=1),a.TimedTaskInst.remove(this.fadeTimeTaskId_),this.maxFadeVol_>0&&(this.maxBgmVol_=this.maxFadeVol_),this.maxFadeVol_=this.maxBgmVol_;var o=this.maxBgmVol_,s=e/10,r=this.maxFadeVol_/10*2,h=!1;this.fadeTimeTaskId_=a.TimedTaskInst.add(function(){i.maxBgmVol_>0&&!h?(i.maxBgmVol_-=r,i.maxBgmVol_<=0&&(i.maxBgmVol_=0,i.playMusic(t),h=!0)):(i.maxBgmVol_+=r,i.maxBgmVol_>=o&&(i.maxBgmVol_=o)),n.G.log(i.maxBgmVol_),i.setBgmVolume(i.maxBgmVol_)},0,10,s)},t.prototype.playSound=function(t,e){void 0===e&&(e=!1),t!==c.kNone&&this._playSfx(t,e)},t.prototype._loadBgm=function(t,e,i){void 0===i&&(i=!1),this.bgms_.put(e,t),this.bgmRemoteDelayType_!=o.kNone&&this.bgmRemoteDelayType_==e?(this.playMusic(this.bgmRemoteDelayType_),this.bgmRemoteDelayType_=o.kNone):i&&this.playMusic(e),++this.bgmProcCnt_,this.bgmProcCb_&&(this.bgmProcCb_(this.bgmProcCnt_,this.bgmProcTotal_),this.bgmProcCnt_>=this.bgmProcTotal_&&(this.bgmProcCb_=null))},t.prototype._loadSfx=function(t,e,i,o){void 0===i&&(i=!1),void 0===o&&(o=!1),this.sfxMap_.put(e,t),i&&!this.bMuteSound_&&this._playSfx(e,o),++this.sfxProcCnt_,this.sfxProcCb_&&(this.sfxProcCb_(this.sfxProcCnt_,this.sfxProcTotal_),this.sfxProcCnt_>=this.sfxProcTotal_&&(this.sfxProcCb_=null))},t.prototype._playSfx=function(t,e){if(void 0===e&&(e=!1),this.sfxMap_.containsKey(t)){if(!this.bMuteSound_)if(n.G.isMinigamePlat){var i=this.sfxMap_.get(t);l.MgpUtil.playAudio(i.url,!0)}else cc.audioEngine.playEffect(this.sfxMap_.get(t),e)}else n.G.readAudio(this.url_+_[t],this._loadSfx.bind(this),t,!this.bMuteSound_,e)},t.prototype._pauseCallback=function(t,e){this.pauseMusic(e?e.pauseType:d.kNorm)},t.prototype._resumeCallback=function(t,e){this.resumeMusic(e?e.pauseType:d.kNorm)},t.instance=new t,t}();i.AudioMgr=p,i.AudioMgrInst=p.instance,cc._RF.pop()},{"./event_mgr":"event_mgr","./game_storage":"game_storage","./global_def":"global_def","./mgp_util":"mgp_util","./structure/hd_map":"hd_map","./timed_task":"timed_task"}],base_ui:[function(t,e,i){"use strict";cc._RF.push(e,"56684xdVYxPFI6CPE0rPQHV","base_ui"),Object.defineProperty(i,"__esModule",{value:!0}),function(t){t[t.kDefault=0]="kDefault",t[t.kSetting=994]="kSetting",t[t.kDialog=995]="kDialog",t[t.kCoin=996]="kCoin",t[t.kBlocker=997]="kBlocker",t[t.kTrans=998]="kTrans",t[t.kExportCom=999]="kExportCom",t[t.kExportPage=1e3]="kExportPage",t[t.kTip=1001]="kTip",t[t.kTestBnr=1002]="kTestBnr"}(i.UIHierarchy||(i.UIHierarchy={}));var o=function(){function t(){this.com_=null,this.id_=0,this.bLock_=!1}return t.prototype.init=function(t){},t.prototype.add=function(t){this.com_&&(t.addChild(this.com_),this.com_.visible=!1)},t.prototype.reset=function(){},t.prototype.remove=function(){this.com_&&this.com_.removeFromParent()},t.root=null,t}();i.BaseUI=o,cc._RF.pop()},{}],bd_util:[function(t,e,i){"use strict";cc._RF.push(e,"766faayrI9FGIhD8OyfgtJ+","bd_util"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./global_def"),n=t("./audio_mgr"),s=t("./structure/hd_map"),r=t("../game_setting"),a=t("./game_storage"),h=t("./wx_util"),l=function(){function t(){}return t.saveWxData=function(){var t={openId:r.GameSetting.openId};a.GameStorage.writeJSON(a.SaveDef.kWxStatus,t)},t.readWxData=function(){var t=a.GameStorage.readJSON(a.SaveDef.kWxStatus);t&&(r.GameSetting.openId=t.openId)},t.fetchSdkInfo=function(){this.sdkInfo=swan.getSystemInfoSync(),1==r.GameSetting.testServer&&(this.domain_="http://119.23.108.126:8900/comLogin")},t.compareVersion=function(t,e){for(var i=t.split("."),o=e.split("."),n=Math.max(i.length,o.length);i.length<n;)i.push("0");for(;o.length<n;)o.push("0");for(var s=0;s<n;s++){var r=parseInt(i[s]),a=parseInt(o[s]);if(r>a)return 1;if(r<a)return-1}return 0},t.login=function(t,e,i,o){var n=this;void 0===i&&(i=!1),void 0===o&&(o=!1),i?this._login(t,e,o):swan.checkSession({success:function(t){console.log("check session succ",t),h.WxUtil.readData()},fail:function(i){console.log("check session fail",i),n._login(t,e,o)},complete:function(t){}})},t._login=function(t,e,i){var n=this;void 0===i&&(i=!1),swan.login({success:function(s){o.G.log("login succ",s,i),s.code&&(n.loginCode=s.code,i?t&&t():swan.request({url:n.domain_+"/user/getSessionKey/bd",data:{code:s.code,proName:r.GameSetting.proName,choose:"1"},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(i){i.statusCode>=200&&i.statusCode<=400?(console.log("login request succ",i),t&&t(JSON.parse(i.data.res))):(console.log("login request fail",i),e&&e(i))},fail:function(t){console.log("login request complete fail",t)}}))},fail:function(t){console.log("login fail",t)},complete:function(t){}})},t.fetchUserInfo=function(t,e,i,n,s,r){var a=this;swan.getSetting({success:function(h){if(h.authSetting["scope.userInfo"])swan.getUserInfo({withCredentials:!0,lang:"zh_CN",success:function(t){e&&e(t.userInfo),a._authLogin(t,i,n)},fail:function(t){o.G.log("get setting scope userInfo failed",t)},complete:function(t){}});else{var l=swan.createImage();l.src="res/raw-assets/resources/"+t+".png",l.onload=function(){var t=r;if(o.G.isEmptyObj(t)){var a=l.width,h=l.height;t={left:.5*this.sdkInfo.screenWidth-.5*a,top:.5*this.sdkInfo.screenHeight,width:a,height:h,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(e,t,l.src,s,i,n)}.bind(a)}},fail:function(t){},complete:function(t){}})},t._authLogin=function(t,e,i){swan.request({url:this.domain_+"/user/auth",data:{encryptedData:t.encryptedData,iv:t.iv,code:this.loginCode,proName:r.GameSetting.proName},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){t.statusCode>=200&&t.statusCode<=400?(console.log("_authLogin request succ",t),e&&e(t.data.res)):(console.log("_authLogin request fail",t),i&&i())},fail:function(t){console.log("_authLogin request complete fail",t)}})},t._authentication=function(t,e,i,n,s,r){var a=swan.createUserInfoButton({type:"image",text:"txt",image:i,style:e,withCredentials:!0,lang:"zh_CN"});a.show(),o.G.log("create button",a);var h=function(l){if(o.G.log("_authentication onTap",l),null==l.iv||null==l.encryptedData){o.G.log("cancel auth");var c=swan.createImage();c.src=i,c.onload=function(){var i=e;if(o.G.isEmptyObj(i)){var a=c.width,h=c.height;i={left:.5*this.sdkInfo.screenWidth-.5*a,top:.5*this.sdkInfo.screenHeight,width:a,height:h,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(t,e,c.src,n,s,r)}.bind(this)}else t&&t(l.userInfo),this._authLogin(l,s,r),n&&n();a.offTap(h),a.destroy()}.bind(this);a.onTap(h)},t.uploadUserInfo=function(t,e,i,o,n,s){swan.request({url:this.domain_+"/user/updUser",data:{proName:r.GameSetting.proName,openid:r.GameSetting.openId,unionid:r.GameSetting.unionId,nickname:t,gender:i,avatarurl:e,city:o,province:n,country:s},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){},fail:function(t){}})},t.showForward=function(t){swan.showShareMenu({withShareTicket:!1,success:function(t){},fail:function(){},complete:function(){}}),swan.onShareAppMessage(function(){var e=null;return t&&(e=t()),e})},t.shareNorm=function(t,e,i,o){var n=this;swan.shareAppMessage({title:t,imageUrl:e,query:"snk=1&gid="+r.GameSetting.gameId,cancel:function(){console.log("norm share cancel"),n.bNormShareCancel=!0,n.normShareFailCallback&&(n.normShareFailCallback(),n.normShareFailCallback=null)}}),this.normShareTimestamp=Date.now(),this.normShareSuccCallback=i,this.normShareFailCallback=o,this.bNormShareCancel=!1},t.normShareResult=function(){var t=this;this.normShareTimestamp>0&&(Date.now()-this.normShareTimestamp>=2400?setTimeout(function(){t.bNormShareCancel||(t.normShareSuccCallback&&(t.normShareSuccCallback(),t.normShareSuccCallback=null),o.G.log("norm share succ"))},100):(this.normShareFailCallback&&(this.normShareFailCallback(),this.normShareFailCallback=null),o.G.log("norm share fail")),this.normShareTimestamp=0)},t.launchInvitationCheck=function(){var t=swan.getLaunchOptionsSync();o.G.isExistObj(t.query)&&o.G.log("launchInvitationCheck",t)},t.onShowInvitationCheck=function(t){o.G.isExistObj(t)&&""!=t.id&&""!=t.token&&o.G.log("onShowInvitationCheck",t)},t.reqTimerReset=function(e,i,n){var s=function(){swan.request({url:this.domain_+"/user/reqTimerReset",data:{proName:r.GameSetting.proName,sysName:e,openId:r.GameSetting.openId,choose:i.toString()},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(e){if(e.statusCode>=200&&e.statusCode<=400){console.log("reqTimerReset request succ",e);var i=parseInt(e.data.res);n&&n(i)}else console.log("reqTimerReset request fail",e),t.modalDialog("\u7f51\u7edc\u62a5\u544a","\u5f53\u524d\u7f51\u7edc\u73af\u5883\u4e0d\u4f73\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u91cd\u8bd5")},fail:function(t){console.log("reqTimerReset request fail",t)}})}.bind(this);""==r.GameSetting.openId?t.login(function(t){r.GameSetting.sessionKey=t.sessionKey,r.GameSetting.openId=t.openId,s(),o.G.log("reqTimerReset relogin",t)},null,!0):s()},t.updateAdsRequestTimer=function(t){this.adsRequestTimer-=t},t.preloadVideoAds=function(t){var e=this;if(!this.videoAdsBuffer.containsKey(t)){var i=swan.createRewardedVideoAd({adUnitId:t,appSid:this.adSid_});i.load().then(function(){e.videoAdsBuffer.put(t,i),console.log("preload ad succ")}).catch(function(t){return console.log(t.errMsg)})}},t.watchVideoAds=function(e,i,o,s,r,a){if(!(this.adsRequestTimer>0)){this.adsRequestTimer=5;var h=t.sdkInfo;console.log(h.SDKVersion);var l=function(s){if(t.videoAdsProtectFlags.containsKey(e)&&1===t.videoAdsProtectFlags.get(e))return;console.log("Ads Close callback",s.isEnded),n.AudioMgr.instance.resumeMusic(),s.isEnded?(i&&i(),t.videoAdsProtectFlags.put(e,1)):o&&o(),t.adsRequestTimer=0,t.videoAd.offClose(l)},c=function(e){console.log("Ads load callback",e),a&&a(),t.videoAd.offLoad(c)},u=function(e){console.log("Ads error callback",e.errMsg),t.adsRequestTimer=0,s&&s(e),t.videoAd.offError(u)};t.videoAd=this.videoAdsBuffer.get(e),t.videoAd?(t.videoAd.show().then(function(){return console.log("video show")}).catch(function(t){return console.log("video err",t)}),t.videoAdsBuffer.remove(e),t.videoAdsProtectFlags.put(e,0),console.log("watch ads preloaded")):(t.videoAd=swan.createRewardedVideoAd({adUnitId:e,appSid:this.adSid_}),t.videoAd.load().then(function(){t.videoAd.show().then(function(){return console.log("video show")}).catch(function(t){return console.log("video err",t)}),t.videoAdsProtectFlags.put(e,0)}).catch(function(t){return console.log(t.errMsg)})),t.videoAd.onClose(l),t.videoAd.onLoad(c),t.videoAd.onError(u),r&&r(),n.AudioMgr.instance.pauseMusic()}},t._calBannerPos=function(t,e,i){void 0===i&&(i=1);var o=this.sdkInfo.screenWidth;t&&(o=t);var n=120*(o/300),s=0;if(e){var r=cc.view.getVisibleSize().height,a=e.localToGlobal().y,h=e.height*e.pivotY+60,l=(r-a+h)/r;s=this.sdkInfo.screenHeight*l,console.log("addBanner node",e,l,a,h,r-a,r,s,this.sdkInfo.screenHeight)}else s=this.sdkInfo.screenHeight-n,0==i&&(s=0);return{x:.5*this.sdkInfo.screenWidth-.5*o,y:s,w:o,h:n}},t.addBanner=function(e,i,n,s,r,a,h,l){var c=this;void 0===s&&(s=1),void 0===r&&(r=!1),void 0===a&&(a=""),void 0===h&&(h=null),void 0===l&&(l=5),""!==a&&(this.bannerPreservedMap_.put(e,a),this.preservedIdMap_.put(a,1),null!=h&&this.preservedFailCbMap_.put(a,h));var u=this.replacedIdMap_.get(e);null!=u&&(e=u,o.G.log("replace banner id",u)),r&&this.refreshRuleMap_.put(e,l);var d=this.refreshRuleMap_.get(e)||5,_=this.bannerRefreshCntMap_.get(e)||0;console.log("banner refresh",_,d,e);var p=!1,f=!1;if(d>0&&d<1e3?(f=!(p=_>0&&_<1e3))&&(_=d):d>=1e3&&(_<=1e3&&(f=!0,r&&(_=d)),p=!0),this.bannerAd_&&(this.bannerAd_.hide(),this.bannerAd_=null),n&&this.bannerRuleMap_.containsKey(n.name)?(this.bannerAd_=this.bannerRuleMap_.get(n.name),console.log("rule bannerAd show",n.name)):null==n&&this.bannerNormMap_.containsKey(e)?(this.bannerAd_=this.bannerNormMap_.get(e),console.log("norm bannerAd show",e)):(p=!1,f=!0,console.log("banner no buffer")),p&&!r)return this.bannerAd_.show().then(function(t){console.log("banner show",e)}).catch(function(t){console.log("banner show err",e,t),c.bannerRefreshCntMap_.put(e,--_)}),void this.bannerRefreshCntMap_.put(e,--_);if(f){this.bannerRefreshCntMap_.put(e,--_),n&&n.name&&this.bannerRuleMap_.containsKey(n.name)?(this.bannerAd_=this.bannerRuleMap_.get(n.name),this.delBanner(!0),this.bannerRuleMap_.remove(n.name)):null==n&&this.bannerNormMap_.containsKey(e)&&(this.bannerAd_=this.bannerNormMap_.get(e),this.delBanner(!0),this.bannerNormMap_.remove(e));var g=this._calBannerPos(i,n,s),m=swan.createBannerAd({adUnitId:e,appSid:this.adSid_,style:{left:g.x,top:g.y,width:g.w,height:g.h}});this.bannerAd_=m,r?console.log("banner preload"):this.bannerAd_.show().then(function(t){console.log("banner show",e)}).catch(function(t){console.log("banner show err",t),c.bannerRefreshCntMap_.put(e,--_)});var v=function(a){if(o.G.log("Banner Ads pull failed",a),this.bannerAd_.offError(),this.bannerRefreshCntMap_.put(e,--_),this.preservedIdMap_.containsKey(e)){var h=this.preservedFailCbMap_.get(e);h&&(h(),o.G.log("preserved banner load failed callback"))}else if(this.bannerPreservedMap_.containsKey(e)){var l=this.bannerPreservedMap_.get(e);t.addBanner(l,i,n,s,r),this.replacedIdMap_.put(e,l),o.G.log("preserved banner add",l)}}.bind(this);this.bannerAd_.onError(v),n?this.bannerRuleMap_.put(n.name,m):this.bannerNormMap_.put(e,m),console.log("add banner")}},t.delBanner=function(t){void 0===t&&(t=!1),this.bannerAd_&&(t?(console.log("del banner"),this.bannerAd_.destroy(),this.bannerAd_=null):(this.bannerAd_.hide(),console.log("hide banner")))},t.clearBanner=function(){this.bannerNormMap_.each(function(t,e,i){i&&i.destroy()}),this.bannerNormMap_.clear(),this.bannerRuleMap_.each(function(t,e,i){i&&i.destroy()}),this.bannerRuleMap_.clear(),this.delBanner(!0),console.log("clear all banner")},t.checkVersionUpdate=function(e,i){var n=t.sdkInfo;o.G.log("check version update",n.system);var s=swan.getUpdateManager();s?(s.onCheckForUpdate(function(t){console.log(t.hasUpdate),t.hasUpdate?e&&e():i&&i()}),s.onUpdateReady(function(){t.modalDialog("\u66f4\u65b0\u63d0\u793a","\u65b0\u7248\u672c\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u8bf7\u91cd\u542f\u6e38\u620f",function(){s.applyUpdate()},null,!1)}),s.onUpdateFailed(function(){t.modalDialog("\u66f4\u65b0\u63d0\u793a","\u65b0\u7248\u672c\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u7f51\u7edc\u73af\u5883\u662f\u5426\u826f\u597d\u6216\u8005\u91cd\u542f\u767e\u5ea6",function(){swan.exitMiniProgram({})},null,!1)})):(console.log("no updateManager"),i&&i())},t.modalDialog=function(t,e,i,o,n,s,r,a,h){void 0===n&&(n=!0),void 0===s&&(s="\u53d6\u6d88"),void 0===r&&(r="#000000"),void 0===a&&(a="\u786e\u5b9a"),void 0===h&&(h="#3cc51f"),swan.showModal({title:t,content:e,showCancel:n,cancelText:s,cancelColor:r,confirmText:a,confirmColor:h,success:function(t){t.confirm?i&&i():t.cancel&&o&&o()}})},t.vibrateShort=function(){swan.vibrateShort()},t.vibrateLong=function(){swan.vibrateLong()},t.createRecommendationButton=function(e,i,n,s){void 0===s&&(s=1);var r=t.sdkInfo;if(-1!=t.compareVersion(r.SDKVersion,"1.5.2")&&null!=swan.createRecommendationButton&&!this.recommendBtnMap_.containsKey(e)){var a=cc.view.getVisibleSize().width,h=cc.view.getVisibleSize().height,l=this.sdkInfo.screenWidth,c=this.sdkInfo.screenHeight,u=l/a*i,d=c/h*(h-n);console.log("createRecommendationButton pos",a,h,l,c,u,d);var _=1==s?"carousel":"list",p=swan.createRecommendationButton({style:{left:u,top:d},type:_});p&&(p.onError(function(){o.G.log("BDUtil createRecommendationButton error",1,e)}),this.recommendBtnMap_.put(e,p))}},t.showRecommendationButton=function(t,e,i){var o=this;if(this.recommendBtnMap_.containsKey(t)){var n=this.recommendBtnMap_.get(t);n.onLoad(function(){if(console.log("recommendation button loaded",t),e){var s=cc.view.getVisibleSize().width,r=o.sdkInfo.width/s*e;n.style.left=r}if(i){var a=cc.view.getVisibleSize().height,h=o.sdkInfo.height/a*(a-i);n.style.top=h}n.show(),n.offLoad()}),n.load()}},t.hideRecommendationButton=function(t){this.recommendBtnMap_.containsKey(t)&&this.recommendBtnMap_.get(t).hide()},t.destroyRecommendationButton=function(t){if(this.recommendBtnMap_.containsKey(t)){var e=this.recommendBtnMap_.get(t);e.offError(),e.destroy(),this.recommendBtnMap_.remove(t)}},t.prepareVideoRecord=function(e,i,n,s,r){var a=this,h=t.sdkInfo;-1!=t.compareVersion(h.SDKVersion,"1.4.1")?null==this.recorderMgr_&&null!=swan.getVideoRecorderManager&&(this.recorderMgr_=swan.getVideoRecorderManager(),this.recorderMgr_.onStart(function(t){o.G.log("BDUtil start video record"),e&&e(t.microphoneStatus)}),this.recorderMgr_.onStop(function(t){o.G.log("BDUtil stop video record"),a.tmpRecordPath_=t.videoPath,i&&i()}),this.recorderMgr_.onError(function(t){o.G.log("BDUtil video record error"),n&&n(t.errMsg)}),this.recorderMgr_.onPause(function(){o.G.log("BDUtil pause video record"),s&&s()}),this.recorderMgr_.onResume(function(){o.G.log("BDUtil resume video record"),r&&r()})):t.modalDialog("\u63d0\u793a","\u6682\u4e0d\u652f\u6301\u5f55\u5c4f")},t.startVideoRecord=function(t,e){void 0===t&&(t=30),void 0===e&&(e=!1),this.recorderMgr_&&this.recorderMgr_.start({duration:t,microphoneEnabled:e})},t.pauseVideoRecord=function(){this.recorderMgr_&&this.recorderMgr_.pause()},t.resumeVideoRecord=function(){this.recorderMgr_&&this.recorderMgr_.resume()},t.stopVideoRecord=function(){this.recorderMgr_&&this.recorderMgr_.stop()},t.shareVideo=function(e,i,o,n,s){var r=t.sdkInfo;-1!=t.compareVersion(r.SDKVersion,"1.4.1")&&null!=swan.shareVideo&&swan.shareVideo({videoPath:this.tmpRecordPath_,title:e||"",query:i||"",success:o,fail:n,complete:s})},t.sdkInfo=null,t.domain_="https://login.joyfulh.com/comLogin",t.adSid_="dfc8260c",t.loginCode="",t.normShareTimestamp=0,t.normShareSuccCallback=null,t.normShareFailCallback=null,t.bNormShareCancel=!1,t.adsRequestTimer=0,t.videoAdsBuffer=new s.HDMap,t.videoAd=null,t.videoAdsProtectFlags=new s.HDMap,t.bannerAd_=null,t.bannerRuleMap_=new s.HDMap,t.bannerNormMap_=new s.HDMap,t.bannerPreservedMap_=new s.HDMap,t.preservedFailCbMap_=new s.HDMap,t.preservedIdMap_=new s.HDMap,t.replacedIdMap_=new s.HDMap,t.bannerRefreshCntMap_=new s.HDMap,t.refreshRuleMap_=new s.HDMap,t.recommendBtnMap_=new s.HDMap,t.recorderMgr_=null,t.tmpRecordPath_="",t}();i.BdUtil=l,cc._RF.pop()},{"../game_setting":"game_setting","./audio_mgr":"audio_mgr","./game_storage":"game_storage","./global_def":"global_def","./structure/hd_map":"hd_map","./wx_util":"wx_util"}],bezier:[function(t,e,i){"use strict";cc._RF.push(e,"a78aawEm85CdJ4RhaS10VYI","bezier"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.getPoints=function(t,e){for(var i=[],o=e+1,n=0;n<=o;n++){var s=this._multiPointBezier(t,n/o);i.push(s)}return i},t._multiPointBezier=function(t,e){for(var i=t.length,o=0,n=0,s=0;s<i;s++){var r=t[s];o+=r.x*Math.pow(1-e,i-1-s)*Math.pow(e,s)*this._binomial(i-1,s),n+=r.y*Math.pow(1-e,i-1-s)*Math.pow(e,s)*this._binomial(i-1,s)}return{x:o,y:n}},t._binomial=function(t,e){for(var i=1,o=1;e>0;)i*=t,o*=e,--t,--e;return i/o},t}();i.HDBezier=o,cc._RF.pop()},{}],blocker_ui:[function(t,e,i){"use strict";cc._RF.push(e,"a90feFSucVGOIQah9H0sK7p","blocker_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./base_ui"),s=t("../../util/timed_task"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg_=null,e.rotTrans_=null,e.taskId_=0,e}return o(e,t),e.prototype.init=function(t){t&&(this.com_=t,t.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this.bg_=t.getChild("bg").asImage,this.rotTrans_=t.getTransition("rot"),t.sortingOrder=n.UIHierarchy.kBlocker,t.visible=!1,n.BaseUI.root.addChild(t))},e.prototype.block=function(t,e){var i=this;void 0===t&&(t=3),void 0===e&&(e=!1),this.com_&&(this.com_.visible=!0,this.bg_&&(this.bg_.visible=e),this.rotTrans_.play(null,-1),this.taskId_>0&&(s.TimedTaskMgr.instance.remove(this.taskId_),this.taskId_=0),this.taskId_=s.TimedTaskMgr.instance.add(function(){i.hide()},t))},e.prototype.hide=function(){this.com_&&(this.taskId_>0&&(s.TimedTaskMgr.instance.remove(this.taskId_),this.taskId_=0),this.rotTrans_.stop(),this.com_.visible=!1,this.taskId_=0)},e.instance=new e,e}(n.BaseUI);i.InputBlocker=r,i.InputBlockerInst=r.instance,cc._RF.pop()},{"../../util/timed_task":"timed_task","./base_ui":"base_ui"}],bonus_data:[function(t,e,i){"use strict";cc._RF.push(e,"6b38dIa7PVENZ1lrJM38f9K","bonus_data"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../util/structure/hd_map"),n=t("../util/global_def"),s=function(){return function(){this.val=0,this.prob=0}}(),r=function(){return function(){this.id=0,this.day=0,this.amountBase=0,this.bAmountCal=!1,this.items=[],this.desc=""}}(),a=function(){return function(){this.idRand=[],this.amountRand=[],this.idBase=0,this.bIdCal=!1,this.amountBase=0,this.bAmoutCal=!1}}(),h=function(){return function(){this.id=0,this.count=0,this.items=[]}}(),l=function(){return function(){this.id=0,this.name="",this.res=""}}(),c=function(){function t(){}return t.fetch=function(t){this._parseCategory(t.bonusCategory),this._parseSignInData(t.signInGenRule),this._parseBoxData(t.boxGenRule)},t.getSignInDataGroup=function(t){return this._getDataGroup(this.signInDatMap_,7,t)},t.getBoxDataGroup=function(t){return this._getDataGroup(this.boxDataMap_,3,t)},t.getSignInBonusID=function(t){var e=0;if(this.signInDatMap_.containsKey(t)){var i=this.signInDatMap_.get(t);if(i.items.length>0)if(1==i.items.length)e=i.items[0].val;else for(var o=0,s=0,r=n.G.randRange(0,100),a=0;a<i.items.length;++a){if(r<=(s+=i.items[a].prob)&&r>o){e=i.items[a].val;break}o+=i.items[a].prob}}return e},t.getSignInBonusAmount=function(t,e){var i=0;if(this.signInDatMap_.containsKey(t)){var o=this.signInDatMap_.get(t);i=o.bAmountCal&&e?e(o.amountBase):o.amountBase}return i},t.getBoxBonusID=function(t,e){return this._calBoxBonusVal(t.idRand,t.idBase,t.bIdCal,e)},t.getBoxBonusAmount=function(t,e){return this._calBoxBonusVal(t.amountRand,t.amountBase,t.bAmoutCal,e)},t.getBonusCategoryData=function(t){var e=null;return this.categoryMap_.containsKey(t)&&(e=this.categoryMap_.get(t)),e},t._getDataGroup=function(t,e,i){var o=[],n=t.size();if(n>0){for(;i*e>n-1;)--i;var s=0;for((o=t.values(i*e,e)).length;o.length<e;)o.push(o[s]),++s>=o.length&&(s=0)}return o},t._calBoxBonusVal=function(t,e,i,o){var s=0;if(0==t.length)s=i&&o?o(e):e;else if(1==t.length)s=t[0].val;else for(var r=0,a=0,h=n.G.randRange(0,100),l=0;l<t.length;++l){if(h<=(a+=t[l].prob)&&h>r){s=t[l].val;break}r+=t[l].prob}return s},t._parseSignInData=function(e){if(e)for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],n=new r;n.id=parseInt(i),n.day=o.day;var s=this._parseFuncGrammar(o.amount);n.amountBase=s.base,n.bAmountCal=s.bCal,n.items=this._parseRandGrammar(o.bid),n.desc=o.desc,t.signInDatMap_.put(n.id,n)}},t._parseBoxData=function(e){var i=this;if(e){var o=function(t,e,o){var n=new a;if(""!==t)if(i._isFuncGrammar(t)){var s=i._parseFuncGrammar(t);n.idBase=s.base,n.bIdCal=s.bCal}else i._isRandGrammar(t)?n.idRand=i._parseRandGrammar(t):n.idBase=Number(t);if(""!==e)if(i._isFuncGrammar(e)){s=i._parseFuncGrammar(e);n.amountBase=s.base,n.bAmoutCal=s.bCal}else i._isRandGrammar(e)?n.amountRand=i._parseRandGrammar(e):n.amountBase=Number(e);(n.idBase>0||n.idRand.length>0||n.amountBase>0||n.amountRand.length>0)&&o.push(n)};for(var n in e)if(e.hasOwnProperty(n)){var s=e[n],r=new h;r.id=parseInt(n),r.count=s.count,o(s.bid1,s.num1,r.items),o(s.bid2,s.num2,r.items),o(s.bid3,s.num3,r.items),t.boxDataMap_.put(r.id,r)}}},t._parseCategory=function(e){if(e)for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],n=new l;n.id=parseInt(i),n.name=o.name,n.res=o.res,t.categoryMap_.put(n.id,n)}},t._isFuncGrammar=function(t){return"string"==typeof t&&-1!=t.indexOf("f")},t._isRandGrammar=function(t){return"string"==typeof t&&-1!=t.indexOf(",")},t._parseFuncGrammar=function(t){var e={base:0,bCal:!1};if("string"==typeof t&&-1!=t.indexOf("f")){var i=t.indexOf("("),o=t.indexOf(")");if(-1!=i&&-1!=o){var n=t.substring(i+1,o);e.base=Number(n),e.bCal=!0}else e.base=1,e.bCal=!1}else e.base=Number(t);return e},t._parseRandGrammar=function(t){var e=[];if("string"==typeof t&&-1!=t.indexOf(",")){for(var i=0,o=0,n=t.indexOf(","),r=-1!=n?2:0;r>0;){var a=new s,h=-1!=n?t.substring(0,n):t,l=h.indexOf(":");if(-1!=l){var c=h.substring(0,l);if(a.val=Number(c),i<100){var u=h.substring(l+1);if(a.prob=Number(u),(i+=a.prob)>100){var d=i-100;a.prob-=d,a.prob<0&&(a.prob=0)}}else a.prob=0}else a.val=Number(h),a.prob=-1,++o;--r,-1!=n&&-1!=(n=(t=t.substring(n+1)).indexOf(","))&&++r,e.push(a)}if(i<100){var _=100-i;if(o>0){for(var p=_/o,f=0;f<e.length;++f)-1==e[f].prob&&(e[f].prob=p);e[e.length-1].prob+=1e-7}else e[e.length-1].prob+=_}}else{(a=new s).val=Number(t),a.prob=100,e[0]=a}return e},t.signInDatMap_=new o.HDMap,t.boxDataMap_=new o.HDMap,t.categoryMap_=new o.HDMap,t}();i.BonusData=c,cc._RF.pop()},{"../util/global_def":"global_def","../util/structure/hd_map":"hd_map"}],buff_data:[function(t,e,i){"use strict";cc._RF.push(e,"1c20fwKUwFHSaAlvxko6vrR","buff_data"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../util/global_def"),n=t("../util/structure/hd_map"),s=function(){return function(){this.id=0,this.desc="",this.effect=0,this.incr=0,this.owner=0}}();i.BuffInfo=s;var r=function(){function t(){}return t.fetch=function(e){null==t.itemMap_&&(t.itemMap_=new n.HDMap),t._parseData(e)},t.getDataById=function(e){return t.itemMap_.get(e)},t._parseData=function(e){if(!o.G.isEmptyObj(e))for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=new s;r.id=parseInt(i),r.desc=n.desc,r.effect=n.effect,r.incr=n.incr,r.owner=n.owner,t.itemMap_.put(r.id,r)}},t.itemMap_=null,t}();i.BuffData=r,cc._RF.pop()},{"../util/global_def":"global_def","../util/structure/hd_map":"hd_map"}],buff:[function(t,e,i){"use strict";cc._RF.push(e,"d8987rHfZBPGJnhIrfz2uhO","buff"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../data/buff_data"),s=t("../util/structure/hd_map");(function(t){t[t.kNone=0]="kNone",t[t.kStart=1]="kStart",t[t.kFlying=2]="kFlying",t[t.kHard=3]="kHard",t[t.kStrong=4]="kStrong",t[t.kFaster=5]="kFaster",t[t.kRush=6]="kRush",t[t.kEnd=7]="kEnd"})(o=i.BuffType||(i.BuffType={})),i.kMaxLv=20;var r=function(){function t(){this.type=o.kNone,this.desc="",this.effect=0,this.lastLv_=0}return t.prototype.init=function(t,e){if(this.lastLv_!=e){var o=n.BuffData.getDataById(t);o&&(this.type=o.id,e<1?e=1:e>i.kMaxLv&&(e=i.kMaxLv),this.effect=o.effect+o.incr*(e-1),this.desc=o.desc.replace("@",this.effect.toString())),this.lastLv_=e}},t.prototype.upgrade=function(t){this.init(this.type,t)},t}();i.Buff=r;var a=function(){function t(){this.buffMap_=new s.HDMap,this.bCreated_=!1}return t.prototype.create=function(){if(!this.bCreated_){for(var t=o.kNone+1;t<o.kEnd;++t){var e=new r;e.init(t,1),this.buffMap_.put(t,e)}this.bCreated_=!0}},t.prototype.get=function(t,e){var i=null;return this.buffMap_.containsKey(t)&&(i=this.buffMap_.get(t)).upgrade(e),i},t.instance=new t,t}();i.BuffMgr=a,cc._RF.pop()},{"../data/buff_data":"buff_data","../util/structure/hd_map":"hd_map"}],data_hub:[function(t,e,i){"use strict";cc._RF.push(e,"0fba8pPIztJvpHFywCQ0fNU","data_hub"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../util/global_def"),n=t("../util/network/http_req"),s=t("../game_setting"),r=t("./bonus_data"),a=function(){function t(){}return Object.defineProperty(t,"getMessage",{get:function(){return this.message.sh[o.G.randRange(0,this.message.sh.length-1)]},enumerable:!0,configurable:!0}),t.loadBackendConfig=function(){var e=this;console.log("[DataHub] version:",t.version,"minigame plat:",o.G.isMinigamePlat),o.G.isTMSDK?console.log("[DataHub] TMSDK is actived"):n.HttpRequest.getShareTitle(function(t){if(t&&t.res){for(var i=JSON.parse(t.res),o=0;o<i.sh.length;++o){var n=JSON.parse(i.sh[o]);n.img="https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/Shared/"+s.GameSetting.proName+"/"+n.img,i.sh[o]=n}e.message=i,console.log("getShareTitle",e.message)}}),n.HttpRequest.getFuncSwitch(this.version,function(t){if(t&&t.res){var i=JSON.parse(t.res);e.config.chk=parseInt(i.chk),e.config.adChk=parseInt(i.adChk),e.config.export=parseInt(i.export),e.config.bnrGap=parseInt(i.bnrGap),e.config.bnrRefresh=parseInt(i.bnrRefresh),e.config.videoBonus=parseInt(i.videoBonus),e.config.bnrJumpProb=parseInt(i.bnrJumpProb),e.config.bnrClickCD=parseInt(i.bnrClickCD),e.config.bnrClickSucTime=parseInt(i.bnrClickSucTime),e.config.bnrClickCnt=parseInt(i.bnrClickCnt),e.config.forceNavProb=parseInt(i.forceNavProb),1===e.config.chk&&(e.config.v2sh=0,e.config.adChk=1),1===e.config.adChk&&(e.config.bnrGap=40,e.config.bnrJumpProb=0,e.config.videoBonus=0,e.config.fakeBnrShow=1),console.log("getFuncSwitch",e.config),i&&n.HttpRequest.checkIP(function(t){var i=t.res;i>0?(2!==i&&(e.config.v2sh=0,e.config.sh2v=0,1!==e.config.chk&&e.config.bnrGap<25&&(e.config.bnrGap=25),e.config.videoBonus=0,e.config.bnrJumpProb=0,e.config.fakeBtnClick=0),e.config.forceNavProb=0,2===e.config.export&&(1!==i?(e.config.export=0,e.config.forceFakePageProb=0):e.config.export=1)):e.config.fakeBnrShow=1,console.log("ipBlock",i)},function(){2===e.config.export&&(e.config.export=0)})}})},t.loadJson=function(){var t=this;o.G.readJson("main_pack/data/bonus_dat",function(e){r.BonusData.fetch(e),t.bJsonLoaded=!0})},t.version=window.g_gameVersion||"1.0.0",t.config={export:1,sh2v:0,chk:0,adChk:0,bnrGap:15,bnrRefresh:4,videoBonus:100,bnrJumpProb:100,bnrClickCD:10,bnrClickSucTime:30,bnrClickCnt:4,forceNavProb:0,fakeBnrShow:1,fakeBtnClick:100,forceFakePageProb:50,directAward:0,v2sh:1,exportPageTypeProb:50},t.message={sh:[{title:"\u5206\u4eab\u6807\u9898\uff0c\u8bf7\u81ea\u884c\u4fee\u6539",img:"https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/Shared/test/sh1.png"}]},t.bJsonLoaded=!1,t}();i.DataHub=a,cc._RF.pop()},{"../game_setting":"game_setting","../util/global_def":"global_def","../util/network/http_req":"http_req","./bonus_data":"bonus_data"}],dialog_ui:[function(t,e,i){"use strict";cc._RF.push(e,"c769b3s4phB5J7l14K1MQOS","dialog_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./base_ui"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.titleLbl_=null,e.contentLbl_=null,e.confirmBtn_=null,e.closeBtn_=null,e.showTrans_=null,e.closeTrans_=null,e.yesCallback_=null,e.noCallback_=null,e}return o(e,t),e.prototype.init=function(t){t&&(this.com_=t,t.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this.titleLbl_=t.getChild("titleLbl").asTextField,this.contentLbl_=t.getChild("contentLbl").asTextField,this.confirmBtn_=t.getChild("confirmBtn").asButton,this.closeBtn_=t.getChild("closeBtn").asButton,this.showTrans_=t.getTransition("showTrans"),this.closeTrans_=t.getTransition("closeTrans"),t.sortingOrder=n.UIHierarchy.kDialog,t.visible=!1,n.BaseUI.root.addChild(t))},e.prototype.show=function(t,e,i,o,n){var s=this;void 0===n&&(n=!1),this.com_&&(this.com_.visible=!0,this.titleLbl_.text=t,this.contentLbl_.text=e,this.bLock_=!0,this.showTrans_.play(function(){s.bLock_=!1}),this.confirmBtn_.onClick(this._onConfirm,this),this.closeBtn_.onClick(this._onClose,this),this.yesCallback_=i,this.noCallback_=o,this.closeBtn_.visible=!n)},e.prototype.reset=function(){this.com_&&(this.bLock_=!1,this.com_.visible=!1,this.confirmBtn_.offClick(this._onConfirm,this),this.closeBtn_.offClick(this._onClose,this),this.com_.sortingOrder!=n.UIHierarchy.kDialog&&this.renderSortOriginal())},e.prototype.renderSortTop=function(){this.com_&&(this.com_.sortingOrder=n.UIHierarchy.kTip)},e.prototype.renderSortOriginal=function(){this.com_&&(this.com_.sortingOrder=n.UIHierarchy.kDialog)},e.prototype._onConfirm=function(){this.bLock_||(this.yesCallback_&&this.yesCallback_(),this.bLock_=!0,this.closeTrans_.play(this.reset.bind(this)))},e.prototype._onClose=function(){this.bLock_||(this.noCallback_&&this.noCallback_(),this.bLock_=!0,this.closeTrans_.play(this.reset.bind(this)))},e.instance=new e,e}(n.BaseUI);i.DialogUI=s,i.DialogUIInst=s.instance,cc._RF.pop()},{"./base_ui":"base_ui"}],event_mgr:[function(t,e,i){"use strict";cc._RF.push(e,"cb4511woHpOZ6FgmZCneWh7","event_mgr"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./structure/hd_map"),s=t("./global_def");(function(t){t[t.kNone=0]="kNone",t[t.kAudioPause=1]="kAudioPause",t[t.kAudioResume=2]="kAudioResume",t[t.kBnrAdBrowerSim=3]="kBnrAdBrowerSim",t[t.kAdjustVfxLv=4]="kAdjustVfxLv",t[t.kOpenFreeBox=5]="kOpenFreeBox",t[t.kLeaveHome=6]="kLeaveHome",t[t.kRedPoint=7]="kRedPoint"})(o=i.EventType||(i.EventType={}));var r=function(){function t(){this.type_=o.kNone,this.id_=0,this.sender_=null,this.data_=null}return t.prototype.init=function(t,e,i,o){this.id_=t,this.type_=e,this.sender_=i,this.data_=o},Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.id_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this.sender_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this.data_},enumerable:!0,configurable:!0}),t}(),a=function(){function t(){this.id_=0,this.callback_=null,this.bExe=!1}return Object.defineProperty(t.prototype,"id",{get:function(){return this.id_},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e){this.id_=t,this.callback_=e},t.prototype.excute=function(t,e){this.bExe=!0,this.callback_&&this.callback_(t,e),this.bExe=!1},t}(),h=function(){function t(){this.baseEvtId_=0,this.baseListenerId_=0,this.listenerMap_=null,this.persistListnerMap_=null,this.delMap_=new n.HDMap,this.evtLst_=null,this.bExe_=!1}return t.prototype.init=function(){this.baseEvtId_=0,this.baseListenerId_=0,null==this.listenerMap_&&(this.listenerMap_=new n.HDMap),this.listenerMap_.clear(),null==this.persistListnerMap_&&(this.persistListnerMap_=new n.HDMap),this.persistListnerMap_.clear(),null==this.evtLst_&&(this.evtLst_=new Array),this.evtLst_=[],this.bExe_=!1},t.prototype.addEvent=function(t,e,i,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=!0),++this.baseEvtId_;var n=new r;if(n.init(this.baseEvtId_,t,e,i),o){var s=this.listenerMap_.get(t);if(null!=s)for(var a=0;a<s.length;++a)s[a].excute(n.sender,n.data)}else this.bExe_=!0,this.evtLst_.push(n)},t.prototype.addListener=function(t,e,i){void 0===i&&(i=!1),++this.baseListenerId_;var o=new a;o.init(this.baseListenerId_,e);var n=null;return this.listenerMap_.containsKey(t)?null!=(n=this.listenerMap_.get(t))&&n.push(o):((n=new Array).push(o),this.listenerMap_.put(t,n)),i&&n&&this.persistListnerMap_.put(t,n),this.baseListenerId_},t.prototype.removeListener=function(t,e){if(this.listenerMap_.containsKey(t)){var i=this.listenerMap_.get(t);if(null!=i){for(var o=0;o<i.length;++o){if(!i[o].bExe&&i[o].id===e){i.splice(o,1);break}i[o].bExe&&(this.delMap_.put(t,e),this.bExe_=!0)}0==i.length&&(this.listenerMap_.remove(t),this.persistListnerMap_.containsKey(t)&&this.persistListnerMap_.remove(t))}}},t.prototype.clear=function(){var t=this;this.evtLst_=[];var e=[];this.listenerMap_.each(function(i,o,n){t.persistListnerMap_.containsKey(o)||e.push(o)});for(var i=0;i<e.length;++i)this.listenerMap_.remove(e[i]);this.delMap_.clear()},t.prototype.excuteEvents=function(){var t=this;if(this.bExe_){for(var e=0;e<this.evtLst_.length;++e){var i=this.evtLst_[e];if(null==i){s.G.log("can not find the approriate game event",3);break}var o=this.listenerMap_.get(i.type);if(o)for(var n=0;n<o.length;++n)o[n].excute(i.sender,i.data);else s.G.log("Can not find the listeners about event ",2,i.type.toString())}this.delMap_.size()>0&&(this.delMap_.each(function(e,i,o){t.removeListener(i,o)}),this.delMap_.clear()),this.evtLst_=[],this.bExe_=!1}},t.instance=new t,t}();i.GameEventMgr=h,i.GameEventMgrInst=h.instance,cc._RF.pop()},{"./global_def":"global_def","./structure/hd_map":"hd_map"}],export_ui:[function(t,e,i){"use strict";cc._RF.push(e,"65993isWHhGnrlYq+kQQCxV","export_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n,s=t("./base_ui"),r=t("../../util/structure/hd_map"),a=t("../../util/global_def"),h=t("../../HDSDK"),l=t("../../data/data_hub"),c=t("./tip_ui"),u=t("./dialog_ui"),d=t("../../util/game_storage"),_=t("../../util/audio_mgr"),p=t("../../util/mgp_util"),f=t("../../game/user_info"),g=t("../../util/timed_task");(function(t){t[t.kNone=0]="kNone",t[t.kPop=1]="kPop",t[t.kFade=2]="kFade",t[t.kSpring=3]="kSpring",t[t.kShake=4]="kShake"})(n=i.ExportTransType||(i.ExportTransType={}));var m=function(){function t(){}return t.kSL1="singleL1",t.kSL2="singleL2",t.kSR1="singleR1",t.kSR2="singleR2",t.kHomeNS="homeNB",t.kFake="fakeBtn",t.kGSR1="gsR1",t.kGSR2="gsR2",t.kHT="horTop",t.kHB="horBtm",t.kResultNS="resNS",t.kFP="foldPage",t.kPop="pop",t.kLike="like",t}();i.ExportUIName=m;var v=function(){function t(){}return t.kFold="1088929",t.kPage="1088828",t.kHT="1088727",t.kLike="1088626",t.kSingles="1086404",t.kForce="1089333",t.kCancel="1092262",t}();i.ExportTmID=v;var y=function(){function t(){}return t.kHS4="homeSingle4",t.kHomeAll="homeAll",t.kGS2="gameSingle2",t.kGameAll="gameAll",t}();i.ExportGroupName=y;var b=function(){function t(){}return t.addMembers=function(t,e){this.exportUI_||(this.exportUI_=C.instance);var i=[];this.grpMap_.containsKey(t)&&(i=this.grpMap_.get(t));for(var o=0;o<e.length;++o)i.push(e[o]);i=a.G.uniqueArray(i),this.grpMap_.containsKey(t)||this.grpMap_.put(t,i)},t.showMembers=function(t,e){if(void 0===e&&(e=""),this.exportUI_&&this.grpMap_.containsKey(t)){for(var i=this.grpMap_.get(t),o=0;o<i.length;++o)this.exportUI_.show(i[o],e,!1);0}},t.showMembersTM=function(t,e){if(this.exportUI_&&this.grpMap_.containsKey(t))for(var i=this.grpMap_.get(t),o=0;o<i.length;++o)this.exportUI_.showTM(i[o],e)},t.hideMembers=function(t){if(this.exportUI_&&this.grpMap_.containsKey(t))for(var e=this.grpMap_.get(t),i=0;i<e.length;++i)this.exportUI_.hide(e[i])},t.grpMap_=new r.HDMap,t.exportUI_=null,t}();i.ExportGroup=b;var C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normArr_=[],e.bnrArr_=[],e.navObjMap_=new r.HDMap,e.forceNavDatArr_=[],e.forceFixedNavDatArr_=[],e.usedForceNavIds_=[],e.usedNavIdCntMap_=new r.HDMap,e.singleNavArr_=[],e.singleBnrArr_=[],e.rcShowArr_=[],e.vPage_=null,e.hPage_=null,e.vGrid_=null,e.vFakePage_=null,e.invitePage_=null,e.showPageCb_=null,e.hidePageCb_=null,e.bnrShowId_="",e.block_=null,e.blockBg_=null,e.blockClickCb_=null,e.loadQue_=[],e.loadInfoMap_=new r.HDMap,e.loadInfoCompleteMap_=new r.HDMap,e.currLoadInfo_=null,e.tmSingleLoadMap_=new r.HDMap,e.tmSingleLoadRecMap_=new r.HDMap,e.tmSingleLoadDelay_=1,e.tmSingleLoadCnt_=0,e.normDatIdx_=0,e.bnrDatIdx_=0,e.fetchTimer_=0,e.checkTimer_=0,e.preloaderTimer_=0,e.updCheckCnt_=0,e.fetchCheckCnt_=0,e.cx_=0,e.cy_=0,e.bUpdCheck_=!1,e.bFetchedData_=!1,e.bInited_=!1,e.bPreload_=!1,e.bLockShow_=!1,e.bForceFakePage_=!1,e.tmPageDefaultPosId_="",e}return o(e,t),Object.defineProperty(e.prototype,"defaultPageTmID",{set:function(t){this.tmPageDefaultPosId_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normNavDataIndex",{get:function(){return this.normDatIdx_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normNavData",{get:function(){return this.normArr_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getForceNavData",{get:function(){var t=null;if(this.forceNavDatArr_.length>0&&a.G.randRange(0,100)<=l.DataHub.config.forceNavProb){var e=a.G.randRange(0,this.forceNavDatArr_.length-1);t=this.forceNavDatArr_[e]}return t},enumerable:!0,configurable:!0}),e.prototype.forceNavCancelRecord=function(t){var e=0,i=t.appId;this.usedNavIdCntMap_.containsKey(i)?(e=this.usedNavIdCntMap_.get(i),++e,this.usedNavIdCntMap_.put(i,e)):(this.usedNavIdCntMap_.put(i,1),e=1);var o=0;if(t.extra&&(o=t.extra.force?parseInt(t.extra.force):1),e>=o){for(var n=0;n<this.forceNavDatArr_.length;++n)if(t.appId===this.forceNavDatArr_[n].appId){this.forceNavDatArr_.splice(n,1);break}this.usedForceNavIds_.push(i)}this._saveForceNavIds()},e.prototype.forcePopFakePage=function(t){this.forcePopFakePageTM("",t)},e.prototype.forcePopFakePageTM=function(t,e){this.vFakePage_&&!this.bForceFakePage_&&a.G.randRange(0,100)<=l.DataHub.config.forceFakePageProb?(a.G.isTMSDK?this.vFakePage_.showTM(t):this.vFakePage_.show("\u968f\u673a\u5f3a\u5f39\u5047\u5fae\u4fe1\u9875"),this.bForceFakePage_=!0):(this.bForceFakePage_=!1,e&&e())},Object.defineProperty(e.prototype,"getFixedForceNavDatArr",{get:function(){var t=null;if(this.forceFixedNavDatArr_.length>0){var e=a.G.randRange(0,this.forceFixedNavDatArr_.length-1);t=this.forceFixedNavDatArr_[e]}return t},enumerable:!0,configurable:!0}),e.prototype.forceNavForTMSDK=function(t,e,i){var o=this;a.G.randRange(0,100)<=l.DataHub.config.forceNavProb?wx.tmSDK.getFlowConfig({positionId:t}).then(function(n){if(console.log("[ExportUI TMSDK] force ad pos active: ",t,n.isOpen),n.isOpen&&n.creatives.length>0){var s=n.creatives[a.G.randRange(0,n.creatives.length-1)];o.navigateTM(s.positionId,s.creativeId,null,e,i)}else i&&i()}):i&&i()},e.prototype.init=function(){var t=cc.view.getVisibleSize().height>cc.view.getVisibleSize().width,e=t?"VMainPnl":"HMainPnl",i=fgui.UIPackage.createObject("HDSDK",e).asCom;i&&(this.com_=i,i.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this.cx_=.5*i.width,this.cy_=.5*i.height,t?(this.vPage_=new $,this.vGrid_=new nt):this.hPage_=new tt,this.invitePage_=new st,i.sortingOrder=s.UIHierarchy.kExportCom,s.BaseUI.root.addChild(i),this.block_=i.getChild("block").asCom,this.blockBg_=this.block_.getChild("bg").asImage,this.block_.visible=!1,this.bInited_=!0)},e.prototype.update=function(t){if(this.bInited_){this.bUpdCheck_||(a.G.isTMSDK?this.bUpdCheck_=!0:(this.bFetchedData_||this._fetchChecker(t),this._checkUpdate(t))),a.G.isTMSDK&&(++this.tmSingleLoadCnt_,this.tmSingleLoadCnt_>=this.tmSingleLoadDelay_&&this.tmSingleLoadMap_.size()>0&&(this.tmSingleLoadMap_.each(this._tmLoadCallback.bind(this)),this.tmSingleLoadCnt_=0,this.tmSingleLoadDelay_<21600&&(this.tmSingleLoadDelay_*=2)));for(var e=0;e<this.singleNavArr_.length;++e){if(this.singleNavArr_[e].update(t))(i=this._getNextNormNavDat())&&this.singleNavArr_[e].updateInfo(i)}for(e=0;e<this.singleBnrArr_.length;++e){var i;if(this.singleBnrArr_[e].update(t))(i=this._getNextBnrNavDat())&&this.singleBnrArr_[e].updateInfo(i)}for(e=0;e<this.rcShowArr_.length;++e)this.rcShowArr_[e].update(t);this.vPage_?this.vPage_.update(t):this.hPage_&&this.hPage_.update(t),this.vGrid_&&this.vGrid_.update(t)}},e.prototype.getRelativeXY=function(t){var e=new cc.Vec2;return e=s.BaseUI.root.localToGlobal(t.x,t.y,e),e=this.com_.globalToLocal(e.x,e.y,e)},e.prototype.getCenterXY=function(){return{x:this.cx_,y:this.cy_}},e.prototype.block=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=null),this.block_.visible=!0,this.blockBg_.visible=t,e&&(this.blockClickCb_=e,this.block_.onClick(this._onBlockClick,this))},e.prototype.unblock=function(){this.block_.visible=!1},e.prototype.initPage=function(){this.vPage_?this.vPage_.init(this.normArr_,this.com_):this.hPage_&&this.hPage_.init(this.normArr_,this.bnrArr_,this.com_),this.vGrid_&&this.vGrid_.init(this.normArr_,this.com_),this.invitePage_&&this.invitePage_.init(this.normArr_,this.com_)},e.prototype.bindFakeCloseButton=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=!0),this.navObjMap_.containsKey(t))a.G.warn("[ExportUI bindFakeCloseButton] no need to bind repetitive nav object");else{var o=(e||this.com_).getChild(t);if(o){e&&(o.removeFromParent(),this.com_.addChild(o));var n=new w(o.asCom);if(this.vFakePage_||(this.vFakePage_=new et,this.vFakePage_.init(this.normNavData,this.com_)),a.G.isMinigamePlat&&i){var s=p.MgpUtil.convertMenuButtonRect(0,o.height+10);o.setPosition(s.x,s.y),o.setSize(s.w,s.h)}this.navObjMap_.put(t,n)}else a.G.warn("[ExportUI bindFakeCloseButton] not find component >",t)}},e.prototype.bindMoreGameButton=function(t,e,i,o){if(void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=!0),this.navObjMap_.containsKey(t))a.G.warn("[ExportUI bindMoreGameButton] no need to bind repetitive nav object");else{var n=(e||this.com_).getChild(t);if(n){e&&o&&(n.removeFromParent(),this.com_.addChild(n));var s=new S(n.asCom);i>0&&s.playTrans(i),this.navObjMap_.put(t,s)}else a.G.warn("[ExportUI bindMoreGameButton] not find component >",t)}},e.prototype.bindSingle=function(t,e,i,o,s,r,l,c){if(void 0===e&&(e=null),void 0===i&&(i=n.kNone),void 0===o&&(o=null),void 0===s&&(s=null),void 0===r&&(r=5),void 0===l&&(l=5),void 0===c&&(c=!0),this.navObjMap_.containsKey(t))a.G.warn("[ExportUI bindSingle] no need to bind repetitive nav object");else{var u=(e||this.com_).getChild(t);if(u){e&&(u.removeFromParent(),this.com_.addChild(u));var d=new k(u.asCom),_=null;(_=a.G.isTMSDK?new h.HDNavData:this._getNextNormNavDat())&&(d.init(_),d.appendExtraFunc(o,s,i,r,l),this.navObjMap_.put(t,d),this.singleNavArr_.push(d))}else a.G.warn("[ExportUI bindSingle] not find component >",t)}},e.prototype.bindSingleEx=function(t,e,i,o,s,r,l,c,u,d){if(void 0===e&&(e=null),void 0===i&&(i=n.kNone),void 0===o&&(o=null),void 0===s&&(s=null),void 0===r&&(r=5),void 0===l&&(l=5),void 0===c&&(c="#000000"),void 0===u&&(u=!0),void 0===d&&(d=!1),this.navObjMap_.containsKey(t))a.G.warn("[ExportUI bindSingleEx] no need to bind repetitive nav object");else{var _=(e||this.com_).getChild(t);if(_){e&&(_.removeFromParent(),this.com_.addChild(_));var p=new M(_.asCom),f=null;(f=a.G.isTMSDK?new h.HDNavData:this._getNextNormNavDat())&&(p.init(f,u,c,d),p.appendExtraFunc(o,s,i,r,l),this.navObjMap_.put(t,p),this.singleNavArr_.push(p))}else a.G.warn("[ExportUI bindSingleEx] not find component >",t)}},e.prototype.bindBanner=function(t,e,i,o,s,r,h,l){if(void 0===e&&(e=null),void 0===i&&(i=n.kNone),void 0===o&&(o=null),void 0===s&&(s=null),void 0===r&&(r=5),void 0===h&&(h=5),void 0===l&&(l=!0),this.navObjMap_.containsKey(t))a.G.warn("[ExportUI bindBanner] no need to bind repetitive nav object");else{var c=(e||this.com_).getChild(t);if(c){e&&(c.removeFromParent(),this.com_.addChild(c));var u=new O(c.asCom),d=this._getNextBnrNavDat();d&&(u.init(d),u.appendExtraFunc(o,s,i,r,h),this.navObjMap_.put(t,u),this.singleBnrArr_.push(u))}else a.G.warn("[ExportUI bindBanner] not find component >",t)}},e.prototype.bindButton=function(t,e,i,o,s,r,h){if(void 0===e&&(e=null),void 0===i&&(i=n.kNone),void 0===o&&(o=null),void 0===s&&(s=null),void 0===r&&(r=5),void 0===h&&(h=5),this.navObjMap_.containsKey(t))a.G.warn("[ExportUI bindButton] no need to bind repetitive nav object");else{var l=(e||this.com_).getChild(t);if(l){var c=new A(l.asCom),u=this._getNextNormNavDat();u&&(c.init(u),c.appendExtraFunc(o,s,i,r,h),this.navObjMap_.put(t,c),this.singleNavArr_.push(c))}else a.G.warn("[ExportUI bindBanner] not find component >",t)}},e.prototype.bindRCScroll=function(t,e,i,o,s,r,h,l,c,u,d){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===r&&(r=n.kNone),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=5),void 0===u&&(u=!0),void 0===d&&(d=2),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindRCScroll] no need to bind repetitive nav object"):this._genRCScroll(t,e,i,o,s,!1,"",r,h,l,c,u,d)},e.prototype.bindRCScrollEx=function(t,e,i,o,s,r,h,l,c,u,d,_,p){void 0===e&&(e=null),void 0===i&&(i=-10),void 0===o&&(o=0),void 0===s&&(s=0),void 0===r&&(r=""),void 0===h&&(h=n.kNone),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=5),void 0===d&&(d=!0),void 0===_&&(_=2),void 0===p&&(p=!0),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindRCScroll] no need to bind repetitive nav object"):this._genRCScroll(t,e,i,o,s,!0,r,h,l,c,u,d,_,p)},e.prototype.bindGuessLike=function(t,e,i,o,s,r,h,l){void 0===e&&(e=null),void 0===i&&(i=10),void 0===o&&(o=0),void 0===s&&(s=""),void 0===r&&(r=null),void 0===h&&(h=null),void 0===l&&(l=2),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindGuessLike] no need to bind repetitive nav object"):this._genRCScroll(t,e,0,i,o,!0,s,n.kNone,r,h,-1,!1,2,!1,!0)},e.prototype.bindVerDualCol=function(t,e,i,o,s,r,h,l,c,u){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=5),void 0===r&&(r=n.kNone),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=5),void 0===u&&(u=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindVerDualCol] no need to bind repetitive nav object"):this._genVD(t,e,i,o,!1,"",s,r,h,l,c,u)},e.prototype.bindVerDualColEx=function(t,e,i,o,s,r,h,l,c,u,d){void 0===e&&(e=null),void 0===i&&(i=-15),void 0===o&&(o=0),void 0===s&&(s=""),void 0===r&&(r=5),void 0===h&&(h=n.kNone),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=5),void 0===d&&(d=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindVerDualColEx] no need to bind repetitive nav object"):this._genVD(t,e,i,o,!0,s,r,h,l,c,u,d)},e.prototype.bindGrid2x4=function(t,e,i,o,s,r,h,l,c,u,d){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=5),void 0===r&&(r=n.kNone),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=5),void 0===u&&(u=!0),void 0===d&&(d=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindGrid2x4] no need to bind repetitive nav object"):this._genGrid(t,e,2,4,i,o,0,!1,"",r,h,l,c,d,u,s)},e.prototype.bindGrid2x4Ex=function(t,e,i,o,s,r,h,l,c,u,d,_){void 0===e&&(e=null),void 0===i&&(i=-10),void 0===o&&(o=0),void 0===s&&(s=""),void 0===r&&(r=5),void 0===h&&(h=n.kNone),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=5),void 0===d&&(d=!0),void 0===_&&(_=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindGrid2x4Ex] no need to bind repetitive nav object"):this._genGrid(t,e,2,4,i,o,0,!0,s,h,l,c,u,_,d,r)},e.prototype.bindGrid2x3Ex=function(t,e,i,o,s,r,h,l,c,u,d,_,p){void 0===e&&(e=null),void 0===i&&(i=-10),void 0===o&&(o=0),void 0===s&&(s=""),void 0===r&&(r=5),void 0===h&&(h=n.kNone),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=5),void 0===d&&(d=!0),void 0===_&&(_=!1),void 0===p&&(p=!0),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindGrid2x4Ex] no need to bind repetitive nav object"):this._genGrid(t,e,2,3,i,o,0,!0,s,h,l,c,u,_,d,r,!0,p)},e.prototype.bindGrid3x3=function(t,e,i,o,s,r,h,l,c,u,d){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=5),void 0===r&&(r=n.kNone),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=5),void 0===u&&(u=!0),void 0===d&&(d=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindGrid3x3] no need to bind repetitive nav object"):this._genGrid(t,e,3,3,i,o,0,!1,"",r,h,l,c,d,u,s)},e.prototype.bindGrid3x3Ex=function(t,e,i,o,s,r,h,l,c,u,d,_){void 0===e&&(e=null),void 0===i&&(i=-10),void 0===o&&(o=0),void 0===s&&(s=""),void 0===r&&(r=5),void 0===h&&(h=n.kNone),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=5),void 0===d&&(d=!0),void 0===_&&(_=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindGrid3x3Ex] no need to bind repetitive nav object"):this._genGrid(t,e,3,3,i,o,0,!0,s,h,l,c,u,_,d,r)},e.prototype.bindPop3x3=function(t,e,i,o,s,r,h,l,c,u,d){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=5),void 0===r&&(r=n.kNone),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=5),void 0===u&&(u=!0),void 0===d&&(d=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindPop3x3] no need to bind repetitive nav object"):this._genGrid(t,e,3,3,i,o,0,!1,"",r,h,l,c,d,u,s,!0)},e.prototype.bindPop3x3Ex=function(t,e,i,o,s,r,h,l,c,u,d,_){void 0===e&&(e=null),void 0===i&&(i=-10),void 0===o&&(o=0),void 0===s&&(s=""),void 0===r&&(r=5),void 0===h&&(h=n.kNone),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=5),void 0===d&&(d=!0),void 0===_&&(_=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindPop3x3Ex] no need to bind repetitive nav object"):this._genGrid(t,e,3,3,i,o,0,!0,s,h,l,c,u,_,d,r,!0)},e.prototype.bindPop4x3Ex=function(t,e,i,o,s,r,h,l,c,u,d,_){void 0===e&&(e=null),void 0===i&&(i=-10),void 0===o&&(o=0),void 0===s&&(s=""),void 0===r&&(r=5),void 0===h&&(h=n.kNone),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=5),void 0===d&&(d=!0),void 0===_&&(_=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindPop4x3Ex] no need to bind repetitive nav object"):this._genGrid(t,e,4,3,i,o,0,!0,s,h,l,c,u,_,d,r,!0)},e.prototype.bindFoldPage=function(t,e,i,o,s,r,h,l,c,u,d,_,p,f,g){void 0===e&&(e=null),void 0===i&&(i=3),void 0===o&&(o=-10),void 0===s&&(s=0),void 0===r&&(r=null),void 0===h&&(h=null),void 0===l&&(l=1),void 0===c&&(c=!1),void 0===u&&(u=2),void 0===d&&(d=n.kNone),void 0===_&&(_=null),void 0===p&&(p=null),void 0===f&&(f=5),void 0===g&&(g=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindFoldPage] no need to bind repetitive nav object"):this._genFoldPage(t,e,i,o,s,0,!1,"",d,_,p,l,c,f,g,u,r,h)},e.prototype.bindFoldPageEx=function(t,e,i,o,s,r,h,l,c,u,d,_,p,f,g,m){void 0===e&&(e=null),void 0===i&&(i=3),void 0===o&&(o=-10),void 0===s&&(s=0),void 0===r&&(r=""),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=1),void 0===u&&(u=!1),void 0===d&&(d=2),void 0===_&&(_=n.kNone),void 0===p&&(p=null),void 0===f&&(f=null),void 0===g&&(g=5),void 0===m&&(m=!1),this.navObjMap_.containsKey(t)?a.G.warn("[ExportUI bindFoldPage] no need to bind repetitive nav object"):this._genFoldPage(t,e,i,o,s,0,!0,r,_,p,f,c,u,g,m,d,h,l)},e.prototype.show=function(t,e,i){void 0===e&&(e=""),void 0===i&&(i=!0),this.bLockShow_||(1===l.DataHub.config.export?this._setVisible(t,!0,e,i):this._setVisible(t,!1))},e.prototype.showTM=function(t,e){!this.bLockShow_&&a.G.isTMSDK&&(1===l.DataHub.config.export?this.navObjMap_.containsKey(t)?(console.log("[ExportUI showTM] ",t,e),this.navObjMap_.get(t).showTM(e)):a.G.warn("[ExportUI showTM] not found this component",t):this._setVisible(t,!1))},e.prototype.hide=function(t){this._setVisible(t,!1)},e.prototype.hideAll=function(){this.navObjMap_.each(function(t,e,i){i.hide()})},e.prototype.lockShowOpt=function(){this.bLockShow_=!0},e.prototype.unlockShowOpt=function(){this.bLockShow_=!1},e.prototype.addPageCallback=function(t,e){this.showPageCb_=t,this.hidePageCb_=e},e.prototype.clearShowPageCallback=function(){this.showPageCb_=null,this.hidePageCb_=null},e.prototype.setPageBannerID=function(t){this.bnrShowId_=t},e.prototype.clearPageBannerID=function(){this.bnrShowId_=""},e.prototype.getPageBannerID=function(){return this.bnrShowId_},e.prototype.showPage=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e=""),a.G.isTMSDK){if(""==e&&(e=this.tmPageDefaultPosId_),""==this.tmPageDefaultPosId_)return void console.warn("[ExportUI showPage] tm sdk default page id is not existed");this.vPage_?this.vPage_.showTM(e):this.hPage_&&this.hPage_.showTM(e)}else this.vPage_?this.vPage_.show(t):this.hPage_&&this.hPage_.show(t);this.showPageCb_&&this.showPageCb_()},e.prototype.hidePage=function(){this.vPage_?this.vPage_.hide():this.hPage_&&this.hPage_.hide(),this.hidePageCb_&&this.hidePageCb_()},e.prototype.showGridPage=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e=""),a.G.isTMSDK){if(""==e&&(e=this.tmPageDefaultPosId_),""==this.tmPageDefaultPosId_)return void console.warn("[ExportUI showPage] tm sdk default page id is not existed");this.vGrid_?this.vGrid_.showTM(e):this.showPage("",e)}else this.vGrid_?this.vGrid_.show(t):this.showPage(t);this.showPageCb_&&this.showPageCb_()},e.prototype.hideGridPage=function(){this.vGrid_?this.vGrid_.hide():this.hidePage(),this.hidePageCb_&&this.hidePageCb_()},e.prototype.showFakePage=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e=""),a.G.isTMSDK){if(""==e&&(e=this.tmPageDefaultPosId_),""==this.tmPageDefaultPosId_)return void console.warn("[ExportUI showPage] tm sdk default page id is not existed");this.vFakePage_&&this.vFakePage_.showTM(e)}else this.vFakePage_&&this.vFakePage_.show(t);_.AudioMgrInst.pauseMusic(),this.showPageCb_&&this.showPageCb_()},e.prototype.hideFakePage=function(){this.vFakePage_&&this.vFakePage_.hide(),_.AudioMgrInst.resumeMusic(),this.hidePageCb_&&this.hidePageCb_()},e.prototype.showInvitePage=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e=""),a.G.isTMSDK){if(""==e&&(e=this.tmPageDefaultPosId_),""==this.tmPageDefaultPosId_)return void console.warn("[ExportUI showInvitePage] tm sdk default page id is not existed");this.invitePage_&&this.invitePage_.showTM(e)}else this.invitePage_&&this.invitePage_.show(t)},e.prototype.autoPopFoldPage=function(t){this.navObjMap_.containsKey(t)&&this.navObjMap_.get(t).autoUnfold()},e.prototype.closeFoldPage=function(t){this.navObjMap_.containsKey(t)&&this.navObjMap_.get(t).fold()},e.prototype.uploadLog=function(t,e){},e.prototype.navigate=function(t,e,i){a.G.isMinigamePlat?h.HDSDK.navigate(t.id,e,i):3===t.type?c.TipUI.instance.show("\u8df3\u8f6c\u6a21\u62df \u4e8c\u7ef4\u7801\u5c55\u793a "+t.name):(u.DialogUI.instance.renderSortTop(),u.DialogUI.instance.show("\u8df3\u8f6c\u6a21\u62df","\u662f\u5426\u8df3\u8f6c"+t.name,e,i))},e.prototype.navigateTM=function(t,e,i,o,n){a.G.isTMSDK?(console.log("[ExportUI navigateTM] nav trigger",t,e),wx.tmSDK.flowNavigate({positionId:t,creativeId:e}).then(function(e){if(console.log("[ExportUI navigateTM] nav judgement"),e.navigateMessage){var s=e.navigateMessage.errMsg;-1!==s.indexOf("ok")?(console.log("[ExportUI navigateTM] nav ok",s),o&&o()):(console.log("[ExportUI navigateTM] nav error or cancel",s),n&&n())}i&&i(e.creatives,t)}).catch(function(t){console.log("[ExportUI navigateTM] nav error",t)})):console.log("[ExportUI navigateTM] not wx platform")},e.prototype.addToLoadQueue=function(t){var e=this;if(this.loadInfoMap_.containsKey(t.url)){var i=this.loadInfoMap_.get(t.url);if(this.loadInfoCompleteMap_.containsKey(t.url)){t.completeCallback&&t.completeCallback();for(var o=0;o<i.length;++o)i[o].completeCallback&&i[o].completeCallback();this.loadInfoMap_.put(t.url,[])}else i.push(t)}else{(i=[]).push(t),this.loadInfoMap_.put(t.url,i),this.loadQue_.push(t)}this.currLoadInfo_||(this.currLoadInfo_=this.loadQue_.shift(),this.currLoadInfo_&&cc.loader.load(this.currLoadInfo_.url,null,function(t,i){t||e._loadComplete()}))},e.prototype.addToTmSingleQueue=function(t,e){if(this.tmSingleLoadMap_.containsKey(t)){for(var i=this.tmSingleLoadMap_.get(t),o=!0,n=0;n<i.length;++n)if(""!=e.navData.tmCid&&i[n].navData==e.navData){o=!1;break}o&&i.push(e)}else{(i=[]).push(e),this.tmSingleLoadMap_.put(t,i)}this.tmSingleLoadDelay_=1,this.tmSingleLoadRecMap_.containsKey(t)&&this.tmSingleLoadRecMap_.remove(t)},e.prototype._tmLoadCallback=function(t,e,i){var o=this;this.tmSingleLoadRecMap_.containsKey(e)||(wx.tmSDK.getFlowConfig({positionId:e}).then(function(t){if(t.isOpen){var e=t.creatives;if(e)for(var n=0,s=0;s<i.length;++s)e[s].show_config&&(i[s].navData.img=e[s].show_config.image,i[s].navData.name=e[s].show_config.title),i[s].navData.tmPosId=e[s].positionId,i[s].navData.tmCid=e[s].creativeId,i[s].updateInfo(i[s].navData),i[s].registerTMSDKRefreshCallback(o._tmSdkSingleRefresh.bind(o)),++n>=e.length&&(n=0)}}),this.tmSingleLoadRecMap_.put(e,1))},e.prototype._tmSdkSingleRefresh=function(t,e){if(this.tmSingleLoadMap_.containsKey(e)){var i=this.tmSingleLoadMap_.get(e),o=t;if(o)for(var n=0,s=0;s<i.length;++s)o[s].show_config&&(i[s].navData.img=o[s].show_config.image,i[s].navData.name=o[s].show_config.title),i[s].navData.tmPosId=o[s].positionId,i[s].navData.tmCid=o[s].creativeId,i[s].updateInfo(i[s].navData),++n>=o.length&&(n=0)}else console.warn("[ExportUI _tmSdkSingleRefresh] tm single loading items is not existed",e)},e.prototype._loadComplete=function(){var t=this;if(this.currLoadInfo_&&this.currLoadInfo_.completeCallback){if(this.loadInfoCompleteMap_.put(this.currLoadInfo_.url,1),this.loadInfoMap_.containsKey(this.currLoadInfo_.url)){for(var e=this.loadInfoMap_.get(this.currLoadInfo_.url),i=0;i<e.length;++i)e[i].completeCallback&&e[i].completeCallback();this.loadInfoMap_.put(this.currLoadInfo_.url,[])}this.currLoadInfo_=this.loadQue_.shift(),this.currLoadInfo_&&cc.loader.load(this.currLoadInfo_.url,null,function(e,i){e||t._loadComplete()})}},e.prototype._genRCScroll=function(t,e,i,o,s,r,h,l,c,u,d,_,p,f,g){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===h&&(h=""),void 0===l&&(l=n.kNone),void 0===c&&(c=null),void 0===u&&(u=null),void 0===d&&(d=5),void 0===_&&(_=!1),void 0===p&&(p=2),void 0===f&&(f=!0),void 0===g&&(g=!1);var m=(e||this.com_).getChild(t);if(m){e&&(m.removeFromParent(),this.com_.addChild(m));var v=m.asCom,y=null;v.width>v.height?((y=g?new F(v):new N(v)).setNameBgVisible(f),y.init(this.normArr_,1,5,0,o,r,_,p,h,s),y.buildSingles(),y.appendExtraFunc(c,u,l,d)):((y=new U(v)).init(this.normArr_,0,1,i,0,r,_,p,h,s),y.buildSingles(),y.appendExtraFunc(c,u,l,d)),y&&(this.navObjMap_.put(t,y),this.rcShowArr_.push(y))}else a.G.warn("[ExportUI _genRCScroll] not find component >",t)},e.prototype._genVD=function(t,e,i,o,s,r,h,l,c,u,d,_){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=!1),void 0===r&&(r=""),void 0===h&&(h=5),void 0===l&&(l=n.kNone),void 0===c&&(c=null),void 0===u&&(u=null),void 0===d&&(d=5),void 0===_&&(_=!1);var p=(e||this.com_).getChild(t);if(p){e&&(p.removeFromParent(),this.com_.addChild(p));var f=p.asCom,g=new z(f);g.init(this.normArr_,3,2,i,0,s,_,h,r,o),g.buildSingles(),g.appendExtraFunc(c,u,l,d),this.navObjMap_.put(t,g),this.rcShowArr_.push(g)}else a.G.warn("[ExportUI _genVD] not find component >",t)},e.prototype._genGrid=function(t,e,i,o,s,r,h,l,c,u,d,_,p,f,g,m,v,y){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===h&&(h=0),void 0===l&&(l=!1),void 0===c&&(c=""),void 0===u&&(u=n.kNone),void 0===d&&(d=null),void 0===_&&(_=null),void 0===p&&(p=5),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===m&&(m=5),void 0===v&&(v=!0),void 0===y&&(y=!0);var b=(e||this.com_).getChild(t);if(b){v&&e&&(b.removeFromParent(),this.com_.addChild(b));var C=b.asCom,w=null;3===i&&3===o?w=v?new q(C):new K(C):2===i&&4===o?w=new V(C):2===i&&3===o?w=new W(C):4===i&&3===o&&(w=v?new X(C):new Y(C)),w&&(w.init(this.normArr_,i,o,s,r,l,f,m,c,h,y),w.buildSingles(),w.appendExtraFunc(d,_,u,p),g?w.showTitle():w.hideTitle(),this.navObjMap_.put(t,w),this.rcShowArr_.push(w))}else a.G.warn("[ExportUI _genGrid] not find component >",t)},e.prototype._genFoldPage=function(t,e,i,o,s,r,h,l,c,u,d,_,p,f,g,m,v,y){void 0===e&&(e=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===h&&(h=!1),void 0===l&&(l=""),void 0===c&&(c=n.kNone),void 0===u&&(u=null),void 0===d&&(d=null),void 0===_&&(_=1),void 0===p&&(p=!1),void 0===f&&(f=5),void 0===g&&(g=!1),void 0===m&&(m=5),void 0===v&&(v=null),void 0===y&&(y=null);var b=(e||this.com_).getChild(t);if(b){e&&(b.removeFromParent(),this.com_.addChild(b));var C=b.asCom,w=new J(C);w&&(w.init(this.normArr_,3,i,o,s,h,g,m,l,r,_,p),w.buildSingles(),w.appendExtraFunc(u,d,c,f,v,y),this.navObjMap_.put(t,w),this.rcShowArr_.push(w))}else a.G.warn("[ExportUI _genFoldPage] not find component >",t)},e.prototype._setVisible=function(t,e,i,o){if(void 0===i&&(i=""),void 0===o&&(o=!1),this.navObjMap_.containsKey(t)){var n=this.navObjMap_.get(t);e?n.show(i,o):n.hide()}else a.G.warn("[ExportUI setVisible] not found this component",t)},e.prototype._fetchChecker=function(t){this.fetchTimer_-=t,this.fetchTimer_<=0&&(h.HDSDK.isDataExisted?(this._fillData(),this.bFetchedData_=!0,this.bUpdCheck_=!0,this.checkTimer_=3):(this.fetchTimer_=1+2*this.fetchCheckCnt_,++this.fetchCheckCnt_,a.G.log("[HDSDK UI] fetch data count",this.fetchCheckCnt_)))},e.prototype._checkUpdate=function(t){this.updCheckCnt_<5?(this.checkTimer_-=t,this.checkTimer_<=0&&(h.HDSDK.needUpdateNavData?(this._fillData(),this.bUpdCheck_=!0):(++this.updCheckCnt_,this.checkTimer_=3+5*this.updCheckCnt_))):this.bUpdCheck_=!0},e.prototype._fillData=function(){this.normArr_=this.normArr_.concat(h.HDSDK.getGridArray());var t=h.HDSDK.getLikeArray(),e=[];if(t&&t.length>0){for(var i=0;i<this.normArr_.length;++i)for(var o=this.normArr_[i],n=0;n<t.length;++n)o.sn!=t[n].sn&&o.type!=t[n].type&&e.push(t[n]);e.length>0&&(this.normArr_=this.normArr_.concat(e))}this.normArr_=this.normArr_.concat(h.HDSDK.getQRCodeArray()),this.bnrArr_=this.bnrArr_.concat(h.HDSDK.getBannerArray()),this._filterFoceNavData()},e.prototype._getNextNormNavDat=function(){var t=null;return this.normArr_[this.normDatIdx_]&&(t=this.normArr_[this.normDatIdx_],++this.normDatIdx_,this.normDatIdx_>=this.normArr_.length&&(this.normDatIdx_=0)),t},e.prototype._getNextBnrNavDat=function(){var t=null;return this.bnrArr_[this.bnrDatIdx_]&&(t=this.bnrArr_[this.bnrDatIdx_],++this.bnrDatIdx_,this.bnrDatIdx_>=this.bnrArr_.length&&(this.bnrDatIdx_=0)),t},e.prototype._filterFoceNavData=function(){this.forceNavDatArr_=[],this._readForceNavIds();for(var t=h.HDSDK.getForceNavIds,e=0;e<t.length;++e){var i=h.HDSDK.getForceNavData(t[e]);if(i)if(this.usedForceNavIds_.length>0){for(var o=!1,n=0;n<this.usedForceNavIds_.length;++n)if(i.appId===this.usedForceNavIds_[n]){o=!0;break}o||this.forceNavDatArr_.push(i),this.forceFixedNavDatArr_.push(i)}else this.forceNavDatArr_.push(i),this.forceFixedNavDatArr_.push(i)}},e.prototype._saveForceNavIds=function(){var t=new Date,e={ids:this.usedForceNavIds_,map:this.usedNavIdCntMap_,day:t.getDate()};d.GameStorage.writeJSON(d.SaveDef.kForceNav,e)},e.prototype._readForceNavIds=function(){var t=d.GameStorage.readJSON(d.SaveDef.kForceNav);t?(new Date).getDate()===t.day?(this.usedForceNavIds_=t.ids,t.map?this.usedNavIdCntMap_.copy(t.map):this.usedNavIdCntMap_.clear()):(this.usedForceNavIds_=[],this.usedNavIdCntMap_.clear()):(this.usedForceNavIds_=[],this.usedNavIdCntMap_.clear())},e.prototype._onBlockClick=function(){this.blockClickCb_&&(this.blockClickCb_(),this.blockClickCb_=null,this.block_.offClick(this._onBlockClick,this))},e.instance=new e,e}(s.BaseUI);i.ExportUI=C,i.ExportUIInst=C.instance;var w=function(){function t(t){this.com_=null,this.log_="",this.tmPosId_="",t&&(this.com_=t,this.com_.onClick(this._onClick,this),this.hide())}return t.prototype.show=function(t){void 0===t&&(t=""),this.com_&&(this.com_.visible=!0)},t.prototype.showTM=function(t){this.tmPosId_=t,this.show()},t.prototype.hide=function(){this.com_&&(this.com_.visible=!1)},t.prototype._onClick=function(){this.com_&&C.instance.showFakePage(this.log_,this.tmPosId_)},t}(),S=function(){function t(t){if(this.com_=null,this.redPnt_=null,this.rotTrans_=null,this.sclTrans_=null,this.showTrans_=null,this.hideTrans_=null,this.lastTrans_=null,this.log_="",this.tmPosId_="",t){this.com_=t;var e=t.getChild("redPnt");e&&(this.redPnt_=e.asCom),this.rotTrans_=t.getTransition("rot"),this.sclTrans_=t.getTransition("scl"),this.showTrans_=t.getTransition("show"),this.hideTrans_=t.getTransition("hide"),t.onClick(this._onClick,this),this.hide()}}return t.prototype.show=function(t){void 0===t&&(t=""),this.com_&&(this.showTrans_&&this.showTrans_.play(),this.com_.visible=!0)},t.prototype.showTM=function(t){this.tmPosId_=t,this.show()},t.prototype.hide=function(){this.com_&&(this.hideTrans_&&this.hideTrans_.play(),this.com_.visible=!1)},t.prototype.playTrans=function(t){this.lastTrans_&&this.lastTrans_.stop(),1===t?(this.rotTrans_.play(null,-1),this.lastTrans_=this.rotTrans_):2===t&&(this.sclTrans_.play(null,-1),this.lastTrans_=this.sclTrans_)},t.prototype._onClick=function(){this.com_&&(a.G.randRange(0,100)<=l.DataHub.config.exportPageTypeProb?i.ExportUIInst.showPage(this.log_,this.tmPosId_):i.ExportUIInst.showGridPage(this.log_,this.tmPosId_))},t}(),I=function(){return function(t,e){this.url="",this.completeCallback=null,this.url=t,this.completeCallback=e}}(),T=140,x=145,k=function(){function t(t,e){void 0===e&&(e=!1),this.com_=null,this.grp_=null,this.bgImg_=null,this.iconLdr_=null,this.tag_=null,this.popTrans_=null,this.fadeTrans_=null,this.springTrans_=null,this.tagTrans_=null,this.shakeTrans_=null,this.navDat_=null,this.navSucCb_=null,this.navFailCb_=null,this.tmRefreshCb_=null,this.redPnt_=null,this.origScl_=0,this.transType_=n.kNone,this.infoDura_=-1,this.transDura_=-1,this.updTimer_=0,this.transTimer_=0,this.tagTimer_=0,this.log_="",this.bCancelJumpActive_=!0,t&&(this.com_=t,this.bgImg_=t.getChild("bgImg").asImage,this.iconLdr_=t.getChild("iconLdr").asLoader,this.tag_=t.getChild("tag").asImage,this.grp_=t.getChild("grp").asGroup,this.popTrans_=t.getTransition("pop"),this.fadeTrans_=t.getTransition("fade"),this.springTrans_=t.getTransition("spring"),this.tagTrans_=t.getTransition("tag"),this.shakeTrans_=t.getTransition("shake"),this.redPnt_=t.getChild("redPnt").asCom,this.randShowRedPoint(),this.origScl_=t.width/T,e||t.onClick(this._onClick,this),t.visible=!1)}return Object.defineProperty(t.prototype,"origScale",{get:function(){return this.origScl_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{set:function(t){this.grp_&&(this.grp_.alpha=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navData",{get:function(){return this.navDat_},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,i,o){if(void 0===e&&(e=!0),void 0===i&&(i=""),void 0===o&&(o=!0),this.com_){if(this.iconLdr_.url="ui://CommUI/iconHolder",this.navDat_=t,""!=t.img){var n=new I(t.img,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(n)}this.tag_.visible=1===t.tag,this.bgImg_.visible=e}},t.prototype.appendExtraFunc=function(t,e,i,o,s){void 0===i&&(i=n.kNone),void 0===o&&(o=5),void 0===s&&(s=5),this.navSucCb_=t,this.navFailCb_=e,this.transType_=i,this.infoDura_=a.G.isTMSDK?-1:o,this.transDura_=s},t.prototype.playTrans=function(t){t===n.kPop&&this.popTrans_?this.popTrans_.play():t===n.kFade&&this.fadeTrans_?this.fadeTrans_.play():t===n.kSpring&&this.springTrans_?this.springTrans_.play():t===n.kShake&&this.shakeTrans_&&this.shakeTrans_.play()},t.prototype.addToParent=function(t,e,i,o,n){void 0===o&&(o=-1),void 0===n&&(n=""),this.com_&&(-1!==o&&this.com_.setSize(T*o,140*o),this.com_.visible=!1,this.com_.x=e,this.com_.y=i,t.addChild(this.com_))},t.prototype.updateInfo=function(t){if(this.com_){if(a.G.isTMSDK){var e=new I(t.img,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(e)}else this.iconLdr_.url=t.img;this.tag_.visible=1===t.tag,this.navDat_=t,this.tagTimer_=0}},t.prototype.moveXY=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.com_&&(this.com_.x+=t,this.com_.y+=e)},t.prototype.adjustXY=function(t,e){this.com_&&this.com_.setPosition(t,e)},t.prototype.adjustSize=function(t){void 0===t&&(t=-1),this.com_&&-1!=t&&(this.com_.setSize(T*t,140*t),this.origScl_=t)},t.prototype.randShowRedPoint=function(){this.redPnt_&&(this.redPnt_.visible=a.G.randRange(0,100)>=70)},t.prototype.show=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!0),this.com_&&(this.com_.visible=!0)},t.prototype.showTM=function(t){i.ExportUIInst.addToTmSingleQueue(t,this),this.com_&&(this.com_.visible=!0)},t.prototype.hide=function(){this.com_&&(this.com_.visible=!1),this.reset()},t.prototype.reset=function(){this.popTrans_.stop(),this.fadeTrans_.stop(),this.springTrans_.stop(),this.transTimer_=0,this.updTimer_=0,this.tagTimer_=0},t.prototype.update=function(t){var e=!1;return this.com_.visible&&(this.transType_!=n.kNone&&-1!==this.transDura_&&(this.transTimer_+=t,this.transTimer_>=this.transDura_&&(this.playTrans(this.transType_),this.transTimer_=0)),-1!=this.infoDura_&&(this.updTimer_+=t,this.updTimer_>=this.infoDura_&&(e=!0,this.updTimer_=0)),this.tag_.visible&&(this.tagTimer_+=t,this.tagTimer_>=5&&(this.tagTrans_.play(),this.tagTimer_=0))),e},t.prototype.clickTrigger=function(){this._onClick()},t.prototype.setCancelJumpActive=function(t){void 0===t&&(t=!0),this.bCancelJumpActive_=t},t.prototype.registerTMSDKRefreshCallback=function(t){a.G.isTMSDK&&(this.tmRefreshCb_=t)},t.prototype._onLoadedImg=function(){this.navDat_&&(this.iconLdr_.url=this.navDat_.img)},t.prototype._tmRefreshCallbackTrigger=function(t,e){this.tmRefreshCb_&&this.tmRefreshCb_(t,e)},t.prototype._onClick=function(){this.navDat_&&(a.G.isTMSDK?i.ExportUIInst.navigateTM(this.navDat_.tmPosId,this.navDat_.tmCid,this._tmRefreshCallbackTrigger.bind(this),this._onNavSucc.bind(this),this._onNavFail.bind(this)):i.ExportUIInst.navigate(this.navDat_,this._onNavSucc.bind(this),this._onNavFail.bind(this)))},t.prototype._onNavSucc=function(){this.navSucCb_&&this.navSucCb_()},t.prototype._onNavFail=function(){this.navFailCb_&&this.navFailCb_(),this.bCancelJumpActive_&&(a.G.randRange(0,100)<=l.DataHub.config.exportPageTypeProb?i.ExportUIInst.showPage("\u53d6\u6d88\u8df3\u8f6c\u5f39\u51fa\u72ec\u7acb\u9875\u9762"):i.ExportUIInst.showGridPage("\u53d6\u6d88\u8df3\u8f6c\u5f39\u51fa\u72ec\u7acb\u9875\u9762"))},t}(),P=3,M=function(t){function e(e,i){void 0===i&&(i=!1);var o=t.call(this,e,i)||this;if(o.nameLbl_=null,o.nameBgs_=[],o.curNameBg_=null,o.bNameBg_=!1,e){o.origScl_=e.width/x,o.nameLbl_=e.getChild("nameLbl").asTextField;for(var n=0;n<P;n++){var s=e.getChild("nameBg"+(n+1)).asImage;s&&(o.nameBgs_[n]=s,s.visible=!1)}for(var r=a.G.randRange(0,o.nameBgs_.length-1),h=0;h<o.nameBgs_.length;h++){var l=o.nameBgs_[h];l&&(h===r?(o.curNameBg_=l,o.curNameBg_.visible=!0):l.visible=!1)}}return o}return o(e,t),e.prototype.init=function(e,i,o,n){if(void 0===i&&(i=!0),void 0===o&&(o=""),void 0===n&&(n=!0),this.com_){t.prototype.init.call(this,e,i),this.bNameBg_=n,this.curNameBg_&&(this.curNameBg_.visible=n),this.nameLbl_.text=e.name;var s=n?18:24;if(this.nameLbl_.fontSize=Math.round(s*this.origScl_),""!=o){var r=parseInt(o.substr(0,2),16),a=parseInt(o.substr(2,2),16),h=parseInt(o.substr(2,2),16);this.nameLbl_.color=new cc.Color(r,a,h,255)}}},e.prototype.addToParent=function(t,e,i,o){if(void 0===o&&(o=1),this.com_){-1!==o&&this.com_.setSize(x*o,180*o),this.com_.visible=!1,this.com_.setPosition(e,i),t.addChild(this.com_);var n=this.bNameBg_?18:24;this.nameLbl_.fontSize=Math.round(n*this.origScl_)}},e.prototype.adjustSize=function(t){if(void 0===t&&(t=-1),this.com_&&-1!==t){this.com_.setSize(x*t,180*t);var e=this.bNameBg_?18:24;this.nameLbl_.fontSize=Math.round(e*this.origScl_),this.origScl_=t}},e.prototype.updateInfo=function(e){t.prototype.updateInfo.call(this,e),this.com_&&(this.nameLbl_.text=e.name)},e}(k),B=310,O=function(t){function e(e,i){void 0===i&&(i=!1);var o=t.call(this,e,i)||this;return o.origScl_=e.width/B,o}return o(e,t),e.prototype.init=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),this.com_){if(this.iconLdr_.url="ui://CommUI/iconHolder",this.navDat_=t,""!=t.img){var o=new I(t.bnrUrl,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(o)}this.tag_.visible=1===t.tag,this.bgImg_.visible=e}},e.prototype.addToParent=function(t,e,i,o,n){void 0===o&&(o=1),void 0===n&&(n=""),this.com_&&(-1!==o&&this.com_.setSize(B*o,120*o),this.com_.visible=!1,this.com_.setPosition(e,i),t.addChild(this.com_))},e.prototype.adjustSize=function(t){void 0===t&&(t=-1),this.com_&&-1!==t&&(this.com_.setSize(B*t,120*t),this.origScl_=t)},e.prototype.updateInfo=function(t){if(this.com_){if(a.G.isTMSDK){var e=new I(t.img,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(e)}else this.iconLdr_.url=t.bnrUrl;this.tag_.visible=1===t.tag,this.navDat_=t,this.tagTimer_=0}},e.prototype._onLoadedImg=function(){this.navDat_&&(this.iconLdr_.url=this.navDat_.bnrUrl)},e}(k),D=240,A=function(t){function e(e,i){void 0===i&&(i=!1);var o=t.call(this,null)||this;return e&&(o.com_=e,o.iconLdr_=e.getChild("iconLdr").asLoader,o.grp_=e.getChild("grp").asGroup,o.popTrans_=e.getTransition("pop"),o.fadeTrans_=e.getTransition("fade"),o.springTrans_=e.getTransition("spring"),o.tagTrans_=e.getTransition("tag"),o.origScl_=e.width/D,i||e.onClick(o._onClick,o),e.visible=!1),o}return o(e,t),e.prototype.init=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),this.com_&&(this.iconLdr_.url="ui://CommUI/iconHolder",this.navDat_=t,""!=t.img)){var o=new I(t.img,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(o)}},e.prototype.updateInfo=function(t){if(this.com_){if(a.G.isTMSDK){var e=new I(t.img,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(e)}else this.iconLdr_.url=t.img;this.navDat_=t}},e.prototype.addToParent=function(t,e,i,o,n){void 0===o&&(o=1),void 0===n&&(n=""),this.com_&&(-1!==o&&this.com_.setSize(D*o,100*o),this.com_.visible=!1,this.com_.setPosition(e,i),t.addChild(this.com_))},e.prototype.adjustSize=function(t){void 0===t&&(t=-1),this.com_&&-1!==t&&(this.com_.setSize(D*t,100*t),this.origScl_=t)},e.prototype.update=function(t){var e=!1;return this.com_.visible&&(this.transType_!=n.kNone&&-1!==this.transDura_&&(this.transTimer_+=t,this.transTimer_>=this.transDura_&&(this.playTrans(this.transType_),this.transTimer_=0)),-1!=this.infoDura_&&(this.updTimer_+=t,this.updTimer_>=this.infoDura_&&(e=!0,this.updTimer_=0))),e},e}(k),L=function(t){function e(e,i){void 0===i&&(i=!1);var o=t.call(this,null)||this;return o.nameLbl_=null,e&&(o.com_=e,o.iconLdr_=e.getChild("iconLdr").asLoader,o.tag_=e.getChild("tag").asImage,o.nameLbl_=e.getChild("nameLbl").asTextField,i||e.onClick(o._onClick,o),e.visible=!1),o}return o(e,t),e.prototype.init=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),this.com_){if(this.iconLdr_.url="ui://CommUI/iconHolder",this.navDat_=t,""!=t.img){var o=new I(t.img,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(o)}this.tag_.visible=1===t.tag,this.nameLbl_.text=t.name}},e.prototype.appendExtraFunc=function(t,e,i,o,s){void 0===i&&(i=n.kNone),void 0===o&&(o=5),void 0===s&&(s=5),this.navSucCb_=t,this.navFailCb_=e},e.prototype.playTrans=function(t){},e.prototype.addToParent=function(t,e,i,o,n){void 0===o&&(o=-1),void 0===n&&(n=""),this.com_&&(this.com_.visible=!1,this.com_.setPosition(e,i),t.addChild(this.com_))},e.prototype.updateInfo=function(t){if(this.com_){if(a.G.isTMSDK){var e=new I(t.img,this._onLoadedImg.bind(this));C.instance.addToLoadQueue(e)}else this.iconLdr_.url=t.img;this.tag_.visible=1===t.tag,this.nameLbl_.text=t.name,this.navDat_=t}},e.prototype.moveXY=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0)},e.prototype.adjustXY=function(t,e){},e.prototype.adjustSize=function(t){void 0===t&&(t=-1)},e.prototype.show=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!0),this.com_&&(this.com_.visible=!0)},e.prototype.hide=function(){this.com_&&(this.com_.visible=!1)},e.prototype.reset=function(){},e.prototype.update=function(t){return!1},e.prototype._onLoadedImg=function(){this.navDat_&&(this.iconLdr_.url=this.navDat_.img)},e.prototype._onClick=function(){this.navDat_&&(a.G.isTMSDK?i.ExportUIInst.navigateTM(this.navDat_.tmPosId,this.navDat_.tmCid,this._tmRefreshCallbackTrigger.bind(this),this._onNavSucc.bind(this),this._onNavFail.bind(this)):i.ExportUIInst.navigate(this.navDat_,this._onNavSucc.bind(this),this._onNavFail.bind(this)))},e.prototype._onNavSucc=function(){this.navSucCb_&&this.navSucCb_()},e.prototype._onNavFail=function(){this.navFailCb_&&this.navFailCb_()},e}(k),G=100,R=function(t){function e(e,i){void 0===i&&(i=!1);var o=t.call(this,null)||this;if(o.mask_=null,e){o.com_=e,o.bgImg_=e.getChild("bgImg").asImage;var n=e.getChild("iconLdr");if(n){var s=n;o.iconLdr_=s.getChild("iconLdr").asLoader,o.mask_=s.getChild("mask").asGraph}o.tag_=e.getChild("tag").asImage,o.grp_=e.getChild("grp").asGroup,o.popTrans_=e.getTransition("pop"),o.fadeTrans_=e.getTransition("fade"),o.springTrans_=e.getTransition("spring"),o.tagTrans_=e.getTransition("tag"),o.shakeTrans_=e.getTransition("shake"),o.nameLbl_=e.getChild("nameLbl").asTextField,o.origScl_=e.width/G,i||e.onClick(o._onClick,o),e.visible=!1}return o}return o(e,t),e.prototype.addToParent=function(t,e,i,o){if(void 0===o&&(o=1),this.com_){-1!==o&&this.com_.setSize(G*o,140*o),this.com_.visible=!1,this.com_.setPosition(e,i),t.addChild(this.com_);var n=this.bNameBg_?18:24;this.nameLbl_.fontSize=Math.round(n*this.origScl_)}},e.prototype.adjustSize=function(t){if(void 0===t&&(t=-1),this.com_&&-1!==t){this.com_.setSize(G*t,140*t);var e=this.bNameBg_?18:24;this.nameLbl_.fontSize=Math.round(e*this.origScl_),this.origScl_=t}},e.prototype.playTrans=function(t){},e}(M),E=function(t){function e(e,i){void 0===i&&(i=!1);var o=t.call(this,e,i)||this;return o.cntLbl_=null,o.cntLbl_=e.getChild("cntLbl").asTextField,o}return o(e,t),e.prototype.randomCount=function(t){void 0===t&&(t=!0);var e="";e=t?a.G.randRange(90,300).toString():a.G.randRangeF(.5,3).toFixed(2),this.cntLbl_.text=e+"\u4e07\u4eba\u5728\u73a9"},e.prototype.addToParent=function(t,e,i,o){if(void 0===o&&(o=1),this.com_){-1!==o&&this.com_.setSize(x*o,200*o),this.com_.visible=!1,this.com_.setPosition(e,i),t.addChild(this.com_);var n=this.bNameBg_?18:24;this.nameLbl_.fontSize=Math.round(n*this.origScl_)}},e.prototype.adjustSize=function(t){if(void 0===t&&(t=-1),this.com_&&-1!==t){this.com_.setSize(x*t,200*t);var e=this.bNameBg_?18:24;this.nameLbl_.fontSize=Math.round(e*this.origScl_),this.origScl_=t}},e}(M),j=function(){function t(t){var e=this;if(this.com_=null,this.clipArea_=null,this.scrollArea_=null,this.row_=0,this.col_=0,this.rowPitch_=0,this.colPitch_=0,this.wid_=0,this.hgt_=0,this.helpScl_=0,this.origScl_=0,this.moveDist_=0,this.updDura_=0,this.updTimer_=0,this.navItemArr_=[],this.navDatArr_=[],this.navDatIdx_=0,this.log_="",this.nameClr_="",this.bScroll_=!1,this.bName_=!1,this.bFrame_=!1,this.bNameBg_=!0,this.missDownX_=-1,this.missDownY_=-1,this.bMissingClick_=!1,t){this.com_=t,t.visible=!1;var i=t.getChild("clipFrame");i&&(this.clipArea_=i.asCom,this.clipArea_.on(fgui.Event.SCROLL,this._onScrolling,this),this.clipArea_.on(fgui.Event.SCROLL_END,this._onScrollEnd,this),this.scrollArea_=this.clipArea_,g.TimedTaskInst.add(function(){e.bScroll_=!1},.5),this.wid_=t.width,this.hgt_=t.height)}}return t.prototype.init=function(t,e,i,o,n,s,r,a,h,l){void 0===e&&(e=1),void 0===i&&(i=4),void 0===o&&(o=0),void 0===n&&(n=0),void 0===s&&(s=!1),void 0===r&&(r=!1),void 0===a&&(a=2),void 0===h&&(h=""),void 0===l&&(l=0),this.navDatArr_=t,l<0?l=0:l>t.length&&(l=t.length>0?t.length-1:0),2===e&&3===i&&(this.scrollArea_.scrollPane.touchEffect=!1),this.navDatIdx_=l,this.row_=e,this.col_=i,this.rowPitch_=o,this.colPitch_=n,this.updDura_=a,this.nameClr_=h,this.bName_=s,this.bFrame_=r,this.wid_=this.com_.width,this.hgt_=this.com_.height},t.prototype.addToParent=function(t,e,i,o){void 0===o&&(o=-1),this.com_&&(-1!==o&&(this.com_.setSize(this.wid_*o,this.hgt_*o),this.origScl_=o),this.com_.visible=!1,this.com_.setPosition(e,i),this.buildSingles(),t.addChild(this.com_))},t.prototype.buildSingles=function(){},t.prototype.appendExtraFunc=function(t,e,i,o){void 0===i&&(i=n.kNone),void 0===o&&(o=5);for(var s=0;s<this.navItemArr_.length;++s)this.navItemArr_[s].appendExtraFunc(t,e,i,-1,a.G.randRange(1,o))},t.prototype.adjustXY=function(t,e){this.com_&&this.com_.setPosition(t,e)},t.prototype.adjustSize=function(t){void 0===t&&(t=-1),this.com_&&-1!=t&&(this.origScl_=t,this.com_.setSize(this.wid_*t,this.hgt_*t))},t.prototype.show=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!1),this.com_&&(this.com_.visible=!0,this.scrollArea_.node.on(cc.Node.EventType.TOUCH_START,this._onDown,this),this.scrollArea_.node.on(cc.Node.EventType.TOUCH_MOVE,this._onMove,this),this.scrollArea_.node.on(cc.Node.EventType.TOUCH_END,this._onUp,this))},t.prototype.showTM=function(t){var e=this;wx.tmSDK.getFlowConfig({positionId:t}).then(function(t){if(t.isOpen){console.log("[RCShow showTM] download data");var i=t.creatives;i&&(e._tmSdkDataProc(i),e.com_&&(e.com_.visible=!0,e.scrollArea_.node.on(cc.Node.EventType.TOUCH_START,e._onDown,e),e.scrollArea_.node.on(cc.Node.EventType.TOUCH_MOVE,e._onMove,e),e.scrollArea_.node.on(cc.Node.EventType.TOUCH_END,e._onUp,e)))}})},t.prototype.hide=function(){this.com_&&(this.com_.visible=!1,this.scrollArea_.node.off(cc.Node.EventType.TOUCH_START,this._onDown,this),this.scrollArea_.node.off(cc.Node.EventType.TOUCH_MOVE,this._onMove,this),this.scrollArea_.node.off(cc.Node.EventType.TOUCH_END,this._onUp,this));for(var t=0;t<this.navItemArr_.length;++t)this.navItemArr_[t].reset();this.updTimer_=0},t.prototype.update=function(t){if(this.com_.visible&&this.navItemArr_.length>0){for(var e=0;e<this.navItemArr_.length;++e)this.navItemArr_[e].update(t);this.bScroll_||(this.updTimer_+=t,this.updTimer_>=this.updDura_&&(a.G.isTMSDK||this._randomInfo(),this.updTimer_=0))}},t.prototype._onDown=function(t){this.missDownX_=t.getLocationX(),this.missDownY_=t.getLocationY(),this.bMissingClick_=!1},t.prototype._onMove=function(t){if(-1!=this.missDownX_&&-1!=this.missDownY_){var e=Math.abs(t.getLocationX()-this.missDownX_),i=Math.abs(t.getLocationY()-this.missDownY_);if((e>10||i>10)&&!this.bMissingClick_){if(a.G.randRange(0,100)<=l.DataHub.config.fakeBtnClick){var o=t.getLocationX(),n=t.getLocationY(),s=this.scrollArea_.localToGlobal().x,r=this.scrollArea_.localToGlobal().y,h=this.scrollArea_.width,c=this.scrollArea_.height;if(n>r&&n<r+c&&o>s&&s<s+h){var u=this.scrollArea_.getFirstChildInView();o<s?o=s:o>s+h&&(o=s+h),n<r?n=r:n>r+c&&(n=r+c);var d=h/this.col_,_=c/this.row_,p=Math.floor((o-s)/d),f=Math.floor((n-r)/_),g=this.navItemArr_[u+p+3*f];g&&g.clickTrigger()}}this.bMissingClick_=!0}}},t.prototype._onUp=function(){this.missDownX_=-1,this.missDownY_=-1,this.bMissingClick_=!0},t.prototype._randomInfo=function(){if(this.navDatArr_.length>0){this.navDatIdx_=a.G.randRange(0,this.navDatArr_.length-1);for(var t=0;t<this.navItemArr_.length;++t){var e=this._getNextNavData();e&&this.navItemArr_[t].updateInfo(e)}}},t.prototype._createSingle=function(t,e,i,o,n){void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===n&&(n=1);var s=this._getNextNavData();if(s){var r=this.origScl_*n,a=null;if(i){var h=fgui.UIPackage.createObject("HDSDK","NavItemEx").asCom;(a=new M(h)).init(s,o,this.nameClr_),a.addToParent(this.clipArea_,(e*x+e*this.colPitch_)*r,(180*t+t*this.rowPitch_)*r,r),a.show(),a.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this))}else{h=fgui.UIPackage.createObject("HDSDK","NavItem").asCom;(a=new k(h)).init(s,o),a.addToParent(this.clipArea_,(e*T+e*this.colPitch_)*r,(140*t+t*this.rowPitch_)*r,r),a.show(),a.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this))}a&&this.navItemArr_.push(a)}},t.prototype._tmRefreshCallback=function(t,e){var i=t;i&&(console.log("[RCShow _tmRefreshCallback]"),this._tmSdkDataProc(i))},t.prototype._tmSdkDataProc=function(t){this.navDatArr_.length!=t.length&&(console.log("[RCShow _tmSdkDataProc] data length different"),this.navDatArr_=[],this.navItemArr_=[],this.scrollArea_.removeChildren());for(var e=0;e<t.length;++e){var i=null;i=this.navItemArr_.length>0&&this.navDatArr_[e]||new h.HDNavData,t[e].show_config&&(i.img=t[e].show_config.image,i.name=t[e].show_config.title),i.tmPosId=t[e].positionId,i.tmCid=t[e].creativeId,this.navDatArr_[e]||this.navDatArr_.push(i)}if(this.navItemArr_.length>0)for(e=0;e<this.navItemArr_.length;++e){(i=this._getNextNavData())&&this.navItemArr_[e].updateInfo(i)}else this.buildSingles()},t.prototype._getNextNavData=function(){var t=null;return this.navDatArr_.length>0&&(t=this.navDatArr_[this.navDatIdx_],++this.navDatIdx_,this.navDatIdx_>=this.navDatArr_.length&&(this.navDatIdx_=0)),t},t.prototype._onScrolling=function(){this.updTimer_>0&&(this.bScroll_=!0)},t.prototype._onScrollEnd=function(){this.bScroll_=!1,this.updTimer_=0},t.prototype.setNameBgVisible=function(t){void 0===t&&(t=!0),this.bNameBg_=t},t}(),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,h,l,c,u){void 0===i&&(i=1),void 0===o&&(o=4),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===h&&(h=!1),void 0===l&&(l=2),void 0===c&&(c=""),void 0===u&&(u=0);var d=i;if(i>1&&(d=1),this.origScl_=r?this.hgt_/200:this.hgt_/160,this.helpScl_=this.wid_/580,t.prototype.init.call(this,e,d,o,n,s,r,h,l,c,u),this.origScl_>=1&&!a.G.isEqualF(this.origScl_,this.helpScl_,3)){var _=10*(2-this.helpScl_);this.clipArea_.width=this.wid_-2*(10+_)}else if(this.origScl_<1){_=10*(1-this.origScl_);this.clipArea_.width=this.wid_-2*(10+_),this.clipArea_.x+=_}var p=this.bName_?x:T;this.moveDist_=(p+this.colPitch_)*this.origScl_},e.prototype.buildSingles=function(){if(this.navDatArr_.length>0){for(var t=0;t<this.navDatArr_.length;++t)this._createSingle(0,t,this.bName_,this.bFrame_);this.scrollArea_.scrollPane.scrollLeft()}},e.prototype.update=function(t){if(this.com_.visible&&this.navItemArr_.length>0){for(var e=0;e<this.navItemArr_.length;++e)this.navItemArr_[e].update(t);this.bScroll_||(this.updTimer_+=t,this.updTimer_>=this.updDura_&&(this.bScroll_=!0,this.updTimer_=0,1==this.scrollArea_.scrollPane.percX?this.scrollArea_.scrollPane.scrollLeft(this.navItemArr_.length,!0):(this.scrollArea_.scrollPane.scrollStep=this.moveDist_,this.scrollArea_.scrollPane.scrollRight(1,!0))))}},e}(j),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c){void 0===i&&(i=1),void 0===o&&(o=4),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=2),void 0===l&&(l=""),void 0===c&&(c=0),t.prototype.init.call(this,e,i,o,n,s,r,a,h,l,c),this.moveDist_=(G+this.colPitch_)*this.origScl_},e.prototype._createSingle=function(t,e,i,o,n){void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===n&&(n=1);var s=this._getNextNavData();if(s){var r=this.origScl_*n,a=fgui.UIPackage.createObject("HDSDK","NavLikeEx").asCom,h=new R(a);h.init(s,o,this.nameClr_),h.addToParent(this.clipArea_,(e*G+e*this.colPitch_)*r,(140*t+t*this.rowPitch_)*r,r),h.show(),h.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this)),h&&this.navItemArr_.push(h)}},e}(N),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,h,l,c,u){void 0===i&&(i=1),void 0===o&&(o=4),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===h&&(h=!1),void 0===l&&(l=2),void 0===c&&(c=""),void 0===u&&(u=0);var d=o;o>1&&(d=1),this.origScl_=this.wid_/160;var _=r?700:580;this.helpScl_=this.hgt_/_,t.prototype.init.call(this,e,i,d,n,s,r,h,l,c,u);var p=a.G.isEqualF(this.origScl_,this.helpScl_,3);if(this.origScl_>=1&&!p){var f=10*(2-this.helpScl_);this.clipArea_.height=this.hgt_-2*(10+f)}else if(this.origScl_<1){f=10*((p?1:2)-this.origScl_);this.clipArea_.height=this.hgt_-2*(10+f),this.clipArea_.y+=f}},e.prototype.buildSingles=function(){if(this.navDatArr_.length>0){for(var t=0;t<this.navDatArr_.length;++t)this._createSingle(t,0,this.bName_,this.bFrame_);var e=0;e=this.bName_?(180+this.rowPitch_)*this.origScl_:(140+this.rowPitch_)*this.origScl_,this.scrollArea_.scrollPane.scrollStep=e,this.scrollArea_.scrollPane.scrollUp()}},e.prototype.update=function(t){if(this.com_.visible&&this.navItemArr_.length>0){for(var e=0;e<this.navItemArr_.length;++e)this.navItemArr_[e].update(t);this.bScroll_||(this.updTimer_+=t,this.updTimer_>=this.updDura_&&(this.bScroll_=!0,this.updTimer_=0,1==this.scrollArea_.scrollPane.percX?this.scrollArea_.scrollPane.scrollTop(!0):(this.bName_?this.moveDist_=(180+this.rowPitch_)*this.origScl_:this.moveDist_=(140+this.rowPitch_)*this.origScl_,this.scrollArea_.scrollPane.scrollStep=this.moveDist_,this.scrollArea_.scrollPane.scrollDown(1,!0))))}},e}(j),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c){void 0===i&&(i=3),void 0===o&&(o=2),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=5),void 0===l&&(l=""),void 0===c&&(c=0);var u=o;(o>2||o<2)&&(u=2);var d=this.wid_/300,_=this.hgt_/(r?530:440);this.origScl_=Math.min(d,_),t.prototype.init.call(this,e,i,u,n,s,r,a,h,l,c)},e.prototype.buildSingles=function(){if(this.navDatArr_.length>0)for(var t=0,e=0,i=0;i<this.navDatArr_.length;++i)this._createSingle(t,e,this.bName_,this.bFrame_),++e>=this.col_&&(++t,e=0)},e}(j),H=function(t){function e(e){var i=t.call(this,e)||this;return i.titleImg_=null,i.bg_=null,i.titleImg_=e.getChild("titleImg").asImage,i.bg_=e.getChild("bg").asImage,i}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c,u){void 0===i&&(i=2),void 0===o&&(o=4),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=5),void 0===l&&(l=""),void 0===c&&(c=0),void 0===u&&(u=!0),t.prototype.init.call(this,e,i,o,n,s,r,a,h,l,c);var d=r?180:140;this.hgt_=(d*i+20+n*(i-1)+60)*this.origScl_,this.bg_&&(this.bg_.visible=u)},e.prototype.show=function(e,i){void 0===e&&(e=""),void 0===i&&(i=!1),t.prototype.show.call(this,e,i),this.clipArea_.scrollPane.scrollTop(!0),this._randomInfo()},e.prototype.showTM=function(e){console.log("[GridShow showTM]"),t.prototype.showTM.call(this,e),this.clipArea_.scrollPane.scrollTop(!0)},e.prototype.showTitle=function(){this.titleImg_&&(this.titleImg_.visible=!0)},e.prototype.hideTitle=function(){this.titleImg_&&(this.titleImg_.visible=!1)},e.prototype.buildSingles=function(){if(this.navDatArr_.length>0){var t=this.bName_?180:140,e=this.clipArea_.height-t*this.row_*this.origScl_;if(this.rowPitch_<0){var i=e*this.origScl_/this.row_;this.rowPitch_+=i}else{var o=this.row_-1;o<=0&&(o=1),this.rowPitch_+=e*this.origScl_/o}for(var n=0,s=0,r=0;r<this.navDatArr_.length;++r)this._createSingle(n,s,this.bName_,this.bFrame_),++s>=this.col_&&(++n,s=0)}},e}(j),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c){void 0===i&&(i=2),void 0===o&&(o=4),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=5),void 0===l&&(l=""),void 0===c&&(c=0);var u=o;4!==o&&(u=4);var d=i;2!==i&&(d=2);var _=this.wid_/580,p=this.hgt_/(r?430:360);this.origScl_=Math.min(_,p),t.prototype.init.call(this,e,d,u,n,s,r,a,h,l,c)},e}(H),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c,u){void 0===i&&(i=2),void 0===o&&(o=3),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=5),void 0===l&&(l=""),void 0===c&&(c=0),void 0===u&&(u=!0);var d=o;3!==o&&(d=3);var _=i;2!==i&&(_=2);var p=this.wid_/475,f=this.hgt_/(r?440:360);this.origScl_=Math.min(p,f),t.prototype.init.call(this,e,_,d,n,s,r,a,h,l,c,u)},e}(H),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c){void 0===i&&(i=3),void 0===o&&(o=3),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=5),void 0===l&&(l=""),void 0===c&&(c=0);var u=o;3!==o&&(u=3);var d=i;3!==i&&(d=3);var _=this.wid_/440,p=this.hgt_/(r?600:500);this.origScl_=Math.min(_,p),t.prototype.init.call(this,e,d,u,n,s,r,a,h,l,c)},e}(H),q=function(t){function e(e){var i=t.call(this,e)||this;if(i.block_=null,e){i.block_=e.getChild("block").asCom,i.block_.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height);var o=C.instance.getCenterXY(),n=i.block_.localToGlobal(),s=o.x-n.x,r=o.y-n.y,a=i.block_.x,h=i.block_.y;i.block_.setPosition(a+s,h+r),i.block_.onClick(i._onClick,i)}return i}return o(e,t),e.prototype.show=function(e,i){void 0===e&&(e=""),void 0===i&&(i=!1),t.prototype.show.call(this,e,i),this.block_.visible=!0},e.prototype._onClick=function(){this.block_.visible=!1,this.hide()},e}(K),Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c){void 0===i&&(i=4),void 0===o&&(o=3),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=5),void 0===l&&(l=""),void 0===c&&(c=0);var u=o;3!==o&&(u=3);var d=i;4!==i&&(d=4);this.wid_,this.hgt_;this.origScl_=1.05,t.prototype.init.call(this,e,d,u,n,s,r,a,h,l,c)},e}(H),X=function(t){function e(e){var i=t.call(this,e)||this;if(i.block_=null,e){i.block_=e.getChild("block").asCom,i.block_.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height);var o=C.instance.getCenterXY(),n=i.block_.localToGlobal(),s=o.x-n.x,r=o.y-n.y,a=i.block_.x,h=i.block_.y;i.block_.setPosition(a+s,h+r),i.block_.onClick(i._onClick,i)}return i}return o(e,t),e.prototype.show=function(e,i){void 0===e&&(e=""),void 0===i&&(i=!1),t.prototype.show.call(this,e,i),this.block_.visible=!0},e.prototype._onClick=function(){this.block_.visible=!1,this.hide()},e}(Y),J=function(t){function e(e){var i=t.call(this,e)||this;return i.unfoldCallback_=null,i.foldCallback_=null,i.iconScl_=1,i.btnOrigY_=0,i.btnDistY_=0,i.btnDestY_=0,i.foldState_=0,i.bUnfolded_=!1,i.bMirrow_=!1,i.bAuto_=!1,i.autoFoldTimer_=0,e&&(i.foldBtn_=e.getChild("foldBtn").asButton,i.btnTrans_=i.foldBtn_.getTransition("spring"),i.btnCtrl_=i.foldBtn_.getController("arrow"),i.btnOrigY_=i.foldBtn_.y,i.foldBtn_.onClick(i._onClick,i)),i}return o(e,t),e.prototype.init=function(e,i,o,n,s,r,a,h,l,c,u,d){void 0===i&&(i=3),void 0===o&&(o=3),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=5),void 0===l&&(l=""),void 0===c&&(c=0),void 0===u&&(u=1),void 0===d&&(d=!1);var _=o;o<2?_=2:o>3&&(_=3);var p=this.wid_/570,f=this.hgt_/(r?540:440);this.iconScl_=u,1==this.iconScl_?this.origScl_=Math.min(p,f):this.origScl_=1,t.prototype.init.call(this,e,i,_,n,s,r,a,h,l,c),this.bMirrow_=d},e.prototype.appendExtraFunc=function(t,e,i,o,s,r){void 0===i&&(i=n.kNone),void 0===o&&(o=5),void 0===s&&(s=null),void 0===r&&(r=null);for(var h=0;h<this.navItemArr_.length;++h)this.navItemArr_[h].appendExtraFunc(t,e,i,-1,a.G.randRange(1,5));this.foldCallback_=s,this.unfoldCallback_=r},e.prototype.show=function(e,i){void 0===e&&(e=""),void 0===i&&(i=!1),t.prototype.show.call(this,e,i),this.btnTrans_.play(null,-1)},e.prototype.showTM=function(e){t.prototype.showTM.call(this,e),this.btnTrans_.play(null,-1)},e.prototype.hide=function(){t.prototype.hide.call(this),this.btnTrans_.stop()},e.prototype.autoUnfold=function(){this._onClick(),this.bAuto_=!0,this.autoFoldTimer_=0},e.prototype.fold=function(){2==this.foldState_&&this._onClick()},e.prototype.update=function(t){if(this.com_.visible){if(1==this.foldState_)this.moveDist_=this.moveDist_/2,this.bMirrow_?this.com_.x-=this.moveDist_:this.com_.x+=this.moveDist_,Math.abs(this.moveDist_)<=5&&(this.foldState_=2,this.bMirrow_?this.com_.x=this.com_.parent.width-this.com_.width:this.com_.x=0,this.btnCtrl_.selectedIndex=1,this.btnTrans_.stop(),C.instance.block(!0,this._onClick.bind(this)),this.unfoldCallback_&&this.unfoldCallback_());else if(2==this.foldState_){if(this.bAuto_&&(this.autoFoldTimer_+=t,this.autoFoldTimer_>=5&&(this.bAuto_=!1)),this.navItemArr_.length>0){for(var e=0;e<this.navItemArr_.length;++e)this.navItemArr_[e].update(t);this.bScroll_||(this.updTimer_+=t,this.updTimer_>=this.updDura_&&(this.bScroll_=!0,this.updTimer_=0,1==this.clipArea_.scrollPane.percY?this.clipArea_.scrollPane.scrollTop(!0):(this.bName_?this.moveDist_=(180+this.rowPitch_)*this.origScl_:this.moveDist_=(140+this.rowPitch_)*this.origScl_,this.clipArea_.scrollPane.scrollStep=this.moveDist_,this.clipArea_.scrollPane.scrollDown(1,!0))))}}else 3==this.foldState_&&(this.moveDist_=this.moveDist_/2,this.bMirrow_?this.com_.x+=this.moveDist_:this.com_.x-=this.moveDist_,Math.abs(this.moveDist_)<=5&&(this.foldState_=0,this.bMirrow_?this.com_.x=this.com_.parent.width-this.foldBtn_.width:this.com_.x=-this.com_.width+this.foldBtn_.width,this.btnCtrl_.selectedIndex=0,this.btnTrans_.play(null,-1),C.instance.unblock(),this.foldCallback_&&this.foldCallback_()));0!=this.btnDistY_&&(this.btnDistY_=this.btnDistY_/2,this.foldBtn_.y+=this.btnDistY_,Math.abs(this.foldBtn_.y-this.btnDestY_)<=2&&(this.foldBtn_.y=this.btnDestY_,this.btnDistY_=0))}},e.prototype.buildSingles=function(){if(this.navDatArr_.length>0){var t=this.bName_?180:140,e=this.clipArea_.height-t*this.row_*this.origScl_;if(this.rowPitch_<0){var i=e*this.origScl_/this.row_;this.rowPitch_+=i}else{var o=this.row_-1;o<=0&&(o=1),this.rowPitch_+=e*this.origScl_/o}for(var n=0,s=0,r=0;r<this.navDatArr_.length;++r)this._createSingle(n,s,this.bName_,this.bFrame_,this.iconScl_),++s>=this.col_&&(++n,s=0)}},e.prototype._onClick=function(){0!==this.foldState_&&2!==this.foldState_||(this.bUnfolded_?(this.foldState_=3,this.moveDist_=this.com_.width-130,this.btnDistY_=this.btnOrigY_-this.foldBtn_.y,this.btnDestY_=this.btnOrigY_,this.bUnfolded_=!1,this.bAuto_&&(this.bAuto_=!1,this.autoFoldTimer_=0)):(a.G.isTMSDK||this._randomInfo(),this.foldState_=1,this.moveDist_=this.com_.width-130,this.btnDistY_=10-this.btnOrigY_,this.btnDestY_=10,this.bUnfolded_=!0,this.bAuto_&&(this.bAuto_=!1,this.autoFoldTimer_=0)))},e}(j),Q=!0,Z=!0,$=function(){function t(t){void 0===t&&(t=!1);var e=this;if(this.com_=null,this.topScroll_=null,this.midScroll_=null,this.blockCom_=null,this.closeBtn_=null,this.continueGameBtn_=null,this.showTrans_=null,this.navDatArr_=[],this.topNavIdx_=0,this.midNavIdx_=0,this.topNavItems_=[],this.midNavItems_=[],this.showTransIdx_=0,this.transRandIdxArr_=[],this.showTimer_=0,this.stepTimer_=0,this.bShowItems_=!1,this.midGrids_=0,this.colPitch_=0,this.bName_=!1,this.nameClr_="",this.updTopTimer_=0,this.updMidTimer_=0,this.bTopScroll_=!1,this.bMidScroll_=!1,this.bMidDown_=!0,this.missDownX_=-1,this.missDownY_=-1,this.bMissingClick_=!1,this.bInited_=!1,this.bClicked_=!1,this.bBnrJumping_=!1,this.bBnrJump_=!1,this.bExportMissClick_=!1,this.bBnrMissClick_=!1,this.midMoveSpd_=0,!t){this.bExportMissClick_=Q,this.bBnrMissClick_=Z;var i=fgui.UIPackage.createObject("HDSDK","VerPage");if(i){this.com_=i.asCom,this.com_.visible=!1,i.sortingOrder=s.UIHierarchy.kExportPage;var o=this.com_.getChild("top").asCom;o&&(this.topScroll_=o.getChild("list").asCom,this.topScroll_.on(fgui.Event.SCROLL,this._onTopScrolling,this),this.topScroll_.on(fgui.Event.SCROLL_END,this._onTopScrollEnd,this));var n=this.com_.getChild("scroll");n&&(this.midScroll_=n.asCom,this.midScroll_.on(fgui.Event.SCROLL,this._onMidScrolling,this),this.midScroll_.on(fgui.Event.SCROLL_END,this._onMidScrollEnd,this)),g.TimedTaskInst.add(function(){e.bTopScroll_=!1,e.bMidScroll_=!1},.5),this.blockCom_=this.com_.getChild("block").asCom;var r=this.blockCom_.getChild("bg");r&&(r.visible=!1),this.closeBtn_=this.com_.getChild("closeBtn").asButton,this.continueGameBtn_=this.com_.getChild("continueGameBtn").asButton,this.closeBtn_.onClick(this._onClose,this),this.continueGameBtn_.onClick(this._onContinue,this),this.showTrans_=this.com_.getTransition("show")}}}return t.prototype.init=function(t,e,i,o){void 0===i&&(i=!1),void 0===o&&(o=""),this.com_&&!this.bInited_&&(this.com_.setSize(e.width,e.height),e.addChild(this.com_),this.navDatArr_=t,this.bName_=i,this.nameClr_=o,a.G.isTMSDK||this._initIcons(),this.hide(),this.bInited_=!0)},t.prototype.appendExtraFunc=function(t,e,i,o){void 0===i&&(i=n.kNone),void 0===o&&(o=5);for(var s=0;s<this.topNavItems_.length;++s)this.topNavItems_[s].appendExtraFunc(t,e,i,-1,o);for(s=0;s<this.midNavItems_.length;++s)this.midNavItems_[s].appendExtraFunc(t,e,i,-1,o)},t.prototype.update=function(t){if(this.com_.visible)if(this.bShowItems_){if(this.showTimer_+=t,this.stepTimer_+=t,this.stepTimer_>=.03&&this.showTransIdx_<this.midNavItems_.length){if(null!=this.transRandIdxArr_[this.showTransIdx_]){var e=this.transRandIdxArr_[this.showTransIdx_];this.midNavItems_[e]&&this.midNavItems_[e].playTrans(n.kFade)}this.stepTimer_-=.03,++this.showTransIdx_}if(this.showTimer_>=.5){for(var i=0;i<this.midNavItems_.length;++i)i<this.midGrids_&&(this.midNavItems_[i].alpha=1);this.bShowItems_=!1,this.showTimer_=0}}else{for(i=0;i<this.topNavItems_.length;++i)this.topNavItems_[i].update(t);for(i=0;i<this.midNavItems_.length;++i)this.midNavItems_[i].update(t);this.bTopScroll_||(this.updTopTimer_+=t,this.updTopTimer_>=2&&(this.bTopScroll_=!0,this.updTopTimer_=0,1==this.topScroll_.scrollPane.percX?this.topScroll_.scrollPane.scrollLeft(this.topNavItems_.length,!0):(this.topScroll_.scrollPane.scrollStep=.86*T+12,this.topScroll_.scrollPane.scrollRight(1,!0)))),this.bMidScroll_||this.bClicked_||(this.updMidTimer_+=t,this.updMidTimer_>=1&&(1==this.midScroll_.scrollPane.percY?(this.midMoveSpd_=0,this.midScroll_.scrollPane.scrollTop(!0),this.updMidTimer_=0):(this.midMoveSpd_+=2,this.midScroll_.scrollPane.setPosY(this.midMoveSpd_,!0))))}},t.prototype.show=function(t){var e=this;if(void 0===t&&(t=""),this.com_&&!this.com_.visible){this.midMoveSpd_=0,this.bClicked_=!1,this.bBnrJumping_=!1,this.bBnrJump_=this.bBnrMissClick_&&f.GameUserInfo.isBannerClickAvailable&&a.G.randRange(1,100)<=l.DataHub.config.bnrJumpProb,this.bBnrJump_&&(g.TimedTaskInst.add(function(){p.MgpUtil.showBanner(i.ExportUIInst.getPageBannerID()),g.TimedTaskInst.add(function(){p.MgpUtil.hideBanner(i.ExportUIInst.getPageBannerID()),e.bBnrJumping_=!1},1.5)},a.G.randRangeF(1,1.5)),this.bBnrJumping_=!0),this.com_.visible=!0,this.bExportMissClick_&&(this.com_.node.on(cc.Node.EventType.TOUCH_START,this._onDown,this),this.com_.node.on(cc.Node.EventType.TOUCH_MOVE,this._onMove,this),this.com_.node.on(cc.Node.EventType.TOUCH_END,this._onUp,this)),this.closeBtn_&&(this.closeBtn_.visible=!this.bBnrJump_),this.transRandIdxArr_.sort(function(t,e){return Math.random()>.5?-1:1});for(var o=0;o<this.topNavItems_.length;++o)this.topNavItems_[o].show(t,!1);this.midNavIdx_=a.G.randRange(0,this.midNavItems_.length-1);for(o=0;o<this.midNavItems_.length;++o)if(o<this.midGrids_&&(this.midNavItems_[o].alpha=0),this.midNavItems_[o].show(t,!1),!a.G.isTMSDK){var n=this._getNextMidNavData();n&&this.midNavItems_[o].updateInfo(n)}this.midScroll_.scrollPane.scrollTop(!1),this.blockCom_.visible=!0,this.showTrans_?this.showTrans_.play(this._onShowOver.bind(this),1,0,2):this._onShowOver(),this.showTimer_=0,this.showTransIdx_=0,this.bShowItems_=!0,C.instance.uploadLog(t,"\u5c55\u793a")}},t.prototype.showTM=function(t){var e=this;wx.tmSDK.getFlowConfig({positionId:t}).then(function(t){if(t.isOpen){console.log("[VPageShow showTM] download data");var i=t.creatives;i&&(e._tmSdkDataProc(i),e.show())}})},t.prototype.hide=function(){this.com_&&(this.com_.visible=!1,this.bExportMissClick_&&(this.com_.node.off(cc.Node.EventType.TOUCH_START,this._onDown,this),this.com_.node.off(cc.Node.EventType.TOUCH_MOVE,this._onMove,this),this.com_.node.off(cc.Node.EventType.TOUCH_END,this._onUp,this))),this.showTrans_&&this.showTrans_.stop()},t.prototype._initIcons=function(){for(var t=0;t<this.navDatArr_.length;++t)this._createTopSingle(0,t,this.topScroll_);this.topScroll_.scrollPane.scrollLeft(),this.colPitch_=(this.midScroll_.width-3*x*1.37)/2,this.midGrids_=9;var e=this.navDatArr_.length>this.midGrids_?this.navDatArr_.length:this.midGrids_,i=0,o=0;for(t=0;t<e;++t)this._createMidSingle(i,o,this.midScroll_),t<this.midGrids_&&(this.transRandIdxArr_[t]=t),++o>=3&&(++i,o=0)},t.prototype._tmSdkDataProc=function(t){this.navDatArr_.length!=t.length&&(console.log("[RCShow _tmSdkDataProc] data length different"),this.navDatArr_=[],this.topNavItems_=[],this.midNavItems_=[],this.topScroll_.removeChildren(),this.midScroll_.removeChildren());for(var e=0;e<t.length;++e){var i=null;i=this.topNavItems_.length>0&&this.navDatArr_[e]||new h.HDNavData,t[e].show_config&&(i.img=t[e].show_config.image,i.name=t[e].show_config.title),i.tmPosId=t[e].positionId,i.tmCid=t[e].creativeId,this.navDatArr_[e]||this.navDatArr_.push(i)}if(this.topNavItems_.length>0||this.midNavItems_.length>0){for(e=0;e<this.topNavItems_.length;++e){(i=this._getNextTopNavData())&&this.topNavItems_[e].updateInfo(i)}for(e=0;e<this.midNavItems_.length;++e){(i=this._getNextMidNavData())&&this.midNavItems_[e].updateInfo(i)}}else this._initIcons()},t.prototype._tmRefreshCallback=function(t,e){var i=t;i&&(console.log("[VPageShow _tmRefreshCallback]"),this._tmSdkDataProc(i))},t.prototype._onTopScrolling=function(){this.updTopTimer_>0&&(this.bTopScroll_=!0)},t.prototype._onTopScrollEnd=function(){this.bTopScroll_=!1,this.updTopTimer_=0},t.prototype._onMidScrolling=function(){},t.prototype._onMidScrollEnd=function(){},t.prototype._onShowOver=function(){this.blockCom_.visible=!1},t.prototype._onClose=function(){C.instance.hidePage()},t.prototype._onContinue=function(){this.bBnrMissClick_?this.bBnrJump_&&""!=i.ExportUIInst.getPageBannerID()&&this.bBnrJumping_||i.ExportUIInst.hidePage():C.instance.hidePage()},t.prototype._onDown=function(t){this.missDownX_=t.getLocationX(),this.missDownY_=t.getLocationY(),this.bMissingClick_=!1,this.bClicked_=!0},t.prototype._onMove=function(t){if(-1!=this.missDownX_&&-1!=this.missDownY_){var e=Math.abs(t.getLocationX()-this.missDownX_),i=Math.abs(t.getLocationY()-this.missDownY_);if((e>10||i>10)&&!this.bMissingClick_){if(a.G.randRange(0,100)<=l.DataHub.config.fakeBtnClick){var o=t.getLocationX(),n=t.getLocationY(),s=this.topScroll_.localToGlobal().x,r=this.topScroll_.localToGlobal().y,h=this.topScroll_.width,c=this.topScroll_.height,u=this.midScroll_.localToGlobal().x,d=this.midScroll_.localToGlobal().y,_=this.midScroll_.width,p=this.midScroll_.height;if(n<d&&n>r){var f=this.topScroll_.getFirstChildInView();o<s?o=s:o>s+h&&(o=s+h),n<r?n=r:n>r+c&&(n=r+c);var g=h/4,m=Math.floor((o-s)/g);(v=this.topNavItems_[f+m])&&v.clickTrigger()}else if(n>d&&n<d+p){f=this.midScroll_.getFirstChildInView();o<u?o=u:o>u+_&&(o=u+_),n<d?n=d:n>d+p&&(n=d+p);g=_/3;var v,y=p/3,b=(m=Math.floor((o-u)/g),Math.floor((n-d)/y));(v=this.midNavItems_[f+m+3*b])&&v.clickTrigger()}}this.bMissingClick_=!0}}},t.prototype._onUp=function(){this.bMissingClick_=!0,this.missDownX_=-1,this.missDownY_=-1},t.prototype._createTopSingle=function(t,e,i){var o=this._getNextTopNavData();if(o){var n=null;if(this.bName_){var s=fgui.UIPackage.createObject("HDSDK","NavItemEx").asCom;(n=new M(s)).init(o,!0,this.nameClr_),n.setCancelJumpActive(!1),n.addToParent(i,e*x*.86+12*e,0,.86),n.show(),n.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this))}else{s=fgui.UIPackage.createObject("HDSDK","NavItem").asCom;(n=new k(s)).init(o,!0),n.setCancelJumpActive(!1),n.addToParent(i,e*T*.86+12*e,0,.86),n.show(),n.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this))}n&&this.topNavItems_.push(n)}},t.prototype._createMidSingle=function(t,e,i){var o=this._getNextMidNavData();if(o){var s=fgui.UIPackage.createObject("HDSDK","NavItemEx").asCom,r=new M(s);r.init(o,!0),r.setCancelJumpActive(!1),r.addToParent(i,e*x*1.37+e*this.colPitch_,1.37*(180*t+10*t),1.37),r.appendExtraFunc(null,null,1===o.tag?n.kSpring:n.kNone),r.show(),r.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this)),this.midNavItems_.push(r)}},t.prototype._getNextTopNavData=function(){var t=null;return this.navDatArr_.length>0&&(t=this.navDatArr_[this.topNavIdx_],++this.topNavIdx_,this.topNavIdx_>=this.navDatArr_.length&&(this.topNavIdx_=0)),t},t.prototype._getNextMidNavData=function(){var t=null;return this.navDatArr_.length>0&&(t=this.navDatArr_[this.midNavIdx_],++this.midNavIdx_,this.midNavIdx_>=this.navDatArr_.length&&(this.midNavIdx_=0)),t},t}(),tt=function(){function t(){var t=this;this.com_=null,this.topScroll_=null,this.midScroll_=null,this.bnrScroll_=null,this.blockCom_=null,this.closeBtn_=null,this.prevBtn_=null,this.nextBtn_=null,this.tabGrp_=null,this.tabCtrl_=null,this.navDatArr_=[],this.bnrDatArr_=[],this.topNavIdx_=0,this.midNavIdx_=0,this.bnrNavIdx_=0,this.topNavItems_=[],this.midNavItems_=[],this.bnrNavItems_=[],this.showTransIdx_=0,this.transRandIdxArr_=[],this.showTimer_=0,this.stepTimer_=0,this.bShowItems_=!1,this.colPitch_=0,this.bName_=!1,this.nameClr_="",this.updTopTimer_=0,this.updMidTimer_=0,this.updBnrTimer_=0,this.bTopScroll_=!1,this.bMidScroll_=!1,this.bBnrScroll_=!1,this.bMidDown_=!0,this.bInited_=!1;var e=fgui.UIPackage.createObject("HDSDK","HorPage");if(e){this.com_=e.asCom,this.com_.visible=!1,e.sortingOrder=s.UIHierarchy.kExportPage;var i=this.com_.getChild("bnrShow").asCom;i&&(this.topScroll_=i.getChild("horScroll").asCom,this.topScroll_.on(fgui.Event.SCROLL,this._onTopScrolling,this),this.topScroll_.on(fgui.Event.SCROLL_END,this._onTopScrollEnd,this),this.bnrScroll_=i.getChild("verScroll").asCom,this.bnrScroll_.on(fgui.Event.SCROLL,this._onBnrScrolling,this),this.bnrScroll_.on(fgui.Event.SCROLL_END,this._onBnrScrollEnd,this));var o=this.com_.getChild("scroll");o&&(this.midScroll_=o.asCom,this.midScroll_.on(fgui.Event.SCROLL,this._onMidScrolling,this),this.midScroll_.on(fgui.Event.SCROLL_END,this._onMidScrollEnd,this)),g.TimedTaskInst.add(function(){t.bBnrScroll_=!1,t.bMidScroll_=!1,t.bTopScroll_=!1},.5),this.blockCom_=this.com_.getChild("block").asCom;var n=this.blockCom_.getChild("bg");n&&(n.visible=!1),this.closeBtn_=this.com_.getChild("closeBtn").asButton,this.closeBtn_.onClick(this._onClose,this),this.prevBtn_=this.com_.getChild("prevBtn").asButton,this.prevBtn_.onClick(this._onPrev,this),this.nextBtn_=this.com_.getChild("nextBtn").asButton,this.nextBtn_.onClick(this._onNext,this),this.tabCtrl_=this.com_.getController("tab"),this.tabGrp_=this.com_.getChild("TabGrp").asGroup}}return t.prototype.init=function(t,e,i,o,n){void 0===o&&(o=!1),void 0===n&&(n=""),this.com_&&!this.bInited_&&(this.com_.setSize(i.width,i.height),i.addChild(this.com_),this.navDatArr_=t,this.bnrDatArr_=e,e.length<4?(this.prevBtn_.visible=!1,this.nextBtn_.visible=!1,this.tabGrp_.visible=!1):(this.prevBtn_.visible=!0,this.nextBtn_.visible=!0,this.tabGrp_.visible=!0),this.bName_=o,this.nameClr_=n,a.G.isTMSDK||this._initIcons(),this.hide(),this.bInited_=!0)},t.prototype.appendExtraFunc=function(t,e,i,o){void 0===i&&(i=n.kNone),void 0===o&&(o=5);for(var s=0;s<this.topNavItems_.length;++s)this.topNavItems_[s].appendExtraFunc(t,e,i,-1,o);for(s=0;s<this.midNavItems_.length;++s)this.midNavItems_[s].appendExtraFunc(t,e,i,-1,o);for(s=0;s<this.bnrNavItems_.length;++s)this.bnrNavItems_[s].appendExtraFunc(t,e,i,-1,o)},t.prototype.update=function(t){if(this.com_.visible)if(this.bShowItems_){if(this.showTimer_+=t,this.stepTimer_+=t,this.stepTimer_>=.02&&this.showTransIdx_<this.midNavItems_.length){if(null!=this.transRandIdxArr_[this.showTransIdx_]){var e=this.transRandIdxArr_[this.showTransIdx_];this.midNavItems_[e]&&this.midNavItems_[e].playTrans(n.kFade)}this.stepTimer_-=.02,++this.showTransIdx_}if(this.showTimer_>=.4){for(var i=0;i<this.midNavItems_.length;++i)i<15&&(this.midNavItems_[i].alpha=1);this.bShowItems_=!1,this.showTimer_=0,this.blockCom_.visible=!1}}else if(1===this.tabCtrl_.selectedIndex){for(i=0;i<this.topNavItems_.length;++i)this.topNavItems_[i].update(t);this.bTopScroll_||(this.updTopTimer_+=t,this.updTopTimer_>=2&&(this.bTopScroll_=!0,this.updTopTimer_=0,1==this.topScroll_.scrollPane.percX?this.topScroll_.scrollPane.scrollLeft(this.topNavItems_.length,!0):(this.topScroll_.scrollPane.scrollStep=T+20,this.topScroll_.scrollPane.scrollRight(1,!0))));for(i=0;i<this.bnrNavItems_.length;++i)this.bnrNavItems_[i].update(t);this.bBnrScroll_||(this.updBnrTimer_+=t,this.updBnrTimer_>=2&&(this.bBnrScroll_=!0,this.updBnrTimer_=0,1==this.bnrScroll_.scrollPane.percY?this.bnrScroll_.scrollPane.scrollTop(!0):(this.bnrScroll_.scrollPane.scrollStep=140,this.bnrScroll_.scrollPane.scrollDown(1,!0))))}else{for(i=0;i<this.midNavItems_.length;++i)this.midNavItems_[i].update(t);this.bMidScroll_||(this.updMidTimer_+=t,this.updMidTimer_>=2&&(this.bMidScroll_=!0,this.updMidTimer_=0,1==this.midScroll_.scrollPane.percY?this.midScroll_.scrollPane.scrollTop(!0):(this.midScroll_.scrollPane.scrollStep=200,this.midScroll_.scrollPane.scrollDown(1,!0))))}},t.prototype.show=function(t){if(void 0===t&&(t=""),this.com_&&!this.com_.visible){this.com_.visible=!0,this.transRandIdxArr_.sort(function(t,e){return Math.random()>.5?-1:1});for(var e=0;e<this.topNavItems_.length;++e)this.topNavItems_[e].show(t,!1);this.midNavIdx_=a.G.randRange(0,this.midNavItems_.length-1);for(e=0;e<this.midNavItems_.length;++e){e<15&&(this.midNavItems_[e].alpha=0),this.midNavItems_[e].show(t,!1);var i=this._getNextMidNavData();i&&this.midNavItems_[e].updateInfo(i)}this.midScroll_.scrollPane.scrollTop(!1),this.blockCom_.visible=!0,this.showTimer_=0,this.showTransIdx_=0,this.bShowItems_=!0,this.tabCtrl_.selectedIndex=0,C.instance.uploadLog(t,"\u5c55\u793a")}},t.prototype.showTM=function(t){var e=this;wx.tmSDK.getFlowConfig({positionId:t}).then(function(t){if(t.isOpen){console.log("[HPageShow showTM] download data");var i=t.creatives;i&&(e._tmSdkDataProc(i),e.show())}})},t.prototype.hide=function(){this.com_&&(this.com_.visible=!1)},t.prototype._tmSdkDataProc=function(t){this.navDatArr_.length!=t.length&&(console.log("[HPageShow _tmSdkDataProc] data length different"),this.navDatArr_=[],this.midNavItems_=[],this.midScroll_.removeChildren());for(var e=0;e<t.length;++e){var i=null;i=this.topNavItems_.length>0&&this.navDatArr_[e]||new h.HDNavData,t[e].show_config&&(i.img=t[e].show_config.image,i.name=t[e].show_config.title),i.tmPosId=t[e].positionId,i.tmCid=t[e].creativeId,this.navDatArr_[e]||this.navDatArr_.push(i)}if(this.midNavItems_.length>0)for(e=0;e<this.midNavItems_.length;++e){(i=this._getNextMidNavData())&&this.midNavItems_[e].updateInfo(i)}else this._initIcons()},t.prototype._tmRefreshCallback=function(t,e){var i=t;i&&(console.log("[HPageShow _tmRefreshCallback]"),this._tmSdkDataProc(i))},t.prototype._initIcons=function(){this.colPitch_=(this.midScroll_.width-5*x*1)/4;for(var t=this.navDatArr_.length>15?this.navDatArr_.length:15,e=0,i=0,o=0;o<t;++o)this._createMidSingle(e,i,this.midScroll_),o<15&&(this.transRandIdxArr_[o]=o),++i>=5&&(++e,i=0);if(!a.G.isTMSDK){for(o=0;o<this.navDatArr_.length;++o)this._createTopSingle(0,o,this.topScroll_);this.topScroll_.scrollPane.scrollLeft(),e=0,i=0;for(o=0;o<this.bnrDatArr_.length;++o)this._createBnrSingle(e,i,this.bnrScroll_),++i>=2&&(++e,i=0)}},t.prototype._onTopScrolling=function(){this.updTopTimer_>0&&(this.bTopScroll_=!0)},t.prototype._onTopScrollEnd=function(){this.bTopScroll_=!1,this.updTopTimer_=0},t.prototype._onMidScrolling=function(){this.updMidTimer_>0&&(this.bMidScroll_=!0)},t.prototype._onMidScrollEnd=function(){this.bMidScroll_=!1,this.updMidTimer_=0},t.prototype._onBnrScrolling=function(){this.updBnrTimer_>0&&(this.bBnrScroll_=!0)},t.prototype._onBnrScrollEnd=function(){this.bBnrScroll_=!1,this.updBnrTimer_=0},t.prototype._onShowOver=function(){this.blockCom_.visible=!1},t.prototype._onClose=function(){C.instance.hidePage()},t.prototype._onPrev=function(){var t=this.tabCtrl_.selectedIndex;--t,this.tabCtrl_.selectedIndex=t<0?1:t},t.prototype._onNext=function(){var t=this.tabCtrl_.selectedIndex;++t,this.tabCtrl_.selectedIndex=t>1?0:t},t.prototype._createTopSingle=function(t,e,i){var o=this._getNextTopNavData();if(o){var n=null;if(this.bName_){var s=fgui.UIPackage.createObject("HDSDK","NavItemEx").asCom;(n=new M(s)).init(o,!0,this.nameClr_),n.setCancelJumpActive(!1),n.addToParent(i,e*x*.86+12*e,0,.86),n.show()}else{s=fgui.UIPackage.createObject("HDSDK","NavItem").asCom;(n=new k(s)).init(o,!0),n.setCancelJumpActive(!1),n.addToParent(i,e*T*.86+12*e,0,.86),n.show()}n&&this.topNavItems_.push(n)}},t.prototype._createMidSingle=function(t,e,i){var o=this._getNextMidNavData();if(o){var s=fgui.UIPackage.createObject("HDSDK","NavItemEx").asCom,r=new M(s);r.init(o,!0),r.setCancelJumpActive(!1),r.addToParent(i,e*x*1+e*this.colPitch_,1*(180*t+20*t),1),r.appendExtraFunc(null,null,1===o.tag?n.kSpring:n.kNone),r.show(),r.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this)),this.midNavItems_.push(r)}},t.prototype._createBnrSingle=function(t,e,i){var o=this._getNextBnrNavData();if(o){var s=fgui.UIPackage.createObject("HDSDK","NavBnr").asCom,r=new O(s);r.init(o,!0),r.setCancelJumpActive(!1),r.addToParent(i,e*B+60*e,120*t+20*t,1),r.appendExtraFunc(null,null,1===o.tag?n.kSpring:n.kNone),r.show(),this.bnrNavItems_.push(r)}},t.prototype._getNextTopNavData=function(){var t=null;return this.navDatArr_.length>0&&(t=this.navDatArr_[this.topNavIdx_],++this.topNavIdx_,this.topNavIdx_>=this.navDatArr_.length&&(this.topNavIdx_=0)),t},t.prototype._getNextMidNavData=function(){var t=null;return this.navDatArr_.length>0&&(t=this.navDatArr_[this.midNavIdx_],++this.midNavIdx_,this.midNavIdx_>=this.navDatArr_.length&&(this.midNavIdx_=0)),t},t.prototype._getNextBnrNavData=function(){var t=null;return this.bnrDatArr_.length>0&&(t=this.bnrDatArr_[this.bnrNavIdx_],++this.bnrNavIdx_,this.bnrNavIdx_>=this.bnrDatArr_.length&&(this.bnrNavIdx_=0)),t},t}(),et=function(){function t(){this.com_=null,this.lst_=null,this.closeBtn_=null,this.platCtrl_=null,this.navDatArr_=[],this.topNavIdx_=0,this.navItems_=[],this.missDownY_=0,this.bMissingClick_=!1,this.bInited_=!1;var t=fgui.UIPackage.createObject("HDSDK","VFakePage");if(t){if(this.com_=t.asCom,this.com_.visible=!1,t.sortingOrder=s.UIHierarchy.kExportPage,this.platCtrl_=this.com_.getController("plat"),a.G.isMinigamePlat)"ios"==p.MgpUtil.sdkInfo.platform?this.platCtrl_.selectedIndex=0:this.platCtrl_.selectedIndex=1;var e=this.com_.getChild("content").asCom;e&&(this.lst_=e.getChild("list").asList),this.closeBtn_=this.com_.getChild("closeBtn").asButton,this.closeBtn_.onClick(this._onClose,this)}}return t.prototype.init=function(t,e){this.com_&&!this.bInited_&&(this.com_.setSize(e.width,e.height),e.addChild(this.com_),this.navDatArr_=t,a.G.isTMSDK||(this.lst_.defaultItem="ui://HDSDK/NavFake",this.lst_.itemRenderer=this._onLstRenderItem.bind(this),this.lst_.numItems=this.navDatArr_.length),this.hide(),this.bInited_=!0)},t.prototype.appendExtraFunc=function(t,e){for(var i=0;i<this.navItems_.length;++i)this.navItems_[i].appendExtraFunc(t,e,n.kNone,-1,-1)},t.prototype.show=function(t){if(void 0===t&&(t=""),this.com_&&!this.com_.visible){this.com_.visible=!0,this.com_.node.on(cc.Node.EventType.TOUCH_START,this._onDown,this,!0),this.com_.node.on(cc.Node.EventType.TOUCH_MOVE,this._onMove,this,!0),this.com_.node.on(cc.Node.EventType.TOUCH_END,this._onUp,this,!0);for(var e=0;e<this.navItems_.length;++e)this.navItems_[e].show(t,!1);C.instance.uploadLog(t,"\u5c55\u793a")}},t.prototype.showTM=function(t){var e=this;wx.tmSDK.getFlowConfig({positionId:t}).then(function(t){if(t.isOpen){console.log("[VFakePage showTM] download data");var i=t.creatives;i&&(e._tmSdkDataProc(i),e.show())}})},t.prototype.hide=function(){if(this.com_){this.com_.visible=!1,this.com_.node.off(cc.Node.EventType.TOUCH_START,this._onDown,this,!0),this.com_.node.off(cc.Node.EventType.TOUCH_MOVE,this._onMove,this,!0),this.com_.node.off(cc.Node.EventType.TOUCH_END,this._onUp,this,!0);for(var t=0;t<this.navItems_.length;++t)this.navItems_[t].hide()}},t.prototype._tmSdkDataProc=function(t){this.navDatArr_.length!=t.length&&(console.log("[VFakePage _tmSdkDataProc] data length different"),this.navDatArr_=[],this.navItems_=[],this.lst_.removeChildren());for(var e=0;e<t.length;++e){var i=null;i=this.navItems_.length>0&&this.navDatArr_[e]||new h.HDNavData,t[e].show_config&&(i.img=t[e].show_config.image,i.name=t[e].show_config.title),i.tmPosId=t[e].positionId,i.tmCid=t[e].creativeId,this.navDatArr_[e]||this.navDatArr_.push(i)}if(this.navItems_.length>0)for(e=0;e<this.navItems_.length;++e){(i=this._getNextNavData())&&this.navItems_[e].updateInfo(i)}else this.lst_.defaultItem="ui://HDSDK/NavFake",this.lst_.itemRenderer=this._onLstRenderItem.bind(this),this.lst_.numItems=this.navDatArr_.length},t.prototype._tmRefreshCallback=function(t,e){var i=t;i&&(console.log("[VFakePage _tmRefreshCallback]"),this._tmSdkDataProc(i))},t.prototype._onLstRenderItem=function(t,e){var i=this._getNextNavData();if(i){var o=new L(e.asCom);o.init(i),o.setCancelJumpActive(!1),o.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this)),this.navItems_.push(o)}},t.prototype._onDown=function(t){this.missDownY_=t.getLocationY(),this.bMissingClick_=!1},t.prototype._onMove=function(t){if(Math.abs(t.getLocationY()-this.missDownY_)>10&&!this.bMissingClick_){if(a.G.randRange(0,100)<l.DataHub.config.fakeBtnClick){var e=this.lst_.getFirstChildInView(),i=t.getLocationY(),o=this.lst_.localToGlobal().y,n=this.lst_.height;if(i>o){var s=n/7,r=Math.floor((i-o)/s),h=this.navItems_[e+r];h&&h.clickTrigger()}}this.bMissingClick_=!0}},t.prototype._onUp=function(){this.bMissingClick_=!0},t.prototype._onClose=function(){i.ExportUIInst.hideFakePage()},t.prototype._getNextNavData=function(){var t=null;return this.navDatArr_.length>0&&(t=this.navDatArr_[this.topNavIdx_],++this.topNavIdx_,this.topNavIdx_>=this.navDatArr_.length&&(this.topNavIdx_=0)),t},t}(),it=!0,ot=!0,nt=function(t){function e(){var e=t.call(this,!0)||this;e.topShowTransIdx_=0,e.topTransRandIdxArr_=[],e.topGrids_=0,e.bExportMissClick_=it,e.bBnrMissClick_=ot;var i=fgui.UIPackage.createObject("HDSDK","VGridPage");if(i){e.com_=i.asCom,e.com_.visible=!1,i.sortingOrder=s.UIHierarchy.kExportPage;var o=e.com_.getChild("topScroll").asCom;o&&(e.topScroll_=o.asCom,e.topScroll_.on(fgui.Event.SCROLL,e._onTopScrolling,e),e.topScroll_.on(fgui.Event.SCROLL_END,e._onTopScrollEnd,e));var n=e.com_.getChild("midScroll");n&&(e.midScroll_=n.asCom,e.midScroll_.on(fgui.Event.SCROLL,e._onMidScrolling,e),e.midScroll_.on(fgui.Event.SCROLL_END,e._onMidScrollEnd,e)),e.blockCom_=e.com_.getChild("block").asCom;var r=e.blockCom_.getChild("bg");r&&(r.visible=!1),e.continueGameBtn_=e.com_.getChild("continueGameBtn").asButton,e.continueGameBtn_.onClick(e._onContinue,e)}return e}return o(e,t),e.prototype.init=function(t,e,i,o){void 0===i&&(i=!1),void 0===o&&(o=""),this.com_&&!this.bInited_&&(this.com_.setSize(e.width,e.height),e.addChild(this.com_),this.navDatArr_=t,this.bName_=i,this.nameClr_=o,a.G.isTMSDK||this._initIcons(),this.hide(),this.bInited_=!0)},e.prototype.update=function(t){if(this.com_&&this.com_.visible)if(this.bShowItems_){if(this.showTimer_+=t,this.stepTimer_+=t,this.stepTimer_>=.03){if(this.topShowTransIdx_<this.topNavItems_.length){if(null!=this.topTransRandIdxArr_[this.topShowTransIdx_]){var e=this.topTransRandIdxArr_[this.topShowTransIdx_];this.topNavItems_[e]&&this.topNavItems_[e].playTrans(n.kFade)}++this.topShowTransIdx_}if(this.showTransIdx_<this.midNavItems_.length){if(null!=this.transRandIdxArr_[this.showTransIdx_]){e=this.transRandIdxArr_[this.showTransIdx_];this.midNavItems_[e]&&this.midNavItems_[e].playTrans(n.kFade)}++this.showTransIdx_}this.stepTimer_-=.03}if(this.showTimer_>=.5){for(var i=0;i<this.topNavItems_.length;++i)i<this.topGrids_&&(this.topNavItems_[i].alpha=1);for(i=0;i<this.midNavItems_.length;++i)i<this.midGrids_&&(this.midNavItems_[i].alpha=1);this.bShowItems_=!1,this.showTimer_=0}}else{for(i=0;i<this.topNavItems_.length;++i)this.topNavItems_[i].update(t);for(i=0;i<this.midNavItems_.length;++i)this.midNavItems_[i].update(t)}},e.prototype.show=function(e){if(void 0===e&&(e=""),this.com_&&!this.com_.visible){this.topTransRandIdxArr_.sort(function(t,e){return Math.random()>.5?-1:1}),this.topNavIdx_=a.G.randRange(0,this.topNavItems_.length-1);for(var i=0;i<this.topNavItems_.length;++i){i<this.topGrids_&&(this.topNavItems_[i].alpha=0),this.topNavItems_[i].show(e,!1);var o=this._getNextTopNavData();o&&this.topNavItems_[i].updateInfo(o)}this.topShowTransIdx_=0}t.prototype.show.call(this,e)},e.prototype._createTopSingle=function(t,e,i){var o=this._getNextTopNavData();if(o){var s=fgui.UIPackage.createObject("HDSDK","NavItemCnt").asCom,r=new E(s);r.init(o,!1,"#000000",!1),r.setCancelJumpActive(!1),r.randomCount(!0),r.addToParent(i,e*x*1+e*this.colPitch_,1*(200*t+0*t),1),r.appendExtraFunc(null,null,n.kShake,-1,a.G.randRange(3,10)),r.show(),r.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this)),this.topNavItems_.push(r)}},e.prototype._createMidSingle=function(t,e,i){var o=this._getNextMidNavData();if(o){var s=fgui.UIPackage.createObject("HDSDK","NavItemCnt").asCom,r=new E(s);r.init(o,!1,"#0000000",!1),r.setCancelJumpActive(!1),r.randomCount(!1),r.addToParent(i,e*x*1+e*this.colPitch_,1*(200*t+0*t),1),r.appendExtraFunc(null,null,n.kShake,-1,a.G.randRange(3,10)),r.show(),r.registerTMSDKRefreshCallback(this._tmRefreshCallback.bind(this)),this.midNavItems_.push(r)}},e.prototype._initIcons=function(){this.colPitch_=(this.midScroll_.width-4*x*1)/3,this.topGrids_=12;for(var t=this.navDatArr_.length>this.topGrids_?this.navDatArr_.length:this.topGrids_,e=0,i=0,o=0;o<t;++o)this._createTopSingle(e,i,this.topScroll_),o<this.topGrids_&&(this.topTransRandIdxArr_[o]=o),++i>=4&&(++e,i=0);this.colPitch_=(this.midScroll_.width-4*x*1)/3,this.midGrids_=8;var n=this.navDatArr_.length>this.midGrids_?this.navDatArr_.length:this.midGrids_;e=0,i=0;for(o=0;o<n;++o)this._createMidSingle(e,i,this.midScroll_),o<this.midGrids_&&(this.transRandIdxArr_[o]=o),++i>=4&&(++e,i=0)},e.prototype._onContinue=function(){this.bBnrMissClick_&&this.bBnrJump_&&""!=i.ExportUIInst.getPageBannerID()&&this.bBnrJumping_||i.ExportUIInst.hideGridPage()},e}($),st=function(){function t(){this.com_=null,this.clipFrame_=null,this.userName_=null,this.userIcon_=null,this.userTip_=null,this.showTrans_=null,this.hideTrans_=null,this.confirmBtn_=null,this.cancalBtn_=null,this.navDatArr_=[],this.navDatIdx_=0,this.navItem_=null,this.nameJson_=null,this.iconUrl_=null,this.userIdx_=0,this.bInited_=!1,this.com_=fgui.UIPackage.createObject("HDSDK","InvitePnl").asCom,this.com_.visible=!1,this.clipFrame_=this.com_.getChild("clipFrame").asCom,this.userName_=this.com_.getChild("userName").asTextField,this.userIcon_=this.com_.getChild("userIcon").asLoader,this.userTip_=this.com_.getChild("userTip").asTextField,this.showTrans_=this.com_.getTransition("show"),this.hideTrans_=this.com_.getTransition("hide"),this.confirmBtn_=this.com_.getChild("confirmBtn").asButton,this.cancalBtn_=this.com_.getChild("cancalBtn").asButton}return t.prototype.init=function(t,e,i,o){var n=this;void 0===i&&(i=!1),void 0===o&&(o=""),this.com_&&!this.bInited_&&(this.com_.setSize(e.width,e.height),e.addChild(this.com_),this.navDatArr_=t,this.cancalBtn_.onClick(this.hide,this),this.confirmBtn_.onClick(this._confirm,this),this.bInited_=!0,cc.loader.load("https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/GameRes/WxLikeness/NameCfg/name.json",null,function(t,e){t||n._loadName(e)}))},t.prototype._loadName=function(t){t&&(this.nameJson_=t)},t.prototype.show=function(t){void 0===t&&(t=""),this.userIdx_=a.G.randRange(1,100);var e=this.nameJson_?this.nameJson_[this.userIdx_].name:"\u4f60\u7684\u540d\u5b57";this.userName_.text=e,this.userTip_.setVar("name",e).flushVars(),this.userIcon_.url="https://huandong-1257458597.cos.ap-guangzhou.myqcloud.com/GameRes/WxLikeness/"+this.userIdx_+".png",this._createSingle(),this.com_.visible=!0,this.showTrans_.play()},t.prototype.showTM=function(t){var e=this;wx.tmSDK.getFlowConfig({positionId:t}).then(function(t){if(t.isOpen){console.log("[InvitePage showTM] download data");var i=t.creatives;i&&(e._tmSdkDataProc(i),e.show())}})},t.prototype.hide=function(){var t=this;this.hideTrans_.play(function(){t.com_.visible=!1})},t.prototype._confirm=function(){this.navItem_&&this.navItem_.clickTrigger()},t.prototype._tmSdkDataProc=function(t){this.navDatArr_.length!=t.length&&(console.log("[InvitePage _tmSdkDataProc] data length different"),this.navDatArr_=[]);for(var e=0;e<t.length;++e){var i=new h.HDNavData;t[e].show_config&&(i.img=t[e].show_config.image,i.name=t[e].show_config.title),i.tmPosId=t[e].positionId,i.tmCid=t[e].creativeId,this.navDatArr_[e]||this.navDatArr_.push(i)}},t.prototype._createSingle=function(t){void 0===t&&(t=2);var e=this._getNextNavData();if(e){var i=t,o=null,n=fgui.UIPackage.createObject("HDSDK","NavItem").asCom;(o=new k(n,!0)).init(e,!1),o.addToParent(this.clipFrame_,this.clipFrame_.width/2-T*i/2,this.clipFrame_.height/2-140*i/2,i),o.show(),this.navItem_=o}},t.prototype._getNextNavData=function(){var t=null;return this.navDatArr_.length>0&&(t=this.navDatArr_[this.navDatIdx_],++this.navDatIdx_,this.navDatIdx_>=this.navDatArr_.length&&(this.navDatIdx_=0)),t},t}();cc._RF.pop()},{"../../HDSDK":"HDSDK","../../data/data_hub":"data_hub","../../game/user_info":"user_info","../../util/audio_mgr":"audio_mgr","../../util/game_storage":"game_storage","../../util/global_def":"global_def","../../util/mgp_util":"mgp_util","../../util/structure/hd_map":"hd_map","../../util/timed_task":"timed_task","./base_ui":"base_ui","./dialog_ui":"dialog_ui","./tip_ui":"tip_ui"}],fairygui:[function(t,e,i){"use strict";cc._RF.push(e,"e4fc4CHKwdP3IvxP/DbOcX2","fairygui"),window.fgui={},window.fairygui=window.fgui,window.__extends=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),function(t){var e=function(){function e(){}return e.prototype.createObject=function(e,i){if(this._node)throw"Already running";var o=t.UIPackage.getByName(e);if(!o)throw new Error("package not found: "+e);var n=o.getItemByName(i);if(!n)throw new Error("resource not found: "+i);this.internalCreateObject(n)},e.prototype.createObjectFromURL=function(e){if(this._node)throw"Already running";var i=t.UIPackage.getItemByURL(e);if(!i)throw new Error("resource not found: "+e);this.internalCreateObject(i)},e.prototype.cancel=function(){this._node&&(this._node.destroy(),this._node=null)},e.prototype.internalCreateObject=function(t){this._node=new cc.Node("[AsyncCreating:"+t.name+"]"),this._node.parent=cc.director.getScene(),this._node.on("#",this.completed,this),this._node.addComponent(i).init(t)},e.prototype.completed=function(t){this.cancel(),this.callback&&this.callback(t)},e}();t.AsyncOperation=e;var i=function(e){function i(){var t=e.call(this)||this;return t._itemList=new Array,t._objectPool=new Array,t}return __extends(i,e),i.prototype.init=function(t){this._itemList.length=0,this._objectPool.length=0;var e=new o(t,0);e.childCount=this.collectComponentChildren(t),this._itemList.push(e),this._index=0},i.prototype.onDestroy=function(){this._itemList.length=0;var t=this._objectPool.length;if(t>0){for(var e=0;e<t;e++)this._objectPool[e].dispose();this._objectPool.length=0}},i.prototype.collectComponentChildren=function(e){var i,n,s,r,a,h,l=e.rawData;l.seek(0,2);var c=l.readShort();for(s=0;s<c;s++){r=l.readShort(),a=l.position,l.seek(a,0);var u=l.readByte(),d=l.readS(),_=l.readS();l.position=a,null!=d?(n=null!=(h=null!=_?t.UIPackage.getById(_):e.owner)?h.getItemById(d):null,i=new o(n,u),null!=n&&n.type==t.PackageItemType.Component&&(i.childCount=this.collectComponentChildren(n))):(i=new o(null,u),u==t.ObjectType.List&&(i.listItemCount=this.collectListChildren(l))),this._itemList.push(i),l.position=a+r}return c},i.prototype.collectListChildren=function(e){e.seek(e.position,8);var i,n,s,r,a,h=0,l=e.readS(),c=e.readShort();for(i=0;i<c;i++)n=e.readShort(),n+=e.position,null==(s=e.readS())&&(s=l),s&&null!=(r=t.UIPackage.getItemByURL(s))&&(a=new o(r,r.objectType),r.type==t.PackageItemType.Component&&(a.childCount=this.collectComponentChildren(r)),this._itemList.push(a),h++),e.position=n;return h},i.prototype.update=function(){for(var e,i,o,n,s=t.ToolSet.getTime(),r=t.UIConfig.frameTimeForAsyncUIConstruction,a=this._itemList.length;this._index<a;){if(null!=(i=this._itemList[this._index]).packageItem)e=t.UIObjectFactory.newObject(i.packageItem),this._objectPool.push(e),t.UIPackage._constructing++,i.packageItem.type==t.PackageItemType.Component?(o=this._objectPool.length-i.childCount-1,e.constructFromResource2(this._objectPool,o),this._objectPool.splice(o,i.childCount)):e.constructFromResource(),t.UIPackage._constructing--;else if(e=t.UIObjectFactory.newObject2(i.type),this._objectPool.push(e),i.type==t.ObjectType.List&&i.listItemCount>0){for(o=this._objectPool.length-i.listItemCount-1,n=0;n<i.listItemCount;n++)e.itemPool.returnObject(this._objectPool[n+o]);this._objectPool.splice(o,i.listItemCount)}if(this._index++,this._index%5==0&&t.ToolSet.getTime()-s>=r)return}var h=this._objectPool[0];this._itemList.length=0,this._objectPool.length=0,this.node.emit("#",h)},i}(cc.Component),o=function(){return function(t,e){this.packageItem=t,this.type=e}}()}(fgui||(fgui={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._selectedIndex=0,t._previousIndex=0,t.changing=!1,t._pageIds=[],t._pageNames=[],t._selectedIndex=-1,t._previousIndex=-1,t}return __extends(i,e),i.prototype.dispose=function(){},Object.defineProperty(i.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(e){if(this._selectedIndex!=e){if(e>this._pageIds.length-1)throw"index out of bounds: "+e;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=e,this.parent.applyController(this),this.emit(t.Event.STATUS_CHANGED,this),this.changing=!1}},enumerable:!0,configurable:!0}),i.prototype.onChanged=function(e,i){this.on(t.Event.STATUS_CHANGED,e,i)},i.prototype.offChanged=function(e,i){this.off(t.Event.STATUS_CHANGED,e,i)},i.prototype.setSelectedIndex=function(t){if(this._selectedIndex!=t){if(t>this._pageIds.length-1)throw"index out of bounds: "+t;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.parent.applyController(this),this.changing=!1}},Object.defineProperty(i.prototype,"previsousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedPage",{get:function(){return-1==this._selectedIndex?null:this._pageNames[this._selectedIndex]},set:function(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.selectedIndex=e},enumerable:!0,configurable:!0}),i.prototype.setSelectedPage=function(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.setSelectedIndex(e)},Object.defineProperty(i.prototype,"previousPage",{get:function(){return-1==this._previousIndex?null:this._pageNames[this._previousIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pageCount",{get:function(){return this._pageIds.length},enumerable:!0,configurable:!0}),i.prototype.getPageName=function(t){return this._pageNames[t]},i.prototype.addPage=function(t){void 0===t&&(t=""),this.addPageAt(t,this._pageIds.length)},i.prototype.addPageAt=function(t,e){var o=""+i._nextPageId++;e==this._pageIds.length?(this._pageIds.push(o),this._pageNames.push(t)):(this._pageIds.splice(e,0,o),this._pageNames.splice(e,0,t))},i.prototype.removePage=function(t){var e=this._pageNames.indexOf(t);-1!=e&&(this._pageIds.splice(e,1),this._pageNames.splice(e,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this))},i.prototype.removePageAt=function(t){this._pageIds.splice(t,1),this._pageNames.splice(t,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this)},i.prototype.clearPages=function(){this._pageIds.length=0,this._pageNames.length=0,-1!=this._selectedIndex?this.selectedIndex=-1:this.parent.applyController(this)},i.prototype.hasPage=function(t){return-1!=this._pageNames.indexOf(t)},i.prototype.getPageIndexById=function(t){return this._pageIds.indexOf(t)},i.prototype.getPageIdByName=function(t){var e=this._pageNames.indexOf(t);return-1!=e?this._pageIds[e]:null},i.prototype.getPageNameById=function(t){var e=this._pageIds.indexOf(t);return-1!=e?this._pageNames[e]:null},i.prototype.getPageId=function(t){return this._pageIds[t]},Object.defineProperty(i.prototype,"selectedPageId",{get:function(){return-1==this._selectedIndex?null:this._pageIds[this._selectedIndex]},set:function(t){var e=this._pageIds.indexOf(t);this.selectedIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"oppositePageId",{set:function(t){this._pageIds.indexOf(t)>0?this.selectedIndex=0:this._pageIds.length>1&&(this.selectedIndex=1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"previousPageId",{get:function(){return-1==this._previousIndex?null:this._pageIds[this._previousIndex]},enumerable:!0,configurable:!0}),i.prototype.runActions=function(){if(this._actions)for(var t=this._actions.length,e=0;e<t;e++)this._actions[e].run(this,this.previousPageId,this.selectedPageId)},i.prototype.setup=function(e){var i,o,n=e.position;e.seek(n,0),this.name=e.readS(),this.autoRadioGroupDepth=e.readBool(),e.seek(n,1);var s=e.readShort();for(i=0;i<s;i++)this._pageIds.push(e.readS()),this._pageNames.push(e.readS());var r=0;if(e.version>=2)switch(e.readByte()){case 1:r=e.readShort();break;case 2:-1==(r=this._pageNames.indexOf(t.UIPackage.branch))&&(r=0);break;case 3:-1==(r=this._pageNames.indexOf(t.UIPackage.getVar(e.readS())))&&(r=0)}if(e.seek(n,2),(s=e.readShort())>0)for(null==this._actions&&(this._actions=new Array),i=0;i<s;i++){o=e.readShort(),o+=e.position;var a=t.ControllerAction.createAction(e.readByte());a.setup(e),this._actions.push(a),e.position=o}null!=this.parent&&this._pageIds.length>0?this._selectedIndex=r:this._selectedIndex=-1},i._nextPageId=0,i}(cc.EventTarget);t.Controller=e}(fgui||(fgui={})),function(t){var e=function(){function e(){this._agent=new t.GLoader,this._agent.draggable=!0,this._agent.touchable=!1,this._agent.setSize(100,100),this._agent.setPivot(.5,.5,!0),this._agent.align=t.AlignType.Center,this._agent.verticalAlign=t.VertAlignType.Middle,this._agent.sortingOrder=1e6,this._agent.on(t.Event.DRAG_END,this.onDragEnd,this)}return Object.defineProperty(e,"inst",{get:function(){return null==e._inst&&(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragAgent",{get:function(){return this._agent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragging",{get:function(){return null!=this._agent.parent},enumerable:!0,configurable:!0}),e.prototype.startDrag=function(e,i,o,n){if(null==this._agent.parent){this._sourceData=o,this._agent.url=i,t.GRoot.inst.addChild(this._agent);var s=t.GRoot.inst.getTouchPosition(n);s=t.GRoot.inst.globalToLocal(s.x,s.y),this._agent.setPosition(s.x,s.y),this._agent.startDrag(n)}},e.prototype.cancel=function(){null!=this._agent.parent&&(this._agent.stopDrag(),t.GRoot.inst.removeChild(this._agent),this._sourceData=null)},e.prototype.onDragEnd=function(){if(null!=this._agent.parent){t.GRoot.inst.removeChild(this._agent);var e=this._sourceData;this._sourceData=null;for(var i=t.GRoot.inst.touchTarget;null!=i;){if(i.node.hasEventListener(t.Event.DROP))return i.requestFocus(),void i.node.emit(t.Event.DROP,i,e);i=i.parent}}},e}();t.DragDropManager=e}(fgui||(fgui={})),function(t){(function(t){t[t.Common=0]="Common",t[t.Check=1]="Check",t[t.Radio=2]="Radio"})(t.ButtonMode||(t.ButtonMode={})),function(t){t[t.None=0]="None",t[t.Both=1]="Both",t[t.Height=2]="Height",t[t.Shrink=3]="Shrink"}(t.AutoSizeType||(t.AutoSizeType={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(t.AlignType||(t.AlignType={})),function(t){t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Bottom=2]="Bottom"}(t.VertAlignType||(t.VertAlignType={})),function(t){t[t.None=0]="None",t[t.Scale=1]="Scale",t[t.ScaleMatchHeight=2]="ScaleMatchHeight",t[t.ScaleMatchWidth=3]="ScaleMatchWidth",t[t.ScaleFree=4]="ScaleFree",t[t.ScaleNoBorder=5]="ScaleNoBorder"}(t.LoaderFillType||(t.LoaderFillType={})),function(t){t[t.SingleColumn=0]="SingleColumn",t[t.SingleRow=1]="SingleRow",t[t.FlowHorizontal=2]="FlowHorizontal",t[t.FlowVertical=3]="FlowVertical",t[t.Pagination=4]="Pagination"}(t.ListLayoutType||(t.ListLayoutType={})),function(t){t[t.Single=0]="Single",t[t.Multiple=1]="Multiple",t[t.Multiple_SingleClick=2]="Multiple_SingleClick",t[t.None=3]="None"}(t.ListSelectionMode||(t.ListSelectionMode={})),function(t){t[t.Visible=0]="Visible",t[t.Hidden=1]="Hidden",t[t.Scroll=2]="Scroll"}(t.OverflowType||(t.OverflowType={})),function(t){t[t.Image=0]="Image",t[t.MovieClip=1]="MovieClip",t[t.Sound=2]="Sound",t[t.Component=3]="Component",t[t.Atlas=4]="Atlas",t[t.Font=5]="Font",t[t.Swf=6]="Swf",t[t.Misc=7]="Misc",t[t.Unknown=8]="Unknown"}(t.PackageItemType||(t.PackageItemType={})),function(t){t[t.Image=0]="Image",t[t.MovieClip=1]="MovieClip",t[t.Swf=2]="Swf",t[t.Graph=3]="Graph",t[t.Loader=4]="Loader",t[t.Group=5]="Group",t[t.Text=6]="Text",t[t.RichText=7]="RichText",t[t.InputText=8]="InputText",t[t.Component=9]="Component",t[t.List=10]="List",t[t.Label=11]="Label",t[t.Button=12]="Button",t[t.ComboBox=13]="ComboBox",t[t.ProgressBar=14]="ProgressBar",t[t.Slider=15]="Slider",t[t.ScrollBar=16]="ScrollBar",t[t.Tree=17]="Tree"}(t.ObjectType||(t.ObjectType={})),function(t){t[t.Percent=0]="Percent",t[t.ValueAndMax=1]="ValueAndMax",t[t.Value=2]="Value",t[t.Max=3]="Max"}(t.ProgressTitleType||(t.ProgressTitleType={})),function(t){t[t.Default=0]="Default",t[t.Visible=1]="Visible",t[t.Auto=2]="Auto",t[t.Hidden=3]="Hidden"}(t.ScrollBarDisplayType||(t.ScrollBarDisplayType={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Both=2]="Both"}(t.ScrollType||(t.ScrollType={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Both=3]="Both"}(t.FlipType||(t.FlipType={})),function(t){t[t.Ascent=0]="Ascent",t[t.Descent=1]="Descent",t[t.Arch=2]="Arch"}(t.ChildrenRenderOrder||(t.ChildrenRenderOrder={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(t.GroupLayoutType||(t.GroupLayoutType={})),function(t){t[t.Auto=0]="Auto",t[t.Up=1]="Up",t[t.Down=2]="Down"}(t.PopupDirection||(t.PopupDirection={})),function(t){t[t.Left_Left=0]="Left_Left",t[t.Left_Center=1]="Left_Center",t[t.Left_Right=2]="Left_Right",t[t.Center_Center=3]="Center_Center",t[t.Right_Left=4]="Right_Left",t[t.Right_Center=5]="Right_Center",t[t.Right_Right=6]="Right_Right",t[t.Top_Top=7]="Top_Top",t[t.Top_Middle=8]="Top_Middle",t[t.Top_Bottom=9]="Top_Bottom",t[t.Middle_Middle=10]="Middle_Middle",t[t.Bottom_Top=11]="Bottom_Top",t[t.Bottom_Middle=12]="Bottom_Middle",t[t.Bottom_Bottom=13]="Bottom_Bottom",t[t.Width=14]="Width",t[t.Height=15]="Height",t[t.LeftExt_Left=16]="LeftExt_Left",t[t.LeftExt_Right=17]="LeftExt_Right",t[t.RightExt_Left=18]="RightExt_Left",t[t.RightExt_Right=19]="RightExt_Right",t[t.TopExt_Top=20]="TopExt_Top",t[t.TopExt_Bottom=21]="TopExt_Bottom",t[t.BottomExt_Top=22]="BottomExt_Top",t[t.BottomExt_Bottom=23]="BottomExt_Bottom",t[t.Size=24]="Size"}(t.RelationType||(t.RelationType={})),function(t){t[t.PlaceHolder=0]="PlaceHolder",t[t.Rect=1]="Rect",t[t.Ellipse=2]="Ellipse"}(t.GraphType||(t.GraphType={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Radial90=3]="Radial90",t[t.Radial180=4]="Radial180",t[t.Radial360=5]="Radial360"}(t.FillMethod||(t.FillMethod={})),function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom",t[t.Left=2]="Left",t[t.Right=3]="Right"}(t.FillOrigin||(t.FillOrigin={})),function(t){t[t.Text=0]="Text",t[t.Icon=1]="Icon",t[t.Color=2]="Color",t[t.OutlineColor=3]="OutlineColor",t[t.Playing=4]="Playing",t[t.Frame=5]="Frame",t[t.DeltaTime=6]="DeltaTime",t[t.TimeScale=7]="TimeScale",t[t.FontSize=8]="FontSize",t[t.Selected=9]="Selected"}(t.ObjectPropID||(t.ObjectPropID={}))}(fgui||(fgui={})),function(t){var e=function(){function e(){if(this._x=0,this._y=0,this._alpha=1,this._visible=!0,this._touchable=!0,this._grayed=!1,this._draggable=!1,this._skewX=0,this._skewY=0,this._pivotAsAnchor=!1,this._sortingOrder=0,this._internalVisible=!0,this._handlingController=!1,this._pixelSnapping=!1,this._dragTesting=!1,this.sourceWidth=0,this.sourceHeight=0,this.initWidth=0,this.initHeight=0,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this._width=0,this._height=0,this._rawWidth=0,this._rawHeight=0,this._sizePercentInGroup=0,this._touchDisabled=!1,this._node=new cc.Node,-1==e._defaultGroupIndex){e._defaultGroupIndex=0;for(var o=cc.game.groupList,n=o.length,s=0;s<n;s++)if(o[s].toLowerCase()==t.UIConfig.defaultUIGroup.toLowerCase()){e._defaultGroupIndex=s;break}}this._node.$gobj=this,this._node.groupIndex=e._defaultGroupIndex,this._node.setAnchorPoint(0,1),this._node.on(cc.Node.EventType.ANCHOR_CHANGED,this.handleAnchorChanged,this),this._id=this._node.uuid,this._name="",this._relations=new t.Relations(this),this._gears=new Array(10),this._blendMode=t.BlendMode.Normal,this._partner=this._node.addComponent(i)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this.setPosition(t,this._y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this.setPosition(this._x,t)},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(i,o){if(this._x!=i||this._y!=o){var n=i-this._x,s=o-this._y;this._x=i,this._y=o,this.handlePositionChanged(),this instanceof t.GGroup&&this.moveChildren(n,s),this.updateGear(1),!this._parent||this._parent instanceof t.GList||(this._parent.setBoundsChangedFlag(),null!=this._group&&this._group.setBoundsChangedFlag(!0),this._node.emit(t.Event.XY_CHANGED,this)),e.draggingObject!=this||e.sUpdateInDragging||this.localToGlobalRect(0,0,this._width,this._height,e.sGlobalRect)}},Object.defineProperty(e.prototype,"xMin",{get:function(){return this._pivotAsAnchor?this._x-this._width*this.node.anchorX:this._x},set:function(t){this._pivotAsAnchor?this.setPosition(t+this._width*this.node.anchorX,this._y):this.setPosition(t,this._y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yMin",{get:function(){return this._pivotAsAnchor?this._y-this._height*(1-this.node.anchorY):this._y},set:function(t){this._pivotAsAnchor?this.setPosition(this._x,t+this._height*(1-this.node.anchorY)):this.setPosition(this._x,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pixelSnapping",{get:function(){return this._pixelSnapping},set:function(t){this._pixelSnapping!=t&&(this._pixelSnapping=t,this.handlePositionChanged())},enumerable:!0,configurable:!0}),e.prototype.center=function(e){var i;i=null!=this._parent?this.parent:this.root,this.setPosition((i.width-this._width)/2,(i.height-this._height)/2),e&&(this.addRelation(i,t.RelationType.Center_Center),this.addRelation(i,t.RelationType.Middle_Middle))},Object.defineProperty(e.prototype,"width",{get:function(){return this.ensureSizeCorrect(),this._relations.sizeDirty&&this._relations.ensureRelationsSizeCorrect(),this._width},set:function(t){this.setSize(t,this._rawHeight)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ensureSizeCorrect(),this._relations.sizeDirty&&this._relations.ensureRelationsSizeCorrect(),this._height},set:function(t){this.setSize(this._rawWidth,t)},enumerable:!0,configurable:!0}),e.prototype.setSize=function(e,i,o){if(this._rawWidth!=e||this._rawHeight!=i){this._rawWidth=e,this._rawHeight=i,e<this.minWidth&&(e=this.minWidth),i<this.minHeight&&(i=this.minHeight),this.maxWidth>0&&e>this.maxWidth&&(e=this.maxWidth),this.maxHeight>0&&i>this.maxHeight&&(i=this.maxHeight);var n=e-this._width,s=i-this._height;this._width=e,this._height=i,this.handleSizeChanged(),0==this.node.anchorX&&1==this.node.anchorY||this._pivotAsAnchor||o?this.handlePositionChanged():this.setPosition(this.x-this.node.anchorX*n,this.y-(1-this.node.anchorY)*s),this instanceof t.GGroup&&this.resizeChildren(n,s),this.updateGear(2),this._parent&&(this._relations.onOwnerSizeChanged(n,s,this._pivotAsAnchor||!o),this._parent.setBoundsChangedFlag(),null!=this._group&&this._group.setBoundsChangedFlag()),this._node.emit(t.Event.SIZE_CHANGED,this)}},e.prototype.makeFullScreen=function(){this.setSize(t.GRoot.inst.width,t.GRoot.inst.height)},e.prototype.ensureSizeCorrect=function(){},Object.defineProperty(e.prototype,"actualWidth",{get:function(){return this.width*Math.abs(this._node.scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualHeight",{get:function(){return this.height*Math.abs(this._node.scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._node.scaleX},set:function(t){this.setScale(t,this._node.scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._node.scaleY},set:function(t){this.setScale(this._node.scaleX,t)},enumerable:!0,configurable:!0}),e.prototype.setScale=function(t,e){this._node.scaleX==t&&this._node.scaleY==e||(this._node.setScale(t,e),this.updateGear(2))},Object.defineProperty(e.prototype,"skewX",{get:function(){return this._skewX},set:function(t){this.setSkew(t,this._skewY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:function(){return this._skewY},set:function(t){this.setSkew(this._skewX,t)},enumerable:!0,configurable:!0}),e.prototype.setSkew=function(t,e){this._skewX==t&&this._skewY==e||(this._skewX=t,this._skewY=e,this._node.skewX=t,this._node.skewY=e)},Object.defineProperty(e.prototype,"pivotX",{get:function(){return this.node.anchorX},set:function(t){this.node.anchorX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotY",{get:function(){return 1-this.node.anchorY},set:function(t){this.node.anchorY=1-t},enumerable:!0,configurable:!0}),e.prototype.setPivot=function(t,e,i){this.node.anchorX!=t||this.node.anchorY!=1-e?(this._pivotAsAnchor=i,this.node.setAnchorPoint(t,1-e)):this._pivotAsAnchor!=i&&(this._pivotAsAnchor=i,this.handlePositionChanged())},Object.defineProperty(e.prototype,"pivotAsAnchor",{get:function(){return this._pivotAsAnchor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!=t&&(this._touchable=t,this.updateGear(3))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grayed",{get:function(){return this._grayed},set:function(t){this._grayed!=t&&(this._grayed=t,this.handleGrayedChanged(),this.updateGear(3))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!this._grayed&&this._touchable},set:function(t){this.grayed=!t,this.touchable=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return-this._node.angle},set:function(t){t=-t,this._node.angle!=t&&(this._node.angle=t,this.updateGear(3))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!=e&&(this._alpha=e,this._node.opacity=255*this._alpha,this instanceof t.GGroup&&this.handleAlphaChanged(),this.updateGear(3))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!=t&&(this._visible=t,this.handleVisibleChanged(),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_finalVisible",{get:function(){return this._visible&&this._internalVisible&&(!this._group||this._group._finalVisible)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"internalVisible3",{get:function(){return this._visible&&this._internalVisible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortingOrder",{get:function(){return this._sortingOrder},set:function(t){if(t<0&&(t=0),this._sortingOrder!=t){var e=this._sortingOrder;this._sortingOrder=t,null!=this._parent&&this._parent.childSortingOrderChanged(this,e,this._sortingOrder)}},enumerable:!0,configurable:!0}),e.prototype.requestFocus=function(){},Object.defineProperty(e.prototype,"tooltips",{get:function(){return this._tooltips},set:function(e){this._tooltips&&(this._node.off(t.Event.ROLL_OVER,this.onRollOver,this),this._node.off(t.Event.ROLL_OUT,this.onRollOut,this)),this._tooltips=e,this._tooltips&&(this._node.on(t.Event.ROLL_OVER,this.onRollOver,this),this._node.on(t.Event.ROLL_OUT,this.onRollOut,this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this._blendMode!=e&&(this._blendMode=e,t.BlendModeUtils.apply(this._node,e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onStage",{get:function(){return this._node&&this._node.activeInHierarchy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resourceURL",{get:function(){return null!=this.packageItem?"ui://"+this.packageItem.owner.id+this.packageItem.id:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"group",{get:function(){return this._group},set:function(t){this._group!=t&&(null!=this._group&&this._group.setBoundsChangedFlag(),this._group=t,null!=this._group&&this._group.setBoundsChangedFlag())},enumerable:!0,configurable:!0}),e.prototype.getGear=function(e){var i=this._gears[e];return null==i&&(this._gears[e]=i=t.GearBase.create(this,e)),i},e.prototype.updateGear=function(t){if(!this._underConstruct&&!this._gearLocked){var e=this._gears[t];null!=e&&null!=e.controller&&e.updateState()}},e.prototype.checkGearController=function(t,e){return null!=this._gears[t]&&this._gears[t].controller==e},e.prototype.updateGearFromRelations=function(t,e,i){null!=this._gears[t]&&this._gears[t].updateFromRelations(e,i)},e.prototype.addDisplayLock=function(){var t=this._gears[0];if(t&&t.controller){var e=t.addLock();return this.checkGearDisplay(),e}return 0},e.prototype.releaseDisplayLock=function(t){var e=this._gears[0];e&&e.controller&&(e.releaseLock(t),this.checkGearDisplay())},e.prototype.checkGearDisplay=function(){if(!this._handlingController){var t=null==this._gears[0]||this._gears[0].connected;this._gears[8]&&(t=this._gears[8].evaluate(t)),t!=this._internalVisible&&(this._internalVisible=t,this.handleVisibleChanged(),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag())}},Object.defineProperty(e.prototype,"gearXY",{get:function(){return this.getGear(1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gearSize",{get:function(){return this.getGear(2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gearLook",{get:function(){return this.getGear(3)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relations",{get:function(){return this._relations},enumerable:!0,configurable:!0}),e.prototype.addRelation=function(t,e,i){this._relations.add(t,e,i)},e.prototype.removeRelation=function(t,e){this._relations.remove(t,e)},Object.defineProperty(e.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},e.prototype.findParent=function(){if(this._parent)return this._parent;for(var t=this._node.parent;t;){var e=t.$gobj;if(e)return e;t=t.parent}return null},Object.defineProperty(e.prototype,"root",{get:function(){if(this instanceof t.GRoot)return this;for(var e=this._parent;e;){if(e instanceof t.GRoot)return e;e=e.parent}return t.GRoot.inst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asCom",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asButton",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asLabel",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asProgress",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asTextField",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asRichTextField",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asTextInput",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asLoader",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asList",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asTree",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asGraph",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asGroup",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asSlider",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asComboBox",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asImage",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asMovieClip",{get:function(){return this},enumerable:!0,configurable:!0}),e.cast=function(t){return t.$gobj},Object.defineProperty(e.prototype,"text",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeNode",{get:function(){return this._treeNode},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=this._node;if(t){this.removeFromParent(),this._relations.dispose(),this._node=null,t.destroy();for(var e=0;e<10;e++){var i=this._gears[e];null!=i&&i.dispose()}}},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.onUpdate=function(){},e.prototype.onDestroy=function(){},e.prototype.onClick=function(e,i){this._node.on(t.Event.CLICK,e,i)},e.prototype.offClick=function(e,i){this._node.off(t.Event.CLICK,e,i)},e.prototype.clearClick=function(){this._node.off(t.Event.CLICK)},e.prototype.hasClickListener=function(){return this._node.hasEventListener(t.Event.CLICK)},e.prototype.on=function(e,i,o){e!=t.Event.DISPLAY&&e!=t.Event.UNDISPLAY||(this._partner._emitDisplayEvents=!0),this._node.on(e,i,o)},e.prototype.off=function(t,e,i){this._node.off(t,e,i)},Object.defineProperty(e.prototype,"draggable",{get:function(){return this._draggable},set:function(t){this._draggable!=t&&(this._draggable=t,this.initDrag())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragBounds",{get:function(){return this._dragBounds},set:function(t){this._dragBounds=t},enumerable:!0,configurable:!0}),e.prototype.startDrag=function(t){this._node.activeInHierarchy&&this.dragBegin(t)},e.prototype.stopDrag=function(){this.dragEnd()},Object.defineProperty(e.prototype,"dragging",{get:function(){return e.draggingObject==this},enumerable:!0,configurable:!0}),e.prototype.localToGlobal=function(e,i,o){void 0==e&&(e=0),void 0==i&&(i=0);var n=o||new cc.Vec2;n.x=e,n.y=i,n.y=-n.y,this._pivotAsAnchor||(n.x-=this.node.anchorX*this._width,n.y+=(1-this.node.anchorY)*this._height);var s=this._node.convertToWorldSpaceAR(n);return n.x=s.x,n.y=t.GRoot.inst.height-s.y,n},e.prototype.globalToLocal=function(e,i,o){void 0==e&&(e=0),void 0==i&&(i=0);var n=o||new cc.Vec2;n.x=e,n.y=t.GRoot.inst.height-i;var s=this._node.convertToNodeSpaceAR(n);return n.x=s.x,n.y=s.y,this._pivotAsAnchor||(n.x-=this._node.anchorX*this._width,n.y+=(1-this._node.anchorY)*this._height),n.y=-n.y,n},e.prototype.localToGlobalRect=function(t,e,i,o,n){void 0==t&&(t=0),void 0==e&&(e=0),void 0==i&&(i=0),void 0==o&&(o=0);var s=n||new cc.Rect,r=this.localToGlobal(t,e);return s.x=r.x,s.y=r.y,r=this.localToGlobal(t+i,e+o,r),s.xMax=r.x,s.yMax=r.y,s},e.prototype.globalToLocalRect=function(t,e,i,o,n){void 0==t&&(t=0),void 0==e&&(e=0),void 0==i&&(i=0),void 0==o&&(o=0);var s=n||new cc.Rect,r=this.globalToLocal(t,e);return s.x=r.x,s.y=r.y,r=this.globalToLocal(t+i,e+o,r),s.xMax=r.x,s.yMax=r.y,s},e.prototype.handleControllerChanged=function(t){this._handlingController=!0;for(var e=0;e<10;e++){var i=this._gears[e];null!=i&&i.controller==t&&i.apply()}this._handlingController=!1,this.checkGearDisplay()},e.prototype.handleAnchorChanged=function(){this.handlePositionChanged()},e.prototype.handlePositionChanged=function(){var t=this._x,e=-this._y;this._pivotAsAnchor||(t+=this.node.anchorX*this._width,e-=(1-this.node.anchorY)*this._height),this._pixelSnapping&&(t=Math.round(t),e=Math.round(e)),this._node.setPosition(t,e)},e.prototype.handleSizeChanged=function(){this._node.setContentSize(this._width,this._height)},e.prototype.handleGrayedChanged=function(){},e.prototype.handleVisibleChanged=function(){this._node.active=this._finalVisible,this instanceof t.GGroup&&this.handleVisibleChanged(),this._parent&&this._parent.setBoundsChangedFlag()},e.prototype.hitTest=function(t){if(this._touchDisabled||!this._touchable||!this._node.activeInHierarchy)return null;var e=this._node.convertToNodeSpaceAR(t);return e.x+=this._node.anchorX*this._width,e.y+=this._node.anchorY*this._height,e.x>=0&&e.y>=0&&e.x<this._width&&e.y<this._height?this:null},e.prototype.getProp=function(e){switch(e){case t.ObjectPropID.Text:return this.text;case t.ObjectPropID.Icon:return this.icon;case t.ObjectPropID.Color:case t.ObjectPropID.OutlineColor:return null;case t.ObjectPropID.Playing:return!1;case t.ObjectPropID.Frame:case t.ObjectPropID.DeltaTime:return 0;case t.ObjectPropID.TimeScale:return 1;case t.ObjectPropID.FontSize:return 0;case t.ObjectPropID.Selected:return!1;default:return}},e.prototype.setProp=function(e,i){switch(e){case t.ObjectPropID.Text:this.text=i;break;case t.ObjectPropID.Icon:this.icon=i}},e.prototype.constructFromResource=function(){},e.prototype.setup_beforeAdd=function(t,e){var i,o;t.seek(e,0),t.skip(5),this._id=t.readS(),this._name=t.readS(),i=t.readInt(),o=t.readInt(),this.setPosition(i,o),t.readBool()&&(this.initWidth=t.readInt(),this.initHeight=t.readInt(),this.setSize(this.initWidth,this.initHeight,!0)),t.readBool()&&(this.minWidth=t.readInt(),this.maxWidth=t.readInt(),this.minHeight=t.readInt(),this.maxHeight=t.readInt()),t.readBool()&&(i=t.readFloat(),o=t.readFloat(),this.setScale(i,o)),t.readBool()&&(i=t.readFloat(),o=t.readFloat(),this.setSkew(i,o)),t.readBool()&&(i=t.readFloat(),o=t.readFloat(),this.setPivot(i,o,t.readBool())),1!=(i=t.readFloat())&&(this.alpha=i),0!=(i=t.readFloat())&&(this.rotation=i),t.readBool()||(this.visible=!1),t.readBool()||(this.touchable=!1),t.readBool()&&(this.grayed=!0),this.blendMode=t.readByte();t.readByte();var n=t.readS();null!=n&&(this.data=n)},e.prototype.setup_afterAdd=function(t,e){t.seek(e,1);var i=t.readS();null!=i&&(this.tooltips=i);var o=t.readShort();o>=0&&(this.group=this.parent.getChildAt(o)),t.seek(e,2);for(var n=t.readShort(),s=0;s<n;s++){var r=t.readShort();r+=t.position,this.getGear(t.readByte()).setup(t),t.position=r}},e.prototype.onRollOver=function(){this.root.showTooltips(this.tooltips)},e.prototype.onRollOut=function(){this.root.hideTooltips()},e.prototype.initDrag=function(){this._draggable?(this.on(t.Event.TOUCH_BEGIN,this.onTouchBegin_0,this),this.on(t.Event.TOUCH_MOVE,this.onTouchMove_0,this),this.on(t.Event.TOUCH_END,this.onTouchEnd_0,this)):(this.off(t.Event.TOUCH_BEGIN,this.onTouchBegin_0,this),this.off(t.Event.TOUCH_MOVE,this.onTouchMove_0,this),this.off(t.Event.TOUCH_END,this.onTouchEnd_0,this))},e.prototype.dragBegin=function(i){if(null!=e.draggingObject){var o=e.draggingObject;o.stopDrag(),e.draggingObject=null,o._node.emit(t.Event.DRAG_END)}void 0==i&&(i=t.GRoot.inst.inputProcessor.getAllTouches()[0]),e.sGlobalDragStart.set(t.GRoot.inst.getTouchPosition(i)),this.localToGlobalRect(0,0,this._width,this._height,e.sGlobalRect),e.draggingObject=this,this._dragTesting=!0,t.GRoot.inst.inputProcessor.addTouchMonitor(i,this),this.on(t.Event.TOUCH_MOVE,this.onTouchMove_0,this),this.on(t.Event.TOUCH_END,this.onTouchEnd_0,this)},e.prototype.dragEnd=function(){e.draggingObject==this&&(this._dragTesting=!1,e.draggingObject=null),e.sDragQuery=!1},e.prototype.onTouchBegin_0=function(t){null==this._dragStartPoint&&(this._dragStartPoint=new cc.Vec2),this._dragStartPoint.set(t.pos),this._dragTesting=!0,t.captureTouch()},e.prototype.onTouchMove_0=function(i){if(e.draggingObject!=this&&this._draggable&&this._dragTesting){var o=t.UIConfig.touchDragSensitivity;if(Math.abs(this._dragStartPoint.x-i.pos.x)<o&&Math.abs(this._dragStartPoint.y-i.pos.y)<o)return;this._dragTesting=!1,e.sDragQuery=!0,this._node.emit(t.Event.DRAG_START,i),e.sDragQuery&&this.dragBegin(i.touchId)}if(e.draggingObject==this){var n=i.pos.x-e.sGlobalDragStart.x+e.sGlobalRect.x,s=i.pos.y-e.sGlobalDragStart.y+e.sGlobalRect.y;if(null!=this._dragBounds){var r=t.GRoot.inst.localToGlobalRect(this._dragBounds.x,this._dragBounds.y,this._dragBounds.width,this._dragBounds.height,e.sDragHelperRect);n<r.x?n=r.x:n+e.sGlobalRect.width>r.xMax&&(n=r.xMax-e.sGlobalRect.width)<r.x&&(n=r.x),s<r.y?s=r.y:s+e.sGlobalRect.height>r.yMax&&(s=r.yMax-e.sGlobalRect.height)<r.y&&(s=r.y)}e.sUpdateInDragging=!0;var a=this.parent.globalToLocal(n,s,e.sHelperPoint);this.setPosition(Math.round(a.x),Math.round(a.y)),e.sUpdateInDragging=!1,this._node.emit(t.Event.DRAG_MOVE,i)}},e.prototype.onTouchEnd_0=function(i){e.draggingObject==this&&(e.draggingObject=null,this._node.emit(t.Event.DRAG_END,i))},e._defaultGroupIndex=-1,e.sGlobalDragStart=new cc.Vec2,e.sGlobalRect=new cc.Rect,e.sHelperPoint=new cc.Vec2,e.sDragHelperRect=new cc.Rect,e.sDragQuery=!1,e}();t.GObject=e;var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._emitDisplayEvents=!1,t}return __extends(i,e),i.prototype.callLater=function(t,e){cc.director.getScheduler().isScheduled(t,this)||this.scheduleOnce(t,e)},i.prototype.onClickLink=function(e,i){this.node.emit(t.Event.LINK,i,e)},i.prototype.onEnable=function(){this.node.$gobj.onEnable(),this._emitDisplayEvents&&this.node.emit(t.Event.DISPLAY)},i.prototype.onDisable=function(){this.node.$gobj.onDisable(),this._emitDisplayEvents&&this.node.emit(t.Event.UNDISPLAY)},i.prototype.update=function(t){this.node.$gobj.onUpdate(t)},i.prototype.onDestroy=function(){this.node.$gobj.onDestroy()},i}(cc.Component);t.GObjectPartner=i}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._sortingChildCount=0,i._childrenRenderOrder=t.ChildrenRenderOrder.Ascent,i._apexIndex=0,i._node.name="GComponent",i._children=new Array,i._controllers=new Array,i._transitions=new Array,i._margin=new t.Margin,i._alignOffset=new cc.Vec2,i._container=new cc.Node("Container"),i._container.setAnchorPoint(0,1),i._node.addChild(i._container),i}return __extends(i,e),i.prototype.dispose=function(){var t,i;for(i=this._transitions.length,t=0;t<i;++t){this._transitions[t].dispose()}for(i=this._controllers.length,t=0;t<i;++t){this._controllers[t].dispose()}for(this._scrollPane&&this._scrollPane.destroy(),t=(i=this._children.length)-1;t>=0;--t){var o=this._children[t];o._parent=null,o.dispose()}this._boundsChanged=!1,e.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"displayListContainer",{get:function(){return this._container},enumerable:!0,configurable:!0}),i.prototype.addChild=function(t){return this.addChildAt(t,this._children.length),t},i.prototype.addChildAt=function(t,e){if(!t)throw"child is null";var i=this._children.length;if(e>=0&&e<=i){if(t.parent==this)this.setChildIndex(t,e);else{t.removeFromParent(),t._parent=this;var o=this._children.length;0!=t.sortingOrder?(this._sortingChildCount++,e=this.getInsertPosForSortingChild(t)):this._sortingChildCount>0&&e>o-this._sortingChildCount&&(e=o-this._sortingChildCount),e==o?this._children.push(t):this._children.splice(e,0,t),this.onChildAdd(t,e),this.setBoundsChangedFlag()}return t}throw"Invalid child index"},i.prototype.getInsertPosForSortingChild=function(t){var e=this._children.length,i=0;for(i=0;i<e;i++){var o=this._children[i];if(o!=t&&t.sortingOrder<o.sortingOrder)break}return i},i.prototype.removeChild=function(t,e){var i=this._children.indexOf(t);return-1!=i&&this.removeChildAt(i,e),t},i.prototype.removeChildAt=function(e,i){if(e>=0&&e<this.numChildren){var o=this._children[e];return o._parent=null,0!=o.sortingOrder&&this._sortingChildCount--,this._children.splice(e,1),o.group=null,this._container.removeChild(o.node),this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&this._partner.callLater(this.buildNativeDisplayList),i?o.dispose():o.node.parent=null,this.setBoundsChangedFlag(),o}throw"Invalid child index"},i.prototype.removeChildren=function(t,e,i){void 0==t&&(t=0),void 0==e&&(e=-1),(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(var o=t;o<=e;++o)this.removeChildAt(t,i)},i.prototype.getChildAt=function(t){if(t>=0&&t<this.numChildren)return this._children[t];throw"Invalid child index"},i.prototype.getChild=function(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i].name==t)return this._children[i];return null},i.prototype.getChildByPath=function(t){for(var e,o=t.split("."),n=o.length,s=this,r=0;r<n&&(e=s.getChild(o[r]));++r)if(r!=n-1){if(!(s instanceof i)){e=null;break}s=e}return e},i.prototype.getVisibleChild=function(t){for(var e=this._children.length,i=0;i<e;++i){var o=this._children[i];if(o._finalVisible&&o.name==t)return o}return null},i.prototype.getChildInGroup=function(t,e){for(var i=this._children.length,o=0;o<i;++o){var n=this._children[o];if(n.group==e&&n.name==t)return n}return null},i.prototype.getChildById=function(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i]._id==t)return this._children[i];return null},i.prototype.getChildIndex=function(t){return this._children.indexOf(t)},i.prototype.setChildIndex=function(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0==t.sortingOrder){var o=this._children.length;this._sortingChildCount>0&&e>o-this._sortingChildCount-1&&(e=o-this._sortingChildCount-1),this._setChildIndex(t,i,e)}},i.prototype.setChildIndexBefore=function(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0!=t.sortingOrder)return i;var o=this._children.length;return this._sortingChildCount>0&&e>o-this._sortingChildCount-1&&(e=o-this._sortingChildCount-1),i<e?this._setChildIndex(t,i,e-1):this._setChildIndex(t,i,e)},i.prototype._setChildIndex=function(e,i,o){var n=this._children.length;return o>n&&(o=n),i==o?i:(this._children.splice(i,1),this._children.splice(o,0,e),this._childrenRenderOrder==t.ChildrenRenderOrder.Ascent?e.node.setSiblingIndex(o):this._childrenRenderOrder==t.ChildrenRenderOrder.Descent?e.node.setSiblingIndex(n-o):this._partner.callLater(this.buildNativeDisplayList),this.setBoundsChangedFlag(),o)},i.prototype.swapChildren=function(t,e){var i=this._children.indexOf(t),o=this._children.indexOf(e);if(-1==i||-1==o)throw"Not a child of this container";this.swapChildrenAt(i,o)},i.prototype.swapChildrenAt=function(t,e){var i=this._children[t],o=this._children[e];this.setChildIndex(i,e),this.setChildIndex(o,t)},Object.defineProperty(i.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),i.prototype.isAncestorOf=function(t){if(null==t)return!1;for(var e=t.parent;e;){if(e==this)return!0;e=e.parent}return!1},i.prototype.addController=function(t){this._controllers.push(t),t.parent=this,this.applyController(t)},i.prototype.getControllerAt=function(t){return this._controllers[t]},i.prototype.getController=function(t){for(var e=this._controllers.length,i=0;i<e;++i){var o=this._controllers[i];if(o.name==t)return o}return null},i.prototype.removeController=function(t){var e=this._controllers.indexOf(t);if(-1==e)throw"controller not exists";t.parent=null,this._controllers.splice(e,1);for(var i=this._children.length,o=0;o<i;o++){this._children[o].handleControllerChanged(t)}},Object.defineProperty(i.prototype,"controllers",{get:function(){return this._controllers},enumerable:!0,configurable:!0}),i.prototype.onChildAdd=function(e,i){if(e.node.parent=this._container,e.node.active=e._finalVisible,!this._buildingDisplayList){var o=this._children.length;this._childrenRenderOrder==t.ChildrenRenderOrder.Ascent?e.node.setSiblingIndex(i):this._childrenRenderOrder==t.ChildrenRenderOrder.Descent?e.node.setSiblingIndex(o-i):this._partner.callLater(this.buildNativeDisplayList)}},i.prototype.buildNativeDisplayList=function(e){if(isNaN(e)){var i=this._children.length;if(0!=i)switch(this._childrenRenderOrder){case t.ChildrenRenderOrder.Ascent:for(var o=0,n=0;n<i;n++)this._children[n].node.setSiblingIndex(o++);break;case t.ChildrenRenderOrder.Descent:for(o=0,n=i-1;n>=0;n--)this._children[n].node.setSiblingIndex(o++);break;case t.ChildrenRenderOrder.Arch:for(o=0,n=0;n<this._apexIndex;n++)this._children[n].node.setSiblingIndex(o++);for(n=i-1;n>=this._apexIndex;n--)this._children[n].node.setSiblingIndex(o++)}}else{this.node.$gobj.buildNativeDisplayList()}},i.prototype.applyController=function(t){this._applyingController=t;for(var e=this._children.length,i=0;i<e;i++)this._children[i].handleControllerChanged(t);this._applyingController=null,t.runActions()},i.prototype.applyAllControllers=function(){for(var t=this._controllers.length,e=0;e<t;++e)this.applyController(this._controllers[e])},i.prototype.adjustRadioGroupDepth=function(e,i){var o,n,s=this._children.length,r=-1,a=-1;for(o=0;o<s;o++)(n=this._children[o])==e?r=o:n instanceof t.GButton&&n.relatedController==i&&o>a&&(a=o);r<a&&(null!=this._applyingController&&this._children[a].handleControllerChanged(this._applyingController),this.swapChildrenAt(r,a))},i.prototype.getTransitionAt=function(t){return this._transitions[t]},i.prototype.getTransition=function(t){for(var e=this._transitions.length,i=0;i<e;++i){var o=this._transitions[i];if(o.name==t)return o}return null},i.prototype.isChildInView=function(t){return null!=this._rectMask?t.x+t.width>=0&&t.x<=this.width&&t.y+t.height>=0&&t.y<=this.height:null==this._scrollPane||this._scrollPane.isChildInView(t)},i.prototype.getFirstChildInView=function(){for(var t=this._children.length,e=0;e<t;++e){var i=this._children[e];if(this.isChildInView(i))return e}return-1},Object.defineProperty(i.prototype,"scrollPane",{get:function(){return this._scrollPane},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"opaque",{get:function(){return this._opaque},set:function(t){this._opaque=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin.copy(t),this.handleSizeChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childrenRenderOrder",{get:function(){return this._childrenRenderOrder},set:function(t){this._childrenRenderOrder!=t&&(this._childrenRenderOrder=t,this.buildNativeDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"apexIndex",{get:function(){return this._apexIndex},set:function(e){this._apexIndex!=e&&(this._apexIndex=e,this._childrenRenderOrder==t.ChildrenRenderOrder.Arch&&this.buildNativeDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._maskContent},set:function(t){this.setMask(t,!1)},enumerable:!0,configurable:!0}),i.prototype.setMask=function(e,i){if(this._maskContent&&(this._maskContent.node.off(cc.Node.EventType.POSITION_CHANGED,this.onMaskContentChanged,this),this._maskContent.node.off(cc.Node.EventType.SIZE_CHANGED,this.onMaskContentChanged,this),this._maskContent.node.off(cc.Node.EventType.SCALE_CHANGED,this.onMaskContentChanged,this),this._maskContent.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.onMaskContentChanged,this),this._maskContent.visible=!0),this._maskContent=e,this._maskContent){if(!(e instanceof t.GImage||e instanceof t.GGraph))return;if(!this._customMask){var o=new cc.Node("Mask");o.parent=this._node,this._scrollPane?this._container.parent.parent=o:this._container.parent=o,this._customMask=o.addComponent(cc.Mask)}e.visible=!1,e.node.on(cc.Node.EventType.POSITION_CHANGED,this.onMaskContentChanged,this),e.node.on(cc.Node.EventType.SIZE_CHANGED,this.onMaskContentChanged,this),e.node.on(cc.Node.EventType.SCALE_CHANGED,this.onMaskContentChanged,this),e.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.onMaskContentChanged,this),this._customMask.inverted=i,this._node.activeInHierarchy?this.onMaskReady():this.on(t.Event.DISPLAY,this.onMaskReady,this),this.onMaskContentChanged(),this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(0,0)}else this._customMask&&(this._scrollPane?this._container.parent.parent=this._node:this._container.parent=this._node,this._customMask.node.destroy(),this._customMask=null,this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._pivotCorrectX,this._pivotCorrectY))},i.prototype.onMaskReady=function(){this.off(t.Event.DISPLAY,this.onMaskReady,this),this._maskContent instanceof t.GImage?(this._customMask.type=cc.Mask.Type.IMAGE_STENCIL,this._customMask.alphaThreshold=1e-4,this._customMask.spriteFrame=this._maskContent._content.spriteFrame):this._maskContent.type==t.GraphType.Ellipse?this._customMask.type=cc.Mask.Type.ELLIPSE:this._customMask.type=cc.Mask.Type.RECT},i.prototype.onMaskContentChanged=function(){var t=this._customMask.node,e=this._maskContent.node,i=e.width*e.scaleX,o=e.height*e.scaleY;t.setContentSize(i,o);var n=e.x-e.anchorX*i,s=e.y-e.anchorY*o;t.setAnchorPoint(-n/t.width,-s/t.height),t.setPosition(this._pivotCorrectX,this._pivotCorrectY)},Object.defineProperty(i.prototype,"_pivotCorrectX",{get:function(){return-this.pivotX*this._width+this._margin.left},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_pivotCorrectY",{get:function(){return this.pivotY*this._height-this._margin.top},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"baseUserData",{get:function(){var t=this.packageItem.rawData;return t.seek(0,4),t.readS()},enumerable:!0,configurable:!0}),i.prototype.setupScroll=function(e){this._scrollPane=this._node.addComponent(t.ScrollPane),this._scrollPane.setup(e)},i.prototype.setupOverflow=function(e){e==t.OverflowType.Hidden&&(this._rectMask=this._container.addComponent(cc.Mask)),this._margin.isNone||this.handleSizeChanged()},i.prototype.handleAnchorChanged=function(){e.prototype.handleAnchorChanged.call(this),this._customMask?this._customMask.node.setPosition(this._pivotCorrectX,this._pivotCorrectY):this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._pivotCorrectX+this._alignOffset.x,this._pivotCorrectY-this._alignOffset.y)},i.prototype.handleSizeChanged=function(){e.prototype.handleSizeChanged.call(this),this._customMask?this._customMask.node.setPosition(this._pivotCorrectX,this._pivotCorrectY):this._scrollPane||this._container.setPosition(this._pivotCorrectX,this._pivotCorrectY),this._scrollPane?this._scrollPane.onOwnerSizeChanged():this._container.setContentSize(this.viewWidth,this.viewHeight)},i.prototype.handleGrayedChanged=function(){var t=this.getController("grayed");if(null==t)for(var e=this.grayed,i=this._children.length,o=0;o<i;++o)this._children[o].grayed=e;else t.selectedIndex=this.grayed?1:0},i.prototype.handleControllerChanged=function(t){e.prototype.handleControllerChanged.call(this,t),null!=this._scrollPane&&this._scrollPane.handleControllerChanged(t)},i.prototype.hitTest=function(t){if(this._touchDisabled||!this._touchable||!this._node.activeInHierarchy)return null;var e;if(this._customMask&&!(this._customMask._hitTest(t)||!1))return null;var i=0;if(this.hitArea||this._rectMask){if((s=this._node.convertToNodeSpaceAR(t)).x+=this._node.anchorX*this._width,s.y+=this._node.anchorY*this._height,i=s.x>=0&&s.y>=0&&s.x<this._width&&s.y<this._height?1:2,this.hitArea&&!this.hitArea.hitTest(this,s.x,s.y))return null;if(this._rectMask){s.x+=this._container.x,s.y+=this._container.y;var o=this._container.getContentSize();if(s.x<0||s.y<0||s.x>=o.width||s.y>=o.height)return null}}if(this._scrollPane){if(!(e=this._scrollPane.hitTest(t)))return null;if(e!=this)return e}for(var n=this._children.length-1;n>=0;n--)if(e=this._children[n].hitTest(t))return e;if(this._opaque){var s;if(0==i)(s=this._node.convertToNodeSpaceAR(t)).x+=this._node.anchorX*this._width,s.y+=this._node.anchorY*this._height,i=s.x>=0&&s.y>=0&&s.x<this._width&&s.y<this._height?1:2;return 1==i?this:null}return null},i.prototype.setBoundsChangedFlag=function(){(this._scrollPane||this._trackBounds)&&(this._boundsChanged||(this._boundsChanged=!0,this._partner.callLater(this.refresh)))},i.prototype.refresh=function(t){if(isNaN(t)){if(this._boundsChanged){var e=this._children.length;if(e>0)for(var i=0;i<e;i++){this._children[i].ensureSizeCorrect()}this.updateBounds()}}else this.node.$gobj.refresh()},i.prototype.ensureBoundsCorrect=function(){var t=this._children.length;if(t>0)for(var e=0;e<t;e++){this._children[e].ensureSizeCorrect()}this._boundsChanged&&this.updateBounds()},i.prototype.updateBounds=function(){var t=0,e=0,i=0,o=0,n=this._children.length;if(n>0){t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY;var s=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=0,h=0;for(h=0;h<n;h++){var l=this._children[h];(a=l.x)<t&&(t=a),(a=l.y)<e&&(e=a),(a=l.x+l.actualWidth)>s&&(s=a),(a=l.y+l.actualHeight)>r&&(r=a)}i=s-t,o=r-e}this.setBounds(t,e,i,o)},i.prototype.setBounds=function(t,e,i,o){void 0===o&&(o=0),this._boundsChanged=!1,this._scrollPane&&this._scrollPane.setContentSize(Math.round(t+i),Math.round(e+o))},Object.defineProperty(i.prototype,"viewWidth",{get:function(){return null!=this._scrollPane?this._scrollPane.viewWidth:this.width-this._margin.left-this._margin.right},set:function(t){null!=this._scrollPane?this._scrollPane.viewWidth=t:this.width=t+this._margin.left+this._margin.right},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewHeight",{get:function(){return null!=this._scrollPane?this._scrollPane.viewHeight:this.height-this._margin.top-this._margin.bottom},set:function(t){null!=this._scrollPane?this._scrollPane.viewHeight=t:this.height=t+this._margin.top+this._margin.bottom},enumerable:!0,configurable:!0}),i.prototype.getSnappingPosition=function(t,e,i){i||(i=new cc.Vec2);var o=this._children.length;if(0==o)return i.x=0,i.y=0,i;this.ensureBoundsCorrect();var n=null,s=null,r=0;if(0!=e){for(;r<o;r++)if(e<(n=this._children[r]).y){if(0==r){e=0;break}e=e<(s=this._children[r-1]).y+s.actualHeight/2?s.y:n.y;break}r==o&&(e=n.y)}if(0!=t){for(r>0&&r--;r<o;r++)if(t<(n=this._children[r]).x){if(0==r){t=0;break}t=t<(s=this._children[r-1]).x+s.actualWidth/2?s.x:n.x;break}r==o&&(t=n.x)}return i.x=t,i.y=e,i},i.prototype.childSortingOrderChanged=function(t,e,i){if(void 0===i&&(i=0),0==i)this._sortingChildCount--,this.setChildIndex(t,this._children.length);else{0==e&&this._sortingChildCount++;var o=this._children.indexOf(t),n=this.getInsertPosForSortingChild(t);o<n?this._setChildIndex(t,o,n-1):this._setChildIndex(t,o,n)}},i.prototype.constructFromResource=function(){this.constructFromResource2(null,0)},i.prototype.constructFromResource2=function(e,i){var o,n,s,r,a,h,l,c,u=this.packageItem.getBranch();u.decoded||(u.decoded=!0,t.TranslationHelper.translateComponent(u));var d=u.rawData;d.seek(0,0),this._underConstruct=!0,this.sourceWidth=d.readInt(),this.sourceHeight=d.readInt(),this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),d.readBool()&&(this.minWidth=d.readInt(),this.maxWidth=d.readInt(),this.minHeight=d.readInt(),this.maxHeight=d.readInt()),d.readBool()&&(a=d.readFloat(),h=d.readFloat(),this.setPivot(a,h,d.readBool())),d.readBool()&&(this._margin.top=d.readInt(),this._margin.bottom=d.readInt(),this._margin.left=d.readInt(),this._margin.right=d.readInt());var _=d.readByte();if(_==t.OverflowType.Scroll){var p=d.position;d.seek(0,7),this.setupScroll(d),d.position=p}else this.setupOverflow(_);d.readBool()&&d.skip(8),this._buildingDisplayList=!0,d.seek(0,1);var f,g=d.readShort();for(o=0;o<g;o++){r=d.readShort(),r+=d.position;var m=new t.Controller;this._controllers.push(m),m.parent=this,m.setup(d),d.position=r}d.seek(0,2);var v=d.readShort();for(o=0;o<v;o++){if(n=d.readShort(),s=d.position,null!=e)f=e[i+o];else{d.seek(s,0);var y,b=d.readByte(),C=d.readS(),w=d.readS(),S=null;if(null!=C)S=null!=(y=null!=w?t.UIPackage.getById(w):u.owner)?y.getItemById(C):null;null!=S?(f=t.UIObjectFactory.newObject(S)).constructFromResource():f=t.UIObjectFactory.newObject2(b)}f._underConstruct=!0,f.setup_beforeAdd(d,s),f._parent=this,f.node.parent=this._container,this._children.push(f),d.position=s+n}for(d.seek(0,3),this.relations.setup(d,!0),d.seek(0,2),d.skip(2),o=0;o<v;o++)r=d.readShort(),r+=d.position,d.seek(d.position,3),this._children[o].relations.setup(d,!1),d.position=r;for(d.seek(0,2),d.skip(2),o=0;o<v;o++)r=d.readShort(),r+=d.position,(f=this._children[o]).setup_afterAdd(d,d.position),f._underConstruct=!1,d.position=r;d.seek(0,4),d.skip(2),this.opaque=d.readBool();var I=d.readShort();-1!=I&&this.setMask(this.getChildAt(I),d.readBool());var T=d.readS();l=d.readInt(),c=d.readInt(),null!=T?(S=u.owner.getItemById(T))&&S.hitTestData&&(this.hitArea=new t.PixelHitTest(S.hitTestData,l,c)):0!=l&&-1!=c&&(this.hitArea=new t.ChildHitArea(this.getChildAt(c))),d.seek(0,5);var x=d.readShort();for(o=0;o<x;o++){r=d.readShort(),r+=d.position;var k=new t.Transition(this);k.setup(d),this._transitions.push(k),d.position=r}this.applyAllControllers(),this._buildingDisplayList=!1,this._underConstruct=!1,this.buildNativeDisplayList(),this.setBoundsChangedFlag(),u.objectType!=t.ObjectType.Component&&this.constructExtension(d),this.onConstruct()},i.prototype.constructExtension=function(t){},i.prototype.onConstruct=function(){},i.prototype.setup_afterAdd=function(t,i){e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,4);var o=t.readShort();null!=o&&null!=this._scrollPane&&(this._scrollPane.pageController=this._parent.getControllerAt(o));for(var n=t.readShort(),s=0;s<n;s++){var r=this.getController(t.readS()),a=t.readS();null!=r&&(r.selectedPageId=a)}if(t.version>=2)for(n=t.readShort(),s=0;s<n;s++){var h=t.readS(),l=t.readShort(),c=t.readS(),u=this.getChildByPath(h);u&&u.setProp(l,c)}},i.prototype.onEnable=function(){for(var t=this._transitions.length,e=0;e<t;++e)this._transitions[e].onEnable()},i.prototype.onDisable=function(){for(var t=this._transitions.length,e=0;e<t;++e)this._transitions[e].onDisable()},i}(t.GObject);t.GComponent=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._node.name="GButton",i._mode=t.ButtonMode.Common,i._title="",i._icon="",i._sound=t.UIConfig.buttonSound,i._soundVolumeScale=t.UIConfig.buttonSoundVolumeScale,i._changeStateOnClick=!0,i._downEffect=0,i._downEffectValue=.8,i}return __extends(i,e),Object.defineProperty(i.prototype,"icon",{get:function(){return this._icon},set:function(t){this._icon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,null!=this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedIcon",{get:function(){return this._selectedIcon},set:function(t){this._selectedIcon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,null!=this._iconObject&&(this._iconObject.icon=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"title",{get:function(){return this._title},set:function(t){this._title=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title),this.updateGear(6)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"text",{get:function(){return this.title},set:function(t){this.title=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedTitle",{get:function(){return this._selectedTitle},set:function(t){this._selectedTitle=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"titleColor",{get:function(){var t=this.getTextField();return null!=t?t.color:cc.Color.BLACK},set:function(t){var e=this.getTextField();null!=e&&(e.color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"titleFontSize",{get:function(){var t=this.getTextField();return null!=t?t.fontSize:0},set:function(t){var e=this.getTextField();null!=e&&(e.fontSize=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sound",{get:function(){return this._sound},set:function(t){this._sound=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soundVolumeScale",{get:function(){return this._soundVolumeScale},set:function(t){this._soundVolumeScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},set:function(e){if(this._mode!=t.ButtonMode.Common&&this._selected!=e){if(this._selected=e,this.setCurrentState(),this._selectedTitle&&this._titleObject&&(this._titleObject.text=this._selected?this._selectedTitle:this._title),this._selectedIcon){var i=this._selected?this._selectedIcon:this._icon;null!=this._iconObject&&(this._iconObject.icon=i)}this._relatedController&&this._parent&&!this._parent._buildingDisplayList&&(this._selected?(this._relatedController.selectedPageId=this._relatedPageId,this._relatedController.autoRadioGroupDepth&&this._parent.adjustRadioGroupDepth(this,this._relatedController)):this._mode==t.ButtonMode.Check&&this._relatedController.selectedPageId==this._relatedPageId&&(this._relatedController.oppositePageId=this._relatedPageId))}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode!=e&&(e==t.ButtonMode.Common&&(this.selected=!1),this._mode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"relatedController",{get:function(){return this._relatedController},set:function(t){this._relatedController=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"relatedPageId",{get:function(){return this._relatedPageId},set:function(t){this._relatedPageId=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"changeStateOnClick",{get:function(){return this._changeStateOnClick},set:function(t){this._changeStateOnClick=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"linkedPopup",{get:function(){return this._linkedPopup},set:function(t){this._linkedPopup=t},enumerable:!0,configurable:!0}),i.prototype.getTextField=function(){return this._titleObject instanceof t.GTextField?this._titleObject:this._titleObject instanceof t.GLabel?this._titleObject.getTextField():this._titleObject instanceof i?this._titleObject.getTextField():null},i.prototype.fireClick=function(){t.GRoot.inst.inputProcessor.simulateClick(this)},i.prototype.setState=function(e){if(this._buttonController&&(this._buttonController.selectedPage=e),1==this._downEffect){var o=this.numChildren;if(e==i.DOWN||e==i.SELECTED_OVER||e==i.SELECTED_DISABLED){if(!this._downColor){var n=255*this._downEffectValue;this._downColor=new cc.Color(n,n,n,255)}for(var s=0;s<o;s++){void 0==(r=this.getChildAt(s)).color||r instanceof t.GTextField||(r.color=this._downColor)}}else for(s=0;s<o;s++){var r;void 0==(r=this.getChildAt(s)).color||r instanceof t.GTextField||(r.color=cc.Color.WHITE)}}else 2==this._downEffect&&(e==i.DOWN||e==i.SELECTED_OVER||e==i.SELECTED_DISABLED?this._downScaled||(this._downScaled=!0,this.setScale(this.scaleX*this._downEffectValue,this.scaleY*this._downEffectValue)):this._downScaled&&(this._downScaled=!1,this.setScale(this.scaleX/this._downEffectValue,this.scaleY/this._downEffectValue)))},i.prototype.setCurrentState=function(){this.grayed&&this._buttonController&&this._buttonController.hasPage(i.DISABLED)?this._selected?this.setState(i.SELECTED_DISABLED):this.setState(i.DISABLED):this._selected?this.setState(this._over?i.SELECTED_OVER:i.DOWN):this.setState(this._over?i.OVER:i.UP)},i.prototype.handleControllerChanged=function(t){e.prototype.handleControllerChanged.call(this,t),this._relatedController==t&&(this.selected=this._relatedPageId==t.selectedPageId)},i.prototype.handleGrayedChanged=function(){this._buttonController&&this._buttonController.hasPage(i.DISABLED)?this.grayed?this._selected&&this._buttonController.hasPage(i.SELECTED_DISABLED)?this.setState(i.SELECTED_DISABLED):this.setState(i.DISABLED):this._selected?this.setState(i.DOWN):this.setState(i.UP):e.prototype.handleGrayedChanged.call(this)},i.prototype.getProp=function(i){switch(i){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var o=this.getTextField();return o?o.strokeColor:0;case t.ObjectPropID.FontSize:return this.titleFontSize;case t.ObjectPropID.Selected:return this.selected;default:return e.prototype.getProp.call(this,i)}},i.prototype.setProp=function(i,o){switch(i){case t.ObjectPropID.Color:this.titleColor=o;break;case t.ObjectPropID.OutlineColor:var n=this.getTextField();n&&(n.strokeColor=o);break;case t.ObjectPropID.FontSize:this.titleFontSize=o;break;case t.ObjectPropID.Selected:this.selected=o;break;default:e.prototype.setProp.call(this,i,o)}},i.prototype.constructExtension=function(e){e.seek(0,6),this._mode=e.readByte();var o=e.readS();o&&(this._sound=o),this._soundVolumeScale=e.readFloat(),this._downEffect=e.readByte(),this._downEffectValue=e.readFloat(),2==this._downEffect&&this.setPivot(.5,.5,this.pivotAsAnchor),this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),null!=this._titleObject&&(this._title=this._titleObject.text),null!=this._iconObject&&(this._icon=this._iconObject.icon),this._mode==t.ButtonMode.Common&&this.setState(i.UP),this._node.on(t.Event.TOUCH_BEGIN,this.onTouchBegin_1,this),this._node.on(t.Event.TOUCH_END,this.onTouchEnd_1,this),this._node.on(t.Event.ROLL_OVER,this.onRollOver_1,this),this._node.on(t.Event.ROLL_OUT,this.onRollOut_1,this),this._node.on(t.Event.CLICK,this.onClick_1,this)},i.prototype.setup_afterAdd=function(t,i){var o,n;(e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,6))&&(t.readByte()==this.packageItem.objectType&&(null!=(o=t.readS())&&(this.title=o),null!=(o=t.readS())&&(this.selectedTitle=o),null!=(o=t.readS())&&(this.icon=o),null!=(o=t.readS())&&(this.selectedIcon=o),t.readBool()&&(this.titleColor=t.readColor()),0!=(n=t.readInt())&&(this.titleFontSize=n),(n=t.readShort())>=0&&(this._relatedController=this.parent.getControllerAt(n)),this._relatedPageId=t.readS(),null!=(o=t.readS())&&(this._sound=o),t.readBool()&&(this._soundVolumeScale=t.readFloat()),this.selected=t.readBool()))},i.prototype.onRollOver_1=function(){this._buttonController&&this._buttonController.hasPage(i.OVER)&&(this._over=!0,this._down||this.grayed&&this._buttonController.hasPage(i.DISABLED)||this.setState(this._selected?i.SELECTED_OVER:i.OVER))},i.prototype.onRollOut_1=function(){this._buttonController&&this._buttonController.hasPage(i.OVER)&&(this._over=!1,this._down||this.grayed&&this._buttonController.hasPage(i.DISABLED)||this.setState(this._selected?i.DOWN:i.UP))},i.prototype.onTouchBegin_1=function(e){e.button==cc.Event.EventMouse.BUTTON_LEFT&&(this._down=!0,e.captureTouch(),this._mode==t.ButtonMode.Common&&(this.grayed&&this._buttonController&&this._buttonController.hasPage(i.DISABLED)?this.setState(i.SELECTED_DISABLED):this.setState(i.DOWN)),null!=this._linkedPopup&&(this._linkedPopup instanceof t.Window?this._linkedPopup.toggleStatus():this.root.togglePopup(this._linkedPopup,this)))},i.prototype.onTouchEnd_1=function(e){if(e.button==cc.Event.EventMouse.BUTTON_LEFT&&this._down){if(this._down=!1,null==this._node)return;this._mode==t.ButtonMode.Common?this.grayed&&this._buttonController&&this._buttonController.hasPage(i.DISABLED)?this.setState(i.DISABLED):this._over?this.setState(i.OVER):this.setState(i.UP):this._over||null==this._buttonController||this._buttonController.selectedPage!=i.OVER&&this._buttonController.selectedPage!=i.SELECTED_OVER||this.setCurrentState()}},i.prototype.onClick_1=function(){if(this._sound){var e=t.UIPackage.getItemByURL(this._sound);if(e){var i=e.owner.getItemAsset(e);i&&t.GRoot.inst.playOneShotSound(i,this._soundVolumeScale)}}this._mode==t.ButtonMode.Check?this._changeStateOnClick&&(this.selected=!this._selected,this._node.emit(t.Event.STATUS_CHANGED,this)):this._mode==t.ButtonMode.Radio?this._changeStateOnClick&&!this._selected&&(this.selected=!0,this._node.emit(t.Event.STATUS_CHANGED,this)):this._relatedController&&(this._relatedController.selectedPageId=this._relatedPageId)},i.UP="up",i.DOWN="down",i.OVER="over",i.SELECTED_OVER="selectedOver",i.DISABLED="disabled",i.SELECTED_DISABLED="selectedDisabled",i}(t.GComponent);t.GButton=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._visibleItemCount=0,i._selectedIndex=0,i._popupDirection=t.PopupDirection.Auto,i._node.name="GComboBox",i._visibleItemCount=t.UIConfig.defaultComboBoxVisibleItemCount,i._itemsUpdated=!0,i._selectedIndex=-1,i._items=[],i._values=[],i}return __extends(i,e),Object.defineProperty(i.prototype,"text",{get:function(){return this._titleObject?this._titleObject.text:null},set:function(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"icon",{get:function(){return this._iconObject?this._iconObject.icon:null},set:function(t){this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"titleColor",{get:function(){var t=this.getTextField();return null!=t?t.color:cc.Color.BLACK},set:function(t){var e=this.getTextField();null!=e&&(e.color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"titleFontSize",{get:function(){var t=this.getTextField();return null!=t?t.fontSize:0},set:function(t){var e=this.getTextField();null!=e&&(e.fontSize=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibleItemCount",{get:function(){return this._visibleItemCount},set:function(t){this._visibleItemCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"popupDirection",{get:function(){return this._popupDirection},set:function(t){this._popupDirection=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"items",{get:function(){return this._items},set:function(t){t?this._items=t.concat():this._items.length=0,this._items.length>0?(this._selectedIndex>=this._items.length?this._selectedIndex=this._items.length-1:-1==this._selectedIndex&&(this._selectedIndex=0),this.text=this._items[this._selectedIndex],null!=this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",null!=this._icons&&(this.icon=null),this._selectedIndex=-1),this._itemsUpdated=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"icons",{get:function(){return this._icons},set:function(t){this._icons=t,null!=this._icons&&-1!=this._selectedIndex&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"values",{get:function(){return this._values},set:function(t){t?this._values=t.concat():this._values.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this._selectedIndex>=0&&this._selectedIndex<this._items.length?(this.text=this._items[this._selectedIndex],null!=this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",null!=this._icons&&(this.icon=null)),this.updateSelectionController())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"value",{get:function(){return this._values[this._selectedIndex]},set:function(t){var e=this._values.indexOf(t);-1==e&&null==t&&(e=this._values.indexOf("")),this.selectedIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectionController",{get:function(){return this._selectionController},set:function(t){this._selectionController=t},enumerable:!0,configurable:!0}),i.prototype.getTextField=function(){return this._titleObject instanceof t.GTextField?this._titleObject:this._titleObject instanceof t.GLabel?this._titleObject.getTextField():this._titleObject instanceof t.GButton?this._titleObject.getTextField():null},i.prototype.setState=function(t){this._buttonController&&(this._buttonController.selectedPage=t)},i.prototype.getProp=function(i){switch(i){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var o=this.getTextField();return o?o.strokeColor:0;case t.ObjectPropID.FontSize:return(o=this.getTextField())?o.fontSize:0;default:return e.prototype.getProp.call(this,i)}},i.prototype.setProp=function(i,o){switch(i){case t.ObjectPropID.Color:this.titleColor=o;break;case t.ObjectPropID.OutlineColor:var n=this.getTextField();n&&(n.strokeColor=o);break;case t.ObjectPropID.FontSize:(n=this.getTextField())&&(n.fontSize=o);break;default:e.prototype.setProp.call(this,i,o)}},i.prototype.constructExtension=function(e){var i;if(this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),i=e.readS()){if(this.dropdown=t.UIPackage.createObjectFromURL(i),!this.dropdown)return void console.error("\u4e0b\u62c9\u6846\u5fc5\u987b\u4e3a\u5143\u4ef6");if(this.dropdown.name="this.dropdown",this._list=this.dropdown.getChild("list").asList,null==this._list)return void console.error(this.resourceURL+": \u4e0b\u62c9\u6846\u7684\u5f39\u51fa\u5143\u4ef6\u91cc\u5fc5\u987b\u5305\u542b\u540d\u4e3alist\u7684\u5217\u8868");this._list.on(t.Event.CLICK_ITEM,this.onClickItem,this),this._list.addRelation(this.dropdown,t.RelationType.Width),this._list.removeRelation(this.dropdown,t.RelationType.Height),this.dropdown.addRelation(this._list,t.RelationType.Height),this.dropdown.removeRelation(this._list,t.RelationType.Width),this.dropdown.on(t.Event.UNDISPLAY,this.onPopupClosed,this)}this._node.on(t.Event.TOUCH_BEGIN,this.onTouchBegin_1,this),this._node.on(t.Event.TOUCH_END,this.onTouchEnd_1,this),this._node.on(t.Event.ROLL_OVER,this.onRollOver_1,this),this._node.on(t.Event.ROLL_OUT,this.onRollOut_1,this)},i.prototype.handleControllerChanged=function(t){e.prototype.handleControllerChanged.call(this,t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)},i.prototype.updateSelectionController=function(){if(null!=this._selectionController&&!this._selectionController.changing&&this._selectedIndex<this._selectionController.pageCount){var t=this._selectionController;this._selectionController=null,t.selectedIndex=this._selectedIndex,this._selectionController=t}},i.prototype.dispose=function(){this.dropdown&&(this.dropdown.dispose(),this.dropdown=null),e.prototype.dispose.call(this)},i.prototype.setup_afterAdd=function(t,i){if(e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,6)&&t.readByte()==this.packageItem.objectType){var o,n,s,r,a=t.readShort();for(o=0;o<a;o++)s=t.readShort(),s+=t.position,this._items[o]=t.readS(),this._values[o]=t.readS(),null!=(r=t.readS())&&(null==this._icons&&(this._icons=new Array),this._icons[o]=r),t.position=s;null!=(r=t.readS())?(this.text=r,this._selectedIndex=this._items.indexOf(r)):this._items.length>0?(this._selectedIndex=0,this.text=this._items[0]):this._selectedIndex=-1,null!=(r=t.readS())&&(this.icon=r),t.readBool()&&(this.titleColor=t.readColor()),(n=t.readInt())>0&&(this._visibleItemCount=n),this._popupDirection=t.readByte(),(n=t.readShort())>=0&&(this._selectionController=this.parent.getControllerAt(n))}},i.prototype.showDropdown=function(){if(this._itemsUpdated){this._itemsUpdated=!1,this._list.removeChildrenToPool();for(var e=this._items.length,i=0;i<e;i++){var o=this._list.addItemFromPool();o.name=i<this._values.length?this._values[i]:"",o.text=this._items[i],o.icon=null!=this._icons&&i<this._icons.length?this._icons[i]:null}this._list.resizeToFit(this._visibleItemCount)}this._list.selectedIndex=-1,this.dropdown.width=this.width,this._list.ensureBoundsCorrect();var n=null;this._popupDirection==t.PopupDirection.Down?n=!0:this._popupDirection==t.PopupDirection.Up&&(n=!1),this.root.togglePopup(this.dropdown,this,n),this.dropdown.parent&&this.setState(t.GButton.DOWN)},i.prototype.onPopupClosed=function(){this._over?this.setState(t.GButton.OVER):this.setState(t.GButton.UP)},i.prototype.onClickItem=function(t){var e=this,i=this._list.getChildIndex(t);this._partner.callLater(function(t){e.onClickItem2(i)},.1)},i.prototype.onClickItem2=function(e){this.dropdown.parent instanceof t.GRoot&&this.dropdown.parent.hidePopup(),this._selectedIndex=-1,this.selectedIndex=e,this._node.emit(t.Event.STATUS_CHANGED,this)},i.prototype.onRollOver_1=function(){this._over=!0,this._down||this.dropdown&&this.dropdown.parent||this.setState(t.GButton.OVER)},i.prototype.onRollOut_1=function(){this._over=!1,this._down||this.dropdown&&this.dropdown.parent||this.setState(t.GButton.UP)},i.prototype.onTouchBegin_1=function(e){e.button==cc.Event.EventMouse.BUTTON_LEFT&&(e.initiator instanceof t.GTextInput&&e.initiator.editable||(this._down=!0,e.captureTouch(),this.dropdown&&this.showDropdown()))},i.prototype.onTouchEnd_1=function(e){e.button==cc.Event.EventMouse.BUTTON_LEFT&&this._down&&(this._down=!1,this.dropdown&&!this.dropdown.parent&&(this._over?this.setState(t.GButton.OVER):this.setState(t.GButton.UP)))},i}(t.GComponent);t.GComboBox=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._type=0,t._lineSize=0,t._node.name="GGraph",t._lineSize=1,t._lineColor=cc.Color.BLACK,t._fillColor=cc.Color.WHITE,t._cornerRadius=null,t._sides=3,t._startAngle=0,t._content=t._node.addComponent(cc.Graphics),t}return __extends(i,e),i.prototype.drawRect=function(e,i,o,n){this._type=t.GraphType.Rect,this._lineSize=e,this._lineColor=i,this._fillColor=o,this._cornerRadius=n,this.updateGraph()},i.prototype.drawEllipse=function(e,i,o){this._type=t.GraphType.Ellipse,this._lineSize=e,this._lineColor=i,this._fillColor=o,this._cornerRadius=null,this.updateGraph()},i.prototype.drawRegularPolygon=function(t,e,i,o,n,s){void 0===n&&(n=0),void 0===s&&(s=null),this._type=4,this._lineSize=t,this._lineColor=e,this._fillColor=i,this._sides=o,this._startAngle=n,this._distances=s,this.updateGraph()},i.prototype.drawPolygon=function(t,e,i,o){this._type=3,this._lineSize=t,this._lineColor=e,this._fillColor=i,this._polygonPoints=o,this.updateGraph()},Object.defineProperty(i.prototype,"distances",{get:function(){return this._distances},set:function(t){this._distances=t,3==this._type&&this.updateGraph()},enumerable:!0,configurable:!0}),i.prototype.clearGraphics=function(){this._type=t.GraphType.PlaceHolder,this._hasContent&&(this._content.clear(),this._hasContent=!1)},Object.defineProperty(i.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._fillColor},set:function(t){this._fillColor=t,0!=this._type&&this.updateGraph()},enumerable:!0,configurable:!0}),i.prototype.updateGraph=function(){var t=this._content;this._hasContent&&(this._hasContent=!1,t.clear());var e=this._width,i=this._height;if(0!=e&&0!=i){var o=-this.pivotX*this._width,n=this.pivotY*this._height;if(t.lineWidth=this._lineSize,t.strokeColor=this._lineColor,t.fillColor=this._fillColor,1==this._type)this._cornerRadius?t.roundRect(0+o,-i+n,e,i,2*this._cornerRadius[0]):t.rect(0+o,-i+n,e,i);else if(2==this._type)t.ellipse(e/2+o,-i/2+n,e/2,i/2);else if(3==this._type)this.drawPath(t,this._polygonPoints,o,n);else if(4==this._type){this._polygonPoints||(this._polygonPoints=[]);var s=Math.min(this._width,this._height)/2;this._polygonPoints.length=0;for(var r,a=cc.misc.degreesToRadians(this._startAngle),h=2*Math.PI/this._sides,l=0;l<this._sides;l++){this._distances?(r=this._distances[l],isNaN(r)&&(r=1)):r=1;var c=s+s*r*Math.cos(a),u=s+s*r*Math.sin(a);this._polygonPoints.push(c,u),a+=h}this.drawPath(t,this._polygonPoints,o,n)}0!=this._lineSize&&t.stroke(),t.fill(),this._hasContent=!0}},i.prototype.drawPath=function(t,e,i,o){var n=e.length;t.moveTo(e[0]+i,-e[1]+o);for(var s=2;s<n;s+=2)t.lineTo(e[s]+i,-e[s+1]+o);t.lineTo(e[0]+i,-e[1]+o)},i.prototype.handleSizeChanged=function(){e.prototype.handleSizeChanged.call(this),0!=this._type&&this.updateGraph()},i.prototype.handleAnchorChanged=function(){e.prototype.handleSizeChanged.call(this),0!=this._type&&this.updateGraph()},i.prototype.getProp=function(i){return i==t.ObjectPropID.Color?this.color:e.prototype.getProp.call(this,i)},i.prototype.setProp=function(i,o){i==t.ObjectPropID.Color?this.color=o:e.prototype.setProp.call(this,i,o)},i.prototype.setup_beforeAdd=function(t,i){if(e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,5),this._type=t.readByte(),0!=this._type){var o,n;if(this._lineSize=t.readInt(),this._lineColor=t.readColor(!0),this._fillColor=t.readColor(!0),t.readBool())for(this._cornerRadius=new Array(4),o=0;o<4;o++)this._cornerRadius[o]=t.readFloat();if(3==this._type)for(n=t.readShort(),this._polygonPoints=[],this._polygonPoints.length=n,o=0;o<n;o++)this._polygonPoints[o]=t.readFloat();else if(4==this._type&&(this._sides=t.readShort(),this._startAngle=t.readFloat(),(n=t.readShort())>0))for(this._distances=[],o=0;o<n;o++)this._distances[o]=t.readFloat();this.updateGraph()}},i}(t.GObject);t.GGraph=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._layout=0,t._lineGap=0,t._columnGap=0,t._mainGridIndex=-1,t._mainGridMinSize=50,t._mainChildIndex=-1,t._totalSize=0,t._numChildren=0,t._updating=0,t._node.name="GGroup",t._touchDisabled=!0,t}return __extends(i,e),i.prototype.dispose=function(){this._boundsChanged=!1,e.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"layout",{get:function(){return this._layout},set:function(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineGap",{get:function(){return this._lineGap},set:function(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"columnGap",{get:function(){return this._columnGap},set:function(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"excludeInvisibles",{get:function(){return this._excludeInvisibles},set:function(t){this._excludeInvisibles!=t&&(this._excludeInvisibles=t,this.setBoundsChangedFlag())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoSizeDisabled",{get:function(){return this._autoSizeDisabled},set:function(t){this._autoSizeDisabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mainGridMinSize",{get:function(){return this._mainGridMinSize},set:function(t){this._mainGridMinSize!=t&&(this._mainGridMinSize=t,this.setBoundsChangedFlag())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mainGridIndex",{get:function(){return this._mainGridIndex},set:function(t){this._mainGridIndex!=t&&(this._mainGridIndex=t,this.setBoundsChangedFlag())},enumerable:!0,configurable:!0}),i.prototype.setBoundsChangedFlag=function(e){void 0===e&&(e=!1),0==this._updating&&null!=this._parent&&(e||(this._percentReady=!1),this._boundsChanged||(this._boundsChanged=!0,this._layout!=t.GroupLayoutType.None&&this._partner.callLater(this._ensureBoundsCorrect)))},i.prototype._ensureBoundsCorrect=function(){this.node.$gobj.ensureBoundsCorrect()},i.prototype.ensureSizeCorrect=function(){null!=this._parent&&this._boundsChanged&&0!=this._layout&&(this._boundsChanged=!1,this._autoSizeDisabled?this.resizeChildren(0,0):(this.handleLayout(),this.updateBounds()))},i.prototype.ensureBoundsCorrect=function(){null!=this._parent&&this._boundsChanged&&(this._boundsChanged=!1,0==this._layout?this.updateBounds():this._autoSizeDisabled?this.resizeChildren(0,0):(this.handleLayout(),this.updateBounds()))},i.prototype.updateBounds=function(){this._partner.unschedule(this._ensureBoundsCorrect);var t,e,i,o=this._parent.numChildren,n=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,h=!0;for(t=0;t<o;t++)(e=this._parent.getChildAt(t)).group!=this||this._excludeInvisibles&&!e.internalVisible3||((i=e.xMin)<n&&(n=i),(i=e.yMin)<s&&(s=i),(i=e.xMin+e.width)>r&&(r=i),(i=e.yMin+e.height)>a&&(a=i),h=!1);var l=0,c=0;h||(this._updating|=1,this.setPosition(n,s),this._updating&=2,l=r-n,c=a-s),0==(2&this._updating)?(this._updating|=2,this.setSize(l,c),this._updating&=1):(this._updating&=1,this.resizeChildren(this._width-l,this._height-c))},i.prototype.handleLayout=function(){var e,i,o;if(this._updating|=1,this._layout==t.GroupLayoutType.Horizontal){var n=this.x;for(o=this._parent.numChildren,i=0;i<o;i++)(e=this._parent.getChildAt(i)).group==this&&(this._excludeInvisibles&&!e.internalVisible3||(e.xMin=n,0!=e.width&&(n+=e.width+this._columnGap)))}else if(this._layout==t.GroupLayoutType.Vertical){var s=this.y;for(o=this._parent.numChildren,i=0;i<o;i++)(e=this._parent.getChildAt(i)).group==this&&(this._excludeInvisibles&&!e.internalVisible3||(e.yMin=s,0!=e.height&&(s+=e.height+this._lineGap)))}this._updating&=2},i.prototype.moveChildren=function(t,e){if(0==(1&this._updating)&&null!=this._parent){this._updating|=1;var i,o,n=this._parent.numChildren;for(i=0;i<n;i++)(o=this._parent.getChildAt(i)).group==this&&o.setPosition(o.x+t,o.y+e);this._updating&=2}},i.prototype.resizeChildren=function(e,i){if(this._layout!=t.GroupLayoutType.None&&0==(2&this._updating)&&null!=this._parent)if(this._updating|=2,!this._boundsChanged||(this._boundsChanged=!1,this._autoSizeDisabled)){var o,n,s=this._parent.numChildren;if(!this._percentReady){this._percentReady=!0,this._numChildren=0,this._totalSize=0,this._mainChildIndex=-1;var r=0;for(o=0;o<s;o++)(n=this._parent.getChildAt(o)).group==this&&(this._excludeInvisibles&&!n.internalVisible3||(r==this._mainGridIndex&&(this._mainChildIndex=o),this._numChildren++,1==this._layout?this._totalSize+=n.width:this._totalSize+=n.height),r++);for(-1!=this._mainChildIndex&&(1==this._layout?(n=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-n.width,n._sizePercentInGroup=this._mainGridMinSize/this._totalSize):(n=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-n.height,n._sizePercentInGroup=this._mainGridMinSize/this._totalSize)),o=0;o<s;o++)(n=this._parent.getChildAt(o)).group==this&&o!=this._mainChildIndex&&(this._totalSize>0?n._sizePercentInGroup=(1==this._layout?n.width:n.height)/this._totalSize:n._sizePercentInGroup=0)}var a=0,h=1,l=!1;if(1==this._layout){a=this.width-(this._numChildren-1)*this._columnGap,-1!=this._mainChildIndex&&a>=this._totalSize&&((n=this._parent.getChildAt(this._mainChildIndex)).setSize(a-(this._totalSize-this._mainGridMinSize),n._rawHeight+i,!0),a-=n.width,h-=n._sizePercentInGroup,l=!0);var c=this.x;for(o=0;o<s;o++)(n=this._parent.getChildAt(o)).group==this&&(!this._excludeInvisibles||n.internalVisible3?(l&&o==this._mainChildIndex||(n.setSize(Math.round(n._sizePercentInGroup/h*a),n._rawHeight+i,!0),h-=n._sizePercentInGroup,a-=n.width),n.xMin=c,0!=n.width&&(c+=n.width+this._columnGap)):n.setSize(n._rawWidth,n._rawHeight+i,!0))}else{a=this.height-(this._numChildren-1)*this._lineGap,-1!=this._mainChildIndex&&a>=this._totalSize&&((n=this._parent.getChildAt(this._mainChildIndex)).setSize(n._rawWidth+e,a-(this._totalSize-this._mainGridMinSize),!0),a-=n.height,h-=n._sizePercentInGroup,l=!0);var u=this.y;for(o=0;o<s;o++)(n=this._parent.getChildAt(o)).group==this&&(!this._excludeInvisibles||n.internalVisible3?(l&&o==this._mainChildIndex||(n.setSize(n._rawWidth+e,Math.round(n._sizePercentInGroup/h*a),!0),h-=n._sizePercentInGroup,a-=n.height),n.yMin=u,0!=n.height&&(u+=n.height+this._lineGap)):n.setSize(n._rawWidth+e,n._rawHeight,!0))}this._updating&=1}else this.updateBounds()},i.prototype.handleAlphaChanged=function(){if(!this._underConstruct)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&(i.alpha=this.alpha)}},i.prototype.handleVisibleChanged=function(){if(this._parent)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&i.handleVisibleChanged()}},i.prototype.setup_beforeAdd=function(t,i){e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,5),this._layout=t.readByte(),this._lineGap=t.readInt(),this._columnGap=t.readInt(),t.version>=2&&(this._excludeInvisibles=t.readBool(),this._autoSizeDisabled=t.readBool(),this._mainChildIndex=t.readInt())},i.prototype.setup_afterAdd=function(t,i){e.prototype.setup_afterAdd.call(this,t,i),this.visible||this.handleVisibleChanged()},i}(t.GObject);t.GGroup=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._node.name="GImage",i._touchDisabled=!0,i._content=i._node.addComponent(t.Image),i}return __extends(i,e),Object.defineProperty(i.prototype,"color",{get:function(){return this._node.color},set:function(t){this._node.color!=t&&(this._node.color=t,this.updateGear(4))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flip",{get:function(){return this._content.flip},set:function(t){this._content.flip=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillMethod",{get:function(){return this._content.fillMethod},set:function(t){this._content.fillMethod=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillOrigin",{get:function(){return this._content.fillOrigin},set:function(t){this._content.fillOrigin=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillClockwise",{get:function(){return this._content.fillClockwise},set:function(t){this._content.fillClockwise=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillAmount",{get:function(){return this._content.fillAmount},set:function(t){this._content.fillAmount=t},enumerable:!0,configurable:!0}),i.prototype.constructFromResource=function(){var t=this.packageItem.getBranch();this.sourceWidth=t.width,this.sourceHeight=t.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),(t=t.getHighResolution()).load(),t.scale9Grid?this._content.type=cc.Sprite.Type.SLICED:t.scaleByTile&&(this._content.type=cc.Sprite.Type.TILED),this._content.spriteFrame=t.asset},i.prototype.handleGrayedChanged=function(){this._content.grayed=this._grayed},i.prototype.getProp=function(i){return i==t.ObjectPropID.Color?this.color:e.prototype.getProp.call(this,i)},i.prototype.setProp=function(i,o){i==t.ObjectPropID.Color?this.color=o:e.prototype.setProp.call(this,i,o)},i.prototype.setup_beforeAdd=function(t,i){e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,5),t.readBool()&&(this.color=t.readColor()),this._content.flip=t.readByte(),this._content.fillMethod=t.readByte(),0!=this._content.fillMethod&&(this._content.fillOrigin=t.readByte(),this._content.fillClockwise=t.readBool(),this._content.fillAmount=t.readFloat())},i}(t.GObject);t.GImage=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._node.name="GLabel",t}return __extends(i,e),Object.defineProperty(i.prototype,"icon",{get:function(){if(null!=this._iconObject)return this._iconObject.icon},set:function(t){null!=this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"title",{get:function(){return this._titleObject?this._titleObject.text:null},set:function(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"text",{get:function(){return this.title},set:function(t){this.title=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"titleColor",{get:function(){var t=this.getTextField();return null!=t?t.color:cc.Color.WHITE},set:function(t){var e=this.getTextField();null!=e&&(e.color=t),this.updateGear(4)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"titleFontSize",{get:function(){var t=this.getTextField();return null!=t?t.fontSize:0},set:function(t){var e=this.getTextField();null!=e&&(e.fontSize=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"editable",{get:function(){return!!(this._titleObject&&this._titleObject instanceof t.GTextInput)&&this._titleObject.asTextInput.editable},set:function(t){this._titleObject&&(this._titleObject.asTextInput.editable=t)},enumerable:!0,configurable:!0}),i.prototype.getTextField=function(){return this._titleObject instanceof t.GTextField?this._titleObject:this._titleObject instanceof i?this._titleObject.getTextField():this._titleObject instanceof t.GButton?this._titleObject.getTextField():null},i.prototype.getProp=function(i){switch(i){case t.ObjectPropID.Color:return this.titleColor;case t.ObjectPropID.OutlineColor:var o=this.getTextField();return o?o.strokeColor:0;case t.ObjectPropID.FontSize:return this.titleFontSize;default:return e.prototype.getProp.call(this,i)}},i.prototype.setProp=function(i,o){switch(i){case t.ObjectPropID.Color:this.titleColor=o;break;case t.ObjectPropID.OutlineColor:var n=this.getTextField();n&&(n.strokeColor=o);break;case t.ObjectPropID.FontSize:this.titleFontSize=o;break;default:e.prototype.setProp.call(this,i,o)}},i.prototype.constructExtension=function(t){this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon")},i.prototype.setup_afterAdd=function(t,i){if(e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,6)&&t.readByte()==this.packageItem.objectType){var o;null!=(o=t.readS())&&(this.title=o),null!=(o=t.readS())&&(this.icon=o),t.readBool()&&(this.titleColor=t.readColor());var n=t.readInt();if(0!=n&&(this.titleFontSize=n),t.readBool()){var s=this.getTextField();null!=s?(null!=(o=t.readS())&&(s.promptText=o),null!=(o=t.readS())&&(s.restrict=o),0!=(n=t.readInt())&&(s.maxLength=n),n=t.readInt(),t.readBool()&&(s.password=!0)):t.skip(13)}}},i}(t.GComponent);t.GLabel=e}(fgui||(fgui={})),function(t){var e=function(e){function o(){var i=e.call(this)||this;return i.scrollItemToViewOnClick=!0,i.foldInvisibleItems=!1,i._lineCount=0,i._columnCount=0,i._lineGap=0,i._columnGap=0,i._lastSelectedIndex=0,i._numItems=0,i._realNumItems=0,i._firstIndex=0,i._curLineItemCount=0,i._curLineItemCount2=0,i._virtualListChanged=0,i.itemInfoVer=0,i._node.name="GList",i._trackBounds=!0,i._pool=new t.GObjectPool,i._layout=t.ListLayoutType.SingleColumn,i._autoResizeItem=!0,i._lastSelectedIndex=-1,i._selectionMode=t.ListSelectionMode.Single,i.opaque=!0,i._align=t.AlignType.Left,i._verticalAlign=t.VertAlignType.Top,i}return __extends(o,e),o.prototype.dispose=function(){this._pool.clear(),e.prototype.dispose.call(this)},Object.defineProperty(o.prototype,"layout",{get:function(){return this._layout},set:function(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineCount",{get:function(){return this._lineCount},set:function(t){this._lineCount!=t&&(this._lineCount=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"columnCount",{get:function(){return this._columnCount},set:function(t){this._columnCount!=t&&(this._columnCount=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineGap",{get:function(){return this._lineGap},set:function(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"columnGap",{get:function(){return this._columnGap},set:function(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"align",{get:function(){return this._align},set:function(t){this._align!=t&&(this._align=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"verticalAlign",{get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!=t&&(this._verticalAlign=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"virtualItemSize",{get:function(){return this._itemSize},set:function(t){this._virtual&&(null==this._itemSize&&(this._itemSize=new cc.Size(0,0)),this._itemSize.width=t.width,this._itemSize.height=t.height,this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"defaultItem",{get:function(){return this._defaultItem},set:function(t){this._defaultItem=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"autoResizeItem",{get:function(){return this._autoResizeItem},set:function(t){this._autoResizeItem!=t&&(this._autoResizeItem=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionMode",{get:function(){return this._selectionMode},set:function(t){this._selectionMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionController",{get:function(){return this._selectionController},set:function(t){this._selectionController=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"itemPool",{get:function(){return this._pool},enumerable:!0,configurable:!0}),o.prototype.getFromPool=function(t){void 0===t&&(t=null),t||(t=this._defaultItem);var e=this._pool.getObject(t);return null!=e&&(e.visible=!0),e},o.prototype.returnToPool=function(t){this._pool.returnObject(t)},o.prototype.addChildAt=function(i,o){if(void 0===o&&(o=0),e.prototype.addChildAt.call(this,i,o),i instanceof t.GButton){var n=i;n.selected=!1,n.changeStateOnClick=!1}return i.on(t.Event.CLICK,this.onClickItem,this),i},o.prototype.addItem=function(e){return void 0===e&&(e=null),e||(e=this._defaultItem),this.addChild(t.UIPackage.createObjectFromURL(e))},o.prototype.addItemFromPool=function(t){return void 0===t&&(t=null),this.addChild(this.getFromPool(t))},o.prototype.removeChildAt=function(i,o){var n=e.prototype.removeChildAt.call(this,i,o);return n.off(t.Event.CLICK,this.onClickItem,this),n},o.prototype.removeChildToPoolAt=function(t){var i=e.prototype.removeChildAt.call(this,t);this.returnToPool(i)},o.prototype.removeChildToPool=function(t){e.prototype.removeChild.call(this,t),this.returnToPool(t)},o.prototype.removeChildrenToPool=function(t,e){void 0==t&&(t=0),void 0==e&&(e=-1),(e<0||e>=this._children.length)&&(e=this._children.length-1);for(var i=t;i<=e;++i)this.removeChildToPoolAt(t)},Object.defineProperty(o.prototype,"selectedIndex",{get:function(){var e;if(this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];if(i.obj instanceof t.GButton&&i.obj.selected||null==i.obj&&i.selected)return this._loop?e%this._numItems:e}else{var o=this._children.length;for(e=0;e<o;e++){var n=this._children[e].asButton;if(null!=n&&n.selected)return e}}return-1},set:function(e){e>=0&&e<this.numItems?(this._selectionMode!=t.ListSelectionMode.Single&&this.clearSelection(),this.addSelection(e)):this.clearSelection()},enumerable:!0,configurable:!0}),o.prototype.getSelection=function(e){var i;if(e||(e=new Array),this._virtual)for(i=0;i<this._realNumItems;i++){var o=this._virtualItems[i];if(o.obj instanceof t.GButton&&o.obj.selected||null==o.obj&&o.selected){var n=i;if(this._loop&&(n=i%this._numItems,-1!=e.indexOf(n)))continue;e.push(n)}}else{var s=this._children.length;for(i=0;i<s;i++){var r=this._children[i].asButton;null!=r&&r.selected&&e.push(i)}}return e},o.prototype.addSelection=function(e,i){if(this._selectionMode!=t.ListSelectionMode.None){this.checkVirtualList(),this._selectionMode==t.ListSelectionMode.Single&&this.clearSelection(),i&&this.scrollToView(e),this._lastSelectedIndex=e;var o=null;if(this._virtual){var n=this._virtualItems[e];null!=n.obj&&(o=n.obj.asButton),n.selected=!0}else o=this.getChildAt(e).asButton;null==o||o.selected||(o.selected=!0,this.updateSelectionController(e))}},o.prototype.removeSelection=function(e){if(this._selectionMode!=t.ListSelectionMode.None){var i=null;if(this._virtual){var o=this._virtualItems[e];null!=o.obj&&(i=o.obj.asButton),o.selected=!1}else i=this.getChildAt(e).asButton;null!=i&&(i.selected=!1)}},o.prototype.clearSelection=function(){var e;if(this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];i.obj instanceof t.GButton&&(i.obj.selected=!1),i.selected=!1}else{var o=this._children.length;for(e=0;e<o;e++){var n=this._children[e].asButton;null!=n&&(n.selected=!1)}}},o.prototype.clearSelectionExcept=function(e){var i;if(this._virtual)for(i=0;i<this._realNumItems;i++){var o=this._virtualItems[i];o.obj!=e&&(o.obj instanceof t.GButton&&(o.obj.selected=!1),o.selected=!1)}else{var n=this._children.length;for(i=0;i<n;i++){var s=this._children[i].asButton;null!=s&&s!=e&&(s.selected=!1)}}},o.prototype.selectAll=function(){this.checkVirtualList();var e,i=-1;if(this._virtual)for(e=0;e<this._realNumItems;e++){var o=this._virtualItems[e];o.obj instanceof t.GButton&&!o.obj.selected&&(o.obj.selected=!0,i=e),o.selected=!0}else{var n=this._children.length;for(e=0;e<n;e++){var s=this._children[e].asButton;null==s||s.selected||(s.selected=!0,i=e)}}-1!=i&&this.updateSelectionController(i)},o.prototype.selectNone=function(){this.clearSelection()},o.prototype.selectReverse=function(){this.checkVirtualList();var e,i=-1;if(this._virtual)for(e=0;e<this._realNumItems;e++){var o=this._virtualItems[e];o.obj instanceof t.GButton&&(o.obj.selected=!o.obj.selected,o.obj.selected&&(i=e)),o.selected=!o.selected}else{var n=this._children.length;for(e=0;e<n;e++){var s=this._children[e].asButton;null!=s&&(s.selected=!s.selected,s.selected&&(i=e))}}-1!=i&&this.updateSelectionController(i)},o.prototype.handleArrowKey=function(e){var i=this.selectedIndex;if(-1!=i)switch(e){case 1:if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowVertical)--i>=0&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination){for(var o=this._children[i],n=0,s=i-1;s>=0;s--){var r=this._children[s];if(r.y!=o.y){o=r;break}n++}for(;s>=0;s--)if((r=this._children[s]).y!=o.y){this.clearSelection(),this.addSelection(s+n+1,!0);break}}break;case 3:if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination)++i<this._children.length&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowVertical){o=this._children[i],n=0;var a=this._children.length;for(s=i+1;s<a;s++){if((r=this._children[s]).x!=o.x){o=r;break}n++}for(;s<a;s++)if((r=this._children[s]).x!=o.x){this.clearSelection(),this.addSelection(s-n-1,!0);break}}break;case 5:if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowVertical)++i<this._children.length&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination){for(o=this._children[i],n=0,a=this._children.length,s=i+1;s<a;s++){if((r=this._children[s]).y!=o.y){o=r;break}n++}for(;s<a;s++)if((r=this._children[s]).y!=o.y){this.clearSelection(),this.addSelection(s-n-1,!0);break}}break;case 7:if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.Pagination)--i>=0&&(this.clearSelection(),this.addSelection(i,!0));else if(this._layout==t.ListLayoutType.FlowVertical){for(o=this._children[i],n=0,s=i-1;s>=0;s--){if((r=this._children[s]).x!=o.x){o=r;break}n++}for(;s>=0;s--)if((r=this._children[s]).x!=o.x){this.clearSelection(),this.addSelection(s+n+1,!0);break}}}},o.prototype.onClickItem=function(e){if(null==this._scrollPane||!this._scrollPane.isDragged){var i=t.GObject.cast(e.currentTarget);this.setSelectionOnEvent(i,e),this._scrollPane&&this.scrollItemToViewOnClick&&this._scrollPane.scrollToView(i,!0),this.dispatchItemEvent(i,e)}},o.prototype.dispatchItemEvent=function(e,i){this._node.emit(t.Event.CLICK_ITEM,e,i)},o.prototype.setSelectionOnEvent=function(e,i){if(e instanceof t.GButton&&this._selectionMode!=t.ListSelectionMode.None){var o=!1,n=e,s=this.childIndexToItemIndex(this.getChildIndex(e));if(this._selectionMode==t.ListSelectionMode.Single)n.selected||(this.clearSelectionExcept(n),n.selected=!0);else if(i.isShiftDown){if(!n.selected)if(-1!=this._lastSelectedIndex){var r,a=Math.min(this._lastSelectedIndex,s),h=Math.max(this._lastSelectedIndex,s);if(h=Math.min(h,this.numItems-1),this._virtual)for(r=a;r<=h;r++){var l=this._virtualItems[r];l.obj instanceof t.GButton&&(l.obj.selected=!0),l.selected=!0}else for(r=a;r<=h;r++){var c=this.getChildAt(r).asButton;null!=c&&(c.selected=!0)}o=!0}else n.selected=!0}else i.isCtrlDown||this._selectionMode==t.ListSelectionMode.Multiple_SingleClick?n.selected=!n.selected:n.selected?this.clearSelectionExcept(n):(this.clearSelectionExcept(n),n.selected=!0);o||(this._lastSelectedIndex=s),n.selected&&this.updateSelectionController(s)}},o.prototype.resizeToFit=function(e,i){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===i&&(i=0),this.ensureBoundsCorrect();var o=this.numItems;if(e>o&&(e=o),this._virtual){var n=Math.ceil(e/this._curLineItemCount);this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=n*this._itemSize.height+Math.max(0,n-1)*this._lineGap:this.viewWidth=n*this._itemSize.width+Math.max(0,n-1)*this._columnGap}else if(0==e)this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=i:this.viewWidth=i;else{for(var s=e-1,r=null;s>=0&&(r=this.getChildAt(s),this.foldInvisibleItems&&!r.visible);)s--;if(s<0)this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?this.viewHeight=i:this.viewWidth=i;else{var a=0;this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?((a=r.y+r.height)<i&&(a=i),this.viewHeight=a):((a=r.x+r.width)<i&&(a=i),this.viewWidth=a)}}},o.prototype.getMaxItemWidth=function(){for(var t=this._children.length,e=0,i=0;i<t;i++){var o=this.getChildAt(i);o.width>e&&(e=o.width)}return e},o.prototype.handleSizeChanged=function(){e.prototype.handleSizeChanged.call(this),this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)},o.prototype.handleControllerChanged=function(t){e.prototype.handleControllerChanged.call(this,t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)},o.prototype.updateSelectionController=function(t){if(null!=this._selectionController&&!this._selectionController.changing&&t<this._selectionController.pageCount){var e=this._selectionController;this._selectionController=null,e.selectedIndex=t,this._selectionController=e}},o.prototype.getSnappingPosition=function(i,n,s){var r,a;return this._virtual?(s=s||new cc.Vec2,this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?(r=n,o.pos_param=n,a=this.getIndexOnPos1(!1),n=o.pos_param,a<this._virtualItems.length&&r-n>this._virtualItems[a].height/2&&a<this._realNumItems&&(n+=this._virtualItems[a].height+this._lineGap)):this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical?(r=i,o.pos_param=i,a=this.getIndexOnPos2(!1),i=o.pos_param,a<this._virtualItems.length&&r-i>this._virtualItems[a].width/2&&a<this._realNumItems&&(i+=this._virtualItems[a].width+this._columnGap)):(r=i,o.pos_param=i,a=this.getIndexOnPos3(!1),i=o.pos_param,a<this._virtualItems.length&&r-i>this._virtualItems[a].width/2&&a<this._realNumItems&&(i+=this._virtualItems[a].width+this._columnGap)),s.x=i,s.y=n,s):e.prototype.getSnappingPosition.call(this,i,n,s)},o.prototype.scrollToView=function(e,i,o){if(this._virtual){if(0==this._numItems)return;if(this.checkVirtualList(),e>=this._virtualItems.length)throw"Invalid child index: "+e+">"+this._virtualItems.length;var n;this._loop&&(e=Math.floor(this._firstIndex/this._numItems)*this._numItems+e);var s,r=this._virtualItems[e],a=0;if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(s=this._curLineItemCount-1;s<e;s+=this._curLineItemCount)a+=this._virtualItems[s].height+this._lineGap;n=new cc.Rect(0,a,this._itemSize.width,r.height)}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(s=this._curLineItemCount-1;s<e;s+=this._curLineItemCount)a+=this._virtualItems[s].width+this._columnGap;n=new cc.Rect(a,0,r.width,this._itemSize.height)}else{var h=e/(this._curLineItemCount*this._curLineItemCount2);n=new cc.Rect(h*this.viewWidth+e%this._curLineItemCount*(r.width+this._columnGap),e/this._curLineItemCount%this._curLineItemCount2*(r.height+this._lineGap),r.width,r.height)}o=!0,null!=this._scrollPane&&this._scrollPane.scrollToView(n,i,o)}else{var l=this.getChildAt(e);null!=l&&(null!=this._scrollPane?this._scrollPane.scrollToView(l,i,o):null!=this.parent&&null!=this.parent.scrollPane&&this.parent.scrollPane.scrollToView(l,i,o))}},o.prototype.getFirstChildInView=function(){return this.childIndexToItemIndex(e.prototype.getFirstChildInView.call(this))},o.prototype.childIndexToItemIndex=function(e){if(!this._virtual)return e;if(this._layout==t.ListLayoutType.Pagination){for(var i=this._firstIndex;i<this._realNumItems;i++)if(null!=this._virtualItems[i].obj&&--e<0)return i;return e}return e+=this._firstIndex,this._loop&&this._numItems>0&&(e%=this._numItems),e},o.prototype.itemIndexToChildIndex=function(e){if(!this._virtual)return e;if(this._layout==t.ListLayoutType.Pagination)return this.getChildIndex(this._virtualItems[e].obj);if(this._loop&&this._numItems>0){var i=this._firstIndex%this._numItems;e>=i?e-=i:e=this._numItems-i+e}else e-=this._firstIndex;return e},o.prototype.setVirtual=function(){this._setVirtual(!1)},o.prototype.setVirtualAndLoop=function(){this._setVirtual(!0)},o.prototype._setVirtual=function(e){if(!this._virtual){if(null==this._scrollPane)throw"Virtual list must be scrollable!";if(e){if(this._layout==t.ListLayoutType.FlowHorizontal||this._layout==t.ListLayoutType.FlowVertical)throw"Loop list is not supported for FlowHorizontal or FlowVertical layout!";this._scrollPane.bouncebackEffect=!1}if(this._virtual=!0,this._loop=e,this._virtualItems=new Array,this.removeChildrenToPool(),null==this._itemSize){this._itemSize=new cc.Size(0,0);var i=this.getFromPool(null);if(null==i)throw"Virtual List must have a default list item resource.";this._itemSize.width=i.width,this._itemSize.height=i.height,this.returnToPool(i)}this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal?(this._scrollPane.scrollStep=this._itemSize.height,this._loop&&(this._scrollPane._loop=2)):(this._scrollPane.scrollStep=this._itemSize.width,this._loop&&(this._scrollPane._loop=1)),this._node.on(t.Event.SCROLL,this.__scrolled,this),this.setVirtualListChangedFlag(!0)}},Object.defineProperty(o.prototype,"numItems",{get:function(){return this._virtual?this._numItems:this._children.length},set:function(t){if(this._virtual){if(null==this.itemRenderer)throw"Set itemRenderer first!";this._numItems=t,this._loop?this._realNumItems=6*this._numItems:this._realNumItems=this._numItems;var e=this._virtualItems.length;if(this._realNumItems>e)for(s=e;s<this._realNumItems;s++){var o=new i;o.width=this._itemSize.width,o.height=this._itemSize.height,this._virtualItems.push(o)}else for(s=this._realNumItems;s<e;s++)this._virtualItems[s].selected=!1;0!=this._virtualListChanged&&this._partner.unschedule(this._refreshVirtualList),this._refreshVirtualList()}else{var n=this._children.length;if(t>n)for(var s=n;s<t;s++)null==this.itemProvider?this.addItemFromPool():this.addItemFromPool(this.itemProvider(s));else this.removeChildrenToPool(t,n);if(null!=this.itemRenderer)for(s=0;s<t;s++)this.itemRenderer(s,this.getChildAt(s))}},enumerable:!0,configurable:!0}),o.prototype.refreshVirtualList=function(){this.setVirtualListChangedFlag(!1)},o.prototype.checkVirtualList=function(){0!=this._virtualListChanged&&(this._refreshVirtualList(),this._partner.unschedule(this._refreshVirtualList))},o.prototype.setVirtualListChangedFlag=function(t){t?this._virtualListChanged=2:0==this._virtualListChanged&&(this._virtualListChanged=1),this._partner.callLater(this._refreshVirtualList)},o.prototype._refreshVirtualList=function(e){if(isNaN(e)){var i=2==this._virtualListChanged;this._virtualListChanged=0,this._eventLocked=!0,i&&(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.SingleRow?this._curLineItemCount=1:this._layout==t.ListLayoutType.FlowHorizontal?this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.width+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):this._layout==t.ListLayoutType.FlowVertical?this._lineCount>0?this._curLineItemCount=this._lineCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.height+this._lineGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):(this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.width+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)),this._lineCount>0?this._curLineItemCount2=this._lineCount:(this._curLineItemCount2=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.height+this._lineGap)),this._curLineItemCount2<=0&&(this._curLineItemCount2=1))));var o=0,n=0;if(this._realNumItems>0){var s,r=Math.ceil(this._realNumItems/this._curLineItemCount)*this._curLineItemCount,a=Math.min(this._curLineItemCount,this._realNumItems);if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(s=0;s<r;s+=this._curLineItemCount)o+=this._virtualItems[s].height+this._lineGap;if(o>0&&(o-=this._lineGap),this._autoResizeItem)n=this._scrollPane.viewWidth;else{for(s=0;s<a;s++)n+=this._virtualItems[s].width+this._columnGap;n>0&&(n-=this._columnGap)}}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(s=0;s<r;s+=this._curLineItemCount)n+=this._virtualItems[s].width+this._columnGap;if(n>0&&(n-=this._columnGap),this._autoResizeItem)o=this._scrollPane.viewHeight;else{for(s=0;s<a;s++)o+=this._virtualItems[s].height+this._lineGap;o>0&&(o-=this._lineGap)}}else{n=Math.ceil(r/(this._curLineItemCount*this._curLineItemCount2))*this.viewWidth,o=this.viewHeight}}this.handleAlign(n,o),this._scrollPane.setContentSize(n,o),this._eventLocked=!1,this.handleScroll(!0)}else{this.node.$gobj._refreshVirtualList()}},o.prototype.__scrolled=function(t){this.handleScroll(!1)},o.prototype.getIndexOnPos1=function(t){if(this._realNumItems<this._curLineItemCount)return o.pos_param=0,0;var e,i,n;if(this.numChildren>0&&!t){if((i=this.getChildAt(0).y)>o.pos_param){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((i-=this._virtualItems[e].height+this._lineGap)<=o.pos_param)return o.pos_param=i,e;return o.pos_param=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((n=i+this._virtualItems[e].height+this._lineGap)>o.pos_param)return o.pos_param=i,e;i=n}return o.pos_param=i,this._realNumItems-this._curLineItemCount}for(i=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((n=i+this._virtualItems[e].height+this._lineGap)>o.pos_param)return o.pos_param=i,e;i=n}return o.pos_param=i,this._realNumItems-this._curLineItemCount},o.prototype.getIndexOnPos2=function(t){if(this._realNumItems<this._curLineItemCount)return o.pos_param=0,0;var e,i,n;if(this.numChildren>0&&!t){if((i=this.getChildAt(0).x)>o.pos_param){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((i-=this._virtualItems[e].width+this._columnGap)<=o.pos_param)return o.pos_param=i,e;return o.pos_param=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((n=i+this._virtualItems[e].width+this._columnGap)>o.pos_param)return o.pos_param=i,e;i=n}return o.pos_param=i,this._realNumItems-this._curLineItemCount}for(i=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((n=i+this._virtualItems[e].width+this._columnGap)>o.pos_param)return o.pos_param=i,e;i=n}return o.pos_param=i,this._realNumItems-this._curLineItemCount},o.prototype.getIndexOnPos3=function(t){if(this._realNumItems<this._curLineItemCount)return o.pos_param=0,0;var e,i,n=this.viewWidth,s=Math.floor(o.pos_param/n),r=s*(this._curLineItemCount*this._curLineItemCount2),a=s*n;for(e=0;e<this._curLineItemCount;e++){if((i=a+this._virtualItems[r+e].width+this._columnGap)>o.pos_param)return o.pos_param=a,r+e;a=i}return o.pos_param=a,r+this._curLineItemCount-1},o.prototype.handleScroll=function(e){if(!this._eventLocked){if(this._layout==t.ListLayoutType.SingleColumn||this._layout==t.ListLayoutType.FlowHorizontal){for(var i=0;this.handleScroll1(e);)if(e=!1,++i>20){console.log("FairyGUI: list will never be filled as the item renderer function always returns a different size.");break}this.handleArchOrder1()}else if(this._layout==t.ListLayoutType.SingleRow||this._layout==t.ListLayoutType.FlowVertical){for(i=0;this.handleScroll2(e);)if(e=!1,++i>20){console.log("FairyGUI: list will never be filled as the item renderer function always returns a different size.");break}this.handleArchOrder2()}else this.handleScroll3(e);this._boundsChanged=!1}},o.prototype.handleScroll1=function(e){var i=this._scrollPane.scrollingPosY,n=i+this._scrollPane.viewHeight,s=n==this._scrollPane.contentHeight;o.pos_param=i;var r=this.getIndexOnPos1(e);if(i=o.pos_param,r==this._firstIndex&&!e)return!1;var a=this._firstIndex;this._firstIndex=r;var h,l,c,u,d,_=r,p=a>r,f=this.numChildren,g=a+f-1,m=p?g:a,v=0,y=i,b=0,C=0,w=this.defaultItem,S=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;_<this._realNumItems&&(s||y<n);){if((null==(l=this._virtualItems[_]).obj||e)&&(null!=this.itemProvider&&(null==(w=this.itemProvider(_%this._numItems))&&(w=this._defaultItem),w=t.UIPackage.normalizeURL(w)),null!=l.obj&&l.obj.resourceURL!=w&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null)),null==l.obj){if(p){for(d=m;d>=a;d--)if(null!=(c=this._virtualItems[d]).obj&&c.updateFlag!=this.itemInfoVer&&c.obj.resourceURL==w){c.obj instanceof t.GButton&&(c.selected=c.obj.selected),l.obj=c.obj,c.obj=null,d==m&&m--;break}}else for(d=m;d<=g;d++)if(null!=(c=this._virtualItems[d]).obj&&c.updateFlag!=this.itemInfoVer&&c.obj.resourceURL==w){c.obj instanceof t.GButton&&(c.selected=c.obj.selected),l.obj=c.obj,c.obj=null,d==m&&m++;break}null!=l.obj?this.setChildIndex(l.obj,p?_-r:this.numChildren):(l.obj=this._pool.getObject(w),p?this.addChildAt(l.obj,_-r):this.addChild(l.obj)),l.obj instanceof t.GButton&&(l.obj.selected=l.selected),h=!0}else h=e;h&&(this._autoResizeItem&&(this._layout==t.ListLayoutType.SingleColumn||this._columnCount>0)&&l.obj.setSize(S,l.obj.height,!0),this.itemRenderer(_%this._numItems,l.obj),_%this._curLineItemCount==0&&(b+=Math.ceil(l.obj.height)-l.height,_==r&&a>r&&(C=Math.ceil(l.obj.height)-l.height)),l.width=Math.ceil(l.obj.width),l.height=Math.ceil(l.obj.height)),l.updateFlag=this.itemInfoVer,l.obj.setPosition(v,y),_==r&&(n+=l.height),v+=l.width+this._columnGap,_%this._curLineItemCount==this._curLineItemCount-1&&(v=0,y+=l.height+this._lineGap),_++}for(u=0;u<f;u++)(l=this._virtualItems[a+u]).updateFlag!=this.itemInfoVer&&null!=l.obj&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null);for(f=this._children.length,u=0;u<f;u++){var I=this._virtualItems[r+u].obj;this._children[u]!=I&&this.setChildIndex(I,u)}return 0==b&&0==C||this._scrollPane.changeContentSizeOnScrolling(0,b,0,C),_>0&&this.numChildren>0&&this._container.y<=0&&this.getChildAt(0).y>-this._container.y},o.prototype.handleScroll2=function(e){var i=this._scrollPane.scrollingPosX,n=i+this._scrollPane.viewWidth,s=i==this._scrollPane.contentWidth;o.pos_param=i;var r=this.getIndexOnPos2(e);if(i=o.pos_param,r==this._firstIndex&&!e)return!1;var a=this._firstIndex;this._firstIndex=r;var h,l,c,u,d,_=r,p=a>r,f=this.numChildren,g=a+f-1,m=p?g:a,v=i,y=0,b=0,C=0,w=this.defaultItem,S=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;_<this._realNumItems&&(s||v<n);){if((null==(l=this._virtualItems[_]).obj||e)&&(null!=this.itemProvider&&(null==(w=this.itemProvider(_%this._numItems))&&(w=this._defaultItem),w=t.UIPackage.normalizeURL(w)),null!=l.obj&&l.obj.resourceURL!=w&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null)),null==l.obj){if(p){for(d=m;d>=a;d--)if(null!=(c=this._virtualItems[d]).obj&&c.updateFlag!=this.itemInfoVer&&c.obj.resourceURL==w){c.obj instanceof t.GButton&&(c.selected=c.obj.selected),l.obj=c.obj,c.obj=null,d==m&&m--;break}}else for(d=m;d<=g;d++)if(null!=(c=this._virtualItems[d]).obj&&c.updateFlag!=this.itemInfoVer&&c.obj.resourceURL==w){c.obj instanceof t.GButton&&(c.selected=c.obj.selected),l.obj=c.obj,c.obj=null,d==m&&m++;break}null!=l.obj?this.setChildIndex(l.obj,p?_-r:this.numChildren):(l.obj=this._pool.getObject(w),p?this.addChildAt(l.obj,_-r):this.addChild(l.obj)),l.obj instanceof t.GButton&&(l.obj.selected=l.selected),h=!0}else h=e;h&&(this._autoResizeItem&&(this._layout==t.ListLayoutType.SingleRow||this._lineCount>0)&&l.obj.setSize(l.obj.width,S,!0),this.itemRenderer(_%this._numItems,l.obj),_%this._curLineItemCount==0&&(b+=Math.ceil(l.obj.width)-l.width,_==r&&a>r&&(C=Math.ceil(l.obj.width)-l.width)),l.width=Math.ceil(l.obj.width),l.height=Math.ceil(l.obj.height)),l.updateFlag=this.itemInfoVer,l.obj.setPosition(v,y),_==r&&(n+=l.width),y+=l.height+this._lineGap,_%this._curLineItemCount==this._curLineItemCount-1&&(y=0,v+=l.width+this._columnGap),_++}for(u=0;u<f;u++)(l=this._virtualItems[a+u]).updateFlag!=this.itemInfoVer&&null!=l.obj&&(l.obj instanceof t.GButton&&(l.selected=l.obj.selected),this.removeChildToPool(l.obj),l.obj=null);for(f=this._children.length,u=0;u<f;u++){var I=this._virtualItems[r+u].obj;this._children[u]!=I&&this.setChildIndex(I,u)}return 0==b&&0==C||this._scrollPane.changeContentSizeOnScrolling(b,0,C,0),_>0&&this.numChildren>0&&this._container.x<=0&&this.getChildAt(0).x>-this._container.x},o.prototype.handleScroll3=function(e){var i=this._scrollPane.scrollingPosX;o.pos_param=i;var n=this.getIndexOnPos3(e);if(i=o.pos_param,n!=this._firstIndex||e){var s=this._firstIndex;this._firstIndex=n;var r,a,h,l,c,u=s,d=this._virtualItems.length,_=this._curLineItemCount*this._curLineItemCount2,p=n%this._curLineItemCount,f=this.viewWidth,g=Math.floor(n/_)*_,m=g+2*_,v=this._defaultItem,y=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount,b=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount2-1))/this._curLineItemCount2;for(this.itemInfoVer++,a=g;a<m;a++)if(!(a>=this._realNumItems)){if(c=a%this._curLineItemCount,a-g<_){if(c<p)continue}else if(c>p)continue;(h=this._virtualItems[a]).updateFlag=this.itemInfoVer}var C=null,w=0;for(a=g;a<m;a++)if(!(a>=this._realNumItems)&&(h=this._virtualItems[a]).updateFlag==this.itemInfoVer){if(null==h.obj){for(;u<d;){if(null!=(l=this._virtualItems[u]).obj&&l.updateFlag!=this.itemInfoVer){l.obj instanceof t.GButton&&(l.selected=l.obj.selected),h.obj=l.obj,l.obj=null;break}u++}-1==w&&(w=this.getChildIndex(C)+1),null==h.obj?(null!=this.itemProvider&&(null==(v=this.itemProvider(a%this._numItems))&&(v=this._defaultItem),v=t.UIPackage.normalizeURL(v)),h.obj=this._pool.getObject(v),this.addChildAt(h.obj,w)):w=this.setChildIndexBefore(h.obj,w),w++,h.obj instanceof t.GButton&&(h.obj.selected=h.selected),r=!0}else r=e,w=-1,C=h.obj;r&&(this._autoResizeItem&&(this._curLineItemCount==this._columnCount&&this._curLineItemCount2==this._lineCount?h.obj.setSize(y,b,!0):this._curLineItemCount==this._columnCount?h.obj.setSize(y,h.obj.height,!0):this._curLineItemCount2==this._lineCount&&h.obj.setSize(h.obj.width,b,!0)),this.itemRenderer(a%this._numItems,h.obj),h.width=Math.ceil(h.obj.width),h.height=Math.ceil(h.obj.height))}var S=g/_*f,I=S,T=0,x=0;for(a=g;a<m;a++)a>=this._realNumItems||((h=this._virtualItems[a]).updateFlag==this.itemInfoVer&&h.obj.setPosition(I,T),h.height>x&&(x=h.height),a%this._curLineItemCount==this._curLineItemCount-1?(I=S,T+=x+this._lineGap,x=0,a==g+_-1&&(I=S+=f,T=0)):I+=h.width+this._columnGap);for(a=u;a<d;a++)(h=this._virtualItems[a]).updateFlag!=this.itemInfoVer&&null!=h.obj&&(h.obj instanceof t.GButton&&(h.selected=h.obj.selected),this.removeChildToPool(h.obj),h.obj=null)}},o.prototype.handleArchOrder1=function(){if(this._childrenRenderOrder==t.ChildrenRenderOrder.Arch){for(var e=this._scrollPane.posY+this.viewHeight/2,i=Number.POSITIVE_INFINITY,o=0,n=0,s=this.numChildren,r=0;r<s;r++){var a=this.getChildAt(r);this.foldInvisibleItems&&!a.visible||(o=Math.abs(e-a.y-a.height/2))<i&&(i=o,n=r)}this.apexIndex=n}},o.prototype.handleArchOrder2=function(){if(this._childrenRenderOrder==t.ChildrenRenderOrder.Arch){for(var e=this._scrollPane.posX+this.viewWidth/2,i=Number.POSITIVE_INFINITY,o=0,n=0,s=this.numChildren,r=0;r<s;r++){var a=this.getChildAt(r);this.foldInvisibleItems&&!a.visible||(o=Math.abs(e-a.x-a.width/2))<i&&(i=o,n=r)}this.apexIndex=n}},o.prototype.handleAlign=function(e,i){var o=0,n=0;i<this.viewHeight&&(this._verticalAlign==t.VertAlignType.Middle?n=Math.floor((this.viewHeight-i)/2):this._verticalAlign==t.VertAlignType.Bottom&&(n=this.viewHeight-i)),e<this.viewWidth&&(this._align==t.AlignType.Center?o=Math.floor((this.viewWidth-e)/2):this._align==t.AlignType.Right&&(o=this.viewWidth-e)),o==this._alignOffset.x&&n==this._alignOffset.y||(this._alignOffset.x=o,this._alignOffset.y=n,null!=this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._pivotCorrectX+this._alignOffset.x,this._pivotCorrectY-this._alignOffset.y))},o.prototype.updateBounds=function(){if(!this._virtual){var e,i,o=0,n=0,s=0,r=0,a=0,h=0,l=0,c=0,u=0,d=this._children.length,_=this.viewWidth,p=this.viewHeight,f=0,g=0,m=0;if(this._layout==t.ListLayoutType.SingleColumn){for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=n&&(n+=this._lineGap),i.y=n,this._autoResizeItem&&i.setSize(_,i.height,!0),n+=Math.ceil(i.height),i.width>s&&(s=i.width));if((h=n)<=p&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.vtScrollBar)for(_+=this._scrollPane.vtScrollBar.width,e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(i.setSize(_,i.height,!0),i.width>s&&(s=i.width));a=Math.ceil(s)}else if(this._layout==t.ListLayoutType.SingleRow){for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=o&&(o+=this._columnGap),i.x=o,this._autoResizeItem&&i.setSize(i.width,p,!0),o+=Math.ceil(i.width),i.height>r&&(r=i.height));if((a=o)<=_&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.hzScrollBar)for(p+=this._scrollPane.hzScrollBar.height,e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(i.setSize(i.width,p,!0),i.height>r&&(r=i.height));h=Math.ceil(r)}else if(this._layout==t.ListLayoutType.FlowHorizontal)if(this._autoResizeItem&&this._columnCount>0){for(e=0;e<d;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(f+=i.sourceWidth,++l==this._columnCount||e==d-1)){for(m=(_-f-(l-1)*this._columnGap)/f,o=0,l=g;l<=e;l++)i=this.getChildAt(l),this.foldInvisibleItems&&!i.visible||(i.setPosition(o,n),l<e?(i.setSize(i.sourceWidth+Math.round(i.sourceWidth*m),i.height,!0),o+=Math.ceil(i.width)+this._columnGap):i.setSize(_-o,i.height,!0),i.height>r&&(r=i.height));n+=Math.ceil(r)+this._lineGap,r=0,l=0,g=e+1,f=0}h=n+Math.ceil(r),a=_}else{for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=o&&(o+=this._columnGap),(0!=this._columnCount&&l>=this._columnCount||0==this._columnCount&&o+i.width>_&&0!=r)&&(o=0,n+=Math.ceil(r)+this._lineGap,r=0,l=0),i.setPosition(o,n),(o+=Math.ceil(i.width))>s&&(s=o),i.height>r&&(r=i.height),l++);h=n+Math.ceil(r),a=Math.ceil(s)}else if(this._layout==t.ListLayoutType.FlowVertical)if(this._autoResizeItem&&this._lineCount>0){for(e=0;e<d;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(f+=i.sourceHeight,++l==this._lineCount||e==d-1)){for(m=(p-f-(l-1)*this._lineGap)/f,n=0,l=g;l<=e;l++)i=this.getChildAt(l),this.foldInvisibleItems&&!i.visible||(i.setPosition(o,n),l<e?(i.setSize(i.width,i.sourceHeight+Math.round(i.sourceHeight*m),!0),n+=Math.ceil(i.height)+this._lineGap):i.setSize(i.width,p-n,!0),i.width>s&&(s=i.width));o+=Math.ceil(s)+this._columnGap,s=0,l=0,g=e+1,f=0}a=o+Math.ceil(s),h=p}else{for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=n&&(n+=this._lineGap),(0!=this._lineCount&&l>=this._lineCount||0==this._lineCount&&n+i.height>p&&0!=s)&&(n=0,o+=Math.ceil(s)+this._columnGap,s=0,l=0),i.setPosition(o,n),(n+=Math.ceil(i.height))>r&&(r=n),i.width>s&&(s=i.width),l++);a=o+Math.ceil(s),h=Math.ceil(r)}else{var v;if(this._autoResizeItem&&this._lineCount>0&&(v=Math.floor((p-(this._lineCount-1)*this._lineGap)/this._lineCount)),this._autoResizeItem&&this._columnCount>0){for(e=0;e<d;e++)if(i=this.getChildAt(e),(!this.foldInvisibleItems||i.visible)&&(0==l&&(0!=this._lineCount&&u>=this._lineCount||0==this._lineCount&&n+(this._lineCount>0?v:i.height)>p)&&(c++,n=0,u=0),f+=i.sourceWidth,++l==this._columnCount||e==d-1)){for(m=(_-f-(l-1)*this._columnGap)/f,o=0,l=g;l<=e;l++)i=this.getChildAt(l),this.foldInvisibleItems&&!i.visible||(i.setPosition(c*_+o,n),l<e?(i.setSize(i.sourceWidth+Math.round(i.sourceWidth*m),this._lineCount>0?v:i.height,!0),o+=Math.ceil(i.width)+this._columnGap):i.setSize(_-o,this._lineCount>0?v:i.height,!0),i.height>r&&(r=i.height));n+=Math.ceil(r)+this._lineGap,r=0,l=0,g=e+1,f=0,u++}}else for(e=0;e<d;e++)i=this.getChildAt(e),this.foldInvisibleItems&&!i.visible||(0!=o&&(o+=this._columnGap),this._autoResizeItem&&this._lineCount>0&&i.setSize(i.width,v,!0),(0!=this._columnCount&&l>=this._columnCount||0==this._columnCount&&o+i.width>_&&0!=r)&&(o=0,n+=Math.ceil(r)+this._lineGap,r=0,l=0,u++,(0!=this._lineCount&&u>=this._lineCount||0==this._lineCount&&n+i.height>p&&0!=s)&&(c++,n=0,u=0)),i.setPosition(c*_+o,n),(o+=Math.ceil(i.width))>s&&(s=o),i.height>r&&(r=i.height),l++);h=c>0?p:n+Math.ceil(r),a=(c+1)*_}this.handleAlign(a,h),this.setBounds(0,0,a,h)}},o.prototype.setup_beforeAdd=function(i,o){e.prototype.setup_beforeAdd.call(this,i,o),i.seek(o,5),this._layout=i.readByte(),this._selectionMode=i.readByte(),this._align=i.readByte(),this._verticalAlign=i.readByte(),this._lineGap=i.readShort(),this._columnGap=i.readShort(),this._lineCount=i.readShort(),this._columnCount=i.readShort(),this._autoResizeItem=i.readBool(),this._childrenRenderOrder=i.readByte(),this._apexIndex=i.readShort(),i.readBool()&&(this._margin.top=i.readInt(),this._margin.bottom=i.readInt(),this._margin.left=i.readInt(),this._margin.right=i.readInt());var n=i.readByte();if(n==t.OverflowType.Scroll){var s=i.position;i.seek(o,7),this.setupScroll(i),i.position=s}else this.setupOverflow(n);i.readBool()&&i.skip(8),i.version>=2&&(this.scrollItemToViewOnClick=i.readBool(),this.foldInvisibleItems=i.readBool()),i.seek(o,8),this._defaultItem=i.readS(),this.readItems(i)},o.prototype.readItems=function(t){var e,i,o,n;for(e=t.readShort(),i=0;i<e;i++)if(o=t.readShort(),o+=t.position,null!=(n=t.readS())||(n=this.defaultItem)){var s=this.getFromPool(n);null!=s&&(this.addChild(s),this.setupItem(t,s)),t.position=o}else t.position=o},o.prototype.setupItem=function(e,i){var o,n,s;if(null!=(o=e.readS())&&(i.text=o),null!=(o=e.readS())&&i instanceof t.GButton&&(i.selectedTitle=o),null!=(o=e.readS())&&(i.icon=o),null!=(o=e.readS())&&i instanceof t.GButton&&(i.selectedIcon=o),null!=(o=e.readS())&&(i.name=o),i instanceof t.GComponent){for(n=e.readShort(),s=0;s<n;s++){var r=i.getController(e.readS());o=e.readS(),null!=r&&(r.selectedPageId=o)}if(e.version>=2)for(n=e.readShort(),s=0;s<n;s++){var a=e.readS(),h=e.readShort(),l=e.readS(),c=i.getChildByPath(a);c&&c.setProp(h,l)}}},o.prototype.setup_afterAdd=function(t,i){e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,6);var o=t.readShort();-1!=o&&(this._selectionController=this.parent.getControllerAt(o))},o}(t.GComponent);t.GList=e;var i=function(){return function(){this.width=0,this.height=0,this.updateFlag=0,this.selected=!1}}()}(fgui||(fgui={})),function(t){var e=function(){function e(){this._count=0,this._pool={}}return e.prototype.clear=function(){for(var t in this._pool)for(var e=this._pool[t],i=e.length,o=0;o<i;o++)e[o].dispose();this._pool={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.getObject=function(e){if(null==(e=t.UIPackage.normalizeURL(e)))return null;var i=this._pool[e];return null!=i&&i.length?(this._count--,i.shift()):t.UIPackage.createObjectFromURL(e)},e.prototype.returnObject=function(t){var e=t.resourceURL;if(e){var i=this._pool[e];null==i&&(i=new Array,this._pool[e]=i),this._count++,i.push(t)}},e}();t.GObjectPool=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._frame=0,i._contentSourceWidth=0,i._contentSourceHeight=0,i._contentWidth=0,i._contentHeight=0,i._node.name="GLoader",i._playing=!0,i._url="",i._fill=t.LoaderFillType.None,i._align=t.AlignType.Left,i._verticalAlign=t.VertAlignType.Top,i._showErrorSign=!0,i._color=cc.Color.WHITE,i._container=new cc.Node("Image"),i._container.setAnchorPoint(0,1),i._node.addChild(i._container),i._content=i._container.addComponent(t.MovieClip),i}return __extends(i,e),i.prototype.dispose=function(){null==this._contentItem&&null!=this._content.spriteFrame&&this.freeExternal(this._content.spriteFrame),null!=this._content2&&this._content2.dispose(),e.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"url",{get:function(){return this._url},set:function(t){this._url!=t&&(this._url=t,this.loadContent(),this.updateGear(7))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"icon",{get:function(){return this._url},set:function(t){this.url=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"align",{get:function(){return this._align},set:function(t){this._align!=t&&(this._align=t,this.updateLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"verticalAlign",{get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!=t&&(this._verticalAlign=t,this.updateLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fill",{get:function(){return this._fill},set:function(t){this._fill!=t&&(this._fill=t,this.updateLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shrinkOnly",{get:function(){return this._shrinkOnly},set:function(t){this._shrinkOnly!=t&&(this._shrinkOnly=t,this.updateLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoSize",{get:function(){return this._autoSize},set:function(t){this._autoSize!=t&&(this._autoSize=t,this.updateLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playing",{get:function(){return this._playing},set:function(e){this._playing!=e&&(this._playing=e,this._content instanceof t.MovieClip&&(this._content.playing=e),this.updateGear(5))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frame",{get:function(){return this._frame},set:function(e){this._frame!=e&&(this._frame=e,this._content instanceof t.MovieClip&&(this._content.frame=e),this.updateGear(5))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,this.updateGear(4),this._container.color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillMethod",{get:function(){return this._content.fillMethod},set:function(t){this._content.fillMethod=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillOrigin",{get:function(){return this._content.fillOrigin},set:function(t){this._content.fillOrigin=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillClockwise",{get:function(){return this._content.fillClockwise},set:function(t){this._content.fillClockwise=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillAmount",{get:function(){return this._content.fillAmount},set:function(t){this._content.fillAmount=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showErrorSign",{get:function(){return this._showErrorSign},set:function(t){this._showErrorSign=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"component",{get:function(){return this._content2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._content.spriteFrame},set:function(t){this.url=null,this._content.spriteFrame=t,this._content.type=cc.Sprite.Type.SIMPLE,null!=t?(this._contentSourceWidth=t.getRect().width,this._contentSourceHeight=t.getRect().height):this._contentSourceWidth=this._contentHeight=0,this.updateLayout()},enumerable:!0,configurable:!0}),i.prototype.loadContent=function(){this.clearContent(),this._url&&(t.ToolSet.startsWith(this._url,"ui://")?this.loadFromPackage(this._url):this.loadExternal())},i.prototype.loadFromPackage=function(e){if(this._contentItem=t.UIPackage.getItemByURL(e),null!=this._contentItem)if(this._contentItem=this._contentItem.getBranch(),this._contentSourceWidth=this._contentItem.width,this._contentSourceHeight=this._contentItem.height,this._contentItem=this._contentItem.getHighResolution(),this._contentItem.load(),this._autoSize&&this.setSize(this._contentSourceWidth,this._contentSourceHeight),this._contentItem.type==t.PackageItemType.Image)this._contentItem.asset?(this._content.spriteFrame=this._contentItem.asset,0==this._content.fillMethod&&(this._contentItem.scale9Grid?this._content.type=cc.Sprite.Type.SLICED:this._contentItem.scaleByTile?this._content.type=cc.Sprite.Type.TILED:this._content.type=cc.Sprite.Type.SIMPLE),this.updateLayout()):this.setErrorState();else if(this._contentItem.type==t.PackageItemType.MovieClip)this._content.interval=this._contentItem.interval,this._content.swing=this._contentItem.swing,this._content.repeatDelay=this._contentItem.repeatDelay,this._content.frames=this._contentItem.frames,this.updateLayout();else if(this._contentItem.type==t.PackageItemType.Component){var i=t.UIPackage.createObjectFromURL(e);i?i instanceof t.GComponent?(this._content2=i.asCom,this._container.addChild(this._content2.node),this.updateLayout()):(i.dispose(),this.setErrorState()):this.setErrorState()}else this.setErrorState();else this.setErrorState()},i.prototype.loadExternal=function(){t.ToolSet.startsWith(this._url,"http://")||t.ToolSet.startsWith(this._url,"https://")?cc.loader.load(this._url,this.onLoaded.bind(this)):cc.loader.loadRes(this._url,cc.Asset,this.onLoaded.bind(this))},i.prototype.onLoaded=function(t,e){this._url&&cc.isValid(this._node)&&(e=cc.loader.getRes(this._url))&&(e instanceof cc.SpriteFrame?this.onExternalLoadSuccess(e):e instanceof cc.Texture2D&&this.onExternalLoadSuccess(new cc.SpriteFrame(e)))},i.prototype.freeExternal=function(t){},i.prototype.onExternalLoadSuccess=function(t){this._content.spriteFrame=t,this._content.type=cc.Sprite.Type.SIMPLE,this._contentSourceWidth=t.getRect().width,this._contentSourceHeight=t.getRect().height,this._autoSize&&this.setSize(this._contentSourceWidth,this._contentSourceHeight),this.updateLayout()},i.prototype.onExternalLoadFailed=function(){this.setErrorState()},i.prototype.setErrorState=function(){this._showErrorSign&&(null==this._errorSign&&null!=t.UIConfig.loaderErrorSign&&(this._errorSign=i._errorSignPool.getObject(t.UIConfig.loaderErrorSign)),null!=this._errorSign&&(this._errorSign.setSize(this.width,this.height),this._container.addChild(this._errorSign.node)))},i.prototype.clearErrorState=function(){null!=this._errorSign&&(this._container.removeChild(this._errorSign.node),i._errorSignPool.returnObject(this._errorSign),this._errorSign=null)},i.prototype.updateLayout=function(){if(null!=this._content2||null!=this._content){this._contentWidth=this._contentSourceWidth,this._contentHeight=this._contentSourceHeight;var e=-this.pivotX*this._width,i=this.pivotY*this._height;if(!this._autoSize||(this._updatingLayout=!0,0==this._contentWidth&&(this._contentWidth=50),0==this._contentHeight&&(this._contentHeight=30),this.setSize(this._contentWidth,this._contentHeight),this._updatingLayout=!1,this._container.setContentSize(this._width,this._height),this._container.setPosition(e,i),null!=this._content2&&(this._content2.setPosition(e+this._width*this.pivotX,i-this._height*this.pivotY),this._content2.setScale(1,1)),this._contentWidth!=this._width||this._contentHeight!=this._height)){var o,n,s=1,r=1;this._fill!=t.LoaderFillType.None&&(s=this.width/this._contentSourceWidth,r=this.height/this._contentSourceHeight,1==s&&1==r||(this._fill==t.LoaderFillType.ScaleMatchHeight?s=r:this._fill==t.LoaderFillType.ScaleMatchWidth?r=s:this._fill==t.LoaderFillType.Scale?s>r?s=r:r=s:this._fill==t.LoaderFillType.ScaleNoBorder&&(s>r?r=s:s=r),this._shrinkOnly&&(s>1&&(s=1),r>1&&(r=1)),this._contentWidth=this._contentSourceWidth*s,this._contentHeight=this._contentSourceHeight*r)),this._container.setContentSize(this._contentWidth,this._contentHeight),null!=this._content2&&(this._content2.setPosition(e+this._width*this.pivotX,i-this._height*this.pivotY),this._content2.setScale(s,r)),o=this._align==t.AlignType.Left?0:this._align==t.AlignType.Center?Math.floor((this._width-this._contentWidth)/2):this._width-this._contentWidth,n=-(n=this._verticalAlign==t.VertAlignType.Top?0:this._verticalAlign==t.VertAlignType.Middle?Math.floor((this._height-this._contentHeight)/2):this._height-this._contentHeight),this._container.setPosition(e+o,i+n)}}else this._autoSize&&(this._updatingLayout=!0,this.setSize(50,30),this._updatingLayout=!1)},i.prototype.clearContent=function(){if(this.clearErrorState(),null==this._contentItem){var t=this._content.spriteFrame;null!=t&&this.freeExternal(t)}null!=this._content2&&(this._container.removeChild(this._content2.node),this._content2.dispose(),this._content2=null),this._content.frames=null,this._content.spriteFrame=null,this._contentItem=null},i.prototype.handleSizeChanged=function(){e.prototype.handleSizeChanged.call(this),this._updatingLayout||this.updateLayout()},i.prototype.handleAnchorChanged=function(){e.prototype.handleAnchorChanged.call(this),this._updatingLayout||this.updateLayout()},i.prototype.handleGrayedChanged=function(){this._content.grayed=this._grayed},i.prototype.hitTest=function(t){if(this._touchDisabled||!this._touchable||!this._node.activeInHierarchy)return null;if(this._content2){var e=this._content2.hitTest(t);if(e)return e}var i=this._node.convertToNodeSpaceAR(t);return i.x+=this._node.anchorX*this._width,i.y+=this._node.anchorY*this._height,i.x>=0&&i.y>=0&&i.x<this._width&&i.y<this._height?this:null},i.prototype.getProp=function(i){switch(i){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.Playing:return this.playing;case t.ObjectPropID.Frame:return this.frame;case t.ObjectPropID.TimeScale:return this._content.timeScale;default:return e.prototype.getProp.call(this,i)}},i.prototype.setProp=function(i,o){switch(i){case t.ObjectPropID.Color:this.color=o;break;case t.ObjectPropID.Playing:this.playing=o;break;case t.ObjectPropID.Frame:this.frame=o;break;case t.ObjectPropID.TimeScale:this._content.timeScale=o;break;case t.ObjectPropID.DeltaTime:this._content.advance(o);break;default:e.prototype.setProp.call(this,i,o)}},i.prototype.setup_beforeAdd=function(t,i){e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,5),this._url=t.readS(),this._align=t.readByte(),this._verticalAlign=t.readByte(),this._fill=t.readByte(),this._shrinkOnly=t.readBool(),this._autoSize=t.readBool(),this._showErrorSign=t.readBool(),this._playing=t.readBool(),this._frame=t.readInt(),t.readBool()&&(this.color=t.readColor()),this._content.fillMethod=t.readByte(),0!=this._content.fillMethod&&(this._content.fillOrigin=t.readByte(),this._content.fillClockwise=t.readBool(),this._content.fillAmount=t.readFloat()),this._url&&this.loadContent()},i._errorSignPool=new t.GObjectPool,i}(t.GObject);t.GLoader=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._node.name="GMovieClip",i._touchDisabled=!0,i._content=i._node.addComponent(t.MovieClip),i}return __extends(i,e),Object.defineProperty(i.prototype,"color",{get:function(){return cc.Color.WHITE},set:function(t){this._node.color!=t&&(this._node.color=t,this.updateGear(4))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playing",{get:function(){return this._content.playing},set:function(t){this._content.playing!=t&&(this._content.playing=t,this.updateGear(5))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frame",{get:function(){return this._content.frame},set:function(t){this._content.frame!=t&&(this._content.frame=t,this.updateGear(5))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeScale",{get:function(){return this._content.timeScale},set:function(t){this._content.timeScale=t},enumerable:!0,configurable:!0}),i.prototype.rewind=function(){this._content.rewind()},i.prototype.syncStatus=function(t){this._content.syncStatus(t._content)},i.prototype.advance=function(t){this._content.advance(t)},i.prototype.setPlaySettings=function(t,e,i,o,n,s){this._content.setPlaySettings(t,e,i,o,n,s)},i.prototype.handleGrayedChanged=function(){this._content.grayed=this._grayed},i.prototype.getProp=function(i){switch(i){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.Playing:return this.playing;case t.ObjectPropID.Frame:return this.frame;case t.ObjectPropID.TimeScale:return this.timeScale;default:return e.prototype.getProp.call(this,i)}},i.prototype.setProp=function(i,o){switch(i){case t.ObjectPropID.Color:this.color=o;break;case t.ObjectPropID.Playing:this.playing=o;break;case t.ObjectPropID.Frame:this.frame=o;break;case t.ObjectPropID.TimeScale:this.timeScale=o;break;case t.ObjectPropID.DeltaTime:this.advance(o);break;default:e.prototype.setProp.call(this,i,o)}},i.prototype.constructFromResource=function(){var t=this.packageItem.getBranch();this.sourceWidth=t.width,this.sourceHeight=t.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),(t=t.getHighResolution()).load(),this._content.interval=t.interval,this._content.swing=t.swing,this._content.repeatDelay=t.repeatDelay,this._content.frames=t.frames,this._content.smoothing=t.smoothing},i.prototype.setup_beforeAdd=function(t,i){e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,5),t.readBool()&&(this.color=t.readColor()),t.readByte(),this._content.frame=t.readInt(),this._content.playing=t.readBool()},i}(t.GObject);t.GMovieClip=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._min=0,i._max=0,i._value=0,i._barMaxWidth=0,i._barMaxHeight=0,i._barMaxWidthDelta=0,i._barMaxHeightDelta=0,i._barStartX=0,i._barStartY=0,i._node.name="GProgressBar",i._titleType=t.ProgressTitleType.Percent,i._value=50,i._max=100,i}return __extends(i,e),Object.defineProperty(i.prototype,"titleType",{get:function(){return this._titleType},set:function(t){this._titleType!=t&&(this._titleType=t,this.update(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"min",{get:function(){return this._min},set:function(t){this._min!=t&&(this._min=t,this.update(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"max",{get:function(){return this._max},set:function(t){this._max!=t&&(this._max=t,this.update(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"value",{get:function(){return this._value},set:function(e){this._value!=e&&(t.GTween.kill(this,!1,this.update),this._value=e,this.update(e))},enumerable:!0,configurable:!0}),i.prototype.tweenValue=function(e,i){var o,n=t.GTween.getTween(this,this.update);return null!=n?(o=n.value.x,n.kill()):o=this._value,this._value=e,t.GTween.to(o,this._value,i).setTarget(this,this.update).setEase(t.EaseType.Linear)},i.prototype.update=function(e){var i=t.ToolSet.clamp01((e-this._min)/(this._max-this._min));if(this._titleObject)switch(this._titleType){case t.ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*i)+"%";break;case t.ProgressTitleType.ValueAndMax:this._titleObject.text=Math.floor(e)+"/"+Math.floor(this._max);break;case t.ProgressTitleType.Value:this._titleObject.text=""+Math.floor(e);break;case t.ProgressTitleType.Max:this._titleObject.text=""+Math.floor(this._max)}var o=this.width-this._barMaxWidthDelta,n=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH instanceof t.GImage&&this._barObjectH.fillMethod!=t.FillMethod.None?this._barObjectH.fillAmount=1-i:(this._barObjectH.width=Math.round(o*i),this._barObjectH.x=this._barStartX+(o-this._barObjectH.width))),this._barObjectV&&(this._barObjectV instanceof t.GImage&&this._barObjectV.fillMethod!=t.FillMethod.None?this._barObjectV.fillAmount=1-i:(this._barObjectV.height=Math.round(n*i),this._barObjectV.y=this._barStartY+(n-this._barObjectV.height)))):(this._barObjectH&&(this._barObjectH instanceof t.GImage&&this._barObjectH.fillMethod!=t.FillMethod.None?this._barObjectH.fillAmount=i:this._barObjectH.width=Math.round(o*i)),this._barObjectV&&(this._barObjectV instanceof t.GImage&&this._barObjectV.fillMethod!=t.FillMethod.None?this._barObjectV.fillAmount=i:this._barObjectV.height=Math.round(n*i))),this._aniObject&&this._aniObject.setProp(t.ObjectPropID.Frame,Math.floor(100*i))},i.prototype.constructExtension=function(t){t.seek(0,6),this._titleType=t.readByte(),this._reverse=t.readBool(),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._aniObject=this.getChild("ani"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y)},i.prototype.handleSizeChanged=function(){e.prototype.handleSizeChanged.call(this),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update(this._value)},i.prototype.setup_afterAdd=function(t,i){e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update(this._value)):this.update(this._value)},i}(t.GComponent);t.GProgressBar=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._fontSize=0,t._leading=0,t._node.name="GTextField",t._touchDisabled=!0,t._text="",t._color=cc.Color.WHITE,t._strokeColor=cc.Color.BLACK,t._templateVars=null,t.createRenderer(),t.fontSize=12,t.leading=3,t.singleLine=!1,t._sizeDirty=!1,t._node.on(cc.Node.EventType.SIZE_CHANGED,t.onLabelSizeChanged,t),t}return __extends(i,e),i.prototype.createRenderer=function(){this._label=this._node.addComponent(cc.Label),this.autoSize=t.AutoSizeType.Both},Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,null==this._text&&(this._text=""),this.updateGear(6),this.markSizeChanged(),this.updateText()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"font",{get:function(){return this._font},set:function(e){if(this._font!=e||!e){this._font=e,this.markSizeChanged();var i=e||t.UIConfig.defaultFont;if(t.ToolSet.startsWith(i,"ui://")){var o=t.UIPackage.getItemByURL(i);i=o?o.owner.getItemAsset(o):t.UIConfig.defaultFont}this._realFont=i,this.updateFont()}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){t<0||this._fontSize!=t&&(this._fontSize=t,this.markSizeChanged(),this.updateFontSize())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,this.updateGear(4),this.updateFontColor())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"align",{get:function(){return this._label.horizontalAlign},set:function(t){this._label.horizontalAlign=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"verticalAlign",{get:function(){return this._label.verticalAlign},set:function(t){this._label.verticalAlign=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!=t&&(this._leading=t,this.markSizeChanged(),this.updateFontSize())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"letterSpacing",{get:function(){return this._label.spacingX},set:function(t){this._label.spacingX!=t&&(this.markSizeChanged(),this._label.spacingX=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"underline",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bold",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"italic",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"singleLine",{get:function(){return!this._label.enableWrapText},set:function(t){this._label.enableWrapText=!t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stroke",{get:function(){return this._outline&&this._outline.enabled?this._outline.width:0},set:function(t){0==t?this._outline&&(this._outline.enabled=!1):(this._outline?this._outline.enabled=!0:(this._outline=this._node.addComponent(cc.LabelOutline),this.updateStrokeColor()),this._outline.width=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"strokeColor",{get:function(){return this._strokeColor},set:function(t){this._strokeColor!=t&&(this._strokeColor=t,this.updateGear(4),this.updateStrokeColor())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ubbEnabled",{get:function(){return this._ubbEnabled},set:function(t){this._ubbEnabled!=t&&(this._ubbEnabled=t,this.markSizeChanged(),this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoSize",{get:function(){return this._autoSize},set:function(t){this._autoSize!=t&&(this._autoSize=t,this.markSizeChanged(),this.updateOverflow())},enumerable:!0,configurable:!0}),i.prototype.parseTemplate=function(t){for(var e,i,o,n,s=0,r="";-1!=(e=t.indexOf("{",s));)if(e>0&&92==t.charCodeAt(e-1))r+=t.substring(s,e-1),r+="{",s=e+1;else{if(r+=t.substring(s,e),s=e,-1==(e=t.indexOf("}",s)))break;e!=s+1?(-1!=(i=(o=t.substring(s+1,e)).indexOf("="))?r+=null==(n=this._templateVars[o.substring(0,i)])?o.substring(i+1):n:null!=(n=this._templateVars[o])&&(r+=n),s=e+1):(r+=t.substr(s,2),s=e+1)}return s<t.length&&(r+=t.substr(s)),r},Object.defineProperty(i.prototype,"templateVars",{get:function(){return this._templateVars},set:function(t){null==this._templateVars&&null==t||(this._templateVars=t,this.flushVars())},enumerable:!0,configurable:!0}),i.prototype.setVar=function(t,e){return this._templateVars||(this._templateVars={}),this._templateVars[t]=e,this},i.prototype.flushVars=function(){this.markSizeChanged(),this.updateText()},Object.defineProperty(i.prototype,"textWidth",{get:function(){return this.ensureSizeCorrect(),this._node.width},enumerable:!0,configurable:!0}),i.prototype.ensureSizeCorrect=function(){this._sizeDirty&&(this._label._forceUpdateRenderData?this._label._forceUpdateRenderData():this._label._updateRenderData(!0),this._sizeDirty=!1)},i.prototype.updateText=function(){var e=this._text;null!=this._templateVars&&(e=this.parseTemplate(e)),this._ubbEnabled&&(e=t.UBBParser.inst.parse(t.ToolSet.encodeHTML(e),!0)),this._label.string=e},i.prototype.assignFont=function(e,i){if(i instanceof cc.Font)e.font=i;else{var o=t.getFontByName(i);o?e.font=o:(e.fontFamily=i,e.useSystemFont=!0)}},i.prototype.assignFontColor=function(e,i){var o=e.font;o instanceof cc.BitmapFont&&!o._fntConfig.canTint&&(i=cc.Color.WHITE),this._grayed&&(i=t.ToolSet.toGrayed(i)),e.node.color=i},i.prototype.updateFont=function(){this.assignFont(this._label,this._realFont)},i.prototype.updateFontColor=function(){this.assignFontColor(this._label,this._color)},i.prototype.updateStrokeColor=function(){this._outline&&(this._grayed?this._outline.color=t.ToolSet.toGrayed(this._strokeColor):this._outline.color=this._strokeColor)},i.prototype.updateFontSize=function(){var t=this._label.font;if(t instanceof cc.BitmapFont){var e=t._fntConfig;e.resizable?this._label.fontSize=this._fontSize:this._label.fontSize=e.fontSize,this._label.lineHeight=e.fontSize+(this._leading+4)*e.fontSize/this._label.fontSize}else this._label.fontSize=this._fontSize,this._label.lineHeight=this._fontSize+this._leading},i.prototype.updateOverflow=function(){this._autoSize==t.AutoSizeType.Both?this._label.overflow=cc.Label.Overflow.NONE:this._autoSize==t.AutoSizeType.Height?(this._label.overflow=cc.Label.Overflow.RESIZE_HEIGHT,this._node.width=this._width):this._autoSize==t.AutoSizeType.Shrink?(this._label.overflow=cc.Label.Overflow.SHRINK,this._node.setContentSize(this._width,this._height)):(this._label.overflow=cc.Label.Overflow.CLAMP,this._node.setContentSize(this._width,this._height))},i.prototype.markSizeChanged=function(){this._underConstruct||this._autoSize!=t.AutoSizeType.Both&&this._autoSize!=t.AutoSizeType.Height||this._sizeDirty||(this._node.emit(t.Event.SIZE_DELAY_CHANGE,this),this._sizeDirty=!0)},i.prototype.onLabelSizeChanged=function(){this._sizeDirty=!1,this._underConstruct||this._autoSize!=t.AutoSizeType.Both&&this._autoSize!=t.AutoSizeType.Height||(this._updatingSize=!0,this.setSize(this._node.width,this._node.height),this._updatingSize=!1)},i.prototype.handleSizeChanged=function(){this._updatingSize||(this._autoSize==t.AutoSizeType.None||this._autoSize==t.AutoSizeType.Shrink?this._node.setContentSize(this._width,this._height):this._autoSize==t.AutoSizeType.Height&&(this._node.width=this._width))},i.prototype.handleGrayedChanged=function(){this.updateFontColor(),this.updateStrokeColor()},i.prototype.getProp=function(i){switch(i){case t.ObjectPropID.Color:return this.color;case t.ObjectPropID.OutlineColor:return this.strokeColor;case t.ObjectPropID.FontSize:return this.fontSize;default:return e.prototype.getProp.call(this,i)}},i.prototype.setProp=function(i,o){switch(i){case t.ObjectPropID.Color:this.color=o;break;case t.ObjectPropID.OutlineColor:this.strokeColor=o;break;case t.ObjectPropID.FontSize:this.fontSize=o;break;default:e.prototype.setProp.call(this,i,o)}},i.prototype.setup_beforeAdd=function(t,i){e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,5),this.font=t.readS(),this.fontSize=t.readShort(),this.color=t.readColor(),this.align=t.readByte(),this.verticalAlign=t.readByte(),this.leading=t.readShort(),this.letterSpacing=t.readShort(),this._ubbEnabled=t.readBool(),this.autoSize=t.readByte(),this.underline=t.readBool(),this.italic=t.readBool(),this.bold=t.readBool(),this.singleLine=t.readBool(),t.readBool()&&(this.strokeColor=t.readColor(),this.stroke=t.readFloat()),t.readBool()&&t.skip(12),t.readBool()&&(this._templateVars={})},i.prototype.setup_afterAdd=function(t,i){e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,6);var o=t.readS();null!=o&&(this.text=o)},i}(t.GObject);t.GTextField=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.getSpriteFrame=function(i){var o=t.UIPackage.getItemByURL(i);if(o){if(o.load(),o.type==t.PackageItemType.Image)return o.asset;if(o.type==t.PackageItemType.MovieClip)return o.frames[0].texture}return e.prototype.getSpriteFrame.call(this,i)},i}(cc.SpriteAtlas);t.RichTextImageAtlas=e;var i=function(i){function o(){var e=i.call(this)||this;return e._node.name="GRichTextField",e._touchDisabled=!1,e.linkUnderline=t.UIConfig.linkUnderline,e}return __extends(o,i),o.prototype.createRenderer=function(){this._richText=this._node.addComponent(cc.RichText),this._richText.handleTouchEvent=!1,this.autoSize=t.AutoSizeType.None,this._richText.imageAtlas=o.imageAtlas},Object.defineProperty(o.prototype,"align",{get:function(){return this._richText.horizontalAlign},set:function(t){this._richText.horizontalAlign=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"verticalAlign",{get:function(){return cc.Label.VerticalAlign.TOP},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"letterSpacing",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"underline",{get:function(){return this._underline},set:function(t){this._underline!=t&&(this._underline=t,this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bold",{get:function(){return this._bold},set:function(t){this._bold!=t&&(this._bold=t,this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"italic",{get:function(){return this._italics},set:function(t){this._italics!=t&&(this._italics=t,this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"singleLine",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),o.prototype.markSizeChanged=function(){},o.prototype.updateText=function(){var e=this._text;null!=this._templateVars&&(e=this.parseTemplate(e)),this._ubbEnabled&&(t.UBBParser.inst.linkUnderline=this.linkUnderline,t.UBBParser.inst.linkColor=this.linkColor,e=t.UBBParser.inst.parse(t.ToolSet.encodeHTML(e))),this._bold&&(e="<b>"+e+"</b>"),this._italics&&(e="<i>"+e+"</i>"),this._underline&&(e="<u>"+e+"</u>");var i=this._color;this._grayed&&(i=t.ToolSet.toGrayed(i)),e="<color="+i.toHEX("#rrggbb")+">"+e+"</color>",this._autoSize==t.AutoSizeType.Both?(0!=this._richText.maxWidth&&(this._richText.maxWidth=0),this._richText.string=e,0!=this.maxWidth&&this._node.width>this.maxWidth&&(this._richText.maxWidth=this.maxWidth)):this._richText.string=e},o.prototype.updateFont=function(){this.assignFont(this._richText,this._realFont)},o.prototype.updateFontColor=function(){this.assignFontColor(this._richText,this._color)},o.prototype.updateFontSize=function(){var t=this._fontSize,e=this._richText.font;e instanceof cc.BitmapFont&&(e._fntConfig.resizable||(t=e._fntConfig.fontSize)),this._richText.fontSize=t,this._richText.lineHeight=t+this._leading},o.prototype.updateOverflow=function(){this._autoSize==t.AutoSizeType.Both?this._richText.maxWidth=0:this._richText.maxWidth=this._width},o.prototype.handleSizeChanged=function(){this._updatingSize||this._autoSize!=t.AutoSizeType.Both&&(this._richText.maxWidth=this._width)},o.imageAtlas=new e,o}(t.GTextField);t.GRichTextField=i}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._node.name="GRoot",i.opaque=!1,i._volumeScale=1,i._popupStack=new Array,i._justClosedPopups=new Array,i._modalLayer=new t.GGraph,i._modalLayer.setSize(i.width,i.height),i._modalLayer.drawRect(0,cc.Color.TRANSPARENT,t.UIConfig.modalLayerColor),i._modalLayer.addRelation(i,t.RelationType.Size),i._thisOnResized=i.onWinResize.bind(i),i._inputProcessor=i.node.addComponent(t.InputProcessor),i._inputProcessor._captureCallback=i.onTouchBegin_1,cc.sys.isMobile?window.addEventListener("resize",i._thisOnResized):cc.view.on("canvas-resize",i._thisOnResized),i.onWinResize(),i}return __extends(i,e),Object.defineProperty(i,"inst",{get:function(){if(!i._inst)throw"Call GRoot.create first!";return i._inst},enumerable:!0,configurable:!0}),i.create=function(){return i._inst=new i,i._inst.node.parent=cc.director.getScene(),i._inst},i.prototype.onDestroy=function(){cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):cc.view.off("canvas-resize",this._thisOnResized),this==i._inst&&(i._inst=null)},i.prototype.getTouchPosition=function(t){return this._inputProcessor.getTouchPosition(t)},Object.defineProperty(i.prototype,"touchTarget",{get:function(){return this._inputProcessor.getTouchTarget()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputProcessor",{get:function(){return this._inputProcessor},enumerable:!0,configurable:!0}),i.prototype.showWindow=function(t){this.addChild(t),t.requestFocus(),t.x>this.width?t.x=this.width-t.width:t.x+t.width<0&&(t.x=0),t.y>this.height?t.y=this.height-t.height:t.y+t.height<0&&(t.y=0),this.adjustModalLayer()},i.prototype.hideWindow=function(t){t.hide()},i.prototype.hideWindowImmediately=function(t){t.parent==this&&this.removeChild(t),this.adjustModalLayer()},i.prototype.bringToFront=function(e){var i,o=this.numChildren;for(i=null==this._modalLayer.parent||e.modal?o-1:this.getChildIndex(this._modalLayer)-1;i>=0;i--){var n=this.getChildAt(i);if(n==e)return;if(n instanceof t.Window)break}i>=0&&this.setChildIndex(e,i)},i.prototype.showModalWait=function(e){null!=t.UIConfig.globalModalWaiting&&(null==this._modalWaitPane&&(this._modalWaitPane=t.UIPackage.createObjectFromURL(t.UIConfig.globalModalWaiting)),this._modalWaitPane.setSize(this.width,this.height),this._modalWaitPane.addRelation(this,t.RelationType.Size),this.addChild(this._modalWaitPane),this._modalWaitPane.text=e)},i.prototype.closeModalWait=function(){null!=this._modalWaitPane&&null!=this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane)},i.prototype.closeAllExceptModals=function(){for(var e=this._children.slice(),i=e.length,o=0;o<i;o++){var n=e[o];n instanceof t.Window&&!n.modal&&n.hide()}},i.prototype.closeAllWindows=function(){for(var e=this._children.slice(),i=e.length,o=0;o<i;o++){var n=e[o];n instanceof t.Window&&n.hide()}},i.prototype.getTopWindow=function(){for(var e=this.numChildren-1;e>=0;e--){var i=this.getChildAt(e);if(i instanceof t.Window)return i}return null},Object.defineProperty(i.prototype,"modalLayer",{get:function(){return this._modalLayer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasModalWindow",{get:function(){return null!=this._modalLayer.parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"modalWaiting",{get:function(){return this._modalWaitPane&&this._modalWaitPane.node.activeInHierarchy},enumerable:!0,configurable:!0}),i.prototype.getPopupPosition=function(t,e,i,o){var n=o||new cc.Vec2,s=0,r=0;if(e){n=e.localToGlobal();var a=e.localToGlobal(e.width,e.height);s=a.x-n.x,r=a.y-n.y}else n=this.getTouchPosition(),n=this.globalToLocal(n.x,n.y);return n.x+t.width>this.width&&(n.x=n.x+s-t.width),n.y+=r,(void 0==i&&n.y+t.height>this.height||0==i)&&(n.y=n.y-r-t.height-1,n.y<0&&(n.y=0,n.x+=s/2)),n},i.prototype.showPopup=function(t,e,i){if(this._popupStack.length>0){var o=this._popupStack.indexOf(t);if(-1!=o)for(var n=this._popupStack.length-1;n>=o;n--)this.removeChild(this._popupStack.pop())}if(this._popupStack.push(t),null!=e)for(var s=e;null!=s;){if(s.parent==this){t.sortingOrder<s.sortingOrder&&(t.sortingOrder=s.sortingOrder);break}s=s.parent}this.addChild(t),this.adjustModalLayer();var r=this.getPopupPosition(t,e,i);t.setPosition(r.x,r.y)},i.prototype.togglePopup=function(t,e,i){-1==this._justClosedPopups.indexOf(t)&&this.showPopup(t,e,i)},i.prototype.hidePopup=function(t){if(null!=t){var e=this._popupStack.indexOf(t);if(-1!=e)for(var i=this._popupStack.length-1;i>=e;i--)this.closePopup(this._popupStack.pop())}else{for(i=this._popupStack.length-1;i>=0;i--)this.closePopup(this._popupStack[i]);this._popupStack.length=0}},Object.defineProperty(i.prototype,"hasAnyPopup",{get:function(){return 0!=this._popupStack.length},enumerable:!0,configurable:!0}),i.prototype.closePopup=function(e){null!=e.parent&&(e instanceof t.Window?e.hide():this.removeChild(e))},i.prototype.showTooltips=function(e){if(null==this._defaultTooltipWin){var i=t.UIConfig.tooltipsWin;if(!i)return void console.error("UIConfig.tooltipsWin not defined");this._defaultTooltipWin=t.UIPackage.createObjectFromURL(i)}this._defaultTooltipWin.text=e,this.showTooltipsWin(this._defaultTooltipWin)},i.prototype.showTooltipsWin=function(t){this.hideTooltips(),this._tooltipWin=t;var e=this.getTouchPosition();e.x+=10,e.y+=20,this.globalToLocal(e.x,e.y,e),e.x+this._tooltipWin.width>this.width&&(e.x=e.x-this._tooltipWin.width-1,e.x<0&&(e.x=10)),e.y+this._tooltipWin.height>this.height&&(e.y=e.y-this._tooltipWin.height-1,e.y<0&&(e.y=10)),this._tooltipWin.setPosition(e.x,e.y),this.addChild(this._tooltipWin)},i.prototype.hideTooltips=function(){null!=this._tooltipWin&&(this._tooltipWin.parent&&this.removeChild(this._tooltipWin),this._tooltipWin=null)},Object.defineProperty(i.prototype,"volumeScale",{get:function(){return this._volumeScale},set:function(t){this._volumeScale=t},enumerable:!0,configurable:!0}),i.prototype.playOneShotSound=function(t,e){void 0===e&&(e=1),cc.audioEngine.play(t,!1,this._volumeScale*e)},i.prototype.adjustModalLayer=function(){var e=this.numChildren;null!=this._modalWaitPane&&null!=this._modalWaitPane.parent&&this.setChildIndex(this._modalWaitPane,e-1);for(var i=e-1;i>=0;i--){var o=this.getChildAt(i);if(o instanceof t.Window&&o.modal)return void(null==this._modalLayer.parent?this.addChildAt(this._modalLayer,i):this.setChildIndexBefore(this._modalLayer,i))}null!=this._modalLayer.parent&&this.removeChild(this._modalLayer)},i.prototype.onTouchBegin_1=function(t){if(null!=this._tooltipWin&&this.hideTooltips(),this._justClosedPopups.length=0,this._popupStack.length>0){for(var e=t.initiator;e!=this&&null!=e;){var i=this._popupStack.indexOf(e);if(-1!=i){for(var o=this._popupStack.length-1;o>i;o--){var n=this._popupStack.pop();this.closePopup(n),this._justClosedPopups.push(n)}return}e=e.findParent()}for(o=this._popupStack.length-1;o>=0;o--)n=this._popupStack[o],this.closePopup(n),this._justClosedPopups.push(n);this._popupStack.length=0}},i.prototype.onWinResize=function(){var t=cc.view.getCanvasSize();t.width/=cc.view.getScaleX(),t.height/=cc.view.getScaleY();var e=cc.view.getViewportRect().origin;e.x=e.x/cc.view.getScaleX(),e.y=e.y/cc.view.getScaleY(),this.setSize(t.width,t.height),this._node.setPosition(-e.x,this._height-e.y),this.updateContentScaleLevel()},i.prototype.handlePositionChanged=function(){},i.prototype.updateContentScaleLevel=function(){var t=Math.max(cc.view.getScaleX(),cc.view.getScaleY());i.contentScaleLevel=t>=3.5?3:t>=2.5?2:t>=1.5?1:0},i.contentScaleLevel=0,i}(t.GComponent);t.GRoot=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._node.name="GScrollBar",t._dragOffset=new cc.Vec2,t._scrollPerc=0,t}return __extends(i,e),i.prototype.setScrollPane=function(t,e){this._target=t,this._vertical=e},i.prototype.setDisplayPerc=function(t){this._vertical?(this._fixedGripSize||(this._grip.height=Math.floor(t*this._bar.height)),this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc):(this._fixedGripSize||(this._grip.width=Math.floor(t*this._bar.width)),this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc),this._grip.visible=0!=t&&1!=t},i.prototype.setScrollPerc=function(t){this._scrollPerc=t,this._vertical?this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc:this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc},Object.defineProperty(i.prototype,"minSize",{get:function(){return this._vertical?(null!=this._arrowButton1?this._arrowButton1.height:0)+(null!=this._arrowButton2?this._arrowButton2.height:0):(null!=this._arrowButton1?this._arrowButton1.width:0)+(null!=this._arrowButton2?this._arrowButton2.width:0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gripDragging",{get:function(){return this._gripDragging},enumerable:!0,configurable:!0}),i.prototype.constructExtension=function(e){e.seek(0,6),this._fixedGripSize=e.readBool(),this._grip=this.getChild("grip"),this._grip?(this._bar=this.getChild("bar"),this._bar?(this._arrowButton1=this.getChild("arrow1"),this._arrowButton2=this.getChild("arrow2"),this._grip.on(t.Event.TOUCH_BEGIN,this.onGripTouchDown,this),this._grip.on(t.Event.TOUCH_MOVE,this.onGripTouchMove,this),this._grip.on(t.Event.TOUCH_END,this.onGripTouchEnd,this),this._arrowButton1&&this._arrowButton1.on(t.Event.TOUCH_BEGIN,this.onClickArrow1,this),this._arrowButton2&&this._arrowButton2.on(t.Event.TOUCH_BEGIN,this.onClickArrow2,this),this.on(t.Event.TOUCH_BEGIN,this.onBarTouchBegin,this)):console.error("\u9700\u8981\u5b9a\u4e49bar")):console.error("\u9700\u8981\u5b9a\u4e49grip")},i.prototype.onGripTouchDown=function(t){t.stopPropagation(),t.captureTouch(),this._gripDragging=!0,this._target.updateScrollBarVisible(),this.globalToLocal(t.pos.x,t.pos.y,this._dragOffset),this._dragOffset.x-=this._grip.x,this._dragOffset.y-=this._grip.y},i.prototype.onGripTouchMove=function(t){if(this.onStage){var e=this.globalToLocal(t.pos.x,t.pos.y,i.sScrollbarHelperPoint);if(this._vertical){var o=e.y-this._dragOffset.y;this._target.setPercY((o-this._bar.y)/(this._bar.height-this._grip.height),!1)}else{var n=e.x-this._dragOffset.x;this._target.setPercX((n-this._bar.x)/(this._bar.width-this._grip.width),!1)}}},i.prototype.onGripTouchEnd=function(t){this.onStage&&(this._gripDragging=!1,this._target.updateScrollBarVisible())},i.prototype.onClickArrow1=function(t){t.stopPropagation(),this._vertical?this._target.scrollUp():this._target.scrollLeft()},i.prototype.onClickArrow2=function(t){t.stopPropagation(),this._vertical?this._target.scrollDown():this._target.scrollRight()},i.prototype.onBarTouchBegin=function(t){var e=this._grip.globalToLocal(t.pos.x,t.pos.y,i.sScrollbarHelperPoint);this._vertical?e.y<0?this._target.scrollUp(4):this._target.scrollDown(4):e.x<0?this._target.scrollLeft(4):this._target.scrollRight(4)},i.sScrollbarHelperPoint=new cc.Vec2,i}(t.GComponent);t.GScrollBar=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._min=0,i._max=0,i._value=0,i._barMaxWidth=0,i._barMaxHeight=0,i._barMaxWidthDelta=0,i._barMaxHeightDelta=0,i._clickPercent=0,i._barStartX=0,i._barStartY=0,i.changeOnClick=!0,i.canDrag=!0,i._node.name="GSlider",i._titleType=t.ProgressTitleType.Percent,i._value=50,i._max=100,i._clickPos=new cc.Vec2,i}return __extends(i,e),Object.defineProperty(i.prototype,"titleType",{get:function(){return this._titleType},set:function(t){this._titleType=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wholeNumbers",{get:function(){return this._wholeNumbers},set:function(t){this._wholeNumbers!=t&&(this._wholeNumbers=t,this.update())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"min",{get:function(){return this._min},set:function(t){this._min!=t&&(this._min=t,this.update())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"max",{get:function(){return this._max},set:function(t){this._max!=t&&(this._max=t,this.update())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"value",{get:function(){return this._value},set:function(t){this._value!=t&&(this._value=t,this.update())},enumerable:!0,configurable:!0}),i.prototype.update=function(){this.updateWithPercent((this._value-this._min)/(this._max-this._min))},i.prototype.updateWithPercent=function(e,i){if(e=t.ToolSet.clamp01(e),i){var o=t.ToolSet.clamp(this._min+(this._max-this._min)*e,this._min,this._max);this._wholeNumbers&&(o=Math.round(o),e=t.ToolSet.clamp01((o-this._min)/(this._max-this._min))),o!=this._value&&(this._value=o,this._node.emit(t.Event.STATUS_CHANGED,this))}if(this._titleObject)switch(this._titleType){case t.ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*e)+"%";break;case t.ProgressTitleType.ValueAndMax:this._titleObject.text=this._value+"/"+this._max;break;case t.ProgressTitleType.Value:this._titleObject.text=""+this._value;break;case t.ProgressTitleType.Max:this._titleObject.text=""+this._max}var n=this.width-this._barMaxWidthDelta,s=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH.width=Math.round(n*e),this._barObjectH.x=this._barStartX+(n-this._barObjectH.width)),this._barObjectV&&(this._barObjectV.height=Math.round(s*e),this._barObjectV.y=this._barStartY+(s-this._barObjectV.height))):(this._barObjectH&&(this._barObjectH.width=Math.round(n*e)),this._barObjectV&&(this._barObjectV.height=Math.round(s*e)))},i.prototype.constructExtension=function(e){e.seek(0,6),this._titleType=e.readByte(),this._reverse=e.readBool(),e.version>=2&&(this._wholeNumbers=e.readBool(),this.changeOnClick=e.readBool()),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._gripObject=this.getChild("grip"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y),this._gripObject&&(this._gripObject.on(t.Event.TOUCH_BEGIN,this.onGripTouchBegin,this),this._gripObject.on(t.Event.TOUCH_MOVE,this.onGripTouchMove,this)),this._node.on(t.Event.TOUCH_BEGIN,this.onBarTouchBegin,this)},i.prototype.handleSizeChanged=function(){e.prototype.handleSizeChanged.call(this),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update()},i.prototype.setup_afterAdd=function(t,i){e.prototype.setup_afterAdd.call(this,t,i),t.seek(i,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update()):this.update()},i.prototype.onGripTouchBegin=function(e){this.canDrag=!0,e.stopPropagation(),e.captureTouch(),this._clickPos=this.globalToLocal(e.pos.x,e.pos.y),this._clickPercent=t.ToolSet.clamp01((this._value-this._min)/(this._max-this._min))},i.prototype.onGripTouchMove=function(t){if(this.canDrag){var e,o=this.globalToLocal(t.pos.x,t.pos.y,i.sSilderHelperPoint),n=o.x-this._clickPos.x,s=o.y-this._clickPos.y;this._reverse&&(n=-n,s=-s),e=this._barObjectH?this._clickPercent+n/this._barMaxWidth:this._clickPercent+s/this._barMaxHeight,this.updateWithPercent(e,!0)}},i.prototype.onBarTouchBegin=function(e){if(this.changeOnClick){var o,n=this._gripObject.globalToLocal(e.pos.x,e.pos.y,i.sSilderHelperPoint),s=t.ToolSet.clamp01((this._value-this._min)/(this._max-this._min));this._barObjectH&&(o=n.x/this._barMaxWidth),this._barObjectV&&(o=n.y/this._barMaxHeight),this._reverse?s-=o:s+=o,this.updateWithPercent(s,!0)}},i.sSilderHelperPoint=new cc.Vec2,i}(t.GComponent);t.GSlider=e}(fgui||(fgui={})),function(t){var e=function(e){function o(){var t=e.call(this)||this;return t._node.name="GTextInput",t._touchDisabled=!1,t}return __extends(o,e),o.prototype.createRenderer=function(){this._editBox=this._node.addComponent(i),this._editBox.maxLength=-1,this._editBox._updateTextLabel(),this._node.on("text-changed",this.onTextChanged,this),this.on(t.Event.TOUCH_END,this.onTouchEnd1,this),this.autoSize=t.AutoSizeType.None},Object.defineProperty(o.prototype,"editable",{get:function(){return this._editBox.enabled},set:function(t){this._editBox.enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxLength",{get:function(){return this._editBox.maxLength},set:function(t){0==t&&(t=-1),this._editBox.maxLength=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"promptText",{get:function(){return this._promptText},set:function(e){this._promptText=e;var i=!this._editBox.placeholderLabel;if(this._editBox._updatePlaceholderLabel(),i&&this.assignFont(this._editBox.placeholderLabel,this._realFont),this._editBox.placeholderLabel.string=t.UBBParser.inst.parse(this._promptText,!0),t.UBBParser.inst.lastColor){var o=this._editBox.placeholderLabel.node.color;o||(o=new cc.Color),o.fromHEX(t.UBBParser.inst.lastColor),this.assignFontColor(this._editBox.placeholderLabel,o)}else this.assignFontColor(this._editBox.placeholderLabel,this._color);t.UBBParser.inst.lastSize?this._editBox.placeholderLabel.fontSize=parseInt(t.UBBParser.inst.lastSize):this._editBox.placeholderLabel.fontSize=this._fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"restrict",{get:function(){return""},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"password",{get:function(){return this._editBox.inputFlag==cc.EditBox.InputFlag.PASSWORD},set:function(t){this._editBox.inputFlag=t?cc.EditBox.InputFlag.PASSWORD:cc.EditBox.InputFlag.DEFAULT},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"align",{get:function(){return this._editBox.textLabel.horizontalAlign},set:function(t){this._editBox.textLabel.horizontalAlign=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"verticalAlign",{get:function(){return this._editBox.textLabel.verticalAlign},set:function(t){this._editBox.textLabel.verticalAlign=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"letterSpacing",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"singleLine",{get:function(){return this._editBox.inputMode!=cc.EditBox.InputMode.ANY},set:function(t){this._editBox.inputMode=t?cc.EditBox.InputMode.SINGLE_LINE:cc.EditBox.InputMode.ANY},enumerable:!0,configurable:!0}),o.prototype.requestFocus=function(){this._editBox.focus()},o.prototype.markSizeChanged=function(){},o.prototype.updateText=function(){var e=this._text;null!=this._templateVars&&(e=this.parseTemplate(e)),this._ubbEnabled&&(e=t.UBBParser.inst.parse(t.ToolSet.encodeHTML(e),!0)),this._editBox.string=e},o.prototype.updateFont=function(){this.assignFont(this._editBox.textLabel,this._realFont),this._editBox.placeholderLabel&&this.assignFont(this._editBox.placeholderLabel,this._realFont)},o.prototype.updateFontColor=function(){this.assignFontColor(this._editBox.textLabel,this._color)},o.prototype.updateFontSize=function(){this._editBox.textLabel.fontSize=this._fontSize,this._editBox.textLabel.lineHeight=this._fontSize+this._leading,this._editBox.placeholderLabel&&(this._editBox.placeholderLabel.fontSize=this._editBox.textLabel.fontSize)},o.prototype.updateOverflow=function(){},o.prototype.onTextChanged=function(){this._text=this._editBox.string},o.prototype.onTouchEnd1=function(t){this._editBox.openKeyboard(t.touch)},o.prototype.setup_beforeAdd=function(t,i){e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,4);var o=t.readS();null!=o&&(this.promptText=o),null!=(o=t.readS())&&(this.restrict=o);var n=t.readInt();0!=n&&(this.maxLength=n),n=t.readInt(),t.readBool()&&(this.password=!0)},o}(t.GTextField);t.GTextInput=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._registerEvent=function(){},e.prototype._syncSize=function(){var t=this.node.getContentSize();this._impl.setSize(t.width,t.height),this.textLabel&&this.textLabel.node.setContentSize(t.width,t.height),this.placeholderLabel&&this.placeholderLabel.node.setContentSize(t.width,t.height)},e.prototype.openKeyboard=function(t){var e=this._impl;e&&e.beginEditing()},e}(cc.EditBox)}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._indent=15,i._rootNode=new t.GTreeNode(!0),i._rootNode._setTree(i),i._rootNode.expanded=!0,i}return __extends(i,e),Object.defineProperty(i.prototype,"rootNode",{get:function(){return this._rootNode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"indent",{get:function(){return this._indent},set:function(t){this._indent=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clickToExpand",{get:function(){return this._clickToExpand},set:function(t){this._clickToExpand=t},enumerable:!0,configurable:!0}),i.prototype.getSelectedNode=function(){return-1!=this.selectedIndex?this.getChildAt(this.selectedIndex)._treeNode:null},i.prototype.getSelectedNodes=function(t){t||(t=new Array),i.helperIntList.length=0,e.prototype.getSelection.call(this,i.helperIntList);for(var o=i.helperIntList.length,n=new Array,s=0;s<o;s++){var r=this.getChildAt(i.helperIntList[s])._treeNode;n.push(r)}return n},i.prototype.selectNode=function(t,e){for(var i=t.parent;null!=i&&i!=this._rootNode;)i.expanded=!0,i=i.parent;t._cell&&this.addSelection(this.getChildIndex(t._cell),e)},i.prototype.unselectNode=function(t){t._cell&&this.removeSelection(this.getChildIndex(t._cell))},i.prototype.expandAll=function(t){t||(t=this._rootNode),t.expanded=!0;for(var e=t.numChildren,i=0;i<e;i++){var o=t.getChildAt(i);o.isFolder&&this.expandAll(o)}},i.prototype.collapseAll=function(t){t||(t=this._rootNode),t!=this._rootNode&&(t.expanded=!1);for(var e=t.numChildren,i=0;i<e;i++){var o=t.getChildAt(i);o.isFolder&&this.collapseAll(o)}},i.prototype.createCell=function(e){var i=this.getFromPool(e._resURL);if(!i)throw new Error("cannot create tree node object.");i._treeNode=e,e._cell=i;var o,n=i.getChild("indent");null!=n&&(n.width=(e.level-1)*this._indent),(o=i.getController("expanded"))&&(o.on(t.Event.STATUS_CHANGED,this.__expandedStateChanged,this),o.selectedIndex=e.expanded?1:0),(o=i.getController("leaf"))&&(o.selectedIndex=e.isFolder?0:1),e.isFolder&&e._cell.on(t.Event.TOUCH_BEGIN,this.__cellMouseDown,this),this.treeNodeRender&&this.treeNodeRender(e,i)},i.prototype._afterInserted=function(t){t._cell||this.createCell(t);var e=this.getInsertIndexForNode(t);this.addChildAt(t._cell,e),this.treeNodeRender&&this.treeNodeRender(t,t._cell),t.isFolder&&t.expanded&&this.checkChildren(t,e)},i.prototype.getInsertIndexForNode=function(t){var e=t.getPrevSibling();null==e&&(e=t.parent);for(var i=this.getChildIndex(e._cell)+1,o=t.level,n=this.numChildren,s=i;s<n;s++){if(this.getChildAt(s)._treeNode.level<=o)break;i++}return i},i.prototype._afterRemoved=function(t){this.removeNode(t)},i.prototype._afterExpanded=function(t){if(t!=this._rootNode){if(null!=this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!0),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=1),null!=t._cell.parent&&this.checkChildren(t,this.getChildIndex(t._cell))}}else this.checkChildren(this._rootNode,0)},i.prototype._afterCollapsed=function(t){if(t!=this._rootNode){if(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!1),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=0),null!=t._cell.parent&&this.hideFolderNode(t)}}else this.checkChildren(this._rootNode,0)},i.prototype._afterMoved=function(t){var e,i=this.getChildIndex(t._cell);e=t.isFolder?this.getFolderEndIndex(i,t.level):i+1;var o,n,s=this.getInsertIndexForNode(t),r=e-i;if(s<i)for(o=0;o<r;o++)n=this.getChildAt(i+o),this.setChildIndex(n,s+o);else for(o=0;o<r;o++)n=this.getChildAt(i),this.setChildIndex(n,s)},i.prototype.getFolderEndIndex=function(t,e){for(var i=this.numChildren,o=t+1;o<i;o++){if(this.getChildAt(o)._treeNode.level<=e)return o}return i},i.prototype.checkChildren=function(t,e){for(var i=t.numChildren,o=0;o<i;o++){e++;var n=t.getChildAt(o);null==n._cell&&this.createCell(n),n._cell.parent||this.addChildAt(n._cell,e),n.isFolder&&n.expanded&&(e=this.checkChildren(n,e))}return e},i.prototype.hideFolderNode=function(t){for(var e=t.numChildren,i=0;i<e;i++){var o=t.getChildAt(i);o._cell&&this.removeChild(o._cell),o.isFolder&&o.expanded&&this.hideFolderNode(o)}},i.prototype.removeNode=function(t){if(null!=t._cell&&(null!=t._cell.parent&&this.removeChild(t._cell),this.returnToPool(t._cell),t._cell._treeNode=null,t._cell=null),t.isFolder)for(var e=t.numChildren,i=0;i<e;i++){var o=t.getChildAt(i);this.removeNode(o)}},i.prototype.__cellMouseDown=function(e){var i=t.GObject.cast(e.currentTarget)._treeNode;this._expandedStatusInEvt=i.expanded},i.prototype.__expandedStateChanged=function(t){t.parent._treeNode.expanded=1==t.selectedIndex},i.prototype.dispatchItemEvent=function(t,i){if(0!=this._clickToExpand){var o=t._treeNode;o&&this._expandedStatusInEvt==o.expanded&&(2==this._clickToExpand||(o.expanded=!o.expanded))}e.prototype.dispatchItemEvent.call(this,t,i)},i.prototype.setup_beforeAdd=function(t,i){e.prototype.setup_beforeAdd.call(this,t,i),t.seek(i,9),this._indent=t.readInt(),this._clickToExpand=t.readByte()},i.prototype.readItems=function(e){var i,o,n,s,r,a,h,l=0;for(i=e.readShort(),o=0;o<i;o++)if(n=e.readShort(),n+=e.position,null!=(s=e.readS())||(s=this.defaultItem)){r=e.readBool(),h=e.readByte();var c=new t.GTreeNode(r,s);if(c.expanded=!0,0==o)this._rootNode.addChild(c);else if(h>l)a.addChild(c);else if(h<l){for(var u=h;u<=l;u++)a=a.parent;a.addChild(c)}else a.parent.addChild(c);a=c,l=h,this.setupItem(e,c.cell),e.position=n}else e.position=n},i.helperIntList=new Array,i}(t.GList);t.GTree=e}(fgui||(fgui={})),function(t){var e=function(){function t(t,e){this._expanded=!1,this._level=0,this._resURL=e,t&&(this._children=new Array)}return Object.defineProperty(t.prototype,"expanded",{get:function(){return this._expanded},set:function(t){null!=this._children&&this._expanded!=t&&(this._expanded=t,null!=this._tree&&(this._expanded?this._tree._afterExpanded(this):this._tree._afterCollapsed(this)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFolder",{get:function(){return null!=this._children},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return null!=this._cell?this._cell.text:null},set:function(t){null!=this._cell&&(this._cell.text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return null!=this._cell?this._cell.icon:null},set:function(t){null!=this._cell&&(this._cell.icon=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},enumerable:!0,configurable:!0}),t.prototype._setLevel=function(t){this._level=t},t.prototype.addChild=function(t){return this.addChildAt(t,this._children.length),t},t.prototype.addChildAt=function(t,e){if(!t)throw new Error("child is null");var i=this._children.length;if(e>=0&&e<=i){if(t._parent==this)this.setChildIndex(t,e);else t._parent&&t._parent.removeChild(t),e==this._children.length?this._children.push(t):this._children.splice(e,0,t),t._parent=this,t._level=this._level+1,t._setTree(this._tree),(null!=this._tree&&this==this._tree.rootNode||null!=this._cell&&null!=this._cell.parent&&this._expanded)&&this._tree._afterInserted(t);return t}throw new RangeError("Invalid child index")},t.prototype.removeChild=function(t){var e=this._children.indexOf(t);return-1!=e&&this.removeChildAt(e),t},t.prototype.removeChildAt=function(t){if(t>=0&&t<this.numChildren){var e=this._children[t];return this._children.splice(t,1),e._parent=null,null!=this._tree&&(e._setTree(null),this._tree._afterRemoved(e)),e}throw"Invalid child index"},t.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(var i=t;i<=e;++i)this.removeChildAt(t)},t.prototype.getChildAt=function(t){if(t>=0&&t<this.numChildren)return this._children[t];throw"Invalid child index"},t.prototype.getChildIndex=function(t){return this._children.indexOf(t)},t.prototype.getPrevSibling=function(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<=0?null:this._parent._children[t-1]},t.prototype.getNextSibling=function(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<0||t>=this._parent._children.length-1?null:this._parent._children[t+1]},t.prototype.setChildIndex=function(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";var o=this._children.length;e<0?e=0:e>o&&(e=o),i!=e&&(this._children.splice(i,1),this._children.splice(e,0,t),(null!=this._tree&&this==this._tree.rootNode||null!=this._cell&&null!=this._cell.parent&&this._expanded)&&this._tree._afterMoved(t))},t.prototype.swapChildren=function(t,e){var i=this._children.indexOf(t),o=this._children.indexOf(e);if(-1==i||-1==o)throw"Not a child of this container";this.swapChildrenAt(i,o)},t.prototype.swapChildrenAt=function(t,e){var i=this._children[t],o=this._children[e];this.setChildIndex(i,e),this.setChildIndex(o,t)},Object.defineProperty(t.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),t.prototype.expandToRoot=function(){for(var t=this;t;)t.expanded=!0,t=t.parent},Object.defineProperty(t.prototype,"tree",{get:function(){return this._tree},enumerable:!0,configurable:!0}),t.prototype._setTree=function(t){if(this._tree=t,null!=this._tree&&this._tree.treeNodeWillExpand&&this._expanded&&this._tree.treeNodeWillExpand(this,!0),null!=this._children)for(var e=this._children.length,i=0;i<e;i++){var o=this._children[i];o._level=this._level+1,o._setTree(t)}},t}();t.GTreeNode=e}(fgui||(fgui={})),function(t){var e=function(){function t(){this.left=0,this.right=0,this.top=0,this.bottom=0}return t.prototype.copy=function(t){this.top=t.top,this.bottom=t.bottom,this.left=t.left,this.right=t.right},t.prototype.isNone=function(){return 0==this.left&&0==this.right&&0==this.top&&0==this.bottom},t}();t.Margin=e}(fgui||(fgui={})),function(t){var e=function(){function e(){this.width=0,this.height=0,this.tileGridIndice=0,this.interval=0,this.repeatDelay=0}return e.prototype.load=function(){return this.owner.getItemAsset(this)},e.prototype.getBranch=function(){if(this.branches&&-1!=this.owner._branchIndex){var t=this.branches[this.owner._branchIndex];if(t)return this.owner.getItemById(t)}return this},e.prototype.getHighResolution=function(){if(this.highResolution&&t.GRoot.contentScaleLevel>0){var e=this.highResolution[t.GRoot.contentScaleLevel-1];if(e)return this.owner.getItemById(e)}return this},e.prototype.toString=function(){return this.name},e}();t.PackageItem=e}(fgui||(fgui={})),function(t){var e=function(){function e(e){if(void 0===e&&(e=null),!e&&!(e=t.UIConfig.popupMenu))throw"UIConfig.popupMenu not defined";this._contentPane=t.UIPackage.createObjectFromURL(e).asCom,this._contentPane.on(t.Event.DISPLAY,this.onDisplay,this),this._list=this._contentPane.getChild("list"),this._list.removeChildrenToPool(),this._list.addRelation(this._contentPane,t.RelationType.Width),this._list.removeRelation(this._contentPane,t.RelationType.Height),this._contentPane.addRelation(this._list,t.RelationType.Height),this._list.on(t.Event.CLICK_ITEM,this.onClickItem,this)}return e.prototype.dispose=function(){this._contentPane.dispose()},e.prototype.addItem=function(t,e){var i=this._list.addItemFromPool().asButton;i.title=t,i.data=e,i.grayed=!1;var o=i.getController("checked");return null!=o&&(o.selectedIndex=0),i},e.prototype.addItemAt=function(t,e,i){var o=this._list.getFromPool().asButton;this._list.addChildAt(o,e),o.title=t,o.data=i,o.grayed=!1;var n=o.getController("checked");return null!=n&&(n.selectedIndex=0),o},e.prototype.addSeperator=function(){if(null==t.UIConfig.popupMenu_seperator)throw"UIConfig.popupMenu_seperator not defined";this.list.addItemFromPool(t.UIConfig.popupMenu_seperator)},e.prototype.getItemName=function(t){return this._list.getChildAt(t).name},e.prototype.setItemText=function(t,e){this._list.getChild(t).asButton.title=e},e.prototype.setItemVisible=function(t,e){var i=this._list.getChild(t).asButton;i.visible!=e&&(i.visible=e,this._list.setBoundsChangedFlag())},e.prototype.setItemGrayed=function(t,e){this._list.getChild(t).asButton.grayed=e},e.prototype.setItemCheckable=function(t,e){var i=this._list.getChild(t).asButton.getController("checked");null!=i&&(e?0==i.selectedIndex&&(i.selectedIndex=1):i.selectedIndex=0)},e.prototype.setItemChecked=function(t,e){var i=this._list.getChild(t).asButton.getController("checked");null!=i&&(i.selectedIndex=e?2:1)},e.prototype.isItemChecked=function(t){var e=this._list.getChild(t).asButton.getController("checked");return null!=e&&2==e.selectedIndex},e.prototype.removeItem=function(t){var e=this._list.getChild(t);if(null!=e){var i=this._list.getChildIndex(e);return this._list.removeChildToPoolAt(i),!0}return!1},e.prototype.clearItems=function(){this._list.removeChildrenToPool()},Object.defineProperty(e.prototype,"itemCount",{get:function(){return this._list.numChildren},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentPane",{get:function(){return this._contentPane},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.show=function(e,i){void 0===e&&(e=null),(null!=e?e.root:t.GRoot.inst).showPopup(this.contentPane,e instanceof t.GRoot?null:e,i)},e.prototype.onClickItem=function(t,e){var i=this;this._list._partner.callLater(function(o){i.onClickItem2(t,e)},.1)},e.prototype.onClickItem2=function(t,e){var i=t.asButton;if(null!=i)if(i.grayed)this._list.selectedIndex=-1;else{var o=i.getController("checked");null!=o&&0!=o.selectedIndex&&(1==o.selectedIndex?o.selectedIndex=2:o.selectedIndex=1),this._contentPane.parent.hidePopup(this.contentPane),i.data instanceof Function&&i.data(i,e)}},e.prototype.onDisplay=function(){this._list.selectedIndex=-1,this._list.resizeToFit(1e5,10)},e}();t.PopupMenu=e}(fgui||(fgui={})),function(t){var e=function(){function e(t){this._owner=t,this._defs=new Array}return Object.defineProperty(e.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target!=t&&(this._target&&this.releaseRefTarget(this._target),this._target=t,this._target&&this.addRefTarget(this._target))},enumerable:!0,configurable:!0}),e.prototype.add=function(e,i){if(e==t.RelationType.Size)return this.add(t.RelationType.Width,i),void this.add(t.RelationType.Height,i);for(var o=this._defs.length,n=0;n<o;n++){if(this._defs[n].type==e)return}this.internalAdd(e,i)},e.prototype.internalAdd=function(e,o){if(e==t.RelationType.Size)return this.internalAdd(t.RelationType.Width,o),void this.internalAdd(t.RelationType.Height,o);var n=new i;n.percent=o,n.type=e,n.axis=e<=t.RelationType.Right_Right||e==t.RelationType.Width||e>=t.RelationType.LeftExt_Left&&e<=t.RelationType.RightExt_Right?0:1,this._defs.push(n),(o||e==t.RelationType.Left_Center||e==t.RelationType.Center_Center||e==t.RelationType.Right_Center||e==t.RelationType.Top_Middle||e==t.RelationType.Middle_Middle||e==t.RelationType.Bottom_Middle)&&(this._owner.pixelSnapping=!0)},e.prototype.remove=function(e){if(e==t.RelationType.Size)return this.remove(t.RelationType.Width),void this.remove(t.RelationType.Height);for(var i=this._defs.length,o=0;o<i;o++)if(this._defs[o].type==e){this._defs.splice(o,1);break}},e.prototype.copyFrom=function(t){this.target=t.target,this._defs.length=0;for(var e=t._defs.length,o=0;o<e;o++){var n=t._defs[o],s=new i;s.copyFrom(n),this._defs.push(s)}},e.prototype.dispose=function(){null!=this._target&&(this.releaseRefTarget(this._target),this._target=null)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0==this._defs.length},enumerable:!0,configurable:!0}),e.prototype.applyOnSelfResized=function(e,i,o){for(var n=this._owner.x,s=this._owner.y,r=this._defs.length,a=0;a<r;a++){switch(this._defs[a].type){case t.RelationType.Center_Center:this._owner.x-=(.5-(o?this._owner.pivotX:0))*e;break;case t.RelationType.Right_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Right:this._owner.x-=(1-(o?this._owner.pivotX:0))*e;break;case t.RelationType.Middle_Middle:this._owner.y-=(.5-(o?this._owner.pivotY:0))*i;break;case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Bottom:this._owner.y-=(1-(o?this._owner.pivotY:0))*i}}if((n!=this._owner.x||s!=this._owner.y)&&(n=this._owner.x-n,s=this._owner.y-s,this._owner.updateGearFromRelations(1,n,s),null!=this._owner.parent)){var h=this._owner.parent._transitions.length;if(h>0)for(a=0;a<h;++a)this._owner.parent._transitions[a].updateFromRelations(this._owner.id,n,s)}},e.prototype.applyOnXYChanged=function(e,i,o){var n;switch(e.type){case t.RelationType.Left_Left:case t.RelationType.Left_Center:case t.RelationType.Left_Right:case t.RelationType.Center_Center:case t.RelationType.Right_Left:case t.RelationType.Right_Center:case t.RelationType.Right_Right:this._owner.x+=i;break;case t.RelationType.Top_Top:case t.RelationType.Top_Middle:case t.RelationType.Top_Bottom:case t.RelationType.Middle_Middle:case t.RelationType.Bottom_Top:case t.RelationType.Bottom_Middle:case t.RelationType.Bottom_Bottom:this._owner.y+=o;break;case t.RelationType.Width:case t.RelationType.Height:break;case t.RelationType.LeftExt_Left:case t.RelationType.LeftExt_Right:this._owner!=this._target.parent?(n=this._owner.xMin,this._owner.width=this._owner._rawWidth-i,this._owner.xMin=n+i):this._owner.width=this._owner._rawWidth-i;break;case t.RelationType.RightExt_Left:case t.RelationType.RightExt_Right:this._owner!=this._target.parent?(n=this._owner.xMin,this._owner.width=this._owner._rawWidth+i,this._owner.xMin=n):this._owner.width=this._owner._rawWidth+i;break;case t.RelationType.TopExt_Top:case t.RelationType.TopExt_Bottom:this._owner!=this._target.parent?(n=this._owner.yMin,this._owner.height=this._owner._rawHeight-o,this._owner.yMin=n+o):this._owner.height=this._owner._rawHeight-o;break;case t.RelationType.BottomExt_Top:case t.RelationType.BottomExt_Bottom:this._owner!=this._target.parent?(n=this._owner.yMin,this._owner.height=this._owner._rawHeight+o,this._owner.yMin=n):this._owner.height=this._owner._rawHeight+o}},e.prototype.applyOnSizeChanged=function(e){var i,o,n=0,s=0,r=0;switch(0==e.axis?(this._target!=this._owner.parent&&(n=this._target.x,this._target.pivotAsAnchor&&(s=this._target.pivotX)),e.percent?0!=this._targetWidth&&(r=this._target._width/this._targetWidth):r=this._target._width-this._targetWidth):(this._target!=this._owner.parent&&(n=this._target.y,this._target.pivotAsAnchor&&(s=this._target.pivotY)),e.percent?0!=this._targetHeight&&(r=this._target._height/this._targetHeight):r=this._target._height-this._targetHeight),e.type){case t.RelationType.Left_Left:e.percent?this._owner.xMin=n+(this._owner.xMin-n)*r:0!=s&&(this._owner.x+=r*-s);break;case t.RelationType.Left_Center:e.percent?this._owner.xMin=n+(this._owner.xMin-n)*r:this._owner.x+=r*(.5-s);break;case t.RelationType.Left_Right:e.percent?this._owner.xMin=n+(this._owner.xMin-n)*r:this._owner.x+=r*(1-s);break;case t.RelationType.Center_Center:e.percent?this._owner.xMin=n+(this._owner.xMin+.5*this._owner._rawWidth-n)*r-.5*this._owner._rawWidth:this._owner.x+=r*(.5-s);break;case t.RelationType.Right_Left:e.percent?this._owner.xMin=n+(this._owner.xMin+this._owner._rawWidth-n)*r-this._owner._rawWidth:0!=s&&(this._owner.x+=r*-s);break;case t.RelationType.Right_Center:e.percent?this._owner.xMin=n+(this._owner.xMin+this._owner._rawWidth-n)*r-this._owner._rawWidth:this._owner.x+=r*(.5-s);break;case t.RelationType.Right_Right:e.percent?this._owner.xMin=n+(this._owner.xMin+this._owner._rawWidth-n)*r-this._owner._rawWidth:this._owner.x+=r*(1-s);break;case t.RelationType.Top_Top:e.percent?this._owner.yMin=n+(this._owner.yMin-n)*r:0!=s&&(this._owner.y+=r*-s);break;case t.RelationType.Top_Middle:e.percent?this._owner.yMin=n+(this._owner.yMin-n)*r:this._owner.y+=r*(.5-s);break;case t.RelationType.Top_Bottom:e.percent?this._owner.yMin=n+(this._owner.yMin-n)*r:this._owner.y+=r*(1-s);break;case t.RelationType.Middle_Middle:e.percent?this._owner.yMin=n+(this._owner.yMin+.5*this._owner._rawHeight-n)*r-.5*this._owner._rawHeight:this._owner.y+=r*(.5-s);break;case t.RelationType.Bottom_Top:e.percent?this._owner.yMin=n+(this._owner.yMin+this._owner._rawHeight-n)*r-this._owner._rawHeight:0!=s&&(this._owner.y+=r*-s);break;case t.RelationType.Bottom_Middle:e.percent?this._owner.yMin=n+(this._owner.yMin+this._owner._rawHeight-n)*r-this._owner._rawHeight:this._owner.y+=r*(.5-s);break;case t.RelationType.Bottom_Bottom:e.percent?this._owner.yMin=n+(this._owner.yMin+this._owner._rawHeight-n)*r-this._owner._rawHeight:this._owner.y+=r*(1-s);break;case t.RelationType.Width:i=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceWidth-this._target.initWidth:this._owner._rawWidth-this._targetWidth,e.percent&&(i*=r),this._target==this._owner.parent?this._owner.pivotAsAnchor?(o=this._owner.xMin,this._owner.setSize(this._target._width+i,this._owner._rawHeight,!0),this._owner.xMin=o):this._owner.setSize(this._target._width+i,this._owner._rawHeight,!0):this._owner.width=this._target._width+i;break;case t.RelationType.Height:i=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceHeight-this._target.initHeight:this._owner._rawHeight-this._targetHeight,e.percent&&(i*=r),this._target==this._owner.parent?this._owner.pivotAsAnchor?(o=this._owner.yMin,this._owner.setSize(this._owner._rawWidth,this._target._height+i,!0),this._owner.yMin=o):this._owner.setSize(this._owner._rawWidth,this._target._height+i,!0):this._owner.height=this._target._height+i;break;case t.RelationType.LeftExt_Left:o=this._owner.xMin,i=e.percent?n+(o-n)*r-o:r*-s,this._owner.width=this._owner._rawWidth-i,this._owner.xMin=o+i;break;case t.RelationType.LeftExt_Right:o=this._owner.xMin,i=e.percent?n+(o-n)*r-o:r*(1-s),this._owner.width=this._owner._rawWidth-i,this._owner.xMin=o+i;break;case t.RelationType.RightExt_Left:o=this._owner.xMin,i=e.percent?n+(o+this._owner._rawWidth-n)*r-(o+this._owner._rawWidth):r*-s,this._owner.width=this._owner._rawWidth+i,this._owner.xMin=o;break;case t.RelationType.RightExt_Right:o=this._owner.xMin,e.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=n+this._target._width-this._target._width*s+(this._owner.sourceWidth-n-this._target.initWidth+this._target.initWidth*s)*r:this._owner.width=n+(this._owner._rawWidth-n)*r:(i=n+(o+this._owner._rawWidth-n)*r-(o+this._owner._rawWidth),this._owner.width=this._owner._rawWidth+i,this._owner.xMin=o):this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=this._owner.sourceWidth+(this._target._width-this._target.initWidth)*(1-s):this._owner.width=this._owner._rawWidth+r*(1-s):(i=r*(1-s),this._owner.width=this._owner._rawWidth+i,this._owner.xMin=o);break;case t.RelationType.TopExt_Top:o=this._owner.yMin,i=e.percent?n+(o-n)*r-o:r*-s,this._owner.height=this._owner._rawHeight-i,this._owner.yMin=o+i;break;case t.RelationType.TopExt_Bottom:o=this._owner.yMin,i=e.percent?n+(o-n)*r-o:r*(1-s),this._owner.height=this._owner._rawHeight-i,this._owner.yMin=o+i;break;case t.RelationType.BottomExt_Top:o=this._owner.yMin,i=e.percent?n+(o+this._owner._rawHeight-n)*r-(o+this._owner._rawHeight):r*-s,this._owner.height=this._owner._rawHeight+i,this._owner.yMin=o;break;case t.RelationType.BottomExt_Bottom:o=this._owner.yMin,e.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=n+this._target._height-this._target._height*s+(this._owner.sourceHeight-n-this._target.initHeight+this._target.initHeight*s)*r:this._owner.height=n+(this._owner._rawHeight-n)*r:(i=n+(o+this._owner._rawHeight-n)*r-(o+this._owner._rawHeight),this._owner.height=this._owner._rawHeight+i,this._owner.yMin=o):this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=this._owner.sourceHeight+(this._target._height-this._target.initHeight)*(1-s):this._owner.height=this._owner._rawHeight+r*(1-s):(i=r*(1-s),this._owner.height=this._owner._rawHeight+i,this._owner.yMin=o)}},e.prototype.addRefTarget=function(e){e!=this._owner.parent&&e.on(t.Event.XY_CHANGED,this.__targetXYChanged,this),e.on(t.Event.SIZE_CHANGED,this.__targetSizeChanged,this),e.on(t.Event.SIZE_DELAY_CHANGE,this.__targetSizeWillChange,this),this._targetX=this._target.x,this._targetY=this._target.y,this._targetWidth=this._target._width,this._targetHeight=this._target._height},e.prototype.releaseRefTarget=function(e){e.node&&(e.off(t.Event.XY_CHANGED,this.__targetXYChanged,this),e.off(t.Event.SIZE_CHANGED,this.__targetSizeChanged,this),e.off(t.Event.SIZE_DELAY_CHANGE,this.__targetSizeWillChange,this))},e.prototype.__targetXYChanged=function(t){if(null!=this._owner.relations.handling||null!=this._owner.group&&this._owner.group._updating)return this._targetX=this._target.x,void(this._targetY=this._target.y);this._owner.relations.handling=this._target;for(var e=this._owner.x,i=this._owner.y,o=this._target.x-this._targetX,n=this._target.y-this._targetY,s=this._defs.length,r=0;r<s;r++){var a=this._defs[r];this.applyOnXYChanged(a,o,n)}if(this._targetX=this._target.x,this._targetY=this._target.y,(e!=this._owner.x||i!=this._owner.y)&&(e=this._owner.x-e,i=this._owner.y-i,this._owner.updateGearFromRelations(1,e,i),null!=this._owner.parent)){var h=this._owner.parent._transitions.length;if(h>0)for(r=0;r<h;++r)this._owner.parent._transitions[r].updateFromRelations(this._owner.id,e,i)}this._owner.relations.handling=null},e.prototype.__targetSizeChanged=function(t){if(null==this._owner.relations.handling){this._owner.relations.handling=this._target;for(var e=this._owner.x,i=this._owner.y,o=this._owner._rawWidth,n=this._owner._rawHeight,s=this._defs.length,r=0;r<s;r++){var a=this._defs[r];this.applyOnSizeChanged(a)}if(this._targetWidth=this._target._width,this._targetHeight=this._target._height,(e!=this._owner.x||i!=this._owner.y)&&(e=this._owner.x-e,i=this._owner.y-i,this._owner.updateGearFromRelations(1,e,i),null!=this._owner.parent)){var h=this._owner.parent._transitions.length;if(h>0)for(r=0;r<h;++r)this._owner.parent._transitions[r].updateFromRelations(this._owner.id,e,i)}o==this._owner._rawWidth&&n==this._owner._rawHeight||(o=this._owner._rawWidth-o,n=this._owner._rawHeight-n,this._owner.updateGearFromRelations(2,o,n)),this._owner.relations.handling=null}},e.prototype.__targetSizeWillChange=function(t){this._owner.relations.sizeDirty=!0},e}();t.RelationItem=e;var i=function(){function t(){}return t.prototype.copyFrom=function(t){this.percent=t.percent,this.type=t.type,this.axis=t.axis},t}();t.RelationDef=i}(fgui||(fgui={})),function(t){var e=function(){function e(t){this._owner=t,this._items=new Array}return e.prototype.add=function(e,i,o){for(var n=this._items.length,s=0;s<n;s++){var r=this._items[s];if(r.target==e)return void r.add(i,o)}var a=new t.RelationItem(this._owner);a.target=e,a.add(i,o),this._items.push(a)},e.prototype.remove=function(t,e){void 0===e&&(e=0);for(var i=this._items.length,o=0;o<i;){var n=this._items[o];n.target==t?(n.remove(e),n.isEmpty?(n.dispose(),this._items.splice(o,1),i--):o++):o++}},e.prototype.contains=function(t){for(var e=this._items.length,i=0;i<e;i++){if(this._items[i].target==t)return!0}return!1},e.prototype.clearFor=function(t){for(var e=this._items.length,i=0;i<e;){var o=this._items[i];o.target==t?(o.dispose(),this._items.splice(i,1),e--):i++}},e.prototype.clearAll=function(){for(var t=this._items.length,e=0;e<t;e++){this._items[e].dispose()}this._items.length=0},e.prototype.copyFrom=function(e){this.clearAll();for(var i=e._items,o=i.length,n=0;n<o;n++){var s=i[n],r=new t.RelationItem(this._owner);r.copyFrom(s),this._items.push(r)}},e.prototype.dispose=function(){this.clearAll()},e.prototype.onOwnerSizeChanged=function(t,e,i){if(0!=this._items.length)for(var o=this._items.length,n=0;n<o;n++){this._items[n].applyOnSelfResized(t,e,i)}},e.prototype.ensureRelationsSizeCorrect=function(){if(0!=this._items.length){this.sizeDirty=!1;for(var t=this._items.length,e=0;e<t;e++){this._items[e].target.ensureSizeCorrect()}}},Object.defineProperty(e.prototype,"empty",{get:function(){return 0==this._items.length},enumerable:!0,configurable:!0}),e.prototype.setup=function(e,i){for(var o,n=e.readByte(),s=0;s<n;s++){var r=e.readShort();o=-1==r?this._owner.parent:i?this._owner.getChildAt(r):this._owner.parent.getChildAt(r);var a=new t.RelationItem(this._owner);a.target=o,this._items.push(a);for(var h=e.readByte(),l=0;l<h;l++){var c=e.readByte(),u=e.readBool();a.internalAdd(c,u)}}},e}();t.Relations=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._aniFlag=0,t}return __extends(i,e),i.prototype.setup=function(e){this._owner=this.node.$gobj,this._maskContainer=new cc.Node("ScrollPane"),this._maskContainer.setAnchorPoint(0,1),this._maskContainer.parent=this._owner.node,this._container=this._owner._container,this._container.parent=this._maskContainer,this._scrollBarMargin=new t.Margin,this._mouseWheelEnabled=!0,this._xPos=0,this._yPos=0,this._aniFlag=0,this._tweening=0,this._footerLockedSize=0,this._headerLockedSize=0,this._viewSize=new cc.Vec2,this._contentSize=new cc.Vec2,this._pageSize=new cc.Vec2(1,1),this._overlapSize=new cc.Vec2,this._tweenTime=new cc.Vec2,this._tweenStart=new cc.Vec2,this._tweenDuration=new cc.Vec2,this._tweenChange=new cc.Vec2,this._velocity=new cc.Vec2,this._containerPos=new cc.Vec2,this._beginTouchPos=new cc.Vec2,this._lastTouchPos=new cc.Vec2,this._lastTouchGlobalPos=new cc.Vec2,this._scrollStep=t.UIConfig.defaultScrollStep,this._mouseWheelStep=2*this._scrollStep,this._decelerationRate=t.UIConfig.defaultScrollDecelerationRate,this._owner.on(t.Event.TOUCH_BEGIN,this.onTouchBegin,this),this._owner.on(t.Event.TOUCH_MOVE,this.onTouchMove,this),this._owner.on(t.Event.TOUCH_END,this.onTouchEnd,this),this._owner.on(t.Event.MOUSE_WHEEL,this.onMouseWheel,this),this._scrollType=e.readByte();var i=e.readByte(),o=e.readInt();e.readBool()&&(this._scrollBarMargin.top=e.readInt(),this._scrollBarMargin.bottom=e.readInt(),this._scrollBarMargin.left=e.readInt(),this._scrollBarMargin.right=e.readInt());var n=e.readS(),s=e.readS(),r=e.readS(),a=e.readS();if(this._displayOnLeft=0!=(1&o),this._snapToItem=0!=(2&o),this._displayInDemand=0!=(4&o),this._pageMode=0!=(8&o),this._touchEffect=!!(16&o)||!(32&o)&&t.UIConfig.defaultScrollTouchEffect,this._bouncebackEffect=!!(64&o)||!(128&o)&&t.UIConfig.defaultScrollBounceEffect,this._inertiaDisabled=0!=(256&o),0==(512&o)&&this._maskContainer.addComponent(cc.Mask),this._floating=0!=(1024&o),i==t.ScrollBarDisplayType.Default&&(i=t.UIConfig.defaultScrollBarDisplay),i!=t.ScrollBarDisplayType.Hidden){var h;if(this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Vertical)if(h=n||t.UIConfig.verticalScrollBar){if(this._vtScrollBar=t.UIPackage.createObjectFromURL(h),!this._vtScrollBar)throw"cannot create scrollbar from "+h;this._vtScrollBar.setScrollPane(this,!0),this._vtScrollBar.node.parent=this._owner.node}if(this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Horizontal)if(h=s||t.UIConfig.horizontalScrollBar){if(this._hzScrollBar=t.UIPackage.createObjectFromURL(h),!this._hzScrollBar)throw"cannot create scrollbar from "+h;this._hzScrollBar.setScrollPane(this,!1),this._hzScrollBar.node.parent=this._owner.node}this._scrollBarDisplayAuto=i==t.ScrollBarDisplayType.Auto,this._scrollBarDisplayAuto&&(this._vtScrollBar&&(this._vtScrollBar.node.active=!1),this._hzScrollBar&&(this._hzScrollBar.node.active=!1),this._owner.on(t.Event.ROLL_OVER,this.onRollOver,this),this._owner.on(t.Event.ROLL_OUT,this.onRollOut,this))}if(r){if(this._header=t.UIPackage.createObjectFromURL(r),null==this._header)throw"cannot create scrollPane header from "+r;this._maskContainer.insertChild(this._header.node,0)}if(a){if(this._footer=t.UIPackage.createObjectFromURL(a),null==this._footer)throw"cannot create scrollPane footer from "+a;this._maskContainer.insertChild(this._footer.node,0)}this._refreshBarAxis=this._scrollType==t.ScrollType.Both||this._scrollType==t.ScrollType.Vertical?"y":"x",this.setSize(this._owner.width,this._owner.height)},i.prototype.onDestroy=function(){this._pageController=null,null!=this._hzScrollBar&&this._hzScrollBar.dispose(),null!=this._vtScrollBar&&this._vtScrollBar.dispose(),null!=this._header&&this._header.dispose(),null!=this._footer&&this._footer.dispose()},i.prototype.hitTest=function(t){var e;if(this._vtScrollBar&&(e=this._vtScrollBar.hitTest(t)))return e;if(this._hzScrollBar&&(e=this._hzScrollBar.hitTest(t)))return e;if(this._header&&this._header.node.activeInHierarchy&&(e=this._header.hitTest(t)))return e;if(this._footer&&this._footer.node.activeInHierarchy&&(e=this._footer.hitTest(t)))return e;var i=this._maskContainer.convertToNodeSpaceAR(t);return i.x+=this._maskContainer.anchorX*this._viewSize.x,i.y+=this._maskContainer.anchorY*this._viewSize.y,i.x>=0&&i.y>=0&&i.x<this._viewSize.x&&i.y<this._viewSize.y?this._owner:null},Object.defineProperty(i.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hzScrollBar",{get:function(){return this._hzScrollBar},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vtScrollBar",{get:function(){return this._vtScrollBar},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"footer",{get:function(){return this._footer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bouncebackEffect",{get:function(){return this._bouncebackEffect},set:function(t){this._bouncebackEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"touchEffect",{get:function(){return this._touchEffect},set:function(t){this._touchEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scrollStep",{get:function(){return this._scrollStep},set:function(e){this._scrollStep=e,0==this._scrollStep&&(this._scrollStep=t.UIConfig.defaultScrollStep),this._mouseWheelStep=2*this._scrollStep},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"decelerationRate",{get:function(){return this._decelerationRate},set:function(t){this._decelerationRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"snapToItem",{get:function(){return this._snapToItem},set:function(t){this._snapToItem=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseWheelEnabled",{get:function(){return this._mouseWheelEnabled},set:function(t){this._mouseWheelEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDragged",{get:function(){return this._dragged},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"percX",{get:function(){return 0==this._overlapSize.x?0:this._xPos/this._overlapSize.x},set:function(t){this.setPercX(t,!1)},enumerable:!0,configurable:!0}),i.prototype.setPercX=function(e,i){this._owner.ensureBoundsCorrect(),this.setPosX(this._overlapSize.x*t.ToolSet.clamp01(e),i)},Object.defineProperty(i.prototype,"percY",{get:function(){return 0==this._overlapSize.y?0:this._yPos/this._overlapSize.y},set:function(t){this.setPercY(t,!1)},enumerable:!0,configurable:!0}),i.prototype.setPercY=function(e,i){this._owner.ensureBoundsCorrect(),this.setPosY(this._overlapSize.y*t.ToolSet.clamp01(e),i)},Object.defineProperty(i.prototype,"posX",{get:function(){return this._xPos},set:function(t){this.setPosX(t,!1)},enumerable:!0,configurable:!0}),i.prototype.setPosX=function(e,i){this._owner.ensureBoundsCorrect(),1==this._loop&&(e=this.loopCheckingNewPos(e,"x")),(e=t.ToolSet.clamp(e,0,this._overlapSize.x))!=this._xPos&&(this._xPos=e,this.posChanged(i))},Object.defineProperty(i.prototype,"posY",{get:function(){return this._yPos},set:function(t){this.setPosY(t,!1)},enumerable:!0,configurable:!0}),i.prototype.setPosY=function(e,i){this._owner.ensureBoundsCorrect(),1==this._loop&&(e=this.loopCheckingNewPos(e,"y")),(e=t.ToolSet.clamp(e,0,this._overlapSize.y))!=this._yPos&&(this._yPos=e,this.posChanged(i))},Object.defineProperty(i.prototype,"contentWidth",{get:function(){return this._contentSize.x},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contentHeight",{get:function(){return this._contentSize.y},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewWidth",{get:function(){return this._viewSize.x},set:function(t){t=t+this._owner.margin.left+this._owner.margin.right,null==this._vtScrollBar||this._floating||(t+=this._vtScrollBar.width),this._owner.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewHeight",{get:function(){return this._viewSize.y},set:function(t){t=t+this._owner.margin.top+this._owner.margin.bottom,null==this._hzScrollBar||this._floating||(t+=this._hzScrollBar.height),this._owner.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPageX",{get:function(){if(!this._pageMode)return 0;var t=Math.floor(this._xPos/this._pageSize.x);return this._xPos-t*this._pageSize.x>.5*this._pageSize.x&&t++,t},set:function(t){this.setCurrentPageX(t,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPageY",{get:function(){if(!this._pageMode)return 0;var t=Math.floor(this._yPos/this._pageSize.y);return this._yPos-t*this._pageSize.y>.5*this._pageSize.y&&t++,t},set:function(t){this.setCurrentPageY(t,!1)},enumerable:!0,configurable:!0}),i.prototype.setCurrentPageX=function(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.x>0&&this.setPosX(t*this._pageSize.x,e))},i.prototype.setCurrentPageY=function(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.y>0&&this.setPosY(t*this._pageSize.y,e))},Object.defineProperty(i.prototype,"isBottomMost",{get:function(){return this._yPos==this._overlapSize.y||0==this._overlapSize.y},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isRightMost",{get:function(){return this._xPos==this._overlapSize.x||0==this._overlapSize.x},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pageController",{get:function(){return this._pageController},set:function(t){this._pageController=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scrollingPosX",{get:function(){return t.ToolSet.clamp(-this._container.x,0,this._overlapSize.x)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scrollingPosY",{get:function(){return t.ToolSet.clamp(- -this._container.y,0,this._overlapSize.y)},enumerable:!0,configurable:!0}),i.prototype.scrollTop=function(t){this.setPercY(0,t)},i.prototype.scrollBottom=function(t){this.setPercY(1,t)},i.prototype.scrollUp=function(t,e){void 0==t&&(t=1),this._pageMode?this.setPosY(this._yPos-this._pageSize.y*t,e):this.setPosY(this._yPos-this._scrollStep*t,e)},i.prototype.scrollDown=function(t,e){void 0==t&&(t=1),this._pageMode?this.setPosY(this._yPos+this._pageSize.y*t,e):this.setPosY(this._yPos+this._scrollStep*t,e)},i.prototype.scrollLeft=function(t,e){void 0==t&&(t=1),this._pageMode?this.setPosX(this._xPos-this._pageSize.x*t,e):this.setPosX(this._xPos-this._scrollStep*t,e)},i.prototype.scrollRight=function(t,e){void 0==t&&(t=1),this._pageMode?this.setPosX(this._xPos+this._pageSize.x*t,e):this.setPosX(this._xPos+this._scrollStep*t,e)},i.prototype.scrollToView=function(e,o,n){var s;if(this._owner.ensureBoundsCorrect(),this._needRefresh&&this.refresh(),e instanceof t.GObject?e.parent!=this._owner?(e.parent.localToGlobalRect(e.x,e.y,e.width,e.height,i.sHelperRect),s=this._owner.globalToLocalRect(i.sHelperRect.x,i.sHelperRect.y,i.sHelperRect.width,i.sHelperRect.height,i.sHelperRect)):((s=i.sHelperRect).x=e.x,s.y=e.y,s.width=e.width,s.height=e.height):s=e,this._overlapSize.y>0){var r=this._yPos+this._viewSize.y;n||s.y<=this._yPos||s.height>=this._viewSize.y?this._pageMode?this.setPosY(Math.floor(s.y/this._pageSize.y)*this._pageSize.y,o):this.setPosY(s.y,o):s.y+s.height>r&&(this._pageMode?this.setPosY(Math.floor(s.y/this._pageSize.y)*this._pageSize.y,o):s.height<=this._viewSize.y/2?this.setPosY(s.y+2*s.height-this._viewSize.y,o):this.setPosY(s.y+s.height-this._viewSize.y,o))}if(this._overlapSize.x>0){var a=this._xPos+this._viewSize.x;n||s.x<=this._xPos||s.width>=this._viewSize.x?this._pageMode?this.setPosX(Math.floor(s.x/this._pageSize.x)*this._pageSize.x,o):this.setPosX(s.x,o):s.x+s.width>a&&(this._pageMode?this.setPosX(Math.floor(s.x/this._pageSize.x)*this._pageSize.x,o):s.width<=this._viewSize.x/2?this.setPosX(s.x+2*s.width-this._viewSize.x,o):this.setPosX(s.x+s.width-this._viewSize.x,o))}!o&&this._needRefresh&&this.refresh()},i.prototype.isChildInView=function(t){if(this._overlapSize.y>0){var e=t.y+-this._container.y;if(e<-t.height||e>this._viewSize.y)return!1}return!(this._overlapSize.x>0&&((e=t.x+this._container.x)<-t.width||e>this._viewSize.x))},i.prototype.cancelDragging=function(){i.draggingPane==this&&(i.draggingPane=null),i._gestureFlag=0,this._dragged=!1},i.prototype.lockHeader=function(t){if(this._headerLockedSize!=t){var e=this._container.x,o=-this._container.y,n="x"==this._refreshBarAxis?e:o;this._headerLockedSize=t,!this._refreshEventDispatching&&n>=0&&(this._tweenStart.x=e,this._tweenStart.y=o,this._tweenChange.set(cc.Vec2.ZERO),this._tweenChange[this._refreshBarAxis]=this._headerLockedSize-this._tweenStart[this._refreshBarAxis],this._tweenDuration.x=this._tweenDuration.y=i.TWEEN_TIME_DEFAULT,this.startTween(2))}},i.prototype.lockFooter=function(t){if(this._footerLockedSize!=t){var e=this._container.x,o=-this._container.y,n="x"==this._refreshBarAxis?e:o;if(this._footerLockedSize=t,!this._refreshEventDispatching&&n<=-this._overlapSize[this._refreshBarAxis]){this._tweenStart.x=e,this._tweenStart.y=o,this._tweenChange.set(cc.Vec2.ZERO);var s=this._overlapSize[this._refreshBarAxis];0==s?s=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):s+=this._footerLockedSize,this._tweenChange[this._refreshBarAxis]=-s-this._tweenStart[this._refreshBarAxis],this._tweenDuration.x=this._tweenDuration.y=i.TWEEN_TIME_DEFAULT,this.startTween(2)}}},i.prototype.onOwnerSizeChanged=function(){this.setSize(this._owner.width,this._owner.height),this.posChanged(!1)},i.prototype.handleControllerChanged=function(e){this._pageController==e&&(this._scrollType==t.ScrollType.Horizontal?this.setCurrentPageX(e.selectedIndex,!0):this.setCurrentPageY(e.selectedIndex,!0))},i.prototype.updatePageController=function(){var e;if(null!=this._pageController&&!this._pageController.changing&&(e=this._scrollType==t.ScrollType.Horizontal?this.currentPageX:this.currentPageY)<this._pageController.pageCount){var i=this._pageController;this._pageController=null,i.selectedIndex=e,this._pageController=i}},i.prototype.adjustMaskContainer=function(){var t=0;this._displayOnLeft&&null!=this._vtScrollBar&&!this._floating&&(t=Math.floor(this._owner.margin.left+this._vtScrollBar.width)),this._maskContainer.setAnchorPoint(this._owner._alignOffset.x/this._viewSize.x,1-this._owner._alignOffset.y/this._viewSize.y),this._owner._customMask?this._maskContainer.setPosition(t+this._owner._alignOffset.x,-this._owner._alignOffset.y):this._maskContainer.setPosition(this._owner._pivotCorrectX+t+this._owner._alignOffset.x,this._owner._pivotCorrectY-this._owner._alignOffset.y)},i.prototype.setSize=function(t,e){this._hzScrollBar&&(this._hzScrollBar.y=e-this._hzScrollBar.height,this._vtScrollBar?(this._hzScrollBar.width=t-this._vtScrollBar.width-this._scrollBarMargin.left-this._scrollBarMargin.right,this._displayOnLeft?this._hzScrollBar.x=this._scrollBarMargin.left+this._vtScrollBar.width:this._hzScrollBar.x=this._scrollBarMargin.left):(this._hzScrollBar.width=t-this._scrollBarMargin.left-this._scrollBarMargin.right,this._hzScrollBar.x=this._scrollBarMargin.left)),this._vtScrollBar&&(this._displayOnLeft||(this._vtScrollBar.x=t-this._vtScrollBar.width),this._hzScrollBar?this._vtScrollBar.height=e-this._hzScrollBar.height-this._scrollBarMargin.top-this._scrollBarMargin.bottom:this._vtScrollBar.height=e-this._scrollBarMargin.top-this._scrollBarMargin.bottom,this._vtScrollBar.y=this._scrollBarMargin.top),this._viewSize.x=t,this._viewSize.y=e,this._hzScrollBar&&!this._floating&&(this._viewSize.y-=this._hzScrollBar.height),this._vtScrollBar&&!this._floating&&(this._viewSize.x-=this._vtScrollBar.width),this._viewSize.x-=this._owner.margin.left+this._owner.margin.right,this._viewSize.y-=this._owner.margin.top+this._owner.margin.bottom,this._viewSize.x=Math.max(1,this._viewSize.x),this._viewSize.y=Math.max(1,this._viewSize.y),this._pageSize.x=this._viewSize.x,this._pageSize.y=this._viewSize.y,this.adjustMaskContainer(),this.handleSizeChanged()},i.prototype.setContentSize=function(t,e){this._contentSize.x==t&&this._contentSize.y==e||(this._contentSize.x=t,this._contentSize.y=e,this.handleSizeChanged())},i.prototype.changeContentSizeOnScrolling=function(t,e,i,o){var n=this._xPos==this._overlapSize.x,s=this._yPos==this._overlapSize.y;this._contentSize.x+=t,this._contentSize.y+=e,this.handleSizeChanged(),1==this._tweening?(0!=t&&n&&this._tweenChange.x<0&&(this._xPos=this._overlapSize.x,this._tweenChange.x=-this._xPos-this._tweenStart.x),0!=e&&s&&this._tweenChange.y<0&&(this._yPos=this._overlapSize.y,this._tweenChange.y=-this._yPos-this._tweenStart.y)):2==this._tweening?(0!=i&&(this._container.x-=i,this._tweenStart.x-=i,this._xPos=-this._container.x),0!=o&&(this._container.y+=o,this._tweenStart.y-=o,this._yPos=- -this._container.y)):this._dragged?(0!=i&&(this._container.x-=i,this._containerPos.x-=i,this._xPos=-this._container.x),0!=o&&(this._container.y+=o,this._containerPos.y-=o,this._yPos=- -this._container.y)):(0!=t&&n&&(this._xPos=this._overlapSize.x,this._container.x=-this._xPos),0!=e&&s&&(this._yPos=this._overlapSize.y,this._container.y=this._yPos)),this._pageMode&&this.updatePageController()},i.prototype.handleSizeChanged=function(){this._displayInDemand&&(this._vScrollNone=this._contentSize.y<=this._viewSize.y,this._hScrollNone=this._contentSize.x<=this._viewSize.x),this._vtScrollBar&&(0==this._contentSize.y?this._vtScrollBar.setDisplayPerc(0):this._vtScrollBar.setDisplayPerc(Math.min(1,this._viewSize.y/this._contentSize.y))),this._hzScrollBar&&(0==this._contentSize.x?this._hzScrollBar.setDisplayPerc(0):this._hzScrollBar.setDisplayPerc(Math.min(1,this._viewSize.x/this._contentSize.x))),this.updateScrollBarVisible();var e=this._viewSize.x,i=this._viewSize.y;this._vScrollNone&&this._vtScrollBar&&(e+=this._vtScrollBar.width),this._hScrollNone&&this._hzScrollBar&&(i+=this._hzScrollBar.height),this._maskContainer.setContentSize(e,i),this._vtScrollBar&&this._vtScrollBar.handlePositionChanged(),this._hzScrollBar&&this._hzScrollBar.handlePositionChanged(),this._header&&this._header.handlePositionChanged(),this._footer&&this._footer.handlePositionChanged(),this._scrollType==t.ScrollType.Horizontal||this._scrollType==t.ScrollType.Both?this._overlapSize.x=Math.ceil(Math.max(0,this._contentSize.x-this._viewSize.x)):this._overlapSize.x=0,this._scrollType==t.ScrollType.Vertical||this._scrollType==t.ScrollType.Both?this._overlapSize.y=Math.ceil(Math.max(0,this._contentSize.y-this._viewSize.y)):this._overlapSize.y=0,this._xPos=t.ToolSet.clamp(this._xPos,0,this._overlapSize.x),this._yPos=t.ToolSet.clamp(this._yPos,0,this._overlapSize.y);var o=this._overlapSize[this._refreshBarAxis];0==o?o=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):o+=this._footerLockedSize,"x"==this._refreshBarAxis?this._container.setPosition(t.ToolSet.clamp(this._container.x,-o,this._headerLockedSize),-t.ToolSet.clamp(-this._container.y,-this._overlapSize.y,0)):this._container.setPosition(t.ToolSet.clamp(this._container.x,-this._overlapSize.x,0),-t.ToolSet.clamp(-this._container.y,-o,this._headerLockedSize)),null!=this._header&&("x"==this._refreshBarAxis?this._header.height=this._viewSize.y:this._header.width=this._viewSize.x),null!=this._footer&&("y"==this._refreshBarAxis?this._footer.height=this._viewSize.y:this._footer.width=this._viewSize.x),this.updateScrollBarPos(),this._pageMode&&this.updatePageController()},i.prototype.posChanged=function(t){0==this._aniFlag?this._aniFlag=t?1:-1:1!=this._aniFlag||t||(this._aniFlag=-1),this._needRefresh=!0,cc.director.getScheduler().isScheduled(this.refresh,this)||this.scheduleOnce(this.refresh)},i.prototype.refresh=function(e){this._needRefresh=!1,this.unschedule(this.refresh),(this._pageMode||this._snapToItem)&&(i.sEndPos.x=-this._xPos,i.sEndPos.y=-this._yPos,this.alignPosition(i.sEndPos,!1),this._xPos=-i.sEndPos.x,this._yPos=-i.sEndPos.y),this.refresh2(),this._owner.node.emit(t.Event.SCROLL,this._owner),this._needRefresh&&(this._needRefresh=!1,this.unschedule(this.refresh),this.refresh2()),this.updateScrollBarPos(),this._aniFlag=0},i.prototype.refresh2=function(){var t,e;1!=this._aniFlag||this._dragged?(0!=this._tweening&&this.killTween(),this._container.setPosition(Math.floor(-this._xPos),-Math.floor(-this._yPos)),this.loopCheckingCurrent()):(this._overlapSize.x>0?t=-Math.floor(this._xPos):(0!=this._container.x&&(this._container.x=0),t=0),this._overlapSize.y>0?e=-Math.floor(this._yPos):(0!=this._container.y&&(this._container.y=0),e=0),t!=this._container.x||e!=-this._container.y?(this._tweenDuration.x=this._tweenDuration.y=i.TWEEN_TIME_GO,this._tweenStart.x=this._container.x,this._tweenStart.y=-this._container.y,this._tweenChange.x=t-this._tweenStart.x,this._tweenChange.y=e-this._tweenStart.y,this.startTween(1)):0!=this._tweening&&this.killTween());this._pageMode&&this.updatePageController()},i.prototype.onTouchBegin=function(e){if(this._touchEffect){e.captureTouch(),0!=this._tweening?(this.killTween(),t.GRoot.inst.inputProcessor.cancelClick(e.touchId),this._dragged=!0):this._dragged=!1;var o=this._owner.globalToLocal(e.pos.x,e.pos.y,i.sHelperPoint);this._containerPos.x=this._container.x,this._containerPos.y=-this._container.y,this._beginTouchPos.set(o),this._lastTouchPos.set(o),this._lastTouchGlobalPos.set(e.pos),this._isHoldAreaDone=!1,this._velocity.set(cc.Vec2.ZERO),this._velocityScale=1,this._lastMoveTime=t.ToolSet.getTime()}},i.prototype.onTouchMove=function(e){if(cc.isValid(this._owner.node)&&this._touchEffect&&!(null!=t.GObject.draggingObject&&t.GObject.draggingObject.onStage||null!=i.draggingPane&&i.draggingPane!=this&&i.draggingPane._owner.onStage)){var o,n,s,r=this._owner.globalToLocal(e.pos.x,e.pos.y,i.sHelperPoint),a=t.UIConfig.touchScrollSensitivity;if(this._scrollType==t.ScrollType.Vertical){if(!this._isHoldAreaDone){if(i._gestureFlag|=1,(o=Math.abs(this._beginTouchPos.y-r.y))<a)return;if(0!=(2&i._gestureFlag)&&o<Math.abs(this._beginTouchPos.x-r.x))return}n=!0}else if(this._scrollType==t.ScrollType.Horizontal){if(!this._isHoldAreaDone){if(i._gestureFlag|=2,(o=Math.abs(this._beginTouchPos.x-r.x))<a)return;if(0!=(1&i._gestureFlag)&&o<Math.abs(this._beginTouchPos.y-r.y))return}s=!0}else{if(i._gestureFlag=3,!this._isHoldAreaDone&&(o=Math.abs(this._beginTouchPos.y-r.y))<a&&(o=Math.abs(this._beginTouchPos.x-r.x))<a)return;n=s=!0}var h=Math.floor(this._containerPos.x+r.x-this._beginTouchPos.x),l=Math.floor(this._containerPos.y+r.y-this._beginTouchPos.y);n&&(l>0?this._bouncebackEffect?null!=this._header&&0!=this._header.maxHeight?this._container.y=-Math.floor(Math.min(.5*l,this._header.maxHeight)):this._container.y=-Math.floor(Math.min(.5*l,this._viewSize.y*i.PULL_RATIO)):this._container.y=0:l<-this._overlapSize.y?this._bouncebackEffect?null!=this._footer&&this._footer.maxHeight>0?this._container.y=-Math.floor(Math.max(.5*(l+this._overlapSize.y),-this._footer.maxHeight)-this._overlapSize.y):this._container.y=-Math.floor(Math.max(.5*(l+this._overlapSize.y),-this._viewSize.y*i.PULL_RATIO)-this._overlapSize.y):this._container.y=this._overlapSize.y:this._container.y=-l),s&&(h>0?this._bouncebackEffect?null!=this._header&&0!=this._header.maxWidth?this._container.x=Math.floor(Math.min(.5*h,this._header.maxWidth)):this._container.x=Math.floor(Math.min(.5*h,this._viewSize.x*i.PULL_RATIO)):this._container.x=0:h<0-this._overlapSize.x?this._bouncebackEffect?null!=this._footer&&this._footer.maxWidth>0?this._container.x=Math.floor(Math.max(.5*(h+this._overlapSize.x),-this._footer.maxWidth)-this._overlapSize.x):this._container.x=Math.floor(Math.max(.5*(h+this._overlapSize.x),-this._viewSize.x*i.PULL_RATIO)-this._overlapSize.x):this._container.x=-this._overlapSize.x:this._container.x=h);var c=t.ToolSet.getTime(),u=Math.max(c-this._lastMoveTime,1/60),d=r.x-this._lastTouchPos.x,_=r.y-this._lastTouchPos.y;if(s||(d=0),n||(_=0),0!=u){var p=60*u-1;if(p>1){var f=Math.pow(.833,p);this._velocity.x=this._velocity.x*f,this._velocity.y=this._velocity.y*f}this._velocity.x=t.ToolSet.lerp(this._velocity.x,60*d/60/u,10*u),this._velocity.y=t.ToolSet.lerp(this._velocity.y,60*_/60/u,10*u)}var g=this._lastTouchGlobalPos.x-e.pos.x,m=this._lastTouchGlobalPos.y-e.pos.y;0!=d?this._velocityScale=Math.abs(g/d):0!=_&&(this._velocityScale=Math.abs(m/_)),this._lastTouchPos.set(r),this._lastTouchGlobalPos.x=e.pos.x,this._lastTouchGlobalPos.y=e.pos.y,this._lastMoveTime=c,this._overlapSize.x>0&&(this._xPos=t.ToolSet.clamp(-this._container.x,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=t.ToolSet.clamp(- -this._container.y,0,this._overlapSize.y)),0!=this._loop&&(h=this._container.x,l=-this._container.y,this.loopCheckingCurrent()&&(this._containerPos.x+=this._container.x-h,this._containerPos.y+=-this._container.y-l)),i.draggingPane=this,this._isHoldAreaDone=!0,this._dragged=!0,this.updateScrollBarPos(),this.updateScrollBarVisible(),this._pageMode&&this.updatePageController(),this._owner.node.emit(t.Event.SCROLL),this._owner}},i.prototype.onTouchEnd=function(e){if(i.draggingPane==this&&(i.draggingPane=null),i._gestureFlag=0,this._dragged&&this._touchEffect&&this._owner.node.activeInHierarchy){this._dragged=!1,this._tweenStart.x=this._container.x,this._tweenStart.y=-this._container.y,i.sEndPos.set(this._tweenStart);var o=!1;if(this._container.x>0?(i.sEndPos.x=0,o=!0):this._container.x<-this._overlapSize.x&&(i.sEndPos.x=-this._overlapSize.x,o=!0),-this._container.y>0?(i.sEndPos.y=0,o=!0):-this._container.y<-this._overlapSize.y&&(i.sEndPos.y=-this._overlapSize.y,o=!0),o){if(this._tweenChange.x=i.sEndPos.x-this._tweenStart.x,this._tweenChange.y=i.sEndPos.y-this._tweenStart.y,this._tweenChange.x<-t.UIConfig.touchDragSensitivity||this._tweenChange.y<-t.UIConfig.touchDragSensitivity?(this._refreshEventDispatching=!0,this._owner.node.emit(t.Event.PULL_DOWN_RELEASE),this._owner,this._refreshEventDispatching=!1):(this._tweenChange.x>t.UIConfig.touchDragSensitivity||this._tweenChange.y>t.UIConfig.touchDragSensitivity)&&(this._refreshEventDispatching=!0,this._owner.node.emit(t.Event.PULL_UP_RELEASE,this._owner),this._refreshEventDispatching=!1),this._headerLockedSize>0&&0==i.sEndPos[this._refreshBarAxis])i.sEndPos[this._refreshBarAxis]=this._headerLockedSize,this._tweenChange.x=i.sEndPos.x-this._tweenStart.x,this._tweenChange.y=i.sEndPos.y-this._tweenStart.y;else if(this._footerLockedSize>0&&i.sEndPos[this._refreshBarAxis]==-this._overlapSize[this._refreshBarAxis]){var n=this._overlapSize[this._refreshBarAxis];0==n?n=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):n+=this._footerLockedSize,i.sEndPos[this._refreshBarAxis]=-n,this._tweenChange.x=i.sEndPos.x-this._tweenStart.x,this._tweenChange.y=i.sEndPos.y-this._tweenStart.y}this._tweenDuration.x=this._tweenDuration.y=i.TWEEN_TIME_DEFAULT}else{if(this._inertiaDisabled)this._tweenDuration.x=this._tweenDuration.y=i.TWEEN_TIME_DEFAULT;else{var s=60*(t.ToolSet.getTime()-this._lastMoveTime)-1;if(s>1){var r=Math.pow(.833,s);this._velocity.x=this._velocity.x*r,this._velocity.y=this._velocity.y*r}this.updateTargetAndDuration(this._tweenStart,i.sEndPos)}if(i.sOldChange.x=i.sEndPos.x-this._tweenStart.x,i.sOldChange.y=i.sEndPos.y-this._tweenStart.y,this.loopCheckingTarget(i.sEndPos),(this._pageMode||this._snapToItem)&&this.alignPosition(i.sEndPos,!0),this._tweenChange.x=i.sEndPos.x-this._tweenStart.x,this._tweenChange.y=i.sEndPos.y-this._tweenStart.y,0==this._tweenChange.x&&0==this._tweenChange.y)return void this.updateScrollBarVisible();(this._pageMode||this._snapToItem)&&(this.fixDuration("x",i.sOldChange.x),this.fixDuration("y",i.sOldChange.y))}this.startTween(2)}else this._dragged=!1},i.prototype.onRollOver=function(){this._hover=!0,this.updateScrollBarVisible()},i.prototype.onRollOut=function(){this._hover=!1,this.updateScrollBarVisible()},i.prototype.onMouseWheel=function(t){if(this._mouseWheelEnabled){var e=t.mouseWheelDelta>0?-1:1;this._overlapSize.x>0&&0==this._overlapSize.y?this._pageMode?this.setPosX(this._xPos+this._pageSize.x*e,!1):this.setPosX(this._xPos+this._mouseWheelStep*e,!1):this._pageMode?this.setPosY(this._yPos+this._pageSize.y*e,!1):this.setPosY(this._yPos+this._mouseWheelStep*e,!1)}},i.prototype.updateScrollBarPos=function(){null!=this._vtScrollBar&&this._vtScrollBar.setScrollPerc(0==this._overlapSize.y?0:t.ToolSet.clamp(this._container.y,0,this._overlapSize.y)/this._overlapSize.y),null!=this._hzScrollBar&&this._hzScrollBar.setScrollPerc(0==this._overlapSize.x?0:t.ToolSet.clamp(-this._container.x,0,this._overlapSize.x)/this._overlapSize.x),this.checkRefreshBar()},i.prototype.updateScrollBarVisible=function(){this._vtScrollBar&&(this._viewSize.y<=this._vtScrollBar.minSize||this._vScrollNone?this._vtScrollBar.node.active=!1:this.updateScrollBarVisible2(this._vtScrollBar)),this._hzScrollBar&&(this._viewSize.x<=this._hzScrollBar.minSize||this._hScrollNone?this._hzScrollBar.node.active=!1:this.updateScrollBarVisible2(this._hzScrollBar))},i.prototype.updateScrollBarVisible2=function(e){this._scrollBarDisplayAuto&&t.GTween.kill(e,!1,"alpha"),!this._scrollBarDisplayAuto||this._hover||0!=this._tweening||this._dragged||e.gripDragging?(e.alpha=1,e.node.active=!0):e.node.active&&t.GTween.to(1,0,.5).setDelay(.5).onComplete(this.__barTweenComplete,this).setTarget(e,"alpha")},i.prototype.__barTweenComplete=function(t){var e=t.target;e.alpha=1,e.node.active=!1},i.prototype.getLoopPartSize=function(t,e){return(this._contentSize[e]+("x"==e?this._owner.columnGap:this._owner.lineGap))/t},i.prototype.loopCheckingCurrent=function(){var t=!1;return 1==this._loop&&this._overlapSize.x>0?this._xPos<.001?(this._xPos+=this.getLoopPartSize(2,"x"),t=!0):this._xPos>=this._overlapSize.x&&(this._xPos-=this.getLoopPartSize(2,"x"),t=!0):2==this._loop&&this._overlapSize.y>0&&(this._yPos<.001?(this._yPos+=this.getLoopPartSize(2,"y"),t=!0):this._yPos>=this._overlapSize.y&&(this._yPos-=this.getLoopPartSize(2,"y"),t=!0)),t&&this._container.setPosition(Math.floor(-this._xPos),-Math.floor(-this._yPos)),t},i.prototype.loopCheckingTarget=function(t){1==this._loop&&this.loopCheckingTarget2(t,"x"),2==this._loop&&this.loopCheckingTarget2(t,"y")},i.prototype.loopCheckingTarget2=function(t,e){var i,o;t[e]>0?(i=this.getLoopPartSize(2,e),(o=this._tweenStart[e]-i)<=0&&o>=-this._overlapSize[e]&&(t[e]-=i,this._tweenStart[e]=o)):t[e]<-this._overlapSize[e]&&(i=this.getLoopPartSize(2,e),(o=this._tweenStart[e]+i)<=0&&o>=-this._overlapSize[e]&&(t[e]+=i,this._tweenStart[e]=o))},i.prototype.loopCheckingNewPos=function(e,i){if(0==this._overlapSize[i])return e;var o,n="x"==i?this._xPos:this._yPos,s=!1;return e<.001?(e+=this.getLoopPartSize(2,i))>n&&(o=this.getLoopPartSize(6,i),o=Math.ceil((e-n)/o)*o,n=t.ToolSet.clamp(n+o,0,this._overlapSize[i]),s=!0):e>=this._overlapSize[i]&&(e-=this.getLoopPartSize(2,i))<n&&(o=this.getLoopPartSize(6,i),o=Math.ceil((n-e)/o)*o,n=t.ToolSet.clamp(n-o,0,this._overlapSize[i]),s=!0),s&&("x"==i?this._container.x=-Math.floor(n):this._container.y=Math.floor(n)),e},i.prototype.alignPosition=function(t,e){if(this._pageMode)t.x=this.alignByPage(t.x,"x",e),t.y=this.alignByPage(t.y,"y",e);else if(this._snapToItem){var o=this._owner.getSnappingPosition(-t.x,-t.y,i.sHelperPoint);t.x<0&&t.x>-this._overlapSize.x&&(t.x=-o.x),t.y<0&&t.y>-this._overlapSize.y&&(t.y=-o.y)}},i.prototype.alignByPage=function(t,e,i){var o;if(t>0)o=0;else if(t<-this._overlapSize[e])o=Math.ceil(this._contentSize[e]/this._pageSize[e])-1;else{o=Math.floor(-t/this._pageSize[e]);var n=i?t-this._containerPos[e]:t-("x"==e?this._container.x:-this._container.y),s=Math.min(this._pageSize[e],this._contentSize[e]-(o+1)*this._pageSize[e]),r=-t-o*this._pageSize[e];Math.abs(n)>this._pageSize[e]?r>.5*s&&o++:r>s*(n<0?.3:.7)&&o++,(t=-o*this._pageSize[e])<-this._overlapSize[e]&&(t=-this._overlapSize[e])}if(i){var a,h=this._tweenStart[e];a=h>0?0:h<-this._overlapSize[e]?Math.ceil(this._contentSize[e]/this._pageSize[e])-1:Math.floor(-h/this._pageSize[e]);var l=Math.floor(-this._containerPos[e]/this._pageSize[e]);Math.abs(o-l)>1&&Math.abs(a-l)<=1&&(t=-(o=o>l?l+1:l-1)*this._pageSize[e])}return t},i.prototype.updateTargetAndDuration=function(t,e){e.x=this.updateTargetAndDuration2(t.x,"x"),e.y=this.updateTargetAndDuration2(t.y,"y")},i.prototype.updateTargetAndDuration2=function(t,e){var o=this._velocity[e],n=0;if(t>0)t=0;else if(t<-this._overlapSize[e])t=-this._overlapSize[e];else{var s=cc.sys.isMobile,r=Math.abs(o)*this._velocityScale;s&&(r*=1136/Math.max(cc.winSize.width,cc.winSize.height));var a=0;if(this._pageMode||!s?r>500&&(a=Math.pow((r-500)/500,2)):r>1e3&&(a=Math.pow((r-1e3)/1e3,2)),0!=a)a>1&&(a=1),r*=a,o*=a,this._velocity[e]=o,n=Math.log(60/r)/Math.log(this._decelerationRate)/60,t+=Math.floor(o*n*.4)}return n<i.TWEEN_TIME_DEFAULT&&(n=i.TWEEN_TIME_DEFAULT),this._tweenDuration[e]=n,t},i.prototype.fixDuration=function(t,e){if(!(0==this._tweenChange[t]||Math.abs(this._tweenChange[t])>=Math.abs(e))){var o=Math.abs(this._tweenChange[t]/e)*this._tweenDuration[t];o<i.TWEEN_TIME_DEFAULT&&(o=i.TWEEN_TIME_DEFAULT),this._tweenDuration[t]=o}},i.prototype.startTween=function(t){this._tweenTime.set(cc.Vec2.ZERO),this._tweening=t,this.updateScrollBarVisible()},i.prototype.killTween=function(){1==this._tweening&&(this._container.setPosition(this._tweenStart.x+this._tweenChange.x,-(this._tweenStart.y+this._tweenChange.y)),this._owner.node.emit(t.Event.SCROLL,this._owner)),this._tweening=0,this.updateScrollBarVisible(),this._owner.node.emit(t.Event.SCROLL_END,this._owner)},i.prototype.checkRefreshBar=function(){if(null!=this._header||null!=this._footer){var t="x"==this._refreshBarAxis?this._container.x:-this._container.y;if(null!=this._header)if(t>0){this._header.node.active=!0;var e=i.sHelperPoint;e.x=this._header.width,e.y=this._header.height,e[this._refreshBarAxis]=t,this._header.setSize(e.x,e.y)}else this._header.node.active=!1;if(null!=this._footer){var o=this._overlapSize[this._refreshBarAxis];t<-o||0==o&&this._footerLockedSize>0?(this._footer.node.active=!0,(e=i.sHelperPoint).x=this._footer.x,e.y=this._footer.y,e[this._refreshBarAxis]=o>0?t+this._contentSize[this._refreshBarAxis]:Math.max(Math.min(t+this._viewSize[this._refreshBarAxis],this._viewSize[this._refreshBarAxis]-this._footerLockedSize),this._viewSize[this._refreshBarAxis]-this._contentSize[this._refreshBarAxis]),this._footer.setPosition(e.x,e.y),e.x=this._footer.width,e.y=this._footer.height,e[this._refreshBarAxis]=o>0?-o-t:this._viewSize[this._refreshBarAxis]-this._footer[this._refreshBarAxis],this._footer.setSize(e.x,e.y)):this._footer.node.active=!1}}},i.prototype.update=function(e){if(0!=this._tweening){var i=this.runTween("x",e),o=this.runTween("y",e);return this._container.setPosition(i,-o),2==this._tweening&&(this._overlapSize.x>0&&(this._xPos=t.ToolSet.clamp(-i,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=t.ToolSet.clamp(-o,0,this._overlapSize.y)),this._pageMode&&this.updatePageController()),0==this._tweenChange.x&&0==this._tweenChange.y?(this._tweening=0,this.loopCheckingCurrent(),this.updateScrollBarPos(),this.updateScrollBarVisible(),this._owner.node.emit(t.Event.SCROLL,this._owner),this._owner.node.emit(t.Event.SCROLL_END,this._owner)):(this.updateScrollBarPos(),this._owner.node.emit(t.Event.SCROLL,this._owner)),!0}},i.prototype.runTween=function(t,e){var o;if(0!=this._tweenChange[t]){if(this._tweenTime[t]+=e,this._tweenTime[t]>=this._tweenDuration[t])o=this._tweenStart[t]+this._tweenChange[t],this._tweenChange[t]=0;else{var n=i.easeFunc(this._tweenTime[t],this._tweenDuration[t]);o=this._tweenStart[t]+Math.floor(this._tweenChange[t]*n)}var s=0,r=-this._overlapSize[t];if(this._headerLockedSize>0&&this._refreshBarAxis==t&&(s=this._headerLockedSize),this._footerLockedSize>0&&this._refreshBarAxis==t){var a=this._overlapSize[this._refreshBarAxis];0==a?a=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):a+=this._footerLockedSize,r=-a}2==this._tweening&&this._bouncebackEffect?o>20+s&&this._tweenChange[t]>0||o>s&&0==this._tweenChange[t]?(this._tweenTime[t]=0,this._tweenDuration[t]=i.TWEEN_TIME_DEFAULT,this._tweenChange[t]=-o+s,this._tweenStart[t]=o):(o<r-20&&this._tweenChange[t]<0||o<r&&0==this._tweenChange[t])&&(this._tweenTime[t]=0,this._tweenDuration[t]=i.TWEEN_TIME_DEFAULT,this._tweenChange[t]=r-o,this._tweenStart[t]=o):o>s?(o=s,this._tweenChange[t]=0):o<r&&(o=r,this._tweenChange[t]=0)}else o="x"==t?this._container.x:-this._container.y;return o},i.easeFunc=function(t,e){return(t=t/e-1)*t*t+1},i._gestureFlag=0,i.TWEEN_TIME_GO=.5,i.TWEEN_TIME_DEFAULT=.3,i.PULL_RATIO=.5,i.sHelperPoint=new cc.Vec2,i.sHelperRect=new cc.Rect,i.sEndPos=new cc.Vec2,i.sOldChange=new cc.Vec2,i}(cc.Component);t.ScrollPane=e}(fgui||(fgui={})),function(t){var e=function(){function e(t){this._ownerBaseX=0,this._ownerBaseY=0,this._totalTimes=0,this._totalTasks=0,this._playing=!1,this._paused=!1,this._options=0,this._reversed=!1,this._totalDuration=0,this._autoPlay=!1,this._autoPlayTimes=1,this._autoPlayDelay=0,this._timeScale=1,this._startTime=0,this._endTime=0,this._owner=t,this._items=new Array}return e.prototype.play=function(t,e,i,o,n){this._play(t,e,i,o,n,!1)},e.prototype.playReverse=function(t,e,i){this._play(t,e,i,0,-1,!0)},e.prototype.changePlayTimes=function(t){this._totalTimes=t},e.prototype.setAutoPlay=function(t,e,i){void 0==e&&(e=-1),void 0==i&&(i=0),this._autoPlay!=t&&(this._autoPlay=t,this._autoPlayTimes=e,this._autoPlayDelay=i,this._autoPlay?this._owner.onStage&&this.play(null,this._autoPlayTimes,this._autoPlayDelay):this._owner.onStage||this.stop(!1,!0))},e.prototype._play=function(e,o,n,s,r,a){void 0==o&&(o=1),void 0==n&&(n=0),void 0==s&&(s=0),void 0==r&&(r=-1),this.stop(!0,!0),this._totalTimes=o,this._reversed=a,this._startTime=s,this._endTime=r,this._playing=!0,this._paused=!1,this._onComplete=e;for(var h=this._items.length,l=0;l<h;l++){var c=this._items[l];if(null==c.target?c.targetId?c.target=this._owner.getChildById(c.targetId):c.target=this._owner:c.target!=this._owner&&c.target.parent!=this._owner&&(c.target=null),null!=c.target&&c.type==i.Transition){var u=c.target.getTransition(c.value.transName);if(u==this&&(u=null),null!=u)if(0==c.value.playTimes){var d;for(d=l-1;d>=0;d--){var _=this._items[d];if(_.type==i.Transition&&_.value.trans==u){_.value.stopTime=c.time-_.time;break}}d<0?c.value.stopTime=0:u=null}else c.value.stopTime=-1;c.value.trans=u}}0==n?this.onDelayedPlay():t.GTween.delayedCall(n).onComplete(this.onDelayedPlay,this)},e.prototype.stop=function(e,i){if(void 0==e&&(e=!0),this._playing){this._playing=!1,this._totalTasks=0,this._totalTimes=0;var o=this._onComplete;this._onComplete=null,t.GTween.kill(this);var n=this._items.length;if(this._reversed)for(var s=n-1;s>=0;s--){var r=this._items[s];null!=r.target&&this.stopItem(r,e)}else for(s=0;s<n;s++)null!=(r=this._items[s]).target&&this.stopItem(r,e);i&&null!=o&&o()}},e.prototype.stopItem=function(t,e){if(0!=t.displayLockToken&&(t.target.releaseDisplayLock(t.displayLockToken),t.displayLockToken=0),null!=t.tweener&&(t.tweener.kill(e),t.tweener=null,t.type!=i.Shake||e||(t.target._gearLocked=!0,t.target.setPosition(t.target.x-t.value.lastOffsetX,t.target.y-t.value.lastOffsetY),t.target._gearLocked=!1)),t.type==i.Transition){var o=t.value.trans;null!=o&&o.stop(e,!1)}},e.prototype.setPaused=function(e){if(this._playing&&this._paused!=e){this._paused=e;var o=t.GTween.getTween(this);null!=o&&o.setPaused(e);for(var n=this._items.length,s=0;s<n;s++){var r=this._items[s];null!=r.target&&(r.type==i.Transition?null!=r.value.trans&&r.value.trans.setPaused(e):r.type==i.Animation&&(e?(r.value.flag=r.target.getProp(t.ObjectPropID.Playing),r.target.setProp(t.ObjectPropID.Playing,!1)):r.target.setProp(t.ObjectPropID.Playing,r.value.flag)),null!=r.tweener&&r.tweener.setPaused(e))}}},e.prototype.dispose=function(){this._playing&&t.GTween.kill(this);for(var e=this._items.length,i=0;i<e;i++){var o=this._items[i];null!=o.tweener&&(o.tweener.kill(),o.tweener=null),o.target=null,o.hook=null,null!=o.tweenConfig&&(o.tweenConfig.endHook=null)}this._items.length=0,this._playing=!1,this._onComplete=null},Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!0,configurable:!0}),e.prototype.setValue=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];for(var n,s=this._items.length,r=0;r<s;r++){var a=this._items[r];if(a.label==t)n=null!=a.tweenConfig?a.tweenConfig.startValue:a.value;else{if(null==a.tweenConfig||a.tweenConfig.endLabel!=t)continue;n=a.tweenConfig.endValue}switch(a.type){case i.XY:case i.Size:case i.Pivot:case i.Scale:case i.Skew:n.b1=!0,n.b2=!0,n.f1=parseFloat(e[0]),n.f2=parseFloat(e[1]);break;case i.Alpha:case i.Rotation:case i.Color:n.f1=parseFloat(e[0]);break;case i.Animation:n.frame=parseInt(e[0]),e.length>1&&(n.playing=e[1]);break;case i.Visible:n.visible=e[0];break;case i.Sound:n.sound=e[0],e.length>1&&(n.volume=parseFloat(e[1]));break;case i.Transition:n.transName=e[0],e.length>1&&(n.playTimes=parseInt(e[1]));break;case i.Shake:n.amplitude=parseFloat(e[0]),e.length>1&&(n.duration=parseFloat(e[1]));break;case i.ColorFilter:n.f1=parseFloat(e[0]),n.f2=parseFloat(e[1]),n.f3=parseFloat(e[2]),n.f4=parseFloat(e[3]);break;case i.Text:case i.Icon:n.text=e[0]}}},e.prototype.setHook=function(t,e){for(var i=this._items.length,o=0;o<i;o++){var n=this._items[o];if(n.label==t){n.hook=e;break}if(null!=n.tweenConfig&&n.tweenConfig.endLabel==t){n.tweenConfig.endHook=e;break}}},e.prototype.clearHooks=function(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.hook=null,null!=i.tweenConfig&&(i.tweenConfig.endHook=null)}},e.prototype.setTarget=function(t,e){for(var i=this._items.length,o=0;o<i;o++){var n=this._items[o];n.label==t&&(n.targetId=e.id,n.target=null)}},e.prototype.setDuration=function(t,e){for(var i=this._items.length,o=0;o<i;o++){var n=this._items[o];null!=n.tweenConfig&&n.label==t&&(n.tweenConfig.duration=e)}},e.prototype.getLabelTime=function(t){for(var e=this._items.length,i=0;i<e;i++){var o=this._items[i];if(o.label==t)return o.time;if(null!=o.tweenConfig&&o.tweenConfig.endLabel==t)return o.time+o.tweenConfig.duration}return Number.NaN},Object.defineProperty(e.prototype,"timeScale",{get:function(){return this._timeScale},set:function(e){if(this._timeScale!=e&&(this._timeScale=e,this._playing))for(var o=this._items.length,n=0;n<o;n++){var s=this._items[n];null!=s.tweener?s.tweener.setTimeScale(e):s.type==i.Transition?null!=s.value.trans&&(s.value.trans.timeScale=e):s.type==i.Animation&&null!=s.target&&s.target.setProp(t.ObjectPropID.TimeScale,e)}},enumerable:!0,configurable:!0}),e.prototype.updateFromRelations=function(t,e,o){var n=this._items.length;if(0!=n)for(var s=0;s<n;s++){var r=this._items[s];r.type==i.XY&&r.targetId==t&&(null!=r.tweenConfig?(r.tweenConfig.startValue.f1+=e,r.tweenConfig.startValue.f2+=o,r.tweenConfig.endValue.f1+=e,r.tweenConfig.endValue.f2+=o):(r.value.f1+=e,r.value.f2+=o))}},e.prototype.onEnable=function(){this._autoPlay&&!this._playing&&this.play(null,this._autoPlayTimes,this._autoPlayDelay)},e.prototype.onDisable=function(){0==(this._options&e.OPTION_AUTO_STOP_DISABLED)&&this.stop(0!=(this._options&e.OPTION_AUTO_STOP_AT_END),!1)},e.prototype.onDelayedPlay=function(){if(this.internalPlay(),this._playing=this._totalTasks>0,this._playing){if(0!=(this._options&e.OPTION_IGNORE_DISPLAY_CONTROLLER))for(var t=this._items.length,i=0;i<t;i++){var o=this._items[i];null!=o.target&&o.target!=this._owner&&(o.displayLockToken=o.target.addDisplayLock())}}else if(null!=this._onComplete){var n=this._onComplete;this._onComplete=null,n()}},e.prototype.internalPlay=function(){this._ownerBaseX=this._owner.x,this._ownerBaseY=this._owner.y,this._totalTasks=0;var t,e,o=this._items.length,n=!1;if(this._reversed)for(e=o-1;e>=0;e--)null!=(t=this._items[e]).target&&this.playItem(t);else for(e=0;e<o;e++)null!=(t=this._items[e]).target&&(t.type==i.Animation&&0!=this._startTime&&t.time<=this._startTime?(n=!0,t.value.flag=!1):this.playItem(t));n&&this.skipAnimations()},e.prototype.playItem=function(e){var o;if(null!=e.tweenConfig){if(o=this._reversed?this._totalDuration-e.time-e.tweenConfig.duration:e.time,-1==this._endTime||o<=this._endTime){var n,s;switch(this._reversed?(n=e.tweenConfig.endValue,s=e.tweenConfig.startValue):(n=e.tweenConfig.startValue,s=e.tweenConfig.endValue),e.value.b1=n.b1||s.b1,e.value.b2=n.b2||s.b2,e.type){case i.XY:case i.Size:case i.Scale:case i.Skew:e.tweener=t.GTween.to2(n.f1,n.f2,s.f1,s.f2,e.tweenConfig.duration);break;case i.Alpha:case i.Rotation:e.tweener=t.GTween.to(n.f1,s.f1,e.tweenConfig.duration);break;case i.Color:e.tweener=t.GTween.toColor(n.f1,s.f1,e.tweenConfig.duration);break;case i.ColorFilter:e.tweener=t.GTween.to4(n.f1,n.f2,n.f3,n.f4,s.f1,s.f2,s.f3,s.f4,e.tweenConfig.duration)}e.tweener.setDelay(o).setEase(e.tweenConfig.easeType).setRepeat(e.tweenConfig.repeat,e.tweenConfig.yoyo).setTimeScale(this._timeScale).setTarget(e).onStart(this.onTweenStart,this).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&e.tweener.setBreakpoint(this._endTime-o),this._totalTasks++}}else e.type==i.Shake?(o=this._reversed?this._totalDuration-e.time-e.value.duration:e.time,e.value.offsetX=e.value.offsetY=0,e.value.lastOffsetX=e.value.lastOffsetY=0,e.tweener=t.GTween.shake(0,0,e.value.amplitude,e.value.duration).setDelay(o).setTimeScale(this._timeScale).setTarget(e).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&e.tweener.setBreakpoint(this._endTime-e.time),this._totalTasks++):(o=this._reversed?this._totalDuration-e.time:e.time)<=this._startTime?(this.applyValue(e),this.callHook(e,!1)):(-1==this._endTime||o<=this._endTime)&&(this._totalTasks++,e.tweener=t.GTween.delayedCall(o).setTimeScale(this._timeScale).setTarget(e).onComplete(this.onDelayedPlayItem,this));null!=e.tweener&&e.tweener.seek(this._startTime)},e.prototype.skipAnimations=function(){for(var e,o,n,s,r,a,h=this._items.length,l=0;l<h;l++)if(!((a=this._items[l]).type!=i.Animation||a.time>this._startTime||(s=a.value).flag)){e=(r=a.target).getProp(t.ObjectPropID.Frame),o=r.getProp(t.ObjectPropID.Playing)?0:-1,n=0;for(var c=l;c<h;c++)(a=this._items[c]).type!=i.Animation||a.target!=r||a.time>this._startTime||((s=a.value).flag=!0,-1!=s.frame?(e=s.frame,o=s.playing?a.time:-1,n=0):s.playing?o<0&&(o=a.time):(o>=0&&(n+=a.time-o),o=-1),this.callHook(a,!1));o>=0&&(n+=this._startTime-o),r.setProp(t.ObjectPropID.Playing,o>=0),r.setProp(t.ObjectPropID.Frame,e),n>0&&r.setProp(t.ObjectPropID.DeltaTime,1e3*n)}},e.prototype.onDelayedPlayItem=function(t){var e=t.target;e.tweener=null,this._totalTasks--,this.applyValue(e),this.callHook(e,!1),this.checkAllComplete()},e.prototype.onTweenStart=function(t){var e,o,n=t.target;n.type!=i.XY&&n.type!=i.Size||(this._reversed?(e=n.tweenConfig.endValue,o=n.tweenConfig.startValue):(e=n.tweenConfig.startValue,o=n.tweenConfig.endValue),n.type==i.XY?n.target!=this._owner?(e.b1?e.b3&&(t.startValue.x=e.f1*this._owner.width):t.startValue.x=n.target.x,e.b2?e.b3&&(t.startValue.y=e.f2*this._owner.height):t.startValue.y=n.target.y,o.b1?o.b3&&(t.endValue.x=o.f1*this._owner.width):t.endValue.x=t.startValue.x,o.b2?o.b3&&(t.endValue.y=o.f2*this._owner.height):t.endValue.y=t.startValue.y):(e.b1||(t.startValue.x=n.target.x-this._ownerBaseX),e.b2||(t.startValue.y=n.target.y-this._ownerBaseY),o.b1||(t.endValue.x=t.startValue.x),o.b2||(t.endValue.y=t.startValue.y)):(e.b1||(t.startValue.x=n.target.width),e.b2||(t.startValue.y=n.target.height),o.b1||(t.endValue.x=t.startValue.x),o.b2||(t.endValue.y=t.startValue.y)),n.tweenConfig.path&&(n.value.b1=n.value.b2=!0,t.setPath(n.tweenConfig.path)));this.callHook(n,!1)},e.prototype.onTweenUpdate=function(t){var e=t.target;switch(e.type){case i.XY:case i.Size:case i.Scale:case i.Skew:e.value.f1=t.value.x,e.value.f2=t.value.y,e.tweenConfig.path&&(e.value.f1+=t.startValue.x,e.value.f2+=t.startValue.y);break;case i.Alpha:case i.Rotation:e.value.f1=t.value.x;break;case i.Color:e.value.f1=t.value.color;break;case i.ColorFilter:e.value.f1=t.value.x,e.value.f2=t.value.y,e.value.f3=t.value.z,e.value.f4=t.value.w;break;case i.Shake:e.value.offsetX=t.deltaValue.x,e.value.offsetY=t.deltaValue.y}this.applyValue(e)},e.prototype.onTweenComplete=function(t){var e=t.target;e.tweener=null,this._totalTasks--,t.allCompleted&&this.callHook(e,!0),this.checkAllComplete()},e.prototype.onPlayTransCompleted=function(t){this._totalTasks--,this.checkAllComplete()},e.prototype.callHook=function(t,e){e?null!=t.tweenConfig&&null!=t.tweenConfig.endHook&&t.tweenConfig.endHook(t.label):t.time>=this._startTime&&null!=t.hook&&t.hook(t.label)},e.prototype.checkAllComplete=function(){if(this._playing&&0==this._totalTasks)if(this._totalTimes<0)this.internalPlay();else if(this._totalTimes--,this._totalTimes>0)this.internalPlay();else{this._playing=!1;for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];null!=i.target&&0!=i.displayLockToken&&(i.target.releaseDisplayLock(i.displayLockToken),i.displayLockToken=0)}if(null!=this._onComplete){var o=this._onComplete;this._onComplete=null,o()}}},e.prototype.applyValue=function(e){e.target._gearLocked=!0;var o=e.value;switch(e.type){case i.XY:e.target==this._owner?o.b1&&o.b2?e.target.setPosition(o.f1+this._ownerBaseX,o.f2+this._ownerBaseY):o.b1?e.target.x=o.f1+this._ownerBaseX:e.target.y=o.f2+this._ownerBaseY:o.b3?o.b1&&o.b2?e.target.setPosition(o.f1*this._owner.width,o.f2*this._owner.height):o.b1?e.target.x=o.f1*this._owner.width:o.b2&&(e.target.y=o.f2*this._owner.height):o.b1&&o.b2?e.target.setPosition(o.f1,o.f2):o.b1?e.target.x=o.f1:o.b2&&(e.target.y=o.f2);break;case i.Size:o.b1||(o.f1=e.target.width),o.b2||(o.f2=e.target.height),e.target.setSize(o.f1,o.f2);break;case i.Pivot:e.target.setPivot(o.f1,o.f2,e.target.pivotAsAnchor);break;case i.Alpha:e.target.alpha=o.f1;break;case i.Rotation:e.target.rotation=o.f1;break;case i.Scale:e.target.setScale(o.f1,o.f2);break;case i.Skew:e.target.setSkew(o.f1,o.f2);break;case i.Color:e.target.setProp(t.ObjectPropID.Color,o.f1);break;case i.Animation:o.frame>=0&&e.target.setProp(t.ObjectPropID.Frame,o.frame),e.target.setProp(t.ObjectPropID.Playing,o.playing),e.target.setProp(t.ObjectPropID.TimeScale,this._timeScale);break;case i.Visible:e.target.visible=o.visible;break;case i.Transition:if(this._playing){var n=o.trans;if(null!=n){this._totalTasks++;var s=this._startTime>e.time?this._startTime-e.time:0,r=this._endTime>=0?this._endTime-e.time:-1;o.stopTime>=0&&(r<0||r>o.stopTime)&&(r=o.stopTime),n.timeScale=this._timeScale,n._play(function(){this.onPlayTransCompleted(e)}.bind(this),o.playTimes,0,s,r,this._reversed)}}break;case i.Sound:if(this._playing&&e.time>=this._startTime){if(null==o.audioClip){var a=t.UIPackage.getItemByURL(o.sound);a&&(o.audioClip=a.owner.getItemAsset(a))}o.audioClip&&t.GRoot.inst.playOneShotSound(o.audioClip,o.volume)}break;case i.Shake:e.target.setPosition(e.target.x-o.lastOffsetX+o.offsetX,e.target.y-o.lastOffsetY+o.offsetY),o.lastOffsetX=o.offsetX,o.lastOffsetY=o.offsetY;break;case i.ColorFilter:break;case i.Text:e.target.text=o.text;break;case i.Icon:e.target.icon=o.text}e.target._gearLocked=!1},e.prototype.setup=function(e){this.name=e.readS(),this._options=e.readInt(),this._autoPlay=e.readBool(),this._autoPlayTimes=e.readInt(),this._autoPlayDelay=e.readFloat();for(var i=e.readShort(),s=0;s<i;s++){var r=e.readShort(),a=e.position;e.seek(a,0);var h=new o(e.readByte());this._items[s]=h,h.time=e.readFloat();var l=e.readShort();if(h.targetId=l<0?"":this._owner.getChildAt(l).id,h.label=e.readS(),e.readBool()){if(e.seek(a,1),h.tweenConfig=new n,h.tweenConfig.duration=e.readFloat(),h.time+h.tweenConfig.duration>this._totalDuration&&(this._totalDuration=h.time+h.tweenConfig.duration),h.tweenConfig.easeType=e.readByte(),h.tweenConfig.repeat=e.readInt(),h.tweenConfig.yoyo=e.readBool(),h.tweenConfig.endLabel=e.readS(),e.seek(a,2),this.decodeValue(h,e,h.tweenConfig.startValue),e.seek(a,3),this.decodeValue(h,e,h.tweenConfig.endValue),e.version>=2){var c=e.readInt();if(c>0){h.tweenConfig.path=new t.GPath;for(var u=new Array,d=0;d<c;d++){var _=e.readByte();switch(_){case t.CurveType.Bezier:u.push(t.GPathPoint.newBezierPoint(e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()));break;case t.CurveType.CubicBezier:u.push(t.GPathPoint.newCubicBezierPoint(e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()));break;default:u.push(t.GPathPoint.newPoint(e.readFloat(),e.readFloat(),_))}}h.tweenConfig.path.create(u)}}}else h.time>this._totalDuration&&(this._totalDuration=h.time),e.seek(a,2),this.decodeValue(h,e,h.value);e.position=a+r}},e.prototype.decodeValue=function(t,e,o){switch(t.type){case i.XY:case i.Size:case i.Pivot:case i.Skew:o.b1=e.readBool(),o.b2=e.readBool(),o.f1=e.readFloat(),o.f2=e.readFloat(),e.version>=2&&t.type==i.XY&&(o.b3=e.readBool());break;case i.Alpha:case i.Rotation:o.f1=e.readFloat();break;case i.Scale:o.f1=e.readFloat(),o.f2=e.readFloat();break;case i.Color:o.f1=e.readColor();break;case i.Animation:o.playing=e.readBool(),o.frame=e.readInt();break;case i.Visible:o.visible=e.readBool();break;case i.Sound:o.sound=e.readS(),o.volume=e.readFloat();break;case i.Transition:o.transName=e.readS(),o.playTimes=e.readInt();break;case i.Shake:o.amplitude=e.readFloat(),o.duration=e.readFloat();break;case i.ColorFilter:o.f1=e.readFloat(),o.f2=e.readFloat(),o.f3=e.readFloat(),o.f4=e.readFloat();break;case i.Text:case i.Icon:o.text=e.readS()}},e.OPTION_IGNORE_DISPLAY_CONTROLLER=1,e.OPTION_AUTO_STOP_DISABLED=2,e.OPTION_AUTO_STOP_AT_END=4,e}();t.Transition=e;var i=function(){function t(){}return t.XY=0,t.Size=1,t.Scale=2,t.Pivot=3,t.Alpha=4,t.Rotation=5,t.Color=6,t.Animation=7,t.Visible=8,t.Sound=9,t.Transition=10,t.Shake=11,t.ColorFilter=12,t.Skew=13,t.Text=14,t.Icon=15,t.Unknown=16,t}(),o=function(){return function(t){switch(this.type=t,t){case i.XY:case i.Size:case i.Scale:case i.Pivot:case i.Skew:case i.Alpha:case i.Rotation:case i.Color:case i.ColorFilter:this.value=new u;break;case i.Animation:this.value=new r;break;case i.Shake:this.value=new l;break;case i.Sound:this.value=new a;break;case i.Transition:this.value=new h;break;case i.Visible:this.value=new s;break;case i.Text:case i.Icon:this.value=new c}}}(),n=function(){return function(){this.duration=0,this.repeat=0,this.yoyo=!1,this.easeType=t.EaseType.QuadOut,this.startValue=new u,this.endValue=new u}}(),s=function(){return function(){}}(),r=function(){return function(){}}(),a=function(){return function(){}}(),h=function(){return function(){}}(),l=function(){return function(){}}(),c=function(){return function(){}}(),u=function(){return function(){this.f1=this.f2=this.f3=this.f4=0,this.b1=this.b2=!0}}()}(fgui||(fgui={})),function(t){var e=function(){function e(){}return e.loadFromXML=function(t){e.strings={};for(var i=(new cc.SAXParser).parse(t).documentElement.childNodes,o=i.length,n=0;n<o;n++){var s=i[n];if("string"==s.tagName){var r=s.getAttribute("name"),a=s.childNodes.length>0?s.firstChild.nodeValue:"",h=r.indexOf("-");if(-1==h)continue;var l=r.substr(0,h),c=r.substr(h+1),u=e.strings[l];u||(u={},e.strings[l]=u),u[c]=a}}},e.translateComponent=function(i){if(null!=e.strings){var o=e.strings[i.owner.id+i.id];if(null!=o){var n,s,r,a,h,l,c,u,d,_=i.rawData;_.seek(0,2);var p=_.readShort();for(h=0;h<p;h++){c=_.readShort(),u=_.position,_.seek(u,0);var f=_.readByte(),g=f;_.skip(4),n=_.readS(),g==t.ObjectType.Component&&_.seek(u,6)&&(g=_.readByte()),_.seek(u,1),null!=(s=o[n+"-tips"])&&_.writeS(s),_.seek(u,2);var m=_.readShort();for(l=0;l<m;l++){if(r=_.readShort(),r+=_.position,6==_.readByte()){for(_.skip(2),d=_.readShort(),y=0;y<d;y++)null!=_.readS()&&(null!=(s=o[n+"-texts_"+y])?_.writeS(s):_.skip(2));_.readBool()&&null!=(s=o[n+"-texts_def"])&&_.writeS(s)}if(f==t.ObjectType.Component&&_.version>=2){_.seek(u,4),_.skip(2),_.skip(4*_.readShort());for(var v=_.readShort(),y=0;y<v;y++){var b=_.readS();0==_.readShort()&&null!=(s=o[n+"-cp-"+b])?_.writeS(s):_.skip(2)}}_.position=r}switch(g){case t.ObjectType.Text:case t.ObjectType.RichText:case t.ObjectType.InputText:null!=(s=o[n])&&(_.seek(u,6),_.writeS(s)),null!=(s=o[n+"-prompt"])&&(_.seek(u,4),_.writeS(s));break;case t.ObjectType.List:case t.ObjectType.Tree:for(_.seek(u,8),_.skip(2),a=_.readShort(),l=0;l<a;l++){if(r=_.readShort(),r+=_.position,_.skip(2),g==t.ObjectType.Tree&&_.skip(2),null!=(s=o[n+"-"+l])?_.writeS(s):_.skip(2),null!=(s=o[n+"-"+l+"-0"])?_.writeS(s):_.skip(2),_.version>=2){_.skip(6),_.skip(4*_.readUshort());for(v=_.readUshort(),y=0;y<v;y++){b=_.readS();0==_.readUshort()&&null!=(s=o[n+"-"+l+"-"+b])?_.writeS(s):_.skip(2)}}_.position=r}break;case t.ObjectType.Label:_.seek(u,6)&&_.readByte()==g&&(null!=(s=o[n])?_.writeS(s):_.skip(2),_.skip(2),_.readBool()&&_.skip(4),_.skip(4),_.readBool()&&null!=(s=o[n+"-prompt"])&&_.writeS(s));break;case t.ObjectType.Button:_.seek(u,6)&&_.readByte()==g&&(null!=(s=o[n])?_.writeS(s):_.skip(2),null!=(s=o[n+"-0"])&&_.writeS(s));break;case t.ObjectType.ComboBox:if(_.seek(u,6)&&_.readByte()==g){for(a=_.readShort(),l=0;l<a;l++)r=_.readShort(),r+=_.position,null!=(s=o[n+"-"+l])&&_.writeS(s),_.position=r;null!=(s=o[n])&&_.writeS(s)}}_.position=u+c}}}},e.strings=null,e}();t.TranslationHelper=e}(fgui||(fgui={})),function(t){var e=function(){function e(){}return e.defaultFont="Arial",e.modalLayerColor=new cc.Color(51,51,51,51),e.buttonSoundVolumeScale=1,e.defaultScrollStep=25,e.defaultScrollDecelerationRate=.967,e.defaultScrollBarDisplay=t.ScrollBarDisplayType.Visible,e.defaultScrollTouchEffect=!0,e.defaultScrollBounceEffect=!0,e.defaultComboBoxVisibleItemCount=10,e.touchScrollSensitivity=20,e.touchDragSensitivity=10,e.clickDragSensitivity=2,e.bringWindowToFrontOnClick=!0,e.frameTimeForAsyncUIConstruction=.002,e.linkUnderline=!0,e.defaultUIGroup="UI",e}();t.UIConfig=e;var i=!1;t.addLoadHandler=function(t){var e,o;i||(i=!0,t||(t="bin"),cc.loader.addDownloadHandlers(((e={})[t]=cc.loader.downloader.extMap.binary,e)),cc.loader.addLoadHandlers(((o={})[t]=function(t,e){return t._owner.rawBuffer=t.content,t.content},o)))};var o={};t.registerFont=function(t,e){e instanceof cc.Font?o[t]=e:o[t]=cc.loader.getRes(t,cc.Font)},t.getFontByName=function(t){return o[t]}}(fgui||(fgui={})),function(t){var e=function(){function e(){}return e.setPackageItemExtension=function(t,i){e.setExtension(t,i)},e.setExtension=function(i,o){if(null==i)throw"Invaild url: "+i;var n=t.UIPackage.getItemByURL(i);null!=n&&(n.extensionType=o),e.extensions[i]=o},e.setLoaderExtension=function(t){e.loaderType=t},e.resolveExtension=function(t){t.extensionType=e.extensions["ui://"+t.owner.id+t.id],t.extensionType||(t.extensionType=e.extensions["ui://"+t.owner.name+"/"+t.name])},e.newObject=function(i,o){var n;return(n=i.type==t.PackageItemType.Component?o?new o:i.extensionType?new i.extensionType:e.newObject2(i.objectType):e.newObject2(i.objectType))&&(n.packageItem=i),n},e.newObject2=function(i){switch(e.counter++,i){case t.ObjectType.Image:return new t.GImage;case t.ObjectType.MovieClip:return new t.GMovieClip;case t.ObjectType.Component:return new t.GComponent;case t.ObjectType.Text:return new t.GTextField;case t.ObjectType.RichText:return new t.GRichTextField;case t.ObjectType.InputText:return new t.GTextInput;case t.ObjectType.Group:return new t.GGroup;case t.ObjectType.List:return new t.GList;case t.ObjectType.Graph:return new t.GGraph;case t.ObjectType.Loader:return null!=e.loaderType?new e.loaderType:new t.GLoader;case t.ObjectType.Button:return new t.GButton;case t.ObjectType.Label:return new t.GLabel;case t.ObjectType.ProgressBar:return new t.GProgressBar;case t.ObjectType.Slider:return new t.GSlider;case t.ObjectType.ScrollBar:return new t.GScrollBar;case t.ObjectType.ComboBox:return new t.GComboBox;case t.ObjectType.Tree:return new t.GTree;default:return null}},e.counter=0,e.extensions={},e}();t.UIObjectFactory=e}(fgui||(fgui={})),function(t){var e=function(){function e(){this._items=new Array,this._itemsById={},this._itemsByName={},this._sprites={},this._dependencies=Array(),this._branches=Array(),this._branchIndex=-1}return Object.defineProperty(e,"branch",{get:function(){return e._branch},set:function(t){for(var i in e._branch=t,e._instById){var o=e._instById[i];o._branches&&(o._branchIndex=o._branches.indexOf(t))}},enumerable:!0,configurable:!0}),e.getVar=function(t){return e._vars[t]},e.setVar=function(t,i){e._vars[t]=i},e.getById=function(t){return e._instById[t]},e.getByName=function(t){return e._instByName[t]},e.addPackage=function(i){var o=e._instById[i];if(o)return o;var n=cc.loader.getRes(i);if(!n)throw"Resource '"+i+"' not ready";if(!n.rawBuffer)throw"Missing asset data. Call UIConfig.registerLoader first!";return(o=new e).loadPackage(new t.ByteBuffer(n.rawBuffer),i),e._instById[o.id]=o,e._instByName[o.name]=o,e._instById[o._url]=o,o},e.loadPackage=function(i,o){cc.loader.loadRes(i,function(n,s){if(n)o(n);else{if(!s.rawBuffer)throw"Missing asset data. Call UIConfig.registerLoader first!";var r=new e;r.loadPackage(new t.ByteBuffer(s.rawBuffer),i);for(var a=r._items.length,h=[],l=0;l<a;l++){var c=r._items[l];c.type!=t.PackageItemType.Atlas&&c.type!=t.PackageItemType.Sound||h.push(c.file)}cc.loader.loadResArray(h,function(t,i){t||(e._instById[r.id]=r,e._instByName[r.name]=r),o(t)})}})},e.removePackage=function(t){var i=e._instById[t];if(i||(i=e._instByName[t]),!i)throw"No package found: "+t;i.dispose(),delete e._instById[i.id],null!=i._url&&delete e._instById[i._url],delete e._instByName[i.name]},e.createObject=function(t,i,o){var n=e.getByName(t);return n?n.createObject(i,o):null},e.createObjectFromURL=function(t,i){var o=e.getItemByURL(t);return o?o.owner.internalCreateObject(o,i):null},e.getItemURL=function(t,i){var o=e.getByName(t);if(!o)return null;var n=o._itemsByName[i];return n?"ui://"+o.id+n.id:null},e.getItemByURL=function(t){var i=t.indexOf("//");if(-1==i)return null;var o=t.indexOf("/",i+2);if(-1==o){if(t.length>13){var n=t.substr(5,8),s=e.getById(n);if(null!=s){var r=t.substr(13);return s.getItemById(r)}}}else{var a=t.substr(i+2,o-i-2);if(null!=(s=e.getByName(a))){var h=t.substr(o+1);return s.getItemByName(h)}}return null},e.normalizeURL=function(t){if(null==t)return null;var i=t.indexOf("//");if(-1==i)return null;var o=t.indexOf("/",i+2);if(-1==o)return t;var n=t.substr(i+2,o-i-2),s=t.substr(o+1);return e.getItemURL(n,s)},e.setStringsSource=function(e){t.TranslationHelper.loadFromXML(e)},e.prototype.loadPackage=function(o,n){if(1179080009!=o.readUint())throw"FairyGUI: old package format found in '"+n+"'";this._url=n,o.version=o.readInt();var s=o.version>=2;o.readBool();this._id=o.readString(),this._name=o.readString(),o.skip(20);var r,a,h,l,c,u=o.position;o.seek(u,4),r=o.readInt();var d,_=new Array(r);for(o.stringTable=_,a=0;a<r;a++)_[a]=o.readString();if(o.seek(u,5))for(r=o.readInt(),a=0;a<r;a++){var p=o.readUshort(),f=o.readInt();_[p]=o.readString(f)}for(o.seek(u,0),r=o.readShort(),a=0;a<r;a++)this._dependencies.push({id:o.readS(),name:o.readS()});for(s&&((r=o.readShort())>0&&(this._branches=o.readSArray(r),e._branch&&(this._branchIndex=this._branches.indexOf(e._branch))),c=r>0),o.seek(u,1),n+="_",r=o.readShort(),a=0;a<r;a++){switch(h=o.readInt(),h+=o.position,(d=new t.PackageItem).owner=this,d.type=o.readByte(),d.id=o.readS(),d.name=o.readS(),o.readS(),d.file=o.readS(),o.readBool(),d.width=o.readInt(),d.height=o.readInt(),d.type){case t.PackageItemType.Image:d.objectType=t.ObjectType.Image;var g=o.readByte();1==g?(d.scale9Grid=new cc.Rect,d.scale9Grid.x=o.readInt(),d.scale9Grid.y=o.readInt(),d.scale9Grid.width=o.readInt(),d.scale9Grid.height=o.readInt(),d.tileGridIndice=o.readInt()):2==g&&(d.scaleByTile=!0),d.smoothing=o.readBool();break;case t.PackageItemType.MovieClip:d.smoothing=o.readBool(),d.objectType=t.ObjectType.MovieClip,d.rawData=o.readBuffer();break;case t.PackageItemType.Font:d.rawData=o.readBuffer();break;case t.PackageItemType.Component:var m=o.readByte();d.objectType=m>0?m:t.ObjectType.Component,d.rawData=o.readBuffer(),t.UIObjectFactory.resolveExtension(d);break;case t.PackageItemType.Atlas:case t.PackageItemType.Sound:case t.PackageItemType.Misc:d.file=n+cc.path.mainFileName(d.file)}if(s){(l=o.readS())&&(d.name=l+"/"+d.name);var v=o.readUbyte();v>0&&(c?d.branches=o.readSArray(v):this._itemsById[o.readS()]=d);var y=o.readUbyte();y>0&&(d.highResolution=o.readSArray(y))}this._items.push(d),this._itemsById[d.id]=d,null!=d.name&&(this._itemsByName[d.name]=d),o.position=h}for(o.seek(u,2),r=o.readShort(),a=0;a<r;a++){h=o.readShort(),h+=o.position;var b=o.readS();d=this._itemsById[o.readS()];var C=new i;C.atlas=d,C.rect.x=o.readInt(),C.rect.y=o.readInt(),C.rect.width=o.readInt(),C.rect.height=o.readInt(),C.rotated=o.readBool(),s&&o.readBool()?(C.offset.x=o.readInt(),C.offset.y=o.readInt(),C.originalSize.width=o.readInt(),C.originalSize.height=o.readInt()):(C.originalSize.width=C.rect.width,C.originalSize.height=C.rect.height),this._sprites[b]=C,o.position=h}if(o.seek(u,3))for(r=o.readShort(),a=0;a<r;a++)h=o.readInt(),h+=o.position,(d=this._itemsById[o.readS()])&&d.type==t.PackageItemType.Image&&(d.hitTestData=new t.PixelHitTestData(o)),o.position=h},e.prototype.dispose=function(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.asset&&cc.loader.releaseAsset(i.asset)}},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),e.prototype.createObject=function(t,e){var i=this._itemsByName[t];return i?this.internalCreateObject(i,e):null},e.prototype.internalCreateObject=function(i,o){var n=t.UIObjectFactory.newObject(i,o);return null==n?null:(e._constructing++,n.constructFromResource(),e._constructing--,n)},e.prototype.getItemById=function(t){return this._itemsById[t]},e.prototype.getItemByName=function(t){return this._itemsByName[t]},e.prototype.getItemAssetByName=function(t){var e=this._itemsByName[t];if(null==e)throw"Resource not found -"+t;return this.getItemAsset(e)},e.prototype.getItemAsset=function(e){switch(e.type){case t.PackageItemType.Image:if(!e.decoded){e.decoded=!0;var i=this._sprites[e.id];if(null!=i){var o=this.getItemAsset(i.atlas);if(null!=o){var n=new cc.SpriteFrame(o,i.rect,i.rotated,new cc.Vec2(i.offset.x-(i.originalSize.width-i.rect.width)/2,-(i.offset.y-(i.originalSize.height-i.rect.height)/2)),i.originalSize);e.scale9Grid&&(n.insetLeft=e.scale9Grid.x,n.insetTop=e.scale9Grid.y,n.insetRight=e.width-e.scale9Grid.xMax,n.insetBottom=e.height-e.scale9Grid.yMax),e.asset=n}}}return e.asset;case t.PackageItemType.Atlas:case t.PackageItemType.Sound:return e.decoded||(e.decoded=!0,e.asset=cc.loader.getRes(e.file),e.asset||console.log("Resource '"+e.file+"' not found, please check default.res.json!")),e.asset;case t.PackageItemType.Font:return e.decoded||(e.decoded=!0,this.loadFont(e)),e.asset;case t.PackageItemType.MovieClip:return e.decoded||(e.decoded=!0,this.loadMovieClip(e)),null;case t.PackageItemType.Misc:return e.file?cc.loader.getRes(e.file):null;default:return null}},e.prototype.loadAllAssets=function(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];this.getItemAsset(i)}},e.prototype.loadMovieClip=function(e){var i=e.rawData;i.seek(0,0),e.interval=i.readInt()/1e3,e.swing=i.readBool(),e.repeatDelay=i.readInt()/1e3,i.seek(0,1);var o,n,s,r=i.readShort();e.frames=Array(r);for(var a=0;a<r;a++){var h=i.readShort();if(h+=i.position,(n=new t.Frame).rect.x=i.readInt(),n.rect.y=i.readInt(),n.rect.width=i.readInt(),n.rect.height=i.readInt(),n.addDelay=i.readInt()/1e3,null!=(o=i.readS())&&null!=(s=this._sprites[o])){var l=this.getItemAsset(s.atlas);if(null!=l){e.width,n.rect.width;n.texture=new cc.SpriteFrame(l,s.rect,s.rotated,new cc.Vec2(n.rect.x-(e.width-n.rect.width)/2,-(n.rect.y-(e.height-n.rect.height)/2)),new cc.Size(e.width,e.height))}}e.frames[a]=n,i.position=h}},e.prototype.loadFont=function(t){var e=new cc.LabelAtlas;t.asset=e,e._fntConfig={commonHeight:0,fontSize:0,kerningDict:{},fontDefDictionary:{}};var i=e._fntConfig.fontDefDictionary,o=t.rawData;o.seek(0,0);var n=o.readBool(),s=o.readBool(),r=o.readBool();o.readBool();var a,h=o.readInt(),l=o.readInt(),c=o.readInt(),u=this._sprites[t.id];null!=u&&(a=this.getItemAsset(u.atlas)),o.seek(0,1);for(var d=null,_=o.readInt(),p=0;p<_;p++){var f=o.readShort();f+=o.position,d={},i[o.readUshort()]=d;var g=new cc.Rect;d.rect=g;var m=o.readS();if(g.x=o.readInt(),g.y=o.readInt(),d.xOffset=o.readInt(),d.yOffset=o.readInt(),g.width=o.readInt(),g.height=o.readInt(),d.xAdvance=o.readInt(),d.channel=o.readByte(),1==d.channel?d.channel=3:2==d.channel?d.channel=2:3==d.channel&&(d.channel=1),n)g.x+=u.rect.x,g.y+=u.rect.y;else{var v=this._sprites[m];v&&(g.set(v.rect),d.xOffset+=v.offset.x,d.yOffset+=v.offset.y,0==h&&(h=v.originalSize.height),a||(v.atlas.load(),a=v.atlas.asset)),0==d.xAdvance&&(d.xAdvance=0==l?d.xOffset+d.rect.width:l)}o.position=f}e.fontSize=h,e._fntConfig.fontSize=h,e._fntConfig.commonHeight=0==c?h:c,e._fntConfig.resizable=r,e._fntConfig.canTint=s;var y=new cc.SpriteFrame;y.setTexture(a),e.spriteFrame=y,e.onLoad()},e._constructing=0,e._instById={},e._instByName={},e._branch="",e._vars={},e}();t.UIPackage=e;var i=function(){return function(){this.rect=new cc.Rect,this.offset=new cc.Vec2(0,0),this.originalSize=new cc.Size(0,0)}}()}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._requestingCmd=0,i._uiSources=new Array,i.bringToFontOnClick=t.UIConfig.bringWindowToFrontOnClick,i._node.on(t.Event.TOUCH_BEGIN,i.onTouchBegin_1,i,!0),i}return __extends(i,e),i.prototype.addUISource=function(t){this._uiSources.push(t)},Object.defineProperty(i.prototype,"contentPane",{get:function(){return this._contentPane},set:function(e){this._contentPane!=e&&(null!=this._contentPane&&this.removeChild(this._contentPane),this._contentPane=e,null!=this._contentPane&&(this.addChild(this._contentPane),this.setSize(this._contentPane.width,this._contentPane.height),this._contentPane.addRelation(this,t.RelationType.Size),this._frame=this._contentPane.getChild("frame"),null!=this._frame&&(this.closeButton=this._frame.getChild("closeButton"),this.dragArea=this._frame.getChild("dragArea"),this.contentArea=this._frame.getChild("contentArea"))))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"closeButton",{get:function(){return this._closeButton},set:function(t){null!=this._closeButton&&this._closeButton.offClick(this.closeEventHandler,this),this._closeButton=t,null!=this._closeButton&&this._closeButton.onClick(this.closeEventHandler,this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dragArea",{get:function(){return this._dragArea},set:function(e){this._dragArea!=e&&(null!=this._dragArea&&(this._dragArea.draggable=!1,this._dragArea.off(t.Event.DRAG_START,this.onDragStart_1,this)),this._dragArea=e,null!=this._dragArea&&(this._dragArea.draggable=!0,this._dragArea.on(t.Event.DRAG_START,this.onDragStart_1,this)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contentArea",{get:function(){return this._contentArea},set:function(t){this._contentArea=t},enumerable:!0,configurable:!0}),i.prototype.show=function(){t.GRoot.inst.showWindow(this)},i.prototype.showOn=function(t){t.showWindow(this)},i.prototype.hide=function(){this.isShowing&&this.doHideAnimation()},i.prototype.hideImmediately=function(){var e=this.parent instanceof t.GRoot?this.parent:null;e||(e=t.GRoot.inst),e.hideWindowImmediately(this)},i.prototype.centerOn=function(e,i){this.setPosition(Math.round((e.width-this.width)/2),Math.round((e.height-this.height)/2)),i&&(this.addRelation(e,t.RelationType.Center_Center),this.addRelation(e,t.RelationType.Middle_Middle))},i.prototype.toggleStatus=function(){this.isTop?this.hide():this.show()},Object.defineProperty(i.prototype,"isShowing",{get:function(){return null!=this.parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isTop",{get:function(){return null!=this.parent&&this.parent.getChildIndex(this)==this.parent.numChildren-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"modal",{get:function(){return this._modal},set:function(t){this._modal=t},enumerable:!0,configurable:!0}),i.prototype.bringToFront=function(){this.root.bringToFront(this)},i.prototype.showModalWait=function(e){void 0!=e&&(this._requestingCmd=e),t.UIConfig.windowModalWaiting&&(this._modalWaitPane||(this._modalWaitPane=t.UIPackage.createObjectFromURL(t.UIConfig.windowModalWaiting)),this.layoutModalWaitPane(),this.addChild(this._modalWaitPane))},i.prototype.layoutModalWaitPane=function(){if(null!=this._contentArea){var t=this._frame.localToGlobal();t=this.globalToLocal(t.x,t.y,t),this._modalWaitPane.setPosition(t.x+this._contentArea.x,t.y+this._contentArea.y),this._modalWaitPane.setSize(this._contentArea.width,this._contentArea.height)}else this._modalWaitPane.setSize(this.width,this.height)},i.prototype.closeModalWait=function(t){return void 0===t&&(t=0),(0==t||this._requestingCmd==t)&&(this._requestingCmd=0,this._modalWaitPane&&null!=this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane),!0)},Object.defineProperty(i.prototype,"modalWaiting",{get:function(){return this._modalWaitPane&&null!=this._modalWaitPane.parent},enumerable:!0,configurable:!0}),i.prototype.init=function(){if(!this._inited&&!this._loading)if(this._uiSources.length>0){this._loading=!1;for(var t=this._uiSources.length,e=0;e<t;e++){var i=this._uiSources[e];i.loaded||(i.load(this.__uiLoadComplete,this),this._loading=!0)}this._loading||this._init()}else this._init()},i.prototype.onInit=function(){},i.prototype.onShown=function(){},i.prototype.onHide=function(){},i.prototype.doShowAnimation=function(){this.onShown()},i.prototype.doHideAnimation=function(){this.hideImmediately()},i.prototype.__uiLoadComplete=function(){for(var t=this._uiSources.length,e=0;e<t;e++){if(!this._uiSources[e].loaded)return}this._loading=!1,this._init()},i.prototype._init=function(){this._inited=!0,this.onInit(),this.isShowing&&this.doShowAnimation()},i.prototype.dispose=function(){null!=this.parent&&this.hideImmediately(),e.prototype.dispose.call(this)},i.prototype.closeEventHandler=function(t){this.hide()},i.prototype.onEnable=function(){e.prototype.onEnable.call(this),this._inited?this.doShowAnimation():this.init()},i.prototype.onDisable=function(){e.prototype.onDisable.call(this),this.closeModalWait(),this.onHide()},i.prototype.onTouchBegin_1=function(t){this.isShowing&&this.bringToFontOnClick&&this.bringToFront()},i.prototype.onDragStart_1=function(e){t.GObject.cast(e.currentTarget).stopDrag(),this.startDrag(e.touchId)},i}(t.GComponent);t.Window=e}(fgui||(fgui={})),function(t){var e=function(){function e(){}return e.createAction=function(e){switch(e){case 0:return new t.PlayTransitionAction;case 1:return new t.ChangePageAction}return null},e.prototype.run=function(t,e,i){null!=this.fromPage&&0!=this.fromPage.length&&-1==this.fromPage.indexOf(e)||null!=this.toPage&&0!=this.toPage.length&&-1==this.toPage.indexOf(i)?this.leave(t):this.enter(t)},e.prototype.enter=function(t){},e.prototype.leave=function(t){},e.prototype.setup=function(t){var e,i;for(e=t.readShort(),this.fromPage=[],i=0;i<e;i++)this.fromPage[i]=t.readS();for(e=t.readShort(),this.toPage=[],i=0;i<e;i++)this.toPage[i]=t.readS()},e}();t.ControllerAction=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.enter=function(e){if(this.controllerName){var i;if(this.objectId){var o=e.parent.getChildById(this.objectId);if(!(o instanceof t.GComponent))return;i=o}else i=e.parent;if(i){var n=i.getController(this.controllerName);n&&n!=e&&!n.changing&&("~1"==this.targetPage?e.selectedIndex<n.pageCount&&(n.selectedIndex=e.selectedIndex):"~2"==this.targetPage?n.selectedPage=e.selectedPage:n.selectedPageId=this.targetPage)}}},i.prototype.setup=function(t){e.prototype.setup.call(this,t),this.objectId=t.readS(),this.controllerName=t.readS(),this.targetPage=t.readS()},i}(t.ControllerAction);t.ChangePageAction=e}(fgui||(fgui={})),function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.playTimes=1,e.delay=0,e.stopOnExit=!1,e}return __extends(e,t),e.prototype.enter=function(t){var e=t.parent.getTransition(this.transitionName);e&&(this._currentTransition&&this._currentTransition.playing?e.changePlayTimes(this.playTimes):e.play(null,this.playTimes,this.delay),this._currentTransition=e)},e.prototype.leave=function(t){this.stopOnExit&&this._currentTransition&&(this._currentTransition.stop(),this._currentTransition=null)},e.prototype.setup=function(e){t.prototype.setup.call(this,e),this.transitionName=e.readS(),this.playTimes=e.readInt(),this.delay=e.readFloat(),this.stopOnExit=e.readBool()},e}(t.ControllerAction);t.PlayTransitionAction=e}(fgui||(fgui={})),function(t){(function(t){t[t.Normal=0]="Normal",t[t.None=1]="None",t[t.Add=2]="Add",t[t.Multiply=3]="Multiply",t[t.Screen=4]="Screen",t[t.Erase=5]="Erase",t[t.Mask=6]="Mask",t[t.Below=7]="Below",t[t.Off=8]="Off",t[t.Custom1=9]="Custom1",t[t.Custom2=10]="Custom2",t[t.Custom3=11]="Custom3"})(t.BlendMode||(t.BlendMode={}));var e=function(){function t(){}return t.apply=function(e,i){var o=t.factors[i];e.getComponentsInChildren(cc.RenderComponent).forEach(function(t){t.srcBlendFactor=o[0],t.dstBlendFactor=o[1]})},t.override=function(e,i,o){t.factors[e][0]=i,t.factors[e][1]=o},t.factors=[[cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA],[cc.macro.ONE,cc.macro.ONE],[cc.macro.SRC_ALPHA,cc.macro.ONE],[cc.macro.DST_COLOR,cc.macro.ONE_MINUS_SRC_ALPHA],[cc.macro.ONE,cc.macro.ONE_MINUS_SRC_COLOR],[cc.macro.ZERO,cc.macro.ONE_MINUS_SRC_ALPHA],[cc.macro.ZERO,cc.macro.SRC_ALPHA],[cc.macro.ONE_MINUS_DST_ALPHA,cc.macro.DST_ALPHA],[cc.macro.ONE,cc.macro.ZERO],[cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA],[cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA],[cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA]],t}();t.BlendModeUtils=e}(fgui||(fgui={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._flip=t.FlipType.None,i._fillMethod=t.FillMethod.None,i._fillOrigin=t.FillOrigin.Left,i._fillAmount=0,i._fillClockwise=!1,i._grayed=!1,i}return __extends(i,e),i.prototype.onLoad=function(){this.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.trim=!1},Object.defineProperty(i.prototype,"flip",{get:function(){return this._flip},set:function(e){if(this._flip!=e){this._flip=e;var i=1,o=1;this._flip!=t.FlipType.Horizontal&&this._flip!=t.FlipType.Both||(i=-1),this._flip!=t.FlipType.Vertical&&this._flip!=t.FlipType.Both||(o=-1),1==i&&1==o||this.node.setAnchorPoint(.5,.5),this.node.setScale(i,o)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillMethod",{get:function(){return this._fillMethod},set:function(t){this._fillMethod!=t&&(this._fillMethod=t,0!=this._fillMethod?(this.type=cc.Sprite.Type.FILLED,this._fillMethod<=3?this.fillType=this._fillMethod-1:this.fillType=cc.Sprite.FillType.RADIAL,this.fillCenter=new cc.Vec2(.5,.5),this.setupFill()):this.type=cc.Sprite.Type.SIMPLE)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillOrigin",{get:function(){return this._fillOrigin},set:function(t){this._fillOrigin!=t&&(this._fillOrigin=t,0!=this._fillMethod&&this.setupFill())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillClockwise",{get:function(){return this._fillClockwise},set:function(t){this._fillClockwise!=t&&(this._fillClockwise=t,0!=this._fillMethod&&this.setupFill())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillAmount",{get:function(){return this._fillAmount},set:function(t){this._fillAmount!=t&&(this._fillAmount=t,0!=this._fillMethod&&(this._fillClockwise?this.fillRange=-this._fillAmount:this.fillRange=this._fillAmount))},enumerable:!0,configurable:!0}),i.prototype.setupFill=function(){if(this._fillMethod==t.FillMethod.Horizontal||this._fillMethod==t.FillMethod.Vertical)this._fillClockwise=this._fillOrigin==t.FillOrigin.Right||this._fillOrigin==t.FillOrigin.Bottom,this.fillStart=this._fillClockwise?1:0;else switch(this._fillOrigin){case t.FillOrigin.Right:this.fillOrigin=0;break;case t.FillOrigin.Top:this.fillStart=.25;break;case t.FillOrigin.Left:this.fillStart=.5;break;case t.FillOrigin.Bottom:this.fillStart=.75}},Object.defineProperty(i.prototype,"grayed",{get:function(){return this._grayed},set:function(t){var e;this._grayed!=t&&(this._grayed=t,t?((e=this._graySpriteMaterial)||(e=cc.Material.getBuiltinMaterial("2d-gray-sprite")),e=this._graySpriteMaterial=cc.MaterialVariant.create(e,this)):((e=this._spriteMaterial)||(e=cc.Material.getBuiltinMaterial("2d-sprite",this)),e=this._spriteMaterial=cc.MaterialVariant.create(e,this)),this.setMaterial(0,e))},enumerable:!0,configurable:!0}),i}(cc.Sprite);t.Image=e}(fgui||(fgui={})),function(t){var e=function(){return function(){this.addDelay=0,this.rect=new cc.Rect}}();t.Frame=e;var i=function(t){function e(){var e=t.call(this)||this;return e.interval=0,e.repeatDelay=0,e.timeScale=1,e._playing=!0,e._frameCount=0,e._frame=0,e._start=0,e._end=0,e._times=0,e._endAt=0,e._status=0,e._smoothing=!0,e._frameElapsed=0,e._reversed=!1,e._repeatedCount=0,e.setPlaySettings(),e}return __extends(e,t),Object.defineProperty(e.prototype,"frames",{get:function(){return this._frames},set:function(t){this._frames=t,null!=this._frames?(this._frameCount=this._frames.length,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),(-1==this._endAt||this._endAt>this._frameCount-1)&&(this._endAt=this._frameCount-1),(this._frame<0||this._frame>this._frameCount-1)&&(this._frame=this._frameCount-1),this.type=cc.Sprite.Type.SIMPLE,this.drawFrame(),this._frameElapsed=0,this._repeatedCount=0,this._reversed=!1):this._frameCount=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameCount",{get:function(){return this._frameCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame!=t&&(null!=this._frames&&t>=this._frameCount&&(t=this._frameCount-1),this._frame=t,this._frameElapsed=0,this.drawFrame())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},set:function(t){this._playing!=t&&(this._playing=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smoothing",{get:function(){return this._smoothing},set:function(t){this._smoothing=t},enumerable:!0,configurable:!0}),e.prototype.rewind=function(){this._frame=0,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0,this.drawFrame()},e.prototype.syncStatus=function(t){this._frame=t._frame,this._frameElapsed=t._frameElapsed,this._reversed=t._reversed,this._repeatedCount=t._repeatedCount,this.drawFrame()},e.prototype.advance=function(t){for(var e=this._frame,i=this._reversed,o=t;;){var n=this.interval+this._frames[this._frame].addDelay;if(0==this._frame&&this._repeatedCount>0&&(n+=this.repeatDelay),t<n){this._frameElapsed=0;break}if(t-=n,this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),this._frame==e&&this._reversed==i){var s=o-t;t-=Math.floor(t/s)*s}}this.drawFrame()},e.prototype.setPlaySettings=function(t,e,i,o,n,s){void 0==t&&(t=0),void 0==e&&(e=-1),void 0==i&&(i=0),void 0==o&&(o=-1),this._start=t,this._end=e,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),this._times=i,this._endAt=o,-1==this._endAt&&(this._endAt=this._end),this._status=0,this._callback=n,this._callbackObj=s,this.frame=t},e.prototype.update=function(t){if(this._playing&&0!=this._frameCount&&3!=this._status){1!=this.timeScale&&(t*=this.timeScale),this._frameElapsed+=t;var e=this.interval+this._frames[this._frame].addDelay;if(0==this._frame&&this._repeatedCount>0&&(e+=this.repeatDelay),!(this._frameElapsed<e)){if(this._frameElapsed-=e,this._frameElapsed>this.interval&&(this._frameElapsed=this.interval),this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),1==this._status)this._frame=this._start,this._frameElapsed=0,this._status=0;else if(2==this._status){if(this._frame=this._endAt,this._frameElapsed=0,this._status=3,null!=this._callback){var i=this._callback,o=this._callbackObj;this._callback=null,this._callbackObj=null,i.call(o)}}else this._frame==this._end&&(this._times>0?(this._times--,0==this._times?this._status=2:this._status=1):0!=this._start&&(this._status=1));this.drawFrame()}}},e.prototype.drawFrame=function(){if(this._frameCount>0&&this._frame<this._frames.length){var t=this._frames[this._frame];this.spriteFrame=t.texture}},e}(t.Image);t.MovieClip=i}(fgui||(fgui={})),function(t){var e=function(e){function i(t,i){var o=e.call(this,t,i)||this;return o.pos=new cc.Vec2,o.touchId=0,o.clickCount=0,o.button=0,o.keyModifiers=0,o.mouseWheelDelta=0,o}return __extends(i,e),Object.defineProperty(i.prototype,"isShiftDown",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCtrlDown",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.captureTouch=function(){var e=t.GObject.cast(this.currentTarget);e&&this._processor.addTouchMonitor(this.touchId,e)},i._borrow=function(t,e){var o;return i._eventPool.length?((o=i._eventPool.pop()).type=t,o.bubbles=e):o=new i(t,e),o},i._return=function(t){t.initiator=null,t.touch=null,t.unuse(),i._eventPool.push(t)},i.TOUCH_BEGIN="fui_touch_begin",i.TOUCH_MOVE="fui_touch_move",i.TOUCH_END="fui_touch_end",i.CLICK="fui_click",i.ROLL_OVER="fui_roll_over",i.ROLL_OUT="fui_roll_out",i.MOUSE_WHEEL="fui_mouse_wheel",i.DISPLAY="fui_display",i.UNDISPLAY="fui_undisplay",i.GEAR_STOP="fui_gear_stop",i.LINK="fui_text_link",i.Submit="editing-return",i.TEXT_CHANGE="text-changed",i.STATUS_CHANGED="fui_status_changed",i.XY_CHANGED="fui_xy_changed",i.SIZE_CHANGED="fui_size_changed",i.SIZE_DELAY_CHANGE="fui_size_delay_change",i.DRAG_START="fui_drag_start",i.DRAG_MOVE="fui_drag_move",i.DRAG_END="fui_drag_end",i.DROP="fui_drop",i.SCROLL="fui_scroll",i.SCROLL_END="fui_scroll_end",i.PULL_DOWN_RELEASE="fui_pull_down_release",i.PULL_UP_RELEASE="fui_pull_up_release",i.CLICK_ITEM="fui_click_item",i._eventPool=new Array,i}(cc.Event);t.Event=e}(fgui||(fgui={})),function(t){var e=function(){function t(t,e,i){this._data=t,this.offsetX=void 0==e?0:e,this.offsetY=void 0==i?0:i,this.scaleX=1,this.scaleY=1}return t.prototype.hitTest=function(t,e,i){if(e=Math.floor((e/this.scaleX-this.offsetX)*this._data.scale),i=Math.floor((i/this.scaleY-this.offsetY)*this._data.scale),e<0||i<0||e>=this._data.pixelWidth)return!1;var o=i*this._data.pixelWidth+e,n=Math.floor(o/8),s=o%8;return n>=0&&n<this._data.pixels.length&&1==(this._data.pixels[n]>>s&1)},t}();t.PixelHitTest=e;var i=function(){return function(t){t.readInt(),this.pixelWidth=t.readInt(),this.scale=1/t.readByte(),this.pixels=t.readBuffer().data}}();t.PixelHitTestData=i;var o=function(){function t(t,e){this._child=t,this._reversed=e}return t.prototype.hitTest=function(t,e,i){return!1},t}();t.ChildHitArea=o}(fgui||(fgui={})),function(t){var e=function(e){function o(){var t=e.call(this)||this;return t._touches=new Array,t._rollOutChain=new Array,t._rollOverChain=new Array,t._touchPos=new cc.Vec2,t}return __extends(o,e),o.prototype.onLoad=function(){this._owner=this.node.$gobj},o.prototype.onEnable=function(){var t=this.node;t.on(cc.Node.EventType.TOUCH_START,this.touchBeginHandler,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.touchMoveHandler,this),t.on(cc.Node.EventType.TOUCH_END,this.touchEndHandler,this),t.on(cc.Node.EventType.TOUCH_CANCEL,this.touchCancelHandler,this),t.on(cc.Node.EventType.MOUSE_DOWN,this.mouseDownHandler,this),t.on(cc.Node.EventType.MOUSE_MOVE,this.mouseMoveHandler,this),t.on(cc.Node.EventType.MOUSE_UP,this.mouseUpHandler,this),t.on(cc.Node.EventType.MOUSE_WHEEL,this.mouseWheelHandler,this),this._touchListener=this.node._touchListener},o.prototype.onDisable=function(){var t=this.node;t.off(cc.Node.EventType.TOUCH_START,this.touchBeginHandler,this),t.off(cc.Node.EventType.TOUCH_MOVE,this.touchMoveHandler,this),t.off(cc.Node.EventType.TOUCH_END,this.touchEndHandler,this),t.off(cc.Node.EventType.TOUCH_CANCEL,this.touchCancelHandler,this),t.off(cc.Node.EventType.MOUSE_DOWN,this.mouseDownHandler,this),t.off(cc.Node.EventType.MOUSE_MOVE,this.mouseMoveHandler,this),t.off(cc.Node.EventType.MOUSE_UP,this.mouseUpHandler,this),t.off(cc.Node.EventType.MOUSE_WHEEL,this.mouseWheelHandler,this),this._touchListener=null},o.prototype.getAllTouches=function(t){t=t||new Array;for(var e=this._touches.length,i=0;i<e;i++){var o=this._touches[i];-1!=o.touchId&&t.push(o.touchId)}return t},o.prototype.getTouchPosition=function(t){void 0===t&&(t=-1);for(var e=this._touches.length,i=0;i<e;i++){var o=this._touches[i];if(-1!=o.touchId&&(-1==t||o.touchId==t))return o.pos}return cc.Vec2.ZERO},o.prototype.getTouchTarget=function(){for(var t=this._touches.length,e=0;e<t;e++){var i=this._touches[e];if(-1!=i.touchId)return i.target}return null},o.prototype.addTouchMonitor=function(t,e){var i=this.getInfo(t,!1);i&&(-1==i.touchMonitors.indexOf(e)&&i.touchMonitors.push(e))},o.prototype.removeTouchMonitor=function(t){for(var e=this._touches.length,i=0;i<e;i++){var o=this._touches[i],n=o.touchMonitors.indexOf(t);-1!=n&&o.touchMonitors.splice(n,1)}},o.prototype.cancelClick=function(t){var e=this.getInfo(t,!1);e&&(e.clickCancelled=!0)},o.prototype.simulateClick=function(e){var i;(i=t.Event._borrow(t.Event.TOUCH_BEGIN,!0)).initiator=e,i.pos.set(e.localToGlobal()),i.touchId=0,i.clickCount=1,i.button=0,i._processor=this,this._captureCallback&&this._captureCallback.call(this._owner,i),e.node.dispatchEvent(i),i.unuse(),i.type=t.Event.TOUCH_END,i.bubbles=!0,e.node.dispatchEvent(i),i.unuse(),i.type=t.Event.CLICK,i.bubbles=!0,e.node.dispatchEvent(i),t.Event._return(i)},o.prototype.touchBeginHandler=function(e,i){var o=this.updateInfo(e.getID(),e.getLocation(),e);this._touchListener.setSwallowTouches(o.target!=this._owner),this.setBegin(o);var n=this.getEvent(o,o.target,t.Event.TOUCH_BEGIN,!0);return this._captureCallback&&this._captureCallback.call(this._owner,n),o.target.node.dispatchEvent(n),this.handleRollOver(o,o.target),!0},o.prototype.touchMoveHandler=function(e,i){var o=this.updateInfo(e.getID(),e.getLocation(),e);if(this.handleRollOver(o,o.target),o.began){for(var n=this.getEvent(o,o.target,t.Event.TOUCH_MOVE,!1),s=!1,r=o.touchMonitors.length,a=0;a<r;a++){var h=o.touchMonitors[a];null!=h.node&&h.node.activeInHierarchy&&(n.unuse(),n.type=t.Event.TOUCH_MOVE,h.node.dispatchEvent(n),h==this._owner&&(s=!0))}s||null==this.node||(n.unuse(),n.type=t.Event.TOUCH_MOVE,this.node.dispatchEvent(n)),t.Event._return(n)}},o.prototype.touchEndHandler=function(e,i){var o=this.updateInfo(e.getID(),e.getLocation(),e);this.setEnd(o);for(var n=this.getEvent(o,o.target,t.Event.TOUCH_END,!1),s=o.touchMonitors.length,r=0;r<s;r++){var a=o.touchMonitors[r];a==o.target||null==a.node||!a.node.activeInHierarchy||a instanceof t.GComponent&&a.isAncestorOf(o.target)||(n.unuse(),n.type=t.Event.TOUCH_END,a.node.dispatchEvent(n))}o.touchMonitors.length=0,o.target&&null!=o.target.node&&(o.target instanceof t.GRichTextField&&o.target.node.getComponent(cc.RichText)._onTouchEnded(n),n.unuse(),n.type=t.Event.TOUCH_END,n.bubbles=!0,o.target.node.dispatchEvent(n)),t.Event._return(n),o.target=this.clickTest(o),o.target&&(n=this.getEvent(o,o.target,t.Event.CLICK,!0),o.target.node.dispatchEvent(n),t.Event._return(n)),cc.sys.isMobile?this.handleRollOver(o,null):this.handleRollOver(o,o.target),o.target=null,o.touchId=-1,o.button=-1},o.prototype.touchCancelHandler=function(e,i){for(var o=this.updateInfo(e.getID(),e.getLocation(),e),n=this.getEvent(o,o.target,t.Event.TOUCH_END,!1),s=o.touchMonitors.length,r=0;r<s;r++){var a=o.touchMonitors[r];a==o.target||null==a.node||!a.node.activeInHierarchy||a instanceof t.GComponent&&a.isAncestorOf(o.target)||(n.initiator=a,a.node.dispatchEvent(n))}o.touchMonitors.length=0,o.target&&null!=o.target.node&&(n.bubbles=!0,o.target.node.dispatchEvent(n)),t.Event._return(n),this.handleRollOver(o,null),o.target=null,o.touchId=-1,o.button=-1},o.prototype.mouseDownHandler=function(t){this.getInfo(0,!0).button=t.getButton()},o.prototype.mouseUpHandler=function(t){this.getInfo(0,!0).button=t.getButton()},o.prototype.mouseMoveHandler=function(e){var i=this.getInfo(0,!1);if(!(i&&Math.abs(i.pos.x-e.getLocationX())<1&&Math.abs(i.pos.y-(t.GRoot.inst.height-e.getLocationY()))<1)&&(i=this.updateInfo(0,e.getLocation()),this.handleRollOver(i,i.target),i.began)){for(var o=this.getEvent(i,i.target,t.Event.TOUCH_MOVE,!1),n=!1,s=i.touchMonitors.length,r=0;r<s;r++){var a=i.touchMonitors[r];null!=a.node&&a.node.activeInHierarchy&&(o.initiator=a,a.node.dispatchEvent(o),a==this._owner&&(n=!0))}n||null==this.node||(o.initiator=this._owner,this.node.dispatchEvent(o),t.Event._return(o)),t.Event._return(o)}},o.prototype.mouseWheelHandler=function(e){var i=this.updateInfo(0,e.getLocation());i.mouseWheelDelta=Math.max(e.getScrollX(),e.getScrollY());var o=this.getEvent(i,i.target,t.Event.MOUSE_WHEEL,!0);i.target.node.dispatchEvent(o),t.Event._return(o)},o.prototype.updateInfo=function(e,i,o){var n=cc.Camera.findCamera(this.node);n?n.getScreenToWorldPoint(i,this._touchPos):this._touchPos.set(i);var s=this._owner.hitTest(this._touchPos);s||(s=this._owner);var r=this.getInfo(e);return r.target=s,r.pos.x=i.x,r.pos.y=t.GRoot.inst.height-i.y,r.button=cc.Event.EventMouse.BUTTON_LEFT,r.touch=o,r},o.prototype.getInfo=function(t,e){void 0===e&&(e=!0);for(var o=null,n=this._touches.length,s=0;s<n;s++){var r=this._touches[s];if(r.touchId==t)return r;-1==r.touchId&&(o=r)}if(!o){if(!e)return null;o=new i,this._touches.push(o)}return o.touchId=t,o},o.prototype.setBegin=function(t){t.began=!0,t.clickCancelled=!1,t.downPos.set(t.pos),t.downTargets.length=0;for(var e=t.target;null!=e;)t.downTargets.push(e),e=e.findParent()},o.prototype.setEnd=function(e){e.began=!1;var i=t.ToolSet.getTime();i-e.lastClickTime<.45?2==e.clickCount?e.clickCount=1:e.clickCount++:e.clickCount=1,e.lastClickTime=i},o.prototype.clickTest=function(t){if(0==t.downTargets.length||t.clickCancelled||Math.abs(t.pos.x-t.downPos.x)>50||Math.abs(t.pos.y-t.downPos.y)>50)return null;var e=t.downTargets[0];if(e&&null!=e.node&&e.node.activeInHierarchy)return e;for(e=t.target;null!=e;){if(-1!=t.downTargets.indexOf(e)&&null!=e.node&&e.node.activeInHierarchy)break;e=e.findParent()}return e},o.prototype.handleRollOver=function(e,i){if(e.lastRollOver!=i){for(var o=e.lastRollOver;null!=o&&null!=o.node;)this._rollOutChain.push(o),o=o.findParent();for(o=i;null!=o&&null!=o.node;){if(-1!=(s=this._rollOutChain.indexOf(o))){this._rollOutChain.length=s;break}this._rollOverChain.push(o),o=o.findParent()}e.lastRollOver=i;for(var n=this._rollOutChain.length,s=0;s<n;s++)if(null!=(o=this._rollOutChain[s]).node&&o.node.activeInHierarchy){var r=this.getEvent(e,o,t.Event.ROLL_OUT,!1);o.node.dispatchEvent(r),t.Event._return(r)}n=this._rollOverChain.length;for(s=0;s<n;s++)if(null!=(o=this._rollOverChain[s]).node&&o.node.activeInHierarchy){r=this.getEvent(e,o,t.Event.ROLL_OVER,!1);o.node.dispatchEvent(r),t.Event._return(r)}this._rollOutChain.length=0,this._rollOverChain.length=0}},o.prototype.getEvent=function(e,i,o,n){var s=t.Event._borrow(o,n);return s.initiator=i,s.touch=e.touch,s.pos.set(e.pos),s.touchId=e.touch?e.touch.getID():0,s.clickCount=e.clickCount,s.button=e.button,s.mouseWheelDelta=e.mouseWheelDelta,s._processor=this,s},o}(cc.Component);t.InputProcessor=e;var i=function(){return function(){this.pos=new cc.Vec2,this.touchId=0,this.clickCount=0,this.mouseWheelDelta=0,this.button=-1,this.downPos=new cc.Vec2,this.began=!1,this.clickCancelled=!1,this.lastClickTime=0,this.downTargets=new Array,this.touchMonitors=new Array}}()}(fgui||(fgui={})),function(t){var e=function(){function e(t){this._owner=t}return e.create=function(i,o){return e.Classes||(e.Classes=[t.GearDisplay,t.GearXY,t.GearSize,t.GearLook,t.GearColor,t.GearAnimation,t.GearText,t.GearIcon,t.GearDisplay2,t.GearFontSize]),new e.Classes[o](i)},e.prototype.dispose=function(){null!=this._tweenConfig&&null!=this._tweenConfig._tweener&&(this._tweenConfig._tweener.kill(),this._tweenConfig._tweener=null)},Object.defineProperty(e.prototype,"controller",{get:function(){return this._controller},set:function(t){t!=this._controller&&(this._controller=t,this._controller&&this.init())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tweenConfig",{get:function(){return null==this._tweenConfig&&(this._tweenConfig=new i),this._tweenConfig},enumerable:!0,configurable:!0}),e.prototype.setup=function(e){var o,n;this._controller=this._owner.parent.getControllerAt(e.readShort()),this.init();var s=e.readShort();if(this instanceof t.GearDisplay)this.pages=e.readSArray(s);else if(this instanceof t.GearDisplay2)this.pages=e.readSArray(s);else{for(o=0;o<s;o++)null!=(n=e.readS())&&this.addStatus(n,e);e.readBool()&&this.addStatus(null,e)}if(e.readBool()&&(this._tweenConfig=new i,this._tweenConfig.easeType=e.readByte(),this._tweenConfig.duration=e.readFloat(),this._tweenConfig.delay=e.readFloat()),e.version>=2)if(this instanceof t.GearXY){if(e.readBool()){for(this.positionsInPercent=!0,o=0;o<s;o++)null!=(n=e.readS())&&this.addExtStatus(n,e);e.readBool()&&this.addExtStatus(null,e)}}else this instanceof t.GearDisplay2&&(this.condition=e.readByte())},e.prototype.updateFromRelations=function(t,e){},e.prototype.addStatus=function(t,e){},e.prototype.init=function(){},e.prototype.apply=function(){},e.prototype.updateState=function(){},e.disableAllTweenEffect=!1,e}();t.GearBase=e;var i=function(){return function(){this.tween=!0,this.easeType=t.EaseType.QuadOut,this.duration=.3,this.delay=0}}();t.GearTweenConfig=i}(fgui||(fgui={})),function(t){var e=function(e){function o(t){return e.call(this,t)||this}return __extends(o,e),o.prototype.init=function(){this._default=new i(this._owner.getProp(t.ObjectPropID.Playing),this._owner.getProp(t.ObjectPropID.Frame)),this._storage={}},o.prototype.addStatus=function(t,e){var o;null==t?o=this._default:(o=new i,this._storage[t]=o),o.playing=e.readBool(),o.frame=e.readInt()},o.prototype.apply=function(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId];e||(e=this._default),this._owner.setProp(t.ObjectPropID.Playing,e.playing),this._owner.setProp(t.ObjectPropID.Frame,e.frame),this._owner._gearLocked=!1},o.prototype.updateState=function(){var e=this._storage[this._controller.selectedPageId];e||(e=new i,this._storage[this._controller.selectedPageId]=e),e.playing=this._owner.getProp(t.ObjectPropID.Playing),e.frame=this._owner.getProp(t.ObjectPropID.Frame)},o}(t.GearBase);t.GearAnimation=e;var i=function(){return function(t,e){void 0===t&&(t=!0),void 0===e&&(e=0),this.playing=t,this.frame=e}}()}(fgui||(fgui={})),function(t){var e=function(e){function o(t){return e.call(this,t)||this}return __extends(o,e),o.prototype.init=function(){this._default=new i(this._owner.getProp(t.ObjectPropID.Color),this._owner.getProp(t.ObjectPropID.OutlineColor)),this._storage={}},o.prototype.addStatus=function(t,e){var o;null==t?o=this._default:(o=new i,this._storage[t]=o),o.color=e.readColor(),o.strokeColor=e.readColor()},o.prototype.apply=function(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId];e||(e=this._default),this._owner.setProp(t.ObjectPropID.Color,e.color),null!=e.strokeColor&&this._owner.setProp(t.ObjectPropID.OutlineColor,e.strokeColor),this._owner._gearLocked=!1},o.prototype.updateState=function(){var e=this._storage[this._controller.selectedPageId];e||(this._storage[this._controller.selectedPageId]=e=new i),e.color=this._owner.getProp(t.ObjectPropID.Color),e.strokeColor=this._owner.getProp(t.ObjectPropID.OutlineColor)},o}(t.GearBase);t.GearColor=e;var i=function(){return function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.color=t,this.strokeColor=e}}()}(fgui||(fgui={})),function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._displayLockToken=1,i._visible=0,i}return __extends(e,t),e.prototype.init=function(){this.pages=null},e.prototype.apply=function(){this._displayLockToken++,0==this._displayLockToken&&(this._displayLockToken=1),null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0},e.prototype.addLock=function(){return this._visible++,this._displayLockToken},e.prototype.releaseLock=function(t){t==this._displayLockToken&&this._visible--},Object.defineProperty(e.prototype,"connected",{get:function(){return null==this._controller||this._visible>0},enumerable:!0,configurable:!0}),e}(t.GearBase);t.GearDisplay=e}(fgui||(fgui={})),function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._visible=0,i}return __extends(e,t),e.prototype.init=function(){this.pages=null},e.prototype.apply=function(){null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0},e.prototype.evaluate=function(t){var e=null==this._controller||this._visible>0;return e=0==this.condition?e&&t:e||t},e}(t.GearBase);t.GearDisplay2=e}(fgui||(fgui={})),function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._default=0,i}return __extends(i,e),i.prototype.init=function(){this._default=this._owner.getProp(t.ObjectPropID.FontSize),this._storage={}},i.prototype.addStatus=function(t,e){null==t?this._default=e.readInt():this._storage[t]=e.readInt()},i.prototype.apply=function(){this._owner._gearLocked=!0;var e=this._storage[this._controller.selectedPageId];void 0!=e?this._owner.setProp(t.ObjectPropID.FontSize,e):this._owner.setProp(t.ObjectPropID.FontSize,this._default),this._owner._gearLocked=!1},i.prototype.updateState=function(){this._storage[this._controller.selectedPageId]=this._owner.text},i}(t.GearBase);t.GearFontSize=e}(fgui||(fgui={})),function(t){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.init=function(){this._default=this._owner.icon,this._storage={}},e.prototype.addStatus=function(t,e){null==t?this._default=e.readS():this._storage[t]=e.readS()},e.prototype.apply=function(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.icon=void 0!==t?t:this._default,this._owner._gearLocked=!1},e.prototype.updateState=function(){this._storage[this._controller.selectedPageId]=this._owner.icon},e}(t.GearBase);t.GearIcon=e}(fgui||(fgui={})),function(t){var e=function(e){function o(t){return e.call(this,t)||this}return __extends(o,e),o.prototype.init=function(){this._default=new i(this._owner.alpha,this._owner.rotation,this._owner.grayed,this._owner.touchable),this._storage={}},o.prototype.addStatus=function(t,e){var o;null==t?o=this._default:(o=new i,this._storage[t]=o),o.alpha=e.readFloat(),o.rotation=e.readFloat(),o.grayed=e.readBool(),o.touchable=e.readBool()},o.prototype.apply=function(){var e=this._storage[this._controller.selectedPageId];if(e||(e=this._default),this._tweenConfig&&this._tweenConfig.tween&&!t.UIPackage._constructing&&!t.GearBase.disableAllTweenEffect){if(this._owner._gearLocked=!0,this._owner.grayed=e.grayed,this._owner.touchable=e.touchable,this._owner._gearLocked=!1,null!=this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==e.alpha&&this._tweenConfig._tweener.endValue.y==e.rotation)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var i=e.alpha!=this._owner.alpha,o=e.rotation!=this._owner.rotation;(i||o)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=t.GTween.to2(this._owner.alpha,this._owner.rotation,e.alpha,e.rotation,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((i?1:0)+(o?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.grayed=e.grayed,this._owner.touchable=e.touchable,this._owner.alpha=e.alpha,this._owner.rotation=e.rotation,this._owner._gearLocked=!1},o.prototype.__tweenUpdate=function(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&(this._owner.alpha=t.value.x),0!=(2&e)&&(this._owner.rotation=t.value.y),this._owner._gearLocked=!1},o.prototype.__tweenComplete=function(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null},o.prototype.updateState=function(){var t=this._storage[this._controller.selectedPageId];t||(t=new i,this._storage[this._controller.selectedPageId]=t),t.alpha=this._owner.alpha,t.rotation=this._owner.rotation,t.grayed=this._owner.grayed,t.touchable=this._owner.touchable},o}(t.GearBase);t.GearLook=e;var i=function(){return function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=!1),void 0===o&&(o=!0),this.alpha=t,this.rotation=e,this.grayed=i,this.touchable=o}}()}(fgui||(fgui={})),function(t){var e=function(e){function o(t){return e.call(this,t)||this}return __extends(o,e),o.prototype.init=function(){this._default=new i(this._owner.width,this._owner.height,this._owner.scaleX,this._owner.scaleY),this._storage={}},o.prototype.addStatus=function(t,e){var o;null==t?o=this._default:(o=new i,this._storage[t]=o),o.width=e.readInt(),o.height=e.readInt(),o.scaleX=e.readFloat(),o.scaleY=e.readFloat()},o.prototype.apply=function(){var e=this._storage[this._controller.selectedPageId];if(e||(e=this._default),this._tweenConfig&&this._tweenConfig.tween&&!t.UIPackage._constructing&&!t.GearBase.disableAllTweenEffect){if(null!=this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==e.width&&this._tweenConfig._tweener.endValue.y==e.height&&this._tweenConfig._tweener.endValue.z==e.scaleX&&this._tweenConfig._tweener.endValue.w==e.scaleY)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var i=e.width!=this._owner.width||e.height!=this._owner.height,o=e.scaleX!=this._owner.scaleX||e.scaleY!=this._owner.scaleY;(i||o)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=t.GTween.to4(this._owner.width,this._owner.height,this._owner.scaleX,this._owner.scaleY,e.width,e.height,e.scaleX,e.scaleY,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((i?1:0)+(o?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.setSize(e.width,e.height,this._owner.gearXY.controller==this._controller),this._owner.setScale(e.scaleX,e.scaleY),this._owner._gearLocked=!1},o.prototype.__tweenUpdate=function(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&this._owner.setSize(t.value.x,t.value.y,this._owner.checkGearController(1,this._controller)),0!=(2&e)&&this._owner.setScale(t.value.z,t.value.w),this._owner._gearLocked=!1},o.prototype.__tweenComplete=function(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null},o.prototype.updateState=function(){var t=this._storage[this._controller.selectedPageId];t||(t=new i,this._storage[this._controller.selectedPageId]=t),t.width=this._owner.width,t.height=this._owner.height,t.scaleX=this._owner.scaleX,t.scaleY=this._owner.scaleY},o.prototype.updateFromRelations=function(t,e){if(null!=this._controller&&null!=this._storage){for(var i in this._storage){var o=this._storage[i];o.width+=t,o.height+=e}this._default.width+=t,this._default.height+=e,this.updateState()}},o}(t.GearBase);t.GearSize=e;var i=function(){return function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0),this.width=t,this.height=e,this.scaleX=i,this.scaleY=o}}()}(fgui||(fgui={})),function(t){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.init=function(){this._default=this._owner.text,this._storage={}},e.prototype.addStatus=function(t,e){null==t?this._default=e.readS():this._storage[t]=e.readS()},e.prototype.apply=function(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.text=void 0!==t?t:this._default,this._owner._gearLocked=!1},e.prototype.updateState=function(){this._storage[this._controller.selectedPageId]=this._owner.text},e}(t.GearBase);t.GearText=e}(fgui||(fgui={})),function(t){var e=function(e){function i(t){return e.call(this,t)||this}return __extends(i,e),i.prototype.init=function(){this._default={x:this._owner.x,y:this._owner.y,px:this._owner.x/this._owner.parent.width,py:this._owner.y/this._owner.parent.height},this._storage={}},i.prototype.addStatus=function(t,e){var i;null==t?i=this._default:(i={},this._storage[t]=i),i.x=e.readInt(),i.y=e.readInt()},i.prototype.addExtStatus=function(t,e){var i;(i=null==t?this._default:this._storage[t]).px=e.readFloat(),i.py=e.readFloat()},i.prototype.apply=function(){var e,i,o=this._storage[this._controller.selectedPageId];if(o||(o=this._default),this.positionsInPercent&&this._owner.parent?(e=o.px*this._owner.parent.width,i=o.py*this._owner.parent.height):(e=o.x,i=o.y),null==this._tweenConfig||!this._tweenConfig.tween||t.UIPackage._constructing||t.GearBase.disableAllTweenEffect)this._owner._gearLocked=!0,this._owner.setPosition(e,i),this._owner._gearLocked=!1;else{if(null!=this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==e&&this._tweenConfig._tweener.endValue.y==i)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var n=this._owner.x,s=this._owner.y;n==e&&s==i||(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=t.GTween.to2(n,s,e,i,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}},i.prototype.__tweenUpdate=function(t){this._owner._gearLocked=!0,this._owner.setPosition(t.value.x,t.value.y),this._owner._gearLocked=!1},i.prototype.__tweenComplete=function(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null},i.prototype.updateState=function(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.x=this._owner.x,t.y=this._owner.y,t.px=this._owner.x/this._owner.parent.width,t.py=this._owner.y/this._owner.parent.height},i.prototype.updateFromRelations=function(t,e){if(null!=this._controller&&null!=this._storage&&!this.positionsInPercent){for(var i in this._storage){var o=this._storage[i];o.x+=t,o.y+=e}this._default.x+=t,this._default.y+=e,this.updateState()}},i}(t.GearBase);t.GearXY=e}(fgui||(fgui={})),function(t){var e=function(){function e(){}return e.evaluate=function(o,n,s,r,a){switch(o){case t.EaseType.Linear:return n/s;case t.EaseType.SineIn:return 1-Math.cos(n/s*e._PiOver2);case t.EaseType.SineOut:return Math.sin(n/s*e._PiOver2);case t.EaseType.SineInOut:return-.5*(Math.cos(Math.PI*n/s)-1);case t.EaseType.QuadIn:return(n/=s)*n;case t.EaseType.QuadOut:return-(n/=s)*(n-2);case t.EaseType.QuadInOut:return(n/=.5*s)<1?.5*n*n:-.5*(--n*(n-2)-1);case t.EaseType.CubicIn:return(n/=s)*n*n;case t.EaseType.CubicOut:return(n=n/s-1)*n*n+1;case t.EaseType.CubicInOut:return(n/=.5*s)<1?.5*n*n*n:.5*((n-=2)*n*n+2);case t.EaseType.QuartIn:return(n/=s)*n*n*n;case t.EaseType.QuartOut:return-((n=n/s-1)*n*n*n-1);case t.EaseType.QuartInOut:return(n/=.5*s)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2);case t.EaseType.QuintIn:return(n/=s)*n*n*n*n;case t.EaseType.QuintOut:return(n=n/s-1)*n*n*n*n+1;case t.EaseType.QuintInOut:return(n/=.5*s)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2);case t.EaseType.ExpoIn:return 0==n?0:Math.pow(2,10*(n/s-1));case t.EaseType.ExpoOut:return n==s?1:1-Math.pow(2,-10*n/s);case t.EaseType.ExpoInOut:return 0==n?0:n==s?1:(n/=.5*s)<1?.5*Math.pow(2,10*(n-1)):.5*(2-Math.pow(2,-10*--n));case t.EaseType.CircIn:return-(Math.sqrt(1-(n/=s)*n)-1);case t.EaseType.CircOut:return Math.sqrt(1-(n=n/s-1)*n);case t.EaseType.CircInOut:return(n/=.5*s)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1);case t.EaseType.ElasticIn:var h;return 0==n?0:1==(n/=s)?1:(0==a&&(a=.3*s),r<1?(r=1,h=a/4):h=a/e._TwoPi*Math.asin(1/r),-r*Math.pow(2,10*(n-=1))*Math.sin((n*s-h)*e._TwoPi/a));case t.EaseType.ElasticOut:var l;return 0==n?0:1==(n/=s)?1:(0==a&&(a=.3*s),r<1?(r=1,l=a/4):l=a/e._TwoPi*Math.asin(1/r),r*Math.pow(2,-10*n)*Math.sin((n*s-l)*e._TwoPi/a)+1);case t.EaseType.ElasticInOut:var c;return 0==n?0:2==(n/=.5*s)?1:(0==a&&(a=s*(.3*1.5)),r<1?(r=1,c=a/4):c=a/e._TwoPi*Math.asin(1/r),n<1?r*Math.pow(2,10*(n-=1))*Math.sin((n*s-c)*e._TwoPi/a)*-.5:r*Math.pow(2,-10*(n-=1))*Math.sin((n*s-c)*e._TwoPi/a)*.5+1);case t.EaseType.BackIn:return(n/=s)*n*((r+1)*n-r);case t.EaseType.BackOut:return(n=n/s-1)*n*((r+1)*n+r)+1;case t.EaseType.BackInOut:return(n/=.5*s)<1?n*n*((1+(r*=1.525))*n-r)*.5:.5*((n-=2)*n*((1+(r*=1.525))*n+r)+2);case t.EaseType.BounceIn:return i.easeIn(n,s);case t.EaseType.BounceOut:return i.easeOut(n,s);case t.EaseType.BounceInOut:return i.easeInOut(n,s);default:return-(n/=s)*(n-2)}},e._PiOver2=.5*Math.PI,e._TwoPi=2*Math.PI,e}();t.EaseManager=e;var i=function(){function t(){}return t.easeIn=function(e,i){return 1-t.easeOut(i-e,i)},t.easeOut=function(t,e){return(t/=e)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},t.easeInOut=function(e,i){return e<.5*i?.5*t.easeIn(2*e,i):.5*t.easeOut(2*e-i,i)+.5},t}()}(fgui||(fgui={})),function(t){var e=function(){function t(){}return t.Linear=0,t.SineIn=1,t.SineOut=2,t.SineInOut=3,t.QuadIn=4,t.QuadOut=5,t.QuadInOut=6,t.CubicIn=7,t.CubicOut=8,t.CubicInOut=9,t.QuartIn=10,t.QuartOut=11,t.QuartInOut=12,t.QuintIn=13,t.QuintOut=14,t.QuintInOut=15,t.ExpoIn=16,t.ExpoOut=17,t.ExpoInOut=18,t.CircIn=19,t.CircOut=20,t.CircInOut=21,t.ElasticIn=22,t.ElasticOut=23,t.ElasticInOut=24,t.BackIn=25,t.BackOut=26,t.BackInOut=27,t.BounceIn=28,t.BounceOut=29,t.BounceInOut=30,t.Custom=31,t}();t.EaseType=e}(fgui||(fgui={})),function(t){var e=function(){function e(){this._segments=new Array,this._points=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._fullLength},enumerable:!0,configurable:!0}),e.prototype.create2=function(t,e,i,o){var n=new Array;n.push(t),n.push(e),i&&n.push(i),o&&n.push(o),this.create(n)},e.prototype.create=function(o){this._segments.length=0,this._points.length=0,this._fullLength=0;var n=o.length;if(0!=n){var s=e.helperPoints;s.length=0;var r=o[0];r.curveType==t.CurveType.CRSpline&&s.push(new cc.Vec2(r.x,r.y));for(var a=1;a<n;a++){var h=o[a];if(r.curveType!=t.CurveType.CRSpline){var l=new i;l.type=r.curveType,l.ptStart=this._points.length,r.curveType==t.CurveType.Straight?(l.ptCount=2,this._points.push(new cc.Vec2(r.x,r.y)),this._points.push(new cc.Vec2(h.x,h.y))):r.curveType==t.CurveType.Bezier?(l.ptCount=3,this._points.push(new cc.Vec2(r.x,r.y)),this._points.push(new cc.Vec2(h.x,h.y)),this._points.push(new cc.Vec2(r.control1_x,r.control1_y))):r.curveType==t.CurveType.CubicBezier&&(l.ptCount=4,this._points.push(new cc.Vec2(r.x,r.y)),this._points.push(new cc.Vec2(h.x,h.y)),this._points.push(new cc.Vec2(r.control1_x,r.control1_y)),this._points.push(new cc.Vec2(r.control2_x,r.control2_y))),l.length=t.ToolSet.distance(r.x,r.y,h.x,h.y),this._fullLength+=l.length,this._segments.push(l)}h.curveType!=t.CurveType.CRSpline?s.length>0&&(s.push(new cc.Vec2(h.x,h.y)),this.createSplineSegment()):s.push(new cc.Vec2(h.x,h.y)),r=h}s.length>1&&this.createSplineSegment()}},e.prototype.createSplineSegment=function(){var o=e.helperPoints,n=o.length;o.splice(0,0,o[0]),o.push(o[n]),o.push(o[n]),n+=3;var s=new i;s.type=t.CurveType.CRSpline,s.ptStart=this._points.length,s.ptCount=n,this._points=this._points.concat(o),s.length=0;for(var r=1;r<n;r++)s.length+=t.ToolSet.distance(o[r-1].x,o[r-1].y,o[r].x,o[r].y);this._fullLength+=s.length,this._segments.push(s),o.length=0},e.prototype.clear=function(){this._segments.length=0,this._points.length=0},e.prototype.getPointAt=function(e,i){i?i.x=i.y=0:i=new cc.Vec2,e=t.ToolSet.clamp01(e);var o,n=this._segments.length;if(0==n)return i;if(1==e)return(o=this._segments[n-1]).type==t.CurveType.Straight?(i.x=t.ToolSet.lerp(this._points[o.ptStart].x,this._points[o.ptStart+1].x,e),i.y=t.ToolSet.lerp(this._points[o.ptStart].y,this._points[o.ptStart+1].y,e),i):o.type==t.CurveType.Bezier||o.type==t.CurveType.CubicBezier?this.onBezierCurve(o.ptStart,o.ptCount,e,i):this.onCRSplineCurve(o.ptStart,o.ptCount,e,i);for(var s=e*this._fullLength,r=0;r<n;r++)if((s-=(o=this._segments[r]).length)<0){e=1+s/o.length,o.type==t.CurveType.Straight?(i.x=t.ToolSet.lerp(this._points[o.ptStart].x,this._points[o.ptStart+1].x,e),i.y=t.ToolSet.lerp(this._points[o.ptStart].y,this._points[o.ptStart+1].y,e)):i=o.type==t.CurveType.Bezier||o.type==t.CurveType.CubicBezier?this.onBezierCurve(o.ptStart,o.ptCount,e,i):this.onCRSplineCurve(o.ptStart,o.ptCount,e,i);break}return i},Object.defineProperty(e.prototype,"segmentCount",{get:function(){return this._segments.length},enumerable:!0,configurable:!0}),e.prototype.getAnchorsInSegment=function(t,e){null==e&&(e=new Array);for(var i=this._segments[t],o=0;o<i.ptCount;o++)e.push(new cc.Vec2(this._points[i.ptStart+o].x,this._points[i.ptStart+o].y));return e},e.prototype.getPointsInSegment=function(e,i,o,n,s,r){null==n&&(n=new Array),r&&!isNaN(r)||(r=.1),s&&s.push(i);var a=this._segments[e];if(a.type==t.CurveType.Straight)n.push(new cc.Vec2(t.ToolSet.lerp(this._points[a.ptStart].x,this._points[a.ptStart+1].x,i),t.ToolSet.lerp(this._points[a.ptStart].y,this._points[a.ptStart+1].y,i))),n.push(new cc.Vec2(t.ToolSet.lerp(this._points[a.ptStart].x,this._points[a.ptStart+1].x,o),t.ToolSet.lerp(this._points[a.ptStart].y,this._points[a.ptStart+1].y,o)));else{var h;h=a.type==t.CurveType.Bezier||a.type==t.CurveType.CubicBezier?this.onBezierCurve:this.onCRSplineCurve,n.push(h.call(this,a.ptStart,a.ptCount,i,new cc.Vec2));for(var l=Math.min(a.length*r,50),c=0;c<=l;c++){var u=c/l;u>i&&u<o&&(n.push(h.call(this,a.ptStart,a.ptCount,u,new cc.Vec2)),null!=s&&s.push(u))}n.push(h.call(this,a.ptStart,a.ptCount,o,new cc.Vec2))}return null!=s&&s.push(o),n},e.prototype.getAllPoints=function(t,e,i){null==t&&(t=new Array),i&&!isNaN(i)||(i=.1);for(var o=this._segments.length,n=0;n<o;n++)this.getPointsInSegment(n,0,1,t,e,i);return t},e.prototype.onCRSplineCurve=function(e,i,o,n){var s=Math.floor(o*(i-4))+e,r=this._points[s].x,a=this._points[s].y,h=this._points[s+1].x,l=this._points[s+1].y,c=this._points[s+2].x,u=this._points[s+2].y,d=this._points[s+3].x,_=this._points[s+3].y,p=1==o?1:t.ToolSet.repeat(o*(i-4),1),f=((2-p)*p-1)*p*.5,g=.5*((3*p-5)*p*p+2),m=((-3*p+4)*p+1)*p*.5,v=(p-1)*p*p*.5;return n.x=r*f+h*g+c*m+d*v,n.y=a*f+l*g+u*m+_*v,n},e.prototype.onBezierCurve=function(t,e,i,o){var n=1-i,s=this._points[t].x,r=this._points[t].y,a=this._points[t+1].x,h=this._points[t+1].y,l=this._points[t+2].x,c=this._points[t+2].y;if(4==e){var u=this._points[t+3].x,d=this._points[t+3].y;o.x=n*n*n*s+3*n*n*i*l+3*n*i*i*u+i*i*i*a,o.y=n*n*n*r+3*n*n*i*c+3*n*i*i*d+i*i*i*h}else o.x=n*n*s+2*n*i*l+i*i*a,o.y=n*n*r+2*n*i*c+i*i*h;return o},e.helperPoints=new Array,e}();t.GPath=e;var i=function(){return function(){}}()}(fgui||(fgui={})),function(t){var e;(function(t){t[t.CRSpline=0]="CRSpline",t[t.Bezier=1]="Bezier",t[t.CubicBezier=2]="CubicBezier",t[t.Straight=3]="Straight"})(e=t.CurveType||(t.CurveType={}));var i=function(){function t(){this.x=0,this.y=0,this.control1_x=0,this.control1_y=0,this.control2_x=0,this.control2_y=0,this.curveType=0}return t.newPoint=function(e,i,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0);var n=new t;return n.x=e,n.y=i,n.control1_x=0,n.control1_y=0,n.control2_x=0,n.control2_y=0,n.curveType=o,n},t.newBezierPoint=function(i,o,n,s){void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===s&&(s=0);var r=new t;return r.x=i,r.y=o,r.control1_x=n,r.control1_y=s,r.control2_x=0,r.control2_y=0,r.curveType=e.Bezier,r},t.newCubicBezierPoint=function(i,o,n,s,r,a){void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===a&&(a=0);var h=new t;return h.x=i,h.y=o,h.control1_x=n,h.control1_y=s,h.control2_x=r,h.control2_y=a,h.curveType=e.CubicBezier,h},t.prototype.clone=function(){var e=new t;return e.x=this.x,e.y=this.y,e.control1_x=this.control1_x,e.control1_y=this.control1_y,e.control2_x=this.control2_x,e.control2_y=this.control2_y,e.curveType=this.curveType,e},t}();t.GPathPoint=i}(fgui||(fgui={})),function(t){var e=function(){function e(){}return e.to=function(e,i,o){return t.TweenManager.createTween()._to(e,i,o)},e.to2=function(e,i,o,n,s){return t.TweenManager.createTween()._to2(e,i,o,n,s)},e.to3=function(e,i,o,n,s,r,a){return t.TweenManager.createTween()._to3(e,i,o,n,s,r,a)},e.to4=function(e,i,o,n,s,r,a,h,l){return t.TweenManager.createTween()._to4(e,i,o,n,s,r,a,h,l)},e.toColor=function(e,i,o){return t.TweenManager.createTween()._toColor(e,i,o)},e.delayedCall=function(e){return t.TweenManager.createTween().setDelay(e)},e.shake=function(e,i,o,n){return t.TweenManager.createTween()._shake(e,i,o,n)},e.isTweening=function(e,i){return t.TweenManager.isTweening(e,i)},e.kill=function(e,i,o){t.TweenManager.killTweens(e,i,o)},e.getTween=function(e,i){return t.TweenManager.getTween(e,i)},e.catchCallbackExceptions=!0,e}();t.GTween=e}(fgui||(fgui={})),function(t){var e=function(){function e(){this._startValue=new t.TweenValue,this._endValue=new t.TweenValue,this._value=new t.TweenValue,this._deltaValue=new t.TweenValue,this._reset()}return e.prototype.setDelay=function(t){return this._delay=t,this},Object.defineProperty(e.prototype,"delay",{get:function(){return this._delay},enumerable:!0,configurable:!0}),e.prototype.setDuration=function(t){return this._duration=t,this},Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e.prototype.setBreakpoint=function(t){return this._breakpoint=t,this},e.prototype.setEase=function(t){return this._easeType=t,this},e.prototype.setEasePeriod=function(t){return this._easePeriod=t,this},e.prototype.setEaseOvershootOrAmplitude=function(t){return this._easeOvershootOrAmplitude=t,this},e.prototype.setRepeat=function(t,e){return this._repeat=t,this._yoyo=e,this},Object.defineProperty(e.prototype,"repeat",{get:function(){return this._repeat},enumerable:!0,configurable:!0}),e.prototype.setTimeScale=function(t){return this._timeScale=t,this},e.prototype.setSnapping=function(t){return this._snapping=t,this},e.prototype.setTarget=function(e,i){return this._target=e,this._propType=i,e instanceof t.GObject?this._node=e.node:e instanceof cc.Node&&(this._node=e),this},Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),e.prototype.setPath=function(t){return this._path=t,this},e.prototype.setUserData=function(t){return this._userData=t,this},Object.defineProperty(e.prototype,"userData",{get:function(){return this._userData},enumerable:!0,configurable:!0}),e.prototype.onUpdate=function(t,e){return this._onUpdate=t,this._onUpdateCaller=e,this},e.prototype.onStart=function(t,e){return this._onStart=t,this._onStartCaller=e,this},e.prototype.onComplete=function(t,e){return this._onComplete=t,this._onCompleteCaller=e,this},Object.defineProperty(e.prototype,"startValue",{get:function(){return this._startValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endValue",{get:function(){return this._endValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deltaValue",{get:function(){return this._deltaValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalizedTime",{get:function(){return this._normalizedTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){return 0!=this._ended},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allCompleted",{get:function(){return 1==this._ended},enumerable:!0,configurable:!0}),e.prototype.setPaused=function(t){return this._paused=t,this},e.prototype.seek=function(t){if(!this._killed){if(this._elapsedTime=t,this._elapsedTime<this._delay){if(!this._started)return;this._elapsedTime=this._delay}this.update()}},e.prototype.kill=function(t){this._killed||(t&&(0==this._ended&&(this._breakpoint>=0?this._elapsedTime=this._delay+this._breakpoint:this._repeat>=0?this._elapsedTime=this._delay+this._duration*(this._repeat+1):this._elapsedTime=this._delay+2*this._duration,this.update()),this.callCompleteCallback()),this._killed=!0)},e.prototype._to=function(t,e,i){return this._valueSize=1,this._startValue.x=t,this._endValue.x=e,this._duration=i,this},e.prototype._to2=function(t,e,i,o,n){return this._valueSize=2,this._startValue.x=t,this._endValue.x=i,this._startValue.y=e,this._endValue.y=o,this._duration=n,this},e.prototype._to3=function(t,e,i,o,n,s,r){return this._valueSize=3,this._startValue.x=t,this._endValue.x=o,this._startValue.y=e,this._endValue.y=n,this._startValue.z=i,this._endValue.z=s,this._duration=r,this},e.prototype._to4=function(t,e,i,o,n,s,r,a,h){return this._valueSize=4,this._startValue.x=t,this._endValue.x=n,this._startValue.y=e,this._endValue.y=s,this._startValue.z=i,this._endValue.z=r,this._startValue.w=o,this._endValue.w=a,this._duration=h,this},e.prototype._toColor=function(t,e,i){return this._valueSize=4,this._startValue.color=t,this._endValue.color=e,this._duration=i,this},e.prototype._shake=function(t,e,i,o){return this._valueSize=5,this._startValue.x=t,this._startValue.y=e,this._startValue.w=i,this._duration=o,this},e.prototype._init=function(){this._delay=0,this._duration=0,this._breakpoint=-1,this._easeType=t.EaseType.QuadOut,this._timeScale=1,this._easePeriod=0,this._easeOvershootOrAmplitude=1.70158,this._snapping=!1,this._repeat=0,this._yoyo=!1,this._valueSize=0,this._started=!1,this._paused=!1,this._killed=!1,this._elapsedTime=0,this._normalizedTime=0,this._ended=0},e.prototype._reset=function(){this._target=null,this._propType=null,this._userData=null,this._node=null,this._path=null,this._onStart=this._onUpdate=this._onComplete=null,this._onStartCaller=this._onUpdateCaller=this._onCompleteCaller=null},e.prototype._update=function(t){if(!this._node||cc.isValid(this._node)){if(1!=this._timeScale&&(t*=this._timeScale),0!=t){if(0!=this._ended)return this.callCompleteCallback(),void(this._killed=!0);this._elapsedTime+=t,this.update(),0!=this._ended&&(this._killed||(this.callCompleteCallback(),this._killed=!0))}}else this._killed=!0},e.prototype.update=function(){if(this._ended=0,0!=this._valueSize){if(!this._started){if(this._elapsedTime<this._delay)return;if(this._started=!0,this.callStartCallback(),this._killed)return}var i=!1,o=this._elapsedTime-this._delay;if(this._breakpoint>=0&&o>=this._breakpoint&&(o=this._breakpoint,this._ended=2),0!=this._repeat){var n=Math.floor(o/this._duration);o-=this._duration*n,this._yoyo&&(i=n%2==1),this._repeat>0&&this._repeat-n<0&&(this._yoyo&&(i=this._repeat%2==1),o=this._duration,this._ended=1)}else o>=this._duration&&(o=this._duration,this._ended=1);if(this._normalizedTime=t.EaseManager.evaluate(this._easeType,i?this._duration-o:o,this._duration,this._easeOvershootOrAmplitude,this._easePeriod),this._value.setZero(),this._deltaValue.setZero(),5==this._valueSize)if(0==this._ended){var s=this._startValue.w*(1-this._normalizedTime),r=s*(Math.random()>.5?1:-1),a=s*(Math.random()>.5?1:-1);this._deltaValue.x=r,this._deltaValue.y=a,this._value.x=this._startValue.x+r,this._value.y=this._startValue.y+a}else this._value.x=this._startValue.x,this._value.y=this._startValue.y;else if(this._path){var h=e.helperPoint;this._path.getPointAt(this._normalizedTime,h),this._snapping&&(h.x=Math.round(h.x),h.y=Math.round(h.y)),this._deltaValue.x=h.x-this._value.x,this._deltaValue.y=h.y-this._value.y,this._value.x=h.x,this._value.y=h.y}else for(var l=0;l<this._valueSize;l++){var c=this._startValue.getField(l),u=c+(this._endValue.getField(l)-c)*this._normalizedTime;this._snapping&&(u=Math.round(u)),this._deltaValue.setField(l,u-this._value.getField(l)),this._value.setField(l,u)}if(null!=this._target&&null!=this._propType)if(this._propType instanceof Function)switch(this._valueSize){case 1:this._propType.call(this._target,this._value.x);break;case 2:this._propType.call(this._target,this._value.x,this._value.y);break;case 3:this._propType.call(this._target,this._value.x,this._value.y,this._value.z);break;case 4:this._propType.call(this._target,this._value.x,this._value.y,this._value.z,this._value.w);break;case 5:this._propType.call(this._target,this._value.color);break;case 6:this._propType.call(this._target,this._value.x,this._value.y)}else 5==this._valueSize?this._target[this._propType]=this._value.color:this._target[this._propType]=this._value.x;this.callUpdateCallback()}else this._elapsedTime>=this._delay+this._duration&&(this._ended=1)},e.prototype.callStartCallback=function(){if(null!=this._onStart)try{this._onStart.call(this._onStartCaller,this)}catch(t){console.log("FairyGUI: error in start callback > "+t)}},e.prototype.callUpdateCallback=function(){if(null!=this._onUpdate)try{this._onUpdate.call(this._onUpdateCaller,this)}catch(t){console.log("FairyGUI: error in update callback > "+t)}},e.prototype.callCompleteCallback=function(){if(null!=this._onComplete)try{this._onComplete.call(this._onCompleteCaller,this)}catch(t){console.log("FairyGUI: error in complete callback > "+t)}},e.helperPoint=new cc.Vec2,e}();t.GTweener=e}(fgui||(fgui={})),function(t){var e=function(){function e(){}return e.createTween=function(){var i;return e._root||(e._root=new cc.Node("[TweenManager]"),cc.game.addPersistRootNode(e._root),cc.director.getScheduler().schedule(e.update,e._root,0,!1)),(i=e._tweenerPool.length>0?e._tweenerPool.pop():new t.GTweener)._init(),e._activeTweens[e._totalActiveTweens++]=i,e._totalActiveTweens==e._activeTweens.length&&(e._activeTweens.length=e._activeTweens.length+Math.ceil(.5*e._activeTweens.length)),i},e.isTweening=function(t,i){if(null==t)return!1;for(var o=null==i||void 0==i,n=0;n<e._totalActiveTweens;n++){var s=e._activeTweens[n];if(null!=s&&s.target==t&&!s._killed&&(o||s._propType==i))return!0}return!1},e.killTweens=function(t,i,o){if(null==t)return!1;for(var n=!1,s=e._totalActiveTweens,r=null==o||void 0==o,a=0;a<s;a++){var h=e._activeTweens[a];null==h||h.target!=t||h._killed||!r&&h._propType!=o||(h.kill(i),n=!0)}return n},e.getTween=function(t,i){if(null==t)return null;for(var o=e._totalActiveTweens,n=null==i||void 0==i,s=0;s<o;s++){var r=e._activeTweens[s];if(null!=r&&r.target==t&&!r._killed&&(n||r._propType==i))return r}return null},e.update=function(t){for(var i=e._activeTweens,o=e._totalActiveTweens,n=-1,s=0;s<o;s++){var r=i[s];null==r?-1==n&&(n=s):r._killed?(r._reset(),e._tweenerPool.push(r),i[s]=null,-1==n&&(n=s)):(r._paused||r._update(t),-1!=n&&(i[n]=r,i[s]=null,n++))}if(n>=0){if(e._totalActiveTweens!=o){var a=o;for(o=e._totalActiveTweens-o,s=0;s<o;s++)i[n++]=i[a++]}e._totalActiveTweens=n}return!1},e._activeTweens=new Array(30),e._tweenerPool=new Array,e._totalActiveTweens=0,e}();t.TweenManager=e}(fgui||(fgui={})),function(t){var e=function(){function t(){this.x=this.y=this.z=this.w=0}return Object.defineProperty(t.prototype,"color",{get:function(){return(this.w<<24)+(this.x<<16)+(this.y<<8)+this.z},set:function(t){this.x=(16711680&t)>>16,this.y=(65280&t)>>8,this.z=255&t,this.w=(4278190080&t)>>24},enumerable:!0,configurable:!0}),t.prototype.getField=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("Index out of bounds: "+t)}},t.prototype.setField=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("Index out of bounds: "+t)}},t.prototype.setZero=function(){this.x=this.y=this.z=this.w=0},t}();t.TweenValue=e}(fgui||(fgui={})),function(t){var e=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this.stringTable=null,this.version=0,this.littleEndian=!1,-1==i&&(i=t.byteLength-e),this._bytes=new Uint8Array(t,e,i),this._view=new DataView(this._bytes.buffer,e,i),this._pos=0,this._length=i}return Object.defineProperty(t.prototype,"data",{get:function(){return this._bytes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._pos},set:function(t){if(t>this._length)throw"Out of bounds";this._pos=t},enumerable:!0,configurable:!0}),t.prototype.skip=function(t){this._pos+=t},t.prototype.validate=function(t){if(this._pos+t>this._length)throw"Out of bounds"},t.prototype.readByte=function(){return this.validate(1),this._view.getInt8(this._pos++)},t.prototype.readUbyte=function(){return this._bytes[this._pos++]},t.prototype.readBool=function(){return 1==this.readByte()},t.prototype.readShort=function(){this.validate(2);var t=this._view.getInt16(this._pos,this.littleEndian);return this._pos+=2,t},t.prototype.readUshort=function(){this.validate(2);var t=this._view.getUint16(this._pos,this.littleEndian);return this._pos+=2,t},t.prototype.readInt=function(){this.validate(4);var t=this._view.getInt32(this._pos,this.littleEndian);return this._pos+=4,t},t.prototype.readUint=function(){this.validate(4);var t=this._view.getUint32(this._pos,this.littleEndian);return this._pos+=4,t},t.prototype.readFloat=function(){this.validate(4);var t=this._view.getFloat32(this._pos,this.littleEndian);return this._pos+=4,t},t.prototype.readString=function(t){void 0==t&&(t=this.readUshort()),this.validate(t);for(var e="",i=this._pos+t,o=0,n=String.fromCharCode,s=this._bytes,r=this._pos;r<i;)(o=s[r++])<128?0!=o&&(e+=n(o)):e+=n(o<224?(63&o)<<6|127&s[r++]:o<240?(31&o)<<12|(127&s[r++])<<6|127&s[r++]:(15&o)<<18|(127&s[r++])<<12|s[r++]<<6&127|127&s[r++]),0;return this._pos+=t,e},t.prototype.readS=function(){var t=this.readUshort();return 65534==t?null:65533==t?"":this.stringTable[t]},t.prototype.readSArray=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.readS();return e},t.prototype.writeS=function(t){var e=this.readUshort();65534!=e&&65533!=e&&(this.stringTable[e]=t)},t.prototype.readColor=function(t){var e=this.readUbyte(),i=this.readUbyte(),o=this.readUbyte(),n=this.readUbyte();return new cc.Color(e,i,o,t?n:255)},t.prototype.readChar=function(){var t=this.readUshort();return String.fromCharCode(t)},t.prototype.readBuffer=function(){var e=this.readUint();this.validate(e);var i=new t(this._bytes.buffer,this._bytes.byteOffset+this._pos,e);return i.stringTable=this.stringTable,i.version=this.version,this._pos+=e,i},t.prototype.seek=function(t,e){var i,o=this._pos;return this._pos=t,e<this.readByte()?(1==this.readByte()?(this._pos+=2*e,i=this.readUshort()):(this._pos+=4*e,i=this.readUint()),i>0?(this._pos=t+i,!0):(this._pos=o,!1)):(this._pos=o,!1)},t}();t.ByteBuffer=e}(fgui||(fgui={})),function(t){var e=function(){function t(){this.matrix=new Array(t.LENGTH),this.reset()}return t.create=function(e,i,o,n){var s=new t;return s.adjustColor(e,i,o,n),s},t.prototype.reset=function(){for(var e=0;e<t.LENGTH;e++)this.matrix[e]=t.IDENTITY_MATRIX[e]},t.prototype.invert=function(){this.multiplyMatrix([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},t.prototype.adjustColor=function(t,e,i,o){this.adjustHue(o),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)},t.prototype.adjustBrightness=function(t){t=255*this.cleanValue(t,1),this.multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0])},t.prototype.adjustContrast=function(t){var e=(t=this.cleanValue(t,1))+1,i=128*(1-e);this.multiplyMatrix([e,0,0,0,i,0,e,0,0,i,0,0,e,0,i,0,0,0,1,0])},t.prototype.adjustSaturation=function(e){e=this.cleanValue(e,1);var i=1-(e+=1),o=i*t.LUMA_R,n=i*t.LUMA_G,s=i*t.LUMA_B;this.multiplyMatrix([o+e,n,s,0,0,o,n+e,s,0,0,o,n,s+e,0,0,0,0,0,1,0])},t.prototype.adjustHue=function(e){e=this.cleanValue(e,1),e*=Math.PI;var i=Math.cos(e),o=Math.sin(e);this.multiplyMatrix([t.LUMA_R+i*(1-t.LUMA_R)+o*-t.LUMA_R,t.LUMA_G+i*-t.LUMA_G+o*-t.LUMA_G,t.LUMA_B+i*-t.LUMA_B+o*(1-t.LUMA_B),0,0,t.LUMA_R+i*-t.LUMA_R+.143*o,t.LUMA_G+i*(1-t.LUMA_G)+.14*o,t.LUMA_B+i*-t.LUMA_B+-.283*o,0,0,t.LUMA_R+i*-t.LUMA_R+o*-(1-t.LUMA_R),t.LUMA_G+i*-t.LUMA_G+o*t.LUMA_G,t.LUMA_B+i*(1-t.LUMA_B)+o*t.LUMA_B,0,0,0,0,0,1,0])},t.prototype.concat=function(e){e.length==t.LENGTH&&this.multiplyMatrix(e)},t.prototype.clone=function(){var e=new t;return e.copyMatrix(this.matrix),e},t.prototype.copyMatrix=function(e){for(var i=t.LENGTH,o=0;o<i;o++)this.matrix[o]=e[o]},t.prototype.multiplyMatrix=function(t){for(var e=[],i=0,o=0;o<4;++o){for(var n=0;n<5;++n)e[i+n]=t[i]*this.matrix[n]+t[i+1]*this.matrix[n+5]+t[i+2]*this.matrix[n+10]+t[i+3]*this.matrix[n+15]+(4==n?t[i+4]:0);i+=5}this.copyMatrix(e)},t.prototype.cleanValue=function(t,e){return Math.min(e,Math.max(-e,t))},t.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],t.LENGTH=t.IDENTITY_MATRIX.length,t.LUMA_R=.299,t.LUMA_G=.587,t.LUMA_B=.114,t}();t.ColorMatrix=e}(fgui||(fgui={})),function(t){var e=function(){function t(){this._readPos=0,this._handlers={},this._handlers.url=this.onTag_URL,this._handlers.img=this.onTag_IMG,this._handlers.b=this.onTag_Simple,this._handlers.i=this.onTag_Simple,this._handlers.u=this.onTag_Simple,this._handlers.color=this.onTag_COLOR,this._handlers.size=this.onTag_SIZE}return t.prototype.onTag_URL=function(t,e,i){if(e){o="";return this.linkColor&&(o+="</color>"),this.linkUnderline&&(o+="</u>"),o+="</on>"}var o=void 0;return o=null!=i?'<on click="onClickLink" param="'+i+'">':'<on click="onClickLink" param="'+this.getTagText()+'">',this.linkUnderline&&(o+="<u>"),this.linkColor&&(o+="<color="+this.linkColor+">"),o},t.prototype.onTag_IMG=function(t,e,i){if(e)return null;var o=this.getTagText(!0);return o?'<img src="'+o+'"/>':null},t.prototype.onTag_Simple=function(t,e,i){return e?"</"+t+">":"<"+t+">"},t.prototype.onTag_COLOR=function(t,e,i){return e?"</color>":(this.lastColor=i,"<color="+i+">")},t.prototype.onTag_FONT=function(t,e,i){return e?"</font>":'<font face="'+i+'">'},t.prototype.onTag_SIZE=function(t,e,i){return e?"</size>":(this.lastSize=i,"<size="+i+">")},t.prototype.getTagText=function(t){for(var e,i=this._readPos,o="";-1!=(e=this._text.indexOf("[",i));){if(92!=this._text.charCodeAt(e-1)){o+=this._text.substring(i,e);break}o+=this._text.substring(i,e-1),o+="[",i=e+1}return-1==e?null:(t&&(this._readPos=e),o)},t.prototype.parse=function(t,e){this._text=t,this.lastColor=null,this.lastSize=null;for(var i,o,n,s,r,a,h,l=0,c="";-1!=(i=this._text.indexOf("[",l));)if(i>0&&92==this._text.charCodeAt(i-1))c+=this._text.substring(l,i-1),c+="[",l=i+1;else{if(c+=this._text.substring(l,i),l=i,-1==(i=this._text.indexOf("]",l)))break;n="/"==this._text.charAt(l+1),s=this._text.substring(n?l+2:l+1,i),this._readPos=i+1,r=null,a=null,-1!=(o=s.indexOf("="))&&(r=s.substring(o+1),s=s.substring(0,o)),s=s.toLowerCase(),null!=(h=this._handlers[s])?null==(a=h.call(this,s,n,r))||e||(c+=a):c+=this._text.substring(l,this._readPos),l=this._readPos}return l<this._text.length&&(c+=this._text.substr(l)),this._text=null,c},t.inst=new t,t}();t.UBBParser=e}(fgui||(fgui={})),function(t){var e=function(){function t(){}return t.startsWith=function(t,e,i){return!!t&&(!(t.length<e.length)&&(t=t.substring(0,e.length),i?t.toLowerCase()==e.toLowerCase():t==e))},t.encodeHTML=function(t){return t?t.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("'","&apos;"):""},t.clamp=function(t,e,i){return t<e?t=e:t>i&&(t=i),t},t.clamp01=function(t){return t>1?t=1:t<0&&(t=0),t},t.lerp=function(t,e,i){return t+i*(e-t)},t.getTime=function(){return(new Date).getMilliseconds()/1e3},t.toGrayed=function(t){var e=.299*t.getR()+.587*t.getG()+.114*t.getB();return new cc.Color(e,e,e,t.getA())},t.repeat=function(t,e){return t-Math.floor(t/e)*e},t.distance=function(t,e,i,o){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-o,2))},t}();t.ToolSet=e}(fgui||(fgui={})),cc._RF.pop()},{}],fgui_root:[function(t,e,i){"use strict";cc._RF.push(e,"a747f/XYyNJlaW+Y4V76Gp5","fgui_root");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./base_ui"),r=cc._decorator,a=r.ccclass,h=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var i;return o(e,t),i=e,e.prototype.onLoad=function(){i.instance=this,fgui.addLoadHandler(),fgui.GRoot.create(),s.BaseUI.root=fgui.GRoot.inst,cc.game.addPersistRootNode(s.BaseUI.root.node)},e.prototype.start=function(){},e.instance=null,e.nativePath="fgui/",e=i=n([a],e)}(cc.Component));i.FGUIRoot=h,cc._RF.pop()},{"./base_ui":"base_ui"}],fsm:[function(t,e,i){"use strict";cc._RF.push(e,"46d03pv135OmKk9OZgSA69h","fsm");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n,s=t("../util/structure/hd_map");(function(t){t[t.kNone=0]="kNone",t[t.kIdle=1]="kIdle"})(n=i.FSMState||(i.FSMState={}));var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.enter=function(t){this.obj_},e}(function(){function t(t,e){this.obj_=null,this.param_=null,this.state_=n.kNone,this.obj_=t,this.state_=e}return Object.defineProperty(t.prototype,"state",{get:function(){return this.state_},enumerable:!0,configurable:!0}),t.prototype.enter=function(t){},t.prototype.update=function(t){},t.prototype.over=function(){},t}()),a=function(){function t(t){this.stateMap_=new s.HDMap,this.currState_=null,this.stateMap_.put(n.kIdle,new r(t,n.kIdle))}return t.prototype.switch=function(t,e){void 0===e&&(e=null),this.currState_&&this.currState_.over(),this.stateMap_.containsKey(t)&&(this.currState_=this.stateMap_.get(t),this.currState_.enter(e))},t.prototype.currState=function(){return this.currState_?this.currState_.state:n.kNone},t.prototype.update=function(t){this.currState_&&this.currState_.update(t)},t}();i.FSMController=a,cc._RF.pop()},{"../util/structure/hd_map":"hd_map"}],game_logic:[function(t,e,i){"use strict";cc._RF.push(e,"23eecewgetPqZteGbOQFOV4","game_logic");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./util/global_def"),r=t("./util/game_storage"),a=t("./util/event_mgr"),h=t("./util/audio_mgr"),l=t("./util/timed_task"),c=t("./HDSDK"),u=t("./game/user_info"),d=t("./data/data_hub"),_=t("./game_ui/common/export_ui"),p=t("./util/mgp_util"),f=t("./game_setting"),g=cc._decorator,m=g.ccclass,v=(g.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameEvtMgr_=null,e.timedTaskMgr_=null,e.exportUI_=null,e.fpsSum_=0,e.frames_=0,e.bRecDt_=!1,e.bLogined=!1,e}var i;return o(e,t),i=e,e.prototype.onLoad=function(){i.instance=this,this.init(),cc.game.addPersistRootNode(this.node)},e.prototype.init=function(){var t=this;if(cc.dynamicAtlasManager.enabled=!1,p.MgpUtil.init(),cc.game.setFrameRate(f.GameSetting.framerate),null==this.gameEvtMgr_&&(this.gameEvtMgr_=a.GameEventMgr.instance),this.gameEvtMgr_.init(),null==this.timedTaskMgr_&&(this.timedTaskMgr_=l.TimedTaskMgr.instance),this.timedTaskMgr_.clear(),null==this.exportUI_&&(this.exportUI_=_.ExportUI.instance),h.AudioMgr.instance.init(),1==f.GameSetting.debug&&r.GameStorage.clearAllStorage(),this.loadData(),s.G.isMinigamePlat){if(s.G.isTMSDK)wx.tmSDK.login().then(function(e){console.log("[TMSDK] login",e),f.GameSetting.openId=e.open_id,f.GameSetting.sessionKey="",t.bLogined=!0}),wx.showShareMenu({withShareTicket:!1,success:function(t){},fail:function(){},complete:function(){}}),wx.tmSDK.onShareAppMessage(function(){return{scene:"forward",query:""}});else{var e=this._loginSucc.bind(this),i=this._loginFail.bind(this),o=this._loginError.bind(this);f.GameSetting.openId&&""!=f.GameSetting.openId&&"null"!=f.GameSetting.openId&&0===f.GameSetting.payment?this._loginSucc(null):p.MgpUtil.login(e,i,o,!0);var n=function(){var t=d.DataHub.getMessage;return{title:t.title,imageUrl:t.img,query:""}}.bind(this);p.MgpUtil.showForward(n)}p.MgpUtil.onAudioInterruptionEnd()}else this.bLogined=!0,c.HDSDK.init(f.GameSetting.openId,f.GameSetting.proName);this._onShow(),this._onHide()},e.prototype.start=function(){},e.prototype.log=function(){},e.prototype.loadData=function(){this.readData(),p.MgpUtil.readData(),u.GameUserInfo.read()},e.prototype.saveData=function(){r.GameStorage.writeJSON(r.SaveDef.kGameData,{})},e.prototype.readData=function(){var t=r.GameStorage.readJSON(r.SaveDef.kGameData);s.G.isExistObj(t)},Object.defineProperty(e.prototype,"eventManager",{get:function(){return this.gameEvtMgr_},enumerable:!0,configurable:!0}),e.prototype.changeScene=function(t,e,i){a.GameEventMgr.instance.clear(),l.TimedTaskMgr.instance.clear();cc.director.preloadScene(t,function(t,i,o){e&&e(t,i,o)},function(e){e?cc.log("change scene err",e):(s.G.log("changeScene over"),cc.director.loadScene(t,i),cc.sys.garbageCollect(),s.G.isMinigamePlat&&p.MgpUtil.triggerGC())})},e.prototype.recordFPS=function(t){t&&(this.fpsSum_=0,this.frames_=0),this.bRecDt_=t},Object.defineProperty(e.prototype,"averageFPS",{get:function(){var t=0;return this.frames_>0&&(t=Math.floor(this.fpsSum_/this.frames_)),t},enumerable:!0,configurable:!0}),e.prototype.update=function(t){if(this.gameEvtMgr_&&this.gameEvtMgr_.excuteEvents(),this.timedTaskMgr_&&this.timedTaskMgr_.excuteTasks(t),this.exportUI_&&this.exportUI_.update(t),this.bRecDt_){if(t>0){var e=1/t;e>60&&(e=60),this.fpsSum_+=e}++this.frames_}},e.prototype._loginSucc=function(t){t?(f.GameSetting.openId=t.openId,f.GameSetting.sessionKey=t.sessionKey,console.log("login succ cb",t)):console.log("no login succ cb"),f.GameSetting.openId&&""!=f.GameSetting.openId&&"null"!=f.GameSetting.openId&&0===f.GameSetting.payment&&p.MgpUtil.saveData(),c.HDSDK.init(f.GameSetting.openId,f.GameSetting.proName),p.MgpUtil.launchQueryCheck(!1),this.bLogined=!0},e.prototype._loginFail=function(t){f.GameSetting.sessionKey="",this.bLogined=!0,console.log("login fail cb",t)},e.prototype._loginError=function(t){this.bLogined=!0},e.prototype._onShow=function(){s.G.isMinigamePlat&&p.MgpUtil.onShow(!1)},e.prototype._onHide=function(){s.G.isMinigamePlat&&p.MgpUtil.onHide()},e.instance=null,e=i=n([m],e)}(cc.Component));i.GameLogic=v,cc._RF.pop()},{"./HDSDK":"HDSDK","./data/data_hub":"data_hub","./game/user_info":"user_info","./game_setting":"game_setting","./game_ui/common/export_ui":"export_ui","./util/audio_mgr":"audio_mgr","./util/event_mgr":"event_mgr","./util/game_storage":"game_storage","./util/global_def":"global_def","./util/mgp_util":"mgp_util","./util/timed_task":"timed_task"}],game_setting:[function(t,e,i){"use strict";cc._RF.push(e,"a38644xsQpNO6lYuZluwv2Y","game_setting"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.debug=0,t.testServer=0,t.framerate=60,t.payment=0,t.proName="test",t.openId="",t.unionId="",t.sessionKey="",t.gameId="",t}();i.GameSetting=o,cc._RF.pop()},{}],game_storage:[function(t,e,i){"use strict";cc._RF.push(e,"1b63bbiB4tPJYchWVff1Yr0","game_storage"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.kGameData="gameDat",t.kSetting="setting",t.kAudio="audio",t.kWxStatus="wxStatus",t.kPlayer="player",t.kDaily="signIn",t.kVersion="ver",t.kForceNav="nav",t}();i.SaveDef=o;var n=function(){function t(){}return t.clearAllStorage=function(){cc.sys.localStorage.clear()},t.writeBoolean=function(t,e){var i=e?1:0;cc.sys.localStorage.setItem(t,i)},t.readBoolean=function(t){var e=null,i=cc.sys.localStorage.getItem(t);return 0===i?e=!1:null==i||""===i||isNaN(i)||(e=1==i),e},t.writeNum=function(t,e){cc.sys.localStorage.setItem(t,e)},t.readNum=function(t){var e=null,i=cc.sys.localStorage.getItem(t);return 0===i?e=0:null==i||""===i||isNaN(i)||(e=parseInt(i)),e},t.writeJSON=function(t,e){var i=JSON.stringify(e);cc.sys.localStorage.setItem(t,i)},t.readJSON=function(t){var e=null,i=cc.sys.localStorage.getItem(t);return i&&(e=JSON.parse(i)),e},t.remove=function(t){cc.sys.localStorage.removeItem(t)},t}();i.GameStorage=n,cc._RF.pop()},{}],global_def:[function(t,e,i){"use strict";cc._RF.push(e,"cdef6H9LbZEe7LVSvFzVyrV","global_def"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./structure/hd_map"),n=[.1,.01,.001,1e-4,1e-5,1e-6],s=!1;"undefined"==typeof wx&&"undefined"==typeof tt&&"undefined"==typeof qg||(s=!0);var r=function(){function t(){}return t.isEmptyObj=function(t){if(t){if("object"!=typeof t)return!1;for(var e in t)return!1}return!0},t.isExistObj=function(t){return!this.isEmptyObj(t)},t.uniqueArray=function(t){return t.filter(function(t,e,i){return i.indexOf(t)===e})},t.uniqueArrayEx=function(t){var e={};return t.filter(function(t,i,o){return!e.hasOwnProperty(typeof t+JSON.stringify(t))&&(e[typeof t+JSON.stringify(t)]=!0)})},t.clampString=function(t,e,i){i=null==i?"...":i,e*=2;for(var o=this._toCodePoint(t),n=0,s=0,r=0;r<o.length;++r){var a=1;if(o[r].v>=128&&(a=2),n+a>e)break;s=r,n+=a}if(o.length-1==s)return t;var h=i?1:0;return t.substring(0,o[s-h].pos+1)+i},t.isEqualF=function(t,e,i){void 0===i&&(i=6);var o=!1,s=n[i-1]||1e-4;return Math.abs(t-e)<=s&&(o=!0),o},t.randRange=function(t,e){return Math.round(Math.random()*(e-t))+t},t.randRangeF=function(t,e,i){void 0===i&&(i=0);var o=Math.random()*(e-t)+t;return i>0&&(o=parseFloat(o.toFixed(i))),o},t.formatSecond=function(t,e){void 0===e&&(e=1);var i="";if(1===e)i=parseInt((t/60).toString())+"\u5206"+(t%60).toFixed(0)+"\u79d2";else if(2===e){var o=t%3600;i=parseInt((t/3600).toString())+"\u5c0f\u65f6"+parseInt((o/60).toString())+"\u5206"+(o%60).toFixed(0)+"\u79d2"}else if(3===e){var n=t%86400;o=n%3600;i=parseInt((t/86400).toString())+"\u5929"+parseInt((n/3600).toString())+"\u5c0f\u65f6"+parseInt((o/60).toString())+"\u5206"+(o%60).toFixed(0)+"\u79d2"}return i},t.dispatchCustomEvent=function(e,i,o){var n=new cc.Event.EventCustom(i,!0);t.isEmptyObj(o)||n.setUserData(o),e.dispatchEvent(n)},t.readJson=function(t,e){cc.loader.loadRes(t,cc.JsonAsset,function(t,i){t?cc.log(t):(e&&e(i.json),cc.loader.release(i))})},t.readAudio=function(t,e,i,o,n){void 0===o&&(o=!1),void 0===n&&(n=!1),cc.loader.loadRes(t,cc.AudioClip,function(t,s){t?cc.log(t):e&&e(s,i,o,n)})},t.readImgAsSpFrm=function(t,e,i,o){cc.loader.loadRes(t,cc.SpriteFrame,function(t,n){t?cc.log(t):(e&&(e.getComponent(cc.Sprite).spriteFrame=n,e.getComponent(cc.Sprite).sizeMode=i||cc.Sprite.SizeMode.TRIMMED),o&&o(n))})},t.loadSubpackage=function(e,i,o){var n=this;t.isMinigamePlat?(t.log("[WxUtil loadSubpackage] start",e),this.subRetryTimeMap_.containsKey(e)||this.subRetryTimeMap_.put(e,3),cc.loader.downloader.loadSubpackage(e,function(s){if(s){var r=0;n.subRetryTimeMap_.containsKey(e)&&(r=n.subRetryTimeMap_.get(e),--r,n.subRetryTimeMap_.put(e,r)),r>0?(n.loadSubpackage(e,i,o),t.log("[WxUtil loadSubpackage] retry",e)):t.log("[WxUtil loadSubpackage] fail",e,s),o&&o(r)}else t.log("[WxUtil loadSubpackage] succ",e),n.subRetryTimeMap_.containsKey(e)&&n.subRetryTimeMap_.put(e,3),i&&i()})):i&&i()},t.console=function(t,e){void 0===e&&(e=1);for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];this.log(t,i)},t.log=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e&&e.length>0?console.log(t,e):console.log(t)},t.warn=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e&&e.length>0?console.warn(t,e):console.warn(t)},t.error=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];e&&e.length>0?console.error(t,e):console.error(t)},Object.defineProperty(t,"isMinigamePlat",{get:function(){return s},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isWeChat",{get:function(){return"undefined"!=typeof wx},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isBaidu",{get:function(){return"undefined"!=typeof swan},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isByteDance",{get:function(){return"undefined"!=typeof tt},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isQuickGame",{get:function(){return"undefined"!=typeof qg},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isTMSDK",{get:function(){return"undefined"!=typeof wx&&void 0!==wx.tmSDK},enumerable:!0,configurable:!0}),t._toCodePoint=function(t){for(var e=[],i=0,o=0,n=0;n<t.length;){var s=n;if(65039!=(i=t.charCodeAt(n++)))if(o){var r=65536+(o-55296<<10)+(i-56320);e.push({v:r,pos:s}),o=0}else 55296<=i&&i<=56319?o=i:e.push({v:i,pos:s})}return e},t.subRetryTimeMap_=new o.HDMap,t}();i.G=r,cc._RF.pop()},{"./structure/hd_map":"hd_map"}],hd_map:[function(t,e,i){"use strict";cc._RF.push(e,"c02b1oyS6JALrqGy/PLATtD","hd_map"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){this.keys_=null,this.values_=null,this.keys_=new Array,this.values_=new Object}return t.prototype.copy=function(t){var e=t.keys_,i=t.values_;if(e)for(var o=0;o<e.length;++o)this.keys_[o]=e[o];if(i)for(var n in i)i.hasOwnProperty(n)&&(this.values_[n]=i[n])},t.prototype.toString=function(){for(var t="{ ",e=0,i=this.keys_.length;e<i;++e,t+=", "){var o=this.keys_[e];t+=o+" = "+this.values_[o]}return t=t.substring(0,t.length-1),t+=" }"},t.prototype.size=function(){return this.keys_.length},t.prototype.put=function(t,e){var i=t.toString();null==this.values_[i]?(this.values_[i]=e,this.keys_.push(i)):this.values_[i]=e},t.prototype.get=function(t){var e=t.toString();return this.values_[e]},t.prototype.getFirst=function(){var t=this.keys_[0];return this.values_[t]},t.prototype.getLast=function(){var t=this.keys_[this.keys_.length-1];return this.values_[t]},t.prototype.getByIndex=function(t){var e=null;if(t>=0&&t<this.keys_.length){var i=this.keys_[t];e=this.values_[i]}return e},t.prototype.remove=function(t){var e=t.toString(),i=this.indexOf(e);-1!=i&&this.keys_.splice(i,1),this.values_[e]=null},t.prototype.clear=function(){for(var t=0,e=this.keys_.length;t<e;++t)this.values_[this.keys_[t]]=null;this.keys_=[]},t.prototype.containsKey=function(t){var e=t.toString();return null!=this.values_[e]},t.prototype.isEmpty=function(){return 0===this.keys_.length},t.prototype.each=function(t,e){if(void 0===e&&(e=null),t)for(var i=0;i<this.keys_.length;++i){var o=this.keys_[i];t(i,o,this.values_[o],e)}},t.prototype.indexOf=function(t){var e=-1,i=this.size();if(i>0)for(var o=t.toString(),n=0,s=i;n<s;++n)if(this.keys_[n]==o){e=n;break}return e},t.prototype.values=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=new Array,o=(e>0?Math.min(this.keys_.length,e):this.keys_.length)+t,n=t;n<o;++n)i.push(this.values_[this.keys_[n]]);return i},t}();i.HDMap=o,cc._RF.pop()},{}],http_req:[function(t,e,i){"use strict";cc._RF.push(e,"fc973sFPBpJD6286u+HIaSL","http_req"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("../global_def"),n=t("../../game_setting"),s="https://login.joyfulh.com/comLogin",r="http://119.23.108.126:8900/comLogin",a="https://statistic.joyfulh.com/statistic",h="http://120.55.46.25:8900/statistic",l="/user/getShareSwitch",c="/user/getTitles",u="/user/getTimeSwitch",d="/data/getTimeMillis",_="/userPlayRecord/batchUpdRecord",p="/userPlayRecord/getUserPlayRecord",f="/rank/getRankRecord",g="/rank/updRankRecord",m="/statData/getStatData",v="/statData/updStatData",y="/user/getUid",b="/data/updStatistic",C="/data/batchUpdStat",w="/data/updShareStat",S="/data/updInviteStat",I="/IPScreen/getScreen",T=function(){return function(){this.url="",this.data=""}}();i.SendData=T;var x=function(){function t(){}return t.common=function(t,e,i,n){if(null!=e){var s=new T;if(s.url=t,"object"==typeof e){for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];if(null==a)continue;if(""!=s.data&&(s.data+="&"),"object"==typeof a){var h=JSON.stringify(a);s.data+=r+"="+escape(h)}else"string"==typeof a||"number"==typeof a||"boolean"==typeof a?s.data+=r+"="+a.toString():(s.data+=r+"="+a.toString(),o.G.log("[HttpRequest] please check your data type,only support object,string,number or boolean",3))}}else s.data=e;this._send(s,i,n),s=null}else o.G.log("[HttpRequest] failed",3)},t.getTimestamp=function(t,e){var i=s+d;1==n.GameSetting.testServer&&(i=r+d),this.common(i,"",t,e)},t.getFuncSwitch=function(t,e,i){var o=s+l;1==n.GameSetting.testServer&&(o=r+l);var a={proName:n.GameSetting.proName,version:t};this.common(o,a,e,i)},t.getShareTitle=function(t,e){var i=s+c;1==n.GameSetting.testServer&&(i=r+c);var o={proName:n.GameSetting.proName};this.common(i,o,t,e)},t.getTimeSwtich=function(t,e,i){var o=s+u;1==n.GameSetting.testServer&&(o=r+u);var a={proName:n.GameSetting.proName,keys:t};this.common(o,a,e,i)},t.batchUpload=function(t,e,i,o,a){void 0===a&&(a=!1);var h=a?n.GameSetting.unionId:n.GameSetting.openId;if(null==h||""==h)return i&&i(2),void console.warn("fetchUserData - no valid user id");var l=s+_;1==n.GameSetting.testServer&&(l=r+_),a=a||!1;var c={proName:n.GameSetting.proName,wxId:h,data:t};this.common(l,c,function(t){0==t.status?e&&e(t):i(t.status)},o)},t.fetchUserData=function(t,e,i,o){void 0===o&&(o=!1);var a=o?n.GameSetting.unionId:n.GameSetting.openId;if(null==a||""==a)return e&&e(2),void console.warn("fetchUserData - no valid user id");var h=s+p;1==n.GameSetting.testServer&&(h=r+p);var l={proName:n.GameSetting.proName,wxId:a};this.common(h,l,function(i){0==i.status?t&&t(i):e(i.status)},i)},t.fetchRankData=function(t,e,i,o,a){var h=s+f;1==n.GameSetting.testServer&&(h=r+f);var l={proName:n.GameSetting.proName,type:t,page:e,limit:i};this.common(h,l,o,a)},t.uploadRankData=function(t,e){var i=s+g;1==n.GameSetting.testServer&&(i=r+g);for(var o={proName:n.GameSetting.proName,openId:n.GameSetting.openId,type:t},a=0;a<e.length;++a)o[e[a].name]=e[a].val;this.common(i,o,null)},t.fetchStatData=function(t,e){var i=s+m;1==n.GameSetting.testServer&&(i=r+m);var o={proName:n.GameSetting.proName};this.common(i,o,t,e)},t.updateStatData=function(t,e){var i=s+v;1==n.GameSetting.testServer&&(i=r+v);var o={proName:n.GameSetting.proName,data:t};this.common(i,o,null,e)},t.getUserId=function(t,e,i,o){var s=a+y;1==n.GameSetting.testServer&&(s=h+y);var r={proName:n.GameSetting.proName,openId:t,unionId:e};this.common(s,r,i,o)},t.updateStatistic=function(t,e,i,o,s,r){var l=a+b;1==n.GameSetting.testServer&&(l=h+b);var c={proName:n.GameSetting.proName,uid:t,key:e,value:i,choose:o||0};this.common(l,c,s,r)},t.batchUpdateStat=function(t,e,i){var o=a+C;1==n.GameSetting.testServer&&(o=h+C);var s={proName:n.GameSetting.proName,uid:n.GameSetting.gameId,data:t};this.common(o,s,e,i)},t.shareOut=function(t){var e=a+w;1==n.GameSetting.testServer&&(e=h+w);var i={proName:n.GameSetting.proName,path:t};this.common(e,i,null,null)},t.shareClick=function(t){var e=a+S;1==n.GameSetting.testServer&&(e=h+S);var i={proName:n.GameSetting.proName,path:t,openid:n.GameSetting.openId};this.common(e,i,null,null)},t.checkIP=function(t,e){var i=s+I;1==n.GameSetting.testServer&&(i=r+I);var o;o={proName:n.GameSetting.proName,choose:1},console.log("CHECK IP",i,o),this.common(i,o,t,e)},t.checkIPbyThirdParty=function(t,e){var i=this,o=function(e){if(e){for(var o=!1,n=0;n<i.ipHideCityArr_.length;++n)if(-1!=e.indexOf(i.ipHideCityArr_[n])){o=!0;break}if(!o)for(n=0;n<i.ipHideProvinceArr_.length;++n)if(-1!=e.indexOf(i.ipHideProvinceArr_[n])){o=!0;break}t&&t({res:o?1:0})}},n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&n.status>=200&&n.status<400?o&&o(n.responseText):1!=n.readyState&&(n.status<200||n.status>=400)&&e&&e()},n.open("GET","https://pv.sohu.com/cityjson?ie=uft-8",!0),n.send()},t._send=function(t,e,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){if(console.log("[HttpRequest] req succ",n.responseText),e){var t=n.responseText;"string"==typeof t?e(JSON.parse(t)):"object"==typeof t&&e(t)}}else 1!=n.readyState&&(n.status<200||n.status>=400)&&(console.log("[HttpRequest] conn",n.readyState,n.status),i&&i(1))},n.onabort=function(){o.G.log("[HttpRequest] abort",n.status),i&&i(2)},n.ontimeout=function(){o.G.log("[HttpRequest] timeout",n.status),i&&i(3)},n.onerror=function(){o.G.log("[HttpRequest] error",n.status),i&&i(4)};var s=t.url+"?"+t.data;n.open("GET",s,!0),n.send()},t.ipHideProvinceArr_=["\u5e7f\u4e1c"],t.ipHideCityArr_=["\u5e7f\u5dde","\u6df1\u5733"],t}();i.HttpRequest=x,cc._RF.pop()},{"../../game_setting":"game_setting","../global_def":"global_def"}],language:[function(t,e,i){"use strict";cc._RF.push(e,"4b0ec7ks7NH0oNe8r9USIQ7","language"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./structure/hd_map"),s=t("./global_def");(function(t){t[t.kDefault=0]="kDefault",t[t.kSimpleChinese=1]="kSimpleChinese",t[t.kTraditionalChinese=2]="kTraditionalChinese",t[t.kEnglish=3]="kEnglish"})(o=i.LanguageCode||(i.LanguageCode={}));var r=["","zh","tw","en"],a=function(){function t(){}return Object.defineProperty(t,"code",{get:function(){return this.code_},set:function(t){this.code_=t,this._generate()},enumerable:!0,configurable:!0}),t.initDir=function(t){this.dir_=t},t.text=function(t){var e=t;return this.map_.containsKey(t)&&(e=this.map_.get(t)),e},t.image=function(t){},t._generate=function(){this.code_===o.kDefault?this.map_.clear():this._loadFile(this.dir_+"/"+r[this.code_])},t._loadFile=function(t){var e=this;s.G.readJson(t,function(i){if(i){for(var o in e.map_.clear(),i)if(i.hasOwnProperty(o)){var n=i[o];e.map_.put(n.key,n.txt)}}else s.G.log("[Language] file not found",2,t)})},t.code_=o.kDefault,t.map_=new n.HDMap,t.dir_="",t}();i.Language=a,cc._RF.pop()},{"./global_def":"global_def","./structure/hd_map":"hd_map"}],load:[function(t,e,i){"use strict";cc._RF.push(e,"6adf46kw11CIIxn1AWSIODK","load");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("./data/data_hub"),r=t("./util/mgp_util"),a=t("./util/ad_tools"),h=t("./game_ui/common/fgui_root"),l=t("./util/global_def"),c=t("./game_ui/common/base_ui"),u=t("./game_logic"),d=t("./game_ui/common/export_ui"),_=t("./game_ui/common/blocker_ui"),p=t("./game_ui/common/tip_ui"),f=t("./game_ui/common/popup_ui"),g=t("./game_ui/common/dialog_ui"),m=t("./game_ui/common/setting_ui"),v=t("./game_ui/common/trans_ui"),y=t("./util/audio_mgr"),b=cc._decorator,C=b.ccclass,w=(b.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadPnl_=null,e.loadProg_=null,e.loadBg_=null,e.loadProc_=0,e.loadTimer_=0,e.bLoading_=!1,e.bLoaded_=!1,e.bExcuted_=!1,e.bChanged_=!1,e}return o(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){s.DataHub.loadJson(),s.DataHub.loadBackendConfig(),a.HDBannerAd.init(),a.HDBannerAd.switch(),fgui.UIPackage.loadPackage("main_pack/load_ui/LoadUI",this._onLoadingUI.bind(this))},e.prototype._onLoadingUI=function(){if(l.G.isTMSDK&&wx.tmSDK.sendLoadingLog("progressStart"),fgui.UIPackage.addPackage("main_pack/load_ui/LoadUI"),this.loadPnl_=fgui.UIPackage.createObject("LoadUI","Loading").asCom,this.loadPnl_){c.BaseUI.root.addChild(this.loadPnl_);var t=cc.view.getVisibleSize().width,e=cc.view.getVisibleSize().height;this.loadPnl_.setSize(t,e),this.loadBg_=this.loadPnl_.getChild("bg").asImage,this.loadProg_=this.loadPnl_.getChild("prog").asProgress;var i=this.loadBg_.width,o=this.loadBg_.height,n=e/o,s=t/i;n>s?(this.loadBg_.width=i*n,this.loadBg_.height=o*n):(this.loadBg_.width=i*s,this.loadBg_.height=o*s),l.G.log("loading UI size",this.loadBg_.width,this.loadBg_.height,i,o,n,s)}l.G.isMinigamePlat?(r.MgpUtil.fetchSdkInfo(),r.MgpUtil.checkVersionUpdate(this._updateApp.bind(this),this._noUpdate.bind(this)),l.G.loadSubpackage("fgui",this._loadFguiSubSucc.bind(this),this._loadFguiSubFail.bind(this))):this.bLoading_=!0,this.loadProc_=0},e.prototype._updateApp=function(){},e.prototype._noUpdate=function(){},e.prototype._loadFguiSubSucc=function(){this._addProc(40),this.bLoading_=!0,y.AudioMgrInst.loadPackage()},e.prototype._loadFguiSubFail=function(t){t<=0?r.MgpUtil.modalDialog("\u63d0\u793a","\u7f51\u7edc\u72b6\u6001\u4e0d\u4f73\uff0c\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5c1d\u8bd5\u91cd\u65b0\u542f\u52a8\u6e38\u620f",function(){r.MgpUtil.exitGame()},null,!1):(this.loadProc_=0,this.loadProg_.value=0)},e.prototype._excuteLoad=function(){this.bLoaded_=!0,this._addProc(99)},e.prototype.update=function(t){this.bLoading_&&(this.loadProc_<40?(this.loadTimer_-=t,this.loadTimer_<=0&&(this._addProc(l.G.randRange(10,15)),this.loadTimer_=l.G.randRangeF(.1,.3))):this.loadProc_<89?this.bExcuted_?this.loadProc_<88&&this._addProc(1):(this._excuteLoad(),this.bExcuted_=!0):this.bLoaded_&&!this.bChanged_&&s.DataHub.bJsonLoaded&&u.GameLogic.instance.bLogined&&(fgui.UIPackage.loadPackage(h.FGUIRoot.nativePath+"CommUI",this._onLoadCommUI.bind(this)),this.bChanged_=!0))},e.prototype._onLoadCommUI=function(t){if(t)console.error("[Load _onLoadCommUI] err",t);else{console.log("[Load _onLoadCommUI] succ"),fgui.UIPackage.addPackage(h.FGUIRoot.nativePath+"CommUI");var e=fgui.UIPackage.createObject("CommUI","Blocker").asCom;e&&_.InputBlocker.instance.init(e);var i=fgui.UIPackage.createObject("CommUI","Tip").asCom;i&&p.TipUI.instance.init(i);var o=fgui.UIPackage.createObject("CommUI","Popup").asCom;o&&f.PopupUI.instance.init(o);var n=fgui.UIPackage.createObject("CommUI","DialogPnl").asCom;n&&g.DialogUI.instance.init(n);var s=fgui.UIPackage.createObject("CommUI","SettingPnl").asCom;s&&m.SettingUI.instance.init(s);var r=fgui.UIPackage.createObject("CommUI","TransPnl").asCom;r&&v.TransUI.instance.init(r),fgui.UIPackage.loadPackage(h.FGUIRoot.nativePath+"HDSDK",this._onLoadHDSDK.bind(this))}},e.prototype._onLoadHDSDK=function(t){t?console.error("[Load _onLoadHDSDK] err",t):(console.log("[Load _onLoadHDSDK] succ"),fgui.UIPackage.addPackage(h.FGUIRoot.nativePath+"HDSDK"),d.ExportUIInst.init(),this._addProc(0,!0),c.BaseUI.root.removeChild(this.loadPnl_),this.loadPnl_.dispose(),fgui.UIPackage.removePackage("LoadUI"),l.G.isTMSDK&&wx.tmSDK.sendLoadingLog("progressEnd"),v.TransUI.instance.show(function(){u.GameLogic.instance.changeScene("test_entry")}))},e.prototype._addProc=function(t,e){void 0===e&&(e=!1),e?this.loadProc_=100:(this.loadProc_+=t,this.loadProc_>99&&(this.loadProc_=99)),this.loadProg_.value=this.loadProc_},e=n([C],e)}(cc.Component));i.default=w,cc._RF.pop()},{"./data/data_hub":"data_hub","./game_logic":"game_logic","./game_ui/common/base_ui":"base_ui","./game_ui/common/blocker_ui":"blocker_ui","./game_ui/common/dialog_ui":"dialog_ui","./game_ui/common/export_ui":"export_ui","./game_ui/common/fgui_root":"fgui_root","./game_ui/common/popup_ui":"popup_ui","./game_ui/common/setting_ui":"setting_ui","./game_ui/common/tip_ui":"tip_ui","./game_ui/common/trans_ui":"trans_ui","./util/ad_tools":"ad_tools","./util/audio_mgr":"audio_mgr","./util/global_def":"global_def","./util/mgp_util":"mgp_util"}],lucky_box_ui:[function(t,e,i){"use strict";cc._RF.push(e,"3aea1acdhtCO4tvRIWNLf8W","lucky_box_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./base_ui"),s=t("../../util/structure/hd_map"),r=t("../../game/user_info"),a=t("../../util/timed_task"),h=t("../../util/audio_mgr"),l=t("../../util/global_def"),c=t("../../util/ad_tools"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.awardBtn_=null,e.doubleBtn_=null,e.doubleCtrl_=null,e.openTrans_=null,e.piece3Trans_=null,e.piece2Trans_=null,e.piece1Trans_=null,e.closeTrans_=null,e.itemGrps_=[],e.iconLoaders_=[],e.itemTxts_=[],e.awardMap_=new s.HDMap,e.awardNum_=0,e.closeCallback_=null,e.taskId_=0,e}return o(e,t),e.prototype.init=function(t){if(t){this.com_=t,this.awardBtn_=t.getChild("awardBtn").asButton,this.doubleBtn_=t.getChild("doubleBtn").asButton,this.doubleCtrl_=this.doubleBtn_.getController("sh"),this.openTrans_=t.getTransition("openTrans"),this.piece3Trans_=t.getTransition("piece3Trans"),this.piece2Trans_=t.getTransition("piece2Trans"),this.piece1Trans_=t.getTransition("piece1Trans"),this.closeTrans_=t.getTransition("closeTrans");for(var e=0;e<3;++e){var i=e+1;this.itemGrps_[e]=t.getChild("itemGrp"+i).asGroup,this.iconLoaders_[e]=t.getChild("iconLoader"+i).asLoader,this.itemTxts_[e]=t.getChild("itemTxt"+i).asTextField}}},e.prototype.show=function(t,e){var i=this;if(this.com_){this.com_.visible=!0,this.closeCallback_=e,this.awardBtn_.onClick(this._onAward,this),this.doubleBtn_.onClick(this._onDouble,this),this.doubleCtrl_&&(this.doubleCtrl_.selectedIndex=r.GameUserInfo.isVideoLimited?1:0),this._genAwards(t);for(var o=0;o<3;++o)this.iconLoaders_[o].setScale(1,1);this.taskId_>0&&(a.TimedTaskMgr.instance.remove(this.taskId_),this.taskId_=0),h.AudioMgr.instance.playSound(h.SfxType.kLuckyBox),this.openTrans_.play(),this.taskId_=a.TimedTaskMgr.instance.add(function(){1==i.awardNum_?i.piece1Trans_.play():2==i.awardNum_?i.piece2Trans_.play():3==i.awardNum_&&i.piece3Trans_.play(),h.AudioMgr.instance.playSound(h.SfxType.kGoodClick),i.bLock_=!1},2),this.bLock_=!0}},e.prototype.reset=function(){var t=this;this.com_&&(this.taskId_>0&&(a.TimedTaskMgr.instance.remove(this.taskId_),this.taskId_=0),this.awardBtn_.offClick(this._onAward,this),this.doubleBtn_.offClick(this._onDouble,this),this.openTrans_.stop(),this.piece3Trans_.stop(),this.piece2Trans_.stop(),this.piece1Trans_.stop(),this.awardMap_.clear(),this.closeTrans_.play(function(){t.com_.visible=!1,t.closeCallback_&&t.closeCallback_()}))},e.prototype._onAward=function(t){void 0===t&&(t=1),this.bLock_||(this.awardMap_.each(this._awardTraverse.bind(this),t),r.GameUserInfo.saveProp(),this.reset())},e.prototype._onDouble=function(){this.bLock_||(l.G.isWeChat?(c.HDVideoAd.watchOrShare(c.HDVideoAd.kBox,this._onAward.bind(this),2),this.doubleCtrl_&&(this.doubleCtrl_.selectedIndex=r.GameUserInfo.isVideoLimited?1:0)):this._onAward(2))},e.prototype._genAwards=function(t){this.awardNum_=0==t||3==t?1:3-t+1,this.awardNum_=this.awardNum_||1,this.awardMap_&&(this.awardMap_.clear(),r.GameUserInfo.genBoxAwards(this.awardNum_,this.awardMap_),this.awardMap_.each(this._initAwardIcons.bind(this)))},e.prototype._awardTraverse=function(t,e,i,o){var n=i.type;n==r.BonusType.kCoin||n>=r.BonusType.kPiece1&&r.BonusType.kPiece3,this.itemTxts_[t]&&(this.itemTxts_[t].text="x"+i.count*o)},e.prototype._initAwardIcons=function(t,e,i){if(this.iconLoaders_[t]){var o="",n=i.type;n===r.BonusType.kCoin?o="ui://CommUI/coin":n>=r.BonusType.kPiece1&&n<=r.BonusType.kPiece3&&(o="ui://CommUI/piece"+(n-r.BonusType.kPiece1+1)),this.iconLoaders_[t].url=o}this.itemTxts_[t]&&(this.itemTxts_[t].text="x"+i.count)},e}(n.BaseUI);i.LuckyBoxUI=u,cc._RF.pop()},{"../../game/user_info":"user_info","../../util/ad_tools":"ad_tools","../../util/audio_mgr":"audio_mgr","../../util/global_def":"global_def","../../util/structure/hd_map":"hd_map","../../util/timed_task":"timed_task","./base_ui":"base_ui"}],math_helper:[function(t,e,i){"use strict";cc._RF.push(e,"0c2afkMirNOS76kZwpq+3H5","math_helper"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.clamp=function(t,e,i){return Math.max(Math.min(t,i),e)},t}();i.MathHelper=o,cc._RF.pop()},{}],math_vec2:[function(t,e,i){"use strict";cc._RF.push(e,"93608y54ZJCSZ6ZrN7Wn7QL","math_vec2"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.isZero=function(t){return 0===t.x&&0===t.y},t.setAngle=function(t,e){var i=t.mag();t.x=Math.cos(e)*i,t.y=Math.sin(e)*i},t.getAngle=function(t){return Math.atan2(t.y,t.x)},t.getAngleDegree=function(t){return 180*this.getAngle(t)/Math.PI},t.getAngleToCocosDegree=function(t){return 180*(2*Math.PI-this.getAngle(t))/Math.PI},t.setLength=function(t,e){var i=this.getAngle(t);t.x=Math.cos(i)*e,t.y=Math.sin(i)*e},t.truncate=function(t,e){var i=Math.min(e,t.mag());this.setLength(t,i)},t.perp=function(t){return new cc.Vec2(-t.y,t.x)},t.distanceSqrt=function(t,e){var i=e.x-t.x,o=e.y-t.y;return i*i+o*o},t.distance=function(t,e){return Math.sqrt(this.distanceSqrt(t,e))},t.sign=function(t,e){return this.perp(t).dot(e)<0?-1:1},t.prototype.getForwardOfParent=function(t){var e=cc.v2(1,0),i=t.rotation%360;i>0?i=360-i:i<0&&(i=Math.abs(i));var o=Math.PI/180*i;return e.rotateSelf(o).normalize()},t.prototype.lookAt=function(t,e){var i=e.x-t.x,o=e.y-t.y;return cc.v2(i,o).signAngle(cc.v2(1,0))/Math.PI*180},t}();i.MathVec2=o,cc._RF.pop()},{}],mgp_def:[function(t,e,i){"use strict";cc._RF.push(e,"256c5Cmrz5CgYoi2GSMUtyC","mgp_def"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./structure/hd_map"),n=t("../game_ui/common/ad_sim_ui"),s="https://login.joyfulh.com/comLogin",r=function(){function t(){this.sdkInfo=null,this.domain_=s,this.loginCode_="",this.normShareTimestamp=0,this.normShareSuccCallback=null,this.normShareFailCallback=null,this.bNormShareCancel=!1,this.videoBonusCallback_=null,this.videoAd_=null,this.videoTimeId_=0,this.videoAdsProtectFlags_=new o.HDMap,this.videoAdsCallbackMap_=new o.HDMap,this.bnrItemMap_=new o.HDMap,this.lastBnrItemStack_=[],this.bnrHideCbMap_=new o.HDMap,this.bnrRefreshTaskId_=0,this.bBnrShowed_=!1,this.bnrClickCDTimestamp_=0,this.bnrClickSucTimestamp_=0,this.interAd_=null,this.gameClub_=null,this.audioInfoMap_=new o.HDMap,this.gameRecordVideoTempPath="",this.gameRecordClipIndexList=[]}return t.prototype.saveData=function(){},t.prototype.readData=function(){},t.prototype.fetchSdkInfo=function(){},t.prototype.compareVersion=function(t,e){},t.prototype.convertMenuButtonRect=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0)},t.prototype.login=function(t,e,i,o,n){void 0===o&&(o=!1),void 0===n&&(n=!1)},t.prototype._login=function(t,e,i,o){void 0===o&&(o=!1)},t.prototype.fetchUserInfo=function(t,e,i,o,n,s){},t.prototype._authLogin=function(t,e,i){},t.prototype._authentication=function(t,e,i,o,n,s){},t.prototype.uploadUserInfo=function(t,e,i,o,n,s){},t.prototype.showForward=function(t){},t.prototype.shareNorm=function(t,e,i,o){},t.prototype.shareForTMSDK=function(t,e,i,o){void 0===o&&(o="")},t.prototype.normShareResult=function(){},t.prototype.launchQueryCheck=function(t){void 0===t&&(t=!1)},t.prototype.onShowQueryCheck=function(t,e){void 0===e&&(e=!1)},t.prototype.reqTimerReset=function(t,e,i){},t.prototype.reqTimerResetUnion=function(t,e,i,o){},t.prototype._getVideoBonus=function(){},t.prototype.watchVideoAds=function(t,e,i,o,n,s,r){void 0===r&&(r="")},t.prototype.bannerStat=function(t){},t.prototype.recordBannerCDTimestamp=function(){},t.prototype.isBannerClickCD=function(){},t.prototype.recordBannerClickSucTimestamp=function(){},t.prototype.decideBannerClickSuc=function(){},t.prototype.showBannerWithRule=function(t,e,i,o){void 0===o&&(o="")},t.prototype.hideBannerWithRule=function(t,e){void 0===e&&(e="")},t.prototype._calBannerXYWZ=function(t,e,i,o){void 0===i&&(i=1),void 0===o&&(o=15)},t.prototype.preloadBanner=function(t,e,i,o,s,r,a,h,l){void 0===o&&(o=15),void 0===s&&(s=null),void 0===r&&(r=null),void 0===a&&(a=1),void 0===h&&(h=4),void 0===l&&(l=""),n.BannerSimUI.addTestBannerHolder(t,e?e.asCom:null,a),s&&s()},t.prototype.isBannerShowed=function(t,e){return void 0===e&&(e=""),n.BannerSimUI.isTestBannerHolderShowed(t)},t.prototype.isBannerLimited=function(t,e){return void 0===e&&(e=""),n.BannerSimUI.isTestBannerLimited(t)},t.prototype.showBanner=function(t,e){void 0===e&&(e=""),n.BannerSimUI.showTestBannerHolder(t)},t.prototype.hideBanner=function(t,e){void 0===e&&(e=""),n.BannerSimUI.hideTestBannerHolder(t)},t.prototype.showLastOne=function(){n.BannerSimUI.showLastTestBanner()},t.prototype.hideLastOne=function(){n.BannerSimUI.hideLastTestBanner()},t.prototype.destroyBanner=function(t,e){void 0===e&&(e="")},t.prototype.hideAllBanners=function(){n.BannerSimUI.hideAllTestBanner()},t.prototype.addInterstitialAd=function(t){},t.prototype.showInterstitialAd=function(){},t.prototype.checkVersionUpdate=function(t,e){},t.prototype.modalDialog=function(t,e,i,o,n,s,r,a,h){void 0===n&&(n=!0),void 0===s&&(s="\u53d6\u6d88"),void 0===r&&(r="#000000"),void 0===a&&(a="\u786e\u5b9a"),void 0===h&&(h="#3cc51f")},t.prototype.toast=function(t,e){void 0===e&&(e=1500)},t.prototype.showGameClub=function(t,e,i,o){},t.prototype.hideGameClub=function(){},t.prototype.removeGameClub=function(){},t.prototype.vibrateShort=function(){},t.prototype.vibrateLong=function(){},t.prototype.setAudioOption=function(t,e){},t.prototype.playAudio=function(t,e,i,o,n){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=!1)},t.prototype.addAudioCallback=function(t,e){},t.prototype.resumeAudio=function(t){},t.prototype.pauseAudio=function(t){},t.prototype.stopAudio=function(t){},t.prototype.destroyAudio=function(t){},t.prototype.onAudioInterruptionEnd=function(){},t.prototype.onShow=function(t){},t.prototype.onHide=function(){},t.prototype.triggerGC=function(){},t.prototype.exitGame=function(){},t.prototype.checkFileAccess=function(t,e,i){e&&e()},t.prototype.popMoreGamesDialog=function(t,e,i,o){},t.prototype.createMoreGamesButton=function(t,e,i,o,n,s,r,a,h,l,c){void 0===c&&(c=0)},t.prototype.showMoreGamesButton=function(){},t.prototype.hideMoreGamesButton=function(){},t.prototype.prepareGameRecord=function(t,e,i,o,n){},t.prototype.startGameRecord=function(t){void 0===t&&(t=300)},t.prototype.stopGameRecord=function(){},t.prototype.pauseGameRecord=function(){},t.prototype.resumeGameRecord=function(){},t.prototype.clearGameRecord=function(){},t.prototype.cutGameRecordClip=function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===o&&(o=null)},t.prototype.clipGameRecord=function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null)},t.prototype.shareRecordVideo=function(t,e,i,o,n,s){},t.prototype.isCorrectVerCode=function(t){},t.prototype.shareQG=function(t,e,i,o){},t.prototype.installedShortcut=function(){},t.prototype.writeFile=function(t,e,i,o){void 0===i&&(i="utf8"),void 0===o&&(o=0)},t.prototype.preloadNativeAd=function(t,e,i,o,s,r){void 0===i&&(i=720),void 0===o&&(o=288),void 0===s&&(s=25),void 0===r&&(r=null),n.BannerSimUI.addTestBannerHolder(t,e?e.asCom:null)},t.prototype.showNativeAd=function(t,e,i,o){void 0===o&&(o=!0),n.BannerSimUI.showTestBannerHolder(t)},t.prototype.hideNativeAd=function(t){n.BannerSimUI.hideTestBannerHolder(t)},t.prototype.hideAllNativeAd=function(){n.BannerSimUI.hideAllTestBanner()},t}();i.MinigamePlatDef=r,cc._RF.pop()},{"../game_ui/common/ad_sim_ui":"ad_sim_ui","./structure/hd_map":"hd_map"}],mgp_util:[function(t,e,i){"use strict";cc._RF.push(e,"207d7Plv+JKPJW2PQkCFYYf","mgp_util"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./global_def"),n=t("./wx_util"),s=t("./mgp_def"),r=t("./tt_util"),a=t("./qg_util"),h=function(){function t(){}return Object.defineProperty(t,"sdkInfo",{get:function(){return this.util_.sdkInfo},enumerable:!0,configurable:!0}),t.init=function(){o.G.isByteDance?this.util_=new r.TtUtil:o.G.isWeChat?this.util_=new n.WxUtil:o.G.isQuickGame?this.util_=new a.QgUtil:this.util_=new s.MinigamePlatDef},t.saveData=function(){this.util_.saveData()},t.readData=function(){this.util_.readData()},t.fetchSdkInfo=function(){this.util_.fetchSdkInfo()},t.compareVersion=function(t,e){return this.util_.compareVersion(t,e)},t.convertMenuButtonRect=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.util_.convertMenuButtonRect(t,e)},t.login=function(t,e,i,o,n){void 0===o&&(o=!1),void 0===n&&(n=!1),this.util_.login(t,e,i,o,n)},t.fetchUserInfo=function(t,e,i,o,n,s){this.util_.fetchUserInfo(t,e,i,o,n,s)},t.uploadUserInfo=function(t,e,i,o,n,s){this.util_.uploadUserInfo(t,e,i,o,n,s)},t.showForward=function(t){this.util_.showForward(t)},t.shareNorm=function(t,e,i,o){this.util_.shareNorm(t,e,i,o)},t.shareForTMSDK=function(t,e,i,o){void 0===o&&(o=""),this.util_.shareForTMSDK(t,e,i,o)},t.normShareResult=function(){this.util_.normShareResult()},t.launchQueryCheck=function(t){void 0===t&&(t=!1),this.util_.launchQueryCheck(t)},t.onShowQueryCheck=function(t,e){void 0===e&&(e=!1),this.util_.onShowQueryCheck(t,e)},t.reqTimerReset=function(t,e,i){this.util_.reqTimerReset(t,e,i)},t.reqTimerResetUnion=function(t,e,i,o){this.util_.reqTimerResetUnion(t,e,i,o)},t.watchVideoAds=function(t,e,i,o,n,s,r){void 0===r&&(r=""),this.util_.watchVideoAds(t,e,i,o,n,s,r)},t.bannerStat=function(t){this.util_.bannerStat(t)},t.recordBannerCDTimestamp=function(){this.util_.recordBannerCDTimestamp()},t.isBannerClickCD=function(){return this.util_.isBannerClickCD()},t.recordBannerClickSucTimestamp=function(){this.util_.recordBannerClickSucTimestamp()},t.decideBannerClickSuc=function(){this.util_.decideBannerClickSuc()},t.showBannerWithRule=function(t,e,i,o){void 0===o&&(o=""),this.util_.showBannerWithRule(t,e,i,o)},t.hideBannerWithRule=function(t,e){void 0===e&&(e=""),this.util_.hideBannerWithRule(t,e)},t.preloadBanner=function(t,e,i,o,n,s,r,a,h){void 0===o&&(o=15),void 0===n&&(n=null),void 0===s&&(s=null),void 0===r&&(r=1),void 0===a&&(a=4),void 0===h&&(h=""),this.util_.preloadBanner(t,e,i,o,n,s,r,a,h)},t.isBannerShowed=function(t,e){return void 0===e&&(e=""),this.util_.isBannerShowed(t,e)},t.isBannerLimited=function(t,e){return void 0===e&&(e=""),this.util_.isBannerLimited(t,e)},t.showBanner=function(t,e){void 0===e&&(e=""),this.util_.showBanner(t,e)},t.hideBanner=function(t,e){void 0===e&&(e=""),this.util_.hideBanner(t,e)},t.showLastOne=function(){this.util_.showLastOne()},t.hideLastOne=function(){this.util_.hideLastOne()},t.destroyBanner=function(t,e){void 0===e&&(e=""),this.util_.destroyBanner(t,e)},t.hideAllBanners=function(){this.util_.hideAllBanners()},t.addInterstitialAd=function(t){this.util_.addInterstitialAd(t)},t.showInterstitialAd=function(){this.util_.showInterstitialAd()},t.checkVersionUpdate=function(t,e){this.util_.checkVersionUpdate(t,e)},t.modalDialog=function(t,e,i,o,n,s,r,a,h){void 0===n&&(n=!0),void 0===s&&(s="\u53d6\u6d88"),void 0===r&&(r="#000000"),void 0===a&&(a="\u786e\u5b9a"),void 0===h&&(h="#3cc51f"),this.util_.modalDialog(t,e,i,o,n,s,r,a,h)},t.toast=function(t,e){void 0===e&&(e=1500),this.util_.toast(t,e)},t.showGameClub=function(t,e,i,o){this.util_.showGameClub(t,e,i,o)},t.hideGameClub=function(){this.util_.hideGameClub()},t.removeGameClub=function(){this.util_.removeGameClub()},t.vibrateShort=function(){this.util_.vibrateShort()},t.vibrateLong=function(){this.util_.vibrateLong()},t.setAudioOption=function(t,e){this.util_.setAudioOption(t,e)},t.playAudio=function(t,e,i,o,n){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=!1),this.util_.playAudio(t,e,i,o,n)},t.addAudioCallback=function(t,e){this.util_.addAudioCallback(t,e)},t.resumeAudio=function(t){this.util_.resumeAudio(t)},t.pauseAudio=function(t){this.util_.pauseAudio(t)},t.stopAudio=function(t){this.util_.stopAudio(t)},t.destroyAudio=function(t){this.util_.destroyAudio(t)},t.onAudioInterruptionEnd=function(){this.util_.onAudioInterruptionEnd()},t.onShow=function(t){this.util_.onShow(t)},t.onHide=function(){this.util_.onHide()},t.triggerGC=function(){this.util_.triggerGC()},t.exitGame=function(){this.util_.exitGame()},t.checkFileAccess=function(t,e,i){this.util_.checkFileAccess(t,e,i)},Object.defineProperty(t,"gameRecordVideoTempPath",{get:function(){return this.util_.gameRecordVideoTempPath},enumerable:!0,configurable:!0}),Object.defineProperty(t,"gameRecordClipIndexList",{get:function(){return this.util_.gameRecordClipIndexList},enumerable:!0,configurable:!0}),t.popMoreGamesDialog=function(t,e,i,o){this.util_.popMoreGamesDialog(t,e,i,o)},t.createMoreGamesButton=function(t,e,i,o,n,s,r,a,h,l,c){void 0===c&&(c=0),this.util_.createMoreGamesButton(t,e,i,o,n,s,r,a,h,l,c)},t.showMoreGamesButton=function(){this.util_.showMoreGamesButton()},t.hideMoreGamesButton=function(){this.util_.hideMoreGamesButton()},t.prepareGameRecord=function(t,e,i,o,n){this.util_.prepareGameRecord(t,e,i,o,n)},t.startGameRecord=function(t){void 0===t&&(t=300),this.util_.startGameRecord(t)},t.stopGameRecord=function(){this.util_.stopGameRecord()},t.pauseGameRecord=function(){this.util_.pauseGameRecord()},t.resumeGameRecord=function(){this.util_.resumeGameRecord()},t.clearGameRecord=function(){this.util_.clearGameRecord()},t.cutGameRecordClip=function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===o&&(o=null),this.util_.cutGameRecordClip(t,e,i,o)},t.clipGameRecord=function(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null),this.util_.clipGameRecord(t,e,i,o)},t.shareRecordVideo=function(t,e,i,o,n,s){this.util_.shareRecordVideo(t,e,i,o,n,s)},t.isCorrectVerCode=function(t){return this.util_.isCorrectVerCode(t)},t.shareQG=function(t,e,i,o){this.util_.shareQG(t,e,i,o)},t.installedShortcut=function(){this.util_.installedShortcut()},t.writeFile=function(t,e,i,o){void 0===i&&(i="utf8"),void 0===o&&(o=0),this.util_.writeFile(t,e,i,o)},t.preloadNativeAd=function(t,e,i,o,n,s){void 0===i&&(i=720),void 0===o&&(o=288),void 0===n&&(n=25),void 0===s&&(s=null),this.util_.preloadNativeAd(t,e,i,o,n,s)},t.showNativeAd=function(t,e,i,o){void 0===o&&(o=!0),this.util_.showNativeAd(t,e,i,o)},t.hideNativeAd=function(t){this.util_.hideNativeAd(t)},t.hideAllNativeAd=function(){this.util_.hideAllNativeAd()},t.util_=null,t}();i.MgpUtil=h,cc._RF.pop()},{"./global_def":"global_def","./mgp_def":"mgp_def","./qg_util":"qg_util","./tt_util":"tt_util","./wx_util":"wx_util"}],popup_ui:[function(t,e,i){"use strict";cc._RF.push(e,"4e21d8j4VhKPIA3BNGaXBdg","popup_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lbl_=null,e}return o(e,t),e.prototype.init=function(t){t&&(this.com_=t,this.lbl_=t.getChild("txtLbl").asTextField)},e.prototype.show=function(t){this.com_&&(this.lbl_.text=t,this.com_.setSize(this.lbl_.actualWidth+20,this.lbl_.actualHeight+20),fgui.GRoot.inst.showPopup(this.com_))},e.instance=new e,e}(t("./base_ui").BaseUI);i.PopupUI=n,i.PopupUIInst=n.instance,cc._RF.pop()},{"./base_ui":"base_ui"}],qg_util:[function(t,e,i){"use strict";cc._RF.push(e,"e31f57wXB1LGreJUxqvvWI2","qg_util");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("../game_setting"),s=t("./structure/hd_map"),r=t("./event_mgr"),a=t("./timed_task"),h=t("../data/data_hub"),l=t("./global_def"),c=t("../game_ui/common/ad_sim_ui"),u=t("../game_ui/common/base_ui"),d=t("./mgp_def"),_=t("../game/user_info"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.nativeAdMap_=new s.HDMap,e.audioInfoMap_=new s.HDMap,e}return o(e,t),e.prototype.fetchSdkInfo=function(){this.sdkInfo=qg.getSystemInfoSync(),console.log("[QgUtil SDK info]",this.sdkInfo.screenWidth,this.sdkInfo.screenHeight,this.sdkInfo.platform,this.sdkInfo.SDKVersion,this.sdkInfo.appName),1==n.GameSetting.testServer&&(this.domain_="http://119.23.108.126:8900/comLogin")},e.prototype.isCorrectVerCode=function(t){return this.sdkInfo&&this.sdkInfo.platformVersionCode>=t},e.prototype.compareVersion=function(t,e){for(var i=t.split("."),o=e.split("."),n=Math.max(i.length,o.length);i.length<n;)i.push("0");for(;o.length<n;)o.push("0");for(var s=0;s<n;s++){var r=parseInt(i[s]),a=parseInt(o[s]);if(r>a)return 1;if(r<a)return-1}return 0},e.prototype.showForward=function(t){},e.prototype.installedShortcut=function(){this.isCorrectVerCode(1041)&&qg.hasShortcutInstalled({success:function(t){t||qg.installShortcut({message:"\u662f\u5426\u521b\u5efa\u684c\u9762\u56fe\u6807\uff0c\u4ee5\u4fbf\u4e0b\u6b21\u66f4\u5feb\u6377\u7684\u8fdb\u5165\u6e38\u620f"})}})},e.prototype.writeFile=function(t,e,i,o){void 0===i&&(i="utf8"),void 0===o&&(o=0),this.isCorrectVerCode(1031)&&qg.writeFileSync({uri:t,text:e,encoding:i,position:o})},e.prototype.shareQG=function(t,e,i,o){this.isCorrectVerCode(1055)&&qg.share({success:function(){t&&t()},fail:function(t,e){console.log("shareNorm fail",t,e),i&&i(t,e)},cancel:function(){e&&e()},complete:function(){o&&o()}})},e.prototype.normShareResult=function(){},e.prototype.onShowQueryCheck=function(t){},e.prototype._getVideoBonus=function(){this.videoBonusCallback_&&(this.videoBonusCallback_(),this.videoBonusCallback_=null)},e.prototype.watchVideoAds=function(t,e,i,o,n,s,c){var u=this;void 0===c&&(c="");this.sdkInfo;if(this.isCorrectVerCode(1041)){var d=function(o){if(u.videoAdsProtectFlags_.containsKey(t)&&1===u.videoAdsProtectFlags_.get(t))return;console.log("Ads Close callback",o.isEnded),r.GameEventMgrInst.addEvent(r.EventType.kAudioResume,null,{pauseType:1}),o&&o.isEnded?(e&&e(),u.videoAdsProtectFlags_.put(t,1)):(i&&i(),u.toast("\u8bf7\u89c2\u770b\u5b8c\u6574\u89c6\u9891\u4ee5\u83b7\u53d6\u5956\u52b1"),u.videoAdsProtectFlags_.put(t,0)),u.videoTimeId_>0&&(a.TimedTaskInst.remove(u.videoTimeId_),u.videoTimeId_=0),u.videoBonusCallback_=null},_=function(t){switch(r.GameEventMgrInst.addEvent(r.EventType.kAudioResume,null,{pauseType:1}),t.errCode){case-3:console.log("\u6fc0\u52b1\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25---\u8c03\u7528\u592a\u9891\u7e41"),u.toast("\u6682\u65e0\u5408\u9002\u7684\u5e7f\u544a\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",2);break;case-4:console.log("\u6fc0\u52b1\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25--- \u4e00\u5206\u949f\u5185\u4e0d\u80fd\u91cd\u590d\u52a0\u8f7d"),u.toast("\u6682\u65e0\u5408\u9002\u7684\u5e7f\u544a\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",2);break;case 30008:u.toast("\u6682\u65e0\u5408\u9002\u7684\u5e7f\u544a\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",2),o&&o(t);break;default:console.log("\u6fc0\u52b1\u5e7f\u544a\u5c55\u793a\u5931\u8d25",t.errCode),u.toast("\u6682\u65e0\u5408\u9002\u7684\u5e7f\u544a\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",2),o&&o(t)}u.videoBonusCallback_=null},p=function(){console.log("video show"),r.GameEventMgrInst.addEvent(r.EventType.kAudioPause,null,{pauseType:1}),l.G.randRange(0,100)<=h.DataHub.config.videoBonus&&(u.videoTimeId_>0&&(a.TimedTaskInst.remove(u.videoTimeId_),u.videoTimeId_=0),u.videoBonusCallback_=s,u.videoTimeId_=a.TimedTaskInst.add(function(){var t=c||"\u70b9\u51fb\u5e95\u90e8\u6761\u5e45\u53ef\u83b7\u5f97\u5956\u52b1";u.toast(t,5e3)},5));var t=u.videoAd_.show();t&&t.catch(function(t){console.log("\u6fc0\u52b1\u5e7f\u544a\u5c55\u793a\u5931\u8d25",t)})};this.videoAd_=qg.createRewardedVideoAd({posId:t}),this.videoAd_.onClose(d),this.videoAd_.onError(_),this.videoAd_.onLoad(p);var f=this.videoAd_.load();if(f&&f.catch(function(t){console.log("\u6fc0\u52b1\u5e7f\u544aload\u5931\u8d25",t)}),this.videoAdsCallbackMap_.containsKey(t)){var m=this.videoAdsCallbackMap_.get(t);this.videoAd_.offClose(m.closeCallback),this.videoAd_.offError(m.errCallback),this.videoAd_.offLoad(m.loadCallback),this.videoAdsCallbackMap_.remove(t)}var v=new g(d,_,p);this.videoAdsCallbackMap_.put(t,v),n&&n()}else this.modalDialog("\u63d0\u793a","\u5fae\u4fe1\u7248\u672c\u8f83\u4f4e\uff0c\u6682\u4e0d\u652f\u6301\u89c6\u9891\u89c2\u770b",null,null,!1)},e.prototype.bannerStat=function(t){if(t&&t.mode&&t.targetAction){if("back"==t.mode&&3==t.targetAction||"hide"==t.mode&&-1==t.targetAction)return;this._getVideoBonus()}},e.prototype._calBannerXYWZ=function(t,e,i,o){void 0===i&&(i=1),void 0===o&&(o=15);var n=Math.max(Math.min(t,208),128),s=n/16*9,r=0,a=0;if(e){var h=cc.view.getVisibleSize().height,l=e.localToGlobal().y,c=(l+o)/h;a=this.sdkInfo.screenHeight*c,console.log("_calBannerXYWZ node",c,l,o,h-l,h,a,this.sdkInfo.screenHeight)}else r=.5*(this.sdkInfo.screenWidth-n),a=this.sdkInfo.screenHeight-s-25,0==i&&(a=0),console.log("_calBannerXYWZ norm",n,s,r,a);return{x:r,y:a,w:n,h:s}},e.prototype.preloadBanner=function(t,e,i,o,n,s,r,a,h){var u=this;void 0===i&&(i=208),void 0===o&&(o=15),void 0===n&&(n=null),void 0===s&&(s=null),void 0===r&&(r=1),void 0===a&&(a=4),void 0===h&&(h="");var d=t;if(t+=h,!l.G.isQuickGame)return c.BannerSimUI.addTestBannerHolder(t,e?e.asCom:null,r),void(n&&n());if(this.isCorrectVerCode(1031)){if(a>1e3&&this.bnrItemMap_.containsKey(t))this.bnrItemMap_.get(t).refreshCnt>=a&&this.destroyBanner(t);var _=null;if(!this.bnrItemMap_.containsKey(t)){_=new m;var p=this._calBannerXYWZ(i,e,r,o);_.obj=qg.createBannerAd({posId:d,style:{left:p.x,top:p.y,width:p.w}}),_.id=t,_.refreshCnt=0,_.refreshRule=a,_.errCb=s,_.x=p.x,_.y=p.y,_.w=p.w,_.h=p.h,_.adErrCallback=function(t){l.G.log("Banner Ads pull failed",t),++_.refreshCnt,u.isCorrectVerCode(1031)&&t.errCode&&(1e3==t.errCode||1003==t.errCode||(_.bLimited=!0)),_.errCb&&_.errCb()},_.obj.onError(_.adErrCallback.bind(_));var f=function(t){_.obj.style.top=p.y,_.obj.style.left=(u.sdkInfo.screenWidth-t.width)/2,_.obj.offSize(f)};_.obj.onSize(f);var g=function(){l.G.log("Banner pull success"),n&&n(),_.obj.offLoad(g)};_.obj.onLoad(g),this.bnrItemMap_.put(t,_)}}},e.prototype.isBannerShowed=function(t,e){if(void 0===e&&(e=""),t+=e,!l.G.isQuickGame)return c.BannerSimUI.isTestBannerHolderShowed(t);var i=!1;this.bnrItemMap_.containsKey(t)&&(i=this.bnrItemMap_.get(t).bShow);return i},e.prototype.isBannerLimited=function(t,e){if(void 0===e&&(e=""),t+=e,!l.G.isQuickGame)return c.BannerSimUI.isTestBannerLimited(t);var i=!1;this.bnrItemMap_.containsKey(t)&&(i=this.bnrItemMap_.get(t).bLimited);return i},e.prototype.showBanner=function(t,e){var i=this;void 0===e&&(e="");var o=t;if(t+=e,l.G.isQuickGame){if(this.isCorrectVerCode(1031)&&(this.hideLastOne(),this.bnrItemMap_.containsKey(t))){var n=this.bnrItemMap_.get(t);if(n.refreshRule<1e3&&n.refreshCnt>=n.refreshRule){var s=new m;s.obj=qg.createBannerAd({adUnitId:o,style:{left:n.x,top:n.y,width:n.w}}),s.id=t,s.refreshCnt=0,s.refreshRule=n.refreshRule,s.errCb=n.errCb,s.adErrCallback=function(t){l.G.log("Banner Ads pull failed",t),++s.refreshCnt,i.isCorrectVerCode(1031)&&t.errCode&&(1e3==t.errCode||1003==t.errCode||(s.bLimited=!0)),s.errCb&&s.errCb()},s.obj.onError(s.adErrCallback.bind(s));var r=function(t){console.log(t.width,t.height),n.obj.style.top=n.y,n.obj.style.left=(i.sdkInfo.screenWidth-t.width)/2,n.obj.offSize(r)};n.obj.onSize(r),s.x=n.x,s.y=n.y,s.w=n.w,s.h=n.h,n.del(),this.bnrItemMap_.remove(t),this.bnrItemMap_.put(t,s),n=s}n.show(),this.lastBnrItemStack_.push(n)}}else c.BannerSimUI.showTestBannerHolder(t)},e.prototype.hideBanner=function(t,e){(void 0===e&&(e=""),t+=e,l.G.isQuickGame)?this.bnrItemMap_.containsKey(t)&&(this.bnrItemMap_.get(t).hide(),this.lastBnrItemStack_.pop(),this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].show()):c.BannerSimUI.hideTestBannerHolder(t)},e.prototype.showLastOne=function(){l.G.isQuickGame?this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].show():c.BannerSimUI.showLastTestBanner()},e.prototype.hideLastOne=function(){l.G.isQuickGame?this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].hide():c.BannerSimUI.hideLastTestBanner()},e.prototype.destroyBanner=function(t,e){if(void 0===e&&(e=""),t+=e,this.bnrItemMap_.containsKey(t)){this.bnrItemMap_.get(t).del();for(var i=0;i<this.lastBnrItemStack_.length;++i)if(this.lastBnrItemStack_[i].id===t){this.lastBnrItemStack_.splice(i,1);break}this.bnrItemMap_.remove(t)}},e.prototype.hideAllBanners=function(){var t=this;l.G.isQuickGame?(this.hideLastOne(),this.bnrItemMap_.each(function(e,i,o){t.hideBanner(i)})):c.BannerSimUI.hideAllTestBanner()},e.prototype.createInterstitialAd=function(t){if(this.isCorrectVerCode(1031)){var e=qg.createInsertAd({posId:t});e&&e.show().then(function(){console.log("interstitial ad show")}).catch(function(t){console.log("interstitial ad failed",t.code)})}},e.prototype.preloadNativeAd=function(t,e,i,o,n,s){if(void 0===i&&(i=720),void 0===o&&(o=288),void 0===n&&(n=25),void 0===s&&(s=null),l.G.isQuickGame){if(this.isCorrectVerCode(1053)){l.G.log("preloadNativeAd",t);var r=.5*(cc.view.getVisibleSize().width-i),a=e?e.localToGlobal().y+n:cc.view.getVisibleSize().height-o-20,h=new v(t,r,a,i,o);h.load(null,s),this.nativeAdMap_.put(t,h)}}else c.BannerSimUI.addTestBannerHolder(t,e?e.asCom:null)},e.prototype.showNativeAd=function(t,e,i,o){(void 0===o&&(o=!0),l.G.isQuickGame)?this.nativeAdMap_.containsKey(t)&&this.nativeAdMap_.get(t).show(e,i,o):c.BannerSimUI.showTestBannerHolder(t)},e.prototype.hideNativeAd=function(t){l.G.isQuickGame?this.nativeAdMap_.containsKey(t)&&this.nativeAdMap_.get(t).hide():c.BannerSimUI.hideTestBannerHolder(t)},e.prototype.hideAllNativeAd=function(){var t=this;l.G.isQuickGame?(this.hideAllNativeAd(),this.nativeAdMap_.each(function(e,i,o){t.hideNativeAd(i)})):c.BannerSimUI.hideAllTestBanner()},e.prototype.checkVersionUpdate=function(t,e){var i=this;qg.onUpdateReady(function(t){1==t&&i.modalDialog("\u66f4\u65b0\u63d0\u793a","\u65b0\u7248\u672c\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u8bf7\u91cd\u542f\u6e38\u620f",function(){qg.applyUpdate()},null,!1)})},e.prototype.modalDialog=function(t,e,i,o,n){void 0===n&&(n=!0),qg.showDialog({title:t,message:e,buttons:n?[{text:"\u786e\u5b9a",color:"#33dd44"},{text:"\u53d6\u6d88",color:"#000000"}]:[{text:"\u786e\u5b9a",color:"#33dd44"}],success:function(t){console.log("handling callback"),i&&i()},cancel:function(){console.log("handling cancel"),o&&o()}})},e.prototype.toast=function(t,e){void 0===e&&(e=1500),qg.showToast({message:t,duration:e})},e.prototype.vibrateShort=function(){qg.vibrateShort()},e.prototype.vibrateLong=function(){qg.vibrateLong()},e.prototype.playAudio=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=1);var o=null;if(this.audioInfoMap_.containsKey(t)?o=this.audioInfoMap_.get(t):(o=new f(t),this.audioInfoMap_.put(t,o)),o){var n=o.obj;n&&(n.src=t,n.volume=i,n.loop=e,n.play())}},e.prototype.addAudioCallback=function(t,e){if(this.audioInfoMap_.containsKey(t)){var i=this.audioInfoMap_.get(t);i.endCallback&&i.obj.offEnded(i.endCallback),i.endCallback=e,i.obj.onEnded(i.endCallback)}},e.prototype.resumeAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.play()},e.prototype.pauseAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.pause()},e.prototype.stopAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.stop()},e.prototype.destroyAudio=function(t){if(this.audioInfoMap_.containsKey(t)){var e=this.audioInfoMap_.get(t);e.endCallback&&e.obj.offEnded(e.endCallback),e.obj.destroy(),this.audioInfoMap_.remove(t)}},e.prototype.onShow=function(t){var e=this;void 0===t&&(t=!1),qg.onShow(function(t){r.GameEventMgrInst.addEvent(r.EventType.kAudioResume,null,{pauseType:2}),l.G.log("onShow"),e.onShowQueryCheck(t.query),e.normShareResult(),cc.director.resume(),_.GameUserInfo.calOfflineTime(),e.decideBannerClickSuc()})},e.prototype.onHide=function(){var t=this;qg.onHide(function(e){cc.director.pause(),r.GameEventMgrInst.addEvent(r.EventType.kAudioPause,null,{pauseType:2}),t.bannerStat(e),_.GameUserInfo.setOfflineTimestamp(),_.GameUserInfo.saveSignIn()})},e.prototype.triggerGC=function(){qg.triggerGC()},e.prototype.exitGame=function(){qg.exitApplication({})},e}(d.MinigamePlatDef);i.QgUtil=p;var f=function(){return function(t){this.obj=null,this.endCallback=null,this.obj=qg.createInnerAudioContext()}}(),g=function(){return function(t,e,i){this.closeCallback=null,this.errCallback=null,this.loadCallback=null,this.closeCallback=t,this.errCallback=e,this.loadCallback=i}}(),m=function(){function t(){this.id="",this.obj=null,this.errCb=null,this.adErrCallback=null,this.refreshRule=4,this.refreshCnt=0,this.x=0,this.y=0,this.w=0,this.h=0,this.bShow=!1,this.bLimited=!1}return t.prototype.show=function(){var t=this;this.obj&&(++this.refreshCnt,this.obj.show().then(function(e){console.log("banner show",t.id)}).catch(function(e){console.log("banner show err",e),++t.refreshCnt}),this.bShow=!0)},t.prototype.hide=function(){this.obj&&(this.obj.hide(),this.bShow=!1)},t.prototype.del=function(){this.obj&&(this.adErrCallback&&(this.obj.offError(this.adErrCallback),this.adErrCallback=null),this.obj.destroy())},t}(),v=function(){function t(t,e,i,o,n){this.id_="",this.obj_=null,this.currAd_=null,this.errCb_=null,this.holder_=null,this.imgLdr_=null,this.showCnt_=0,this.x_=0,this.y_=0,this.bLoadToShow=!1,this.id_=t,this.obj_=qg.createNativeAd({posId:t}),this.obj_.onLoad(this._onLoaded.bind(this));var s=fairygui.UIPackage.createObject("CommUI","BnrTestHolder");s?(l.G.log("[NativeBnrItem] create holder succ"),this.holder_=s.asCom,this.holder_.setPosition(e,i),this.holder_.setSize(o,n),this.x_=e,this.y_=i,this.holder_.getChild("bg").asCom.visible=!1,this.imgLdr_=this.holder_.getChild("imgLdr").asLoader):l.G.log("[NativeBnrItem] create holder failed")}return t.prototype.load=function(t,e){var i=this;if(l.G.log("native load obj",this.obj_),this.obj_){this.errCb_=e;var o=this.obj_.load();o&&o.then(function(e){l.G.log("[NativeBnrItem] load succ",e),t&&t()}).catch(function(t){l.G.log("[NativeBnrItem] load failed",t),i.errCb_&&i.errCb_(),i.bLoadToShow&&(l.G.log("[NativeBnrItem] show old one"),i._show(i.currAd_))})}},t.prototype.show=function(e,i,o){void 0===o&&(o=!0),e&&(this.x_=e),i&&(this.y_=i),this.holder_.visible=!0,this.holder_.parent||u.BaseUI.root.addChild(this.holder_),this.holder_.onClick(this._onClick,this),!this.currAd_&&t.adList.length>0&&(this.currAd_=t.adList.shift()),this.currAd_&&this.showCnt_<=3&&!o?this._show(this.currAd_):(this.bLoadToShow=!0,this.showCnt_=0,this.load())},t.prototype.hide=function(){l.G.log("[NativeBnrItem] hide"),this.holder_.visible=!1,this.holder_.offClick(this._onClick,this),this.holder_.removeFromParent()},t.prototype._show=function(t){if(t){++this.showCnt_,this.holder_.setPosition(this.x_,this.y_);var e=t.imgUrlList[0];e&&(l.G.log("[NativeBnrItem] show",e,this.x_,this.y_),this.imgLdr_.url=e),this.obj_.reportAdShow({adId:t.adId.toString()})}},t.prototype._onLoaded=function(e){if(e&&e.adList){var i=e.adList.pop();i&&(this.bLoadToShow?(this.currAd_=i,this._show(i),this.bLoadToShow=!1):t.adList.push(i),l.G.log("[NativeBnrItem] load new ad",this.bLoadToShow,i))}},t.prototype._onClick=function(){this.currAd_&&(l.G.log("[NativeBnrItem] _onClick",this.currAd_),this.obj_.reportAdClick({adId:this.currAd_.adId.toString()}),this.currAd_=null,this.showCnt_=0,this.load())},t.adList=[],t}();cc._RF.pop()},{"../data/data_hub":"data_hub","../game/user_info":"user_info","../game_setting":"game_setting","../game_ui/common/ad_sim_ui":"ad_sim_ui","../game_ui/common/base_ui":"base_ui","./event_mgr":"event_mgr","./global_def":"global_def","./mgp_def":"mgp_def","./structure/hd_map":"hd_map","./timed_task":"timed_task"}],quad_tree:[function(t,e,i){"use strict";cc._RF.push(e,"c675cvtCbZMtJdUGldpbZTd","quad_tree"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e){this.objs_=[],this.nodes_=null,this.level_=0,this.bounds_=null,this.objs_=[],this.level_=t,this.bounds_=e,this.nodes_=new Array(4);for(var i=0;i<this.nodes_.length;++i)this.nodes_[i]=null}return t.prototype.clear=function(){this.objs_=[];for(var t=0;t<this.nodes_.length;++t)null!==this.nodes_[t]&&(this.nodes_[t].clear(),this.nodes_[t]=null)},t.prototype.draw=function(t){var e=t.getComponent(cc.Graphics);e.rect(this.bounds_.x,this.bounds_.y,this.bounds_.width,this.bounds_.height),e.stroke();for(var i=0;i<this.nodes_.length;++i)null!==this.nodes_[i]&&this.nodes_[i].draw(t)},t.prototype.split=function(){var e=this.bounds_.width/2,i=this.bounds_.height/2,o=this.bounds_.x,n=this.bounds_.y,s=this.level_+1;this.nodes_[0]=new t(s,new cc.Rect(o+e,n+i,e,i)),this.nodes_[1]=new t(s,new cc.Rect(o,n+i,e,i)),this.nodes_[2]=new t(s,new cc.Rect(o,n,e,i)),this.nodes_[3]=new t(s,new cc.Rect(o+e,n,e,i))},t.prototype.insert=function(t){var e=t.getBoundingBoxToWorld();if(null!==this.nodes_[0])for(var i=this._getIndex(e),o=0;o<i.length;++o){if(-1!==(a=i[o]))return void this.nodes_[a].insert(t)}if(this.objs_.push(t),this.objs_.length>10&&this.level_<5){null===this.nodes_[0]&&this.split();for(o=0;o<this.objs_.length;)for(var n=this.objs_[o],s=n.getBoundingBoxToWorld(),r=(i=this._getIndex(s),0);r<i.length;++r){var a;-1!==(a=i[r])?(this.nodes_[a].insert(n),this.objs_.splice(o,1)):++o}}},t.prototype.retrieve=function(t,e){for(var i=this._getIndex(e),o=0;o<i.length;++o){var n=i[o];-1!==n&&null!==this.nodes_[0]&&(t=this.nodes_[n].retrieve(t,e)),t=t.concat(this.objs_)}return t},t.prototype.refresh=function(t){for(var e=t||this,i=this.objs_.length-1;i>=0;--i){var o=this.objs_[i].getBoundingBoxToWorld();if(this._isInner(o,this.bounds_)){if(null!==this.nodes_[0])for(var n=this._getIndex(o),s=0;s<n.length;++s){var r,a=n[i];if(-1!==a&&null!==this.nodes_[0])(r=this.objs_.splice(i,1))&&this.nodes_[a].insert(r[0])}}else if(this!==e)(r=this.objs_.splice(i,1))&&e.insert(r[0])}i=0;for(var h=this.nodes_.length;i<h;++i)null!==this.nodes_[i]&&this.nodes_[i].refresh(e)},t.prototype._getIndex=function(t){var e=[],i=this.bounds_.center.y,o=this.bounds_.center.x,n=t.yMin>=i,s=t.yMax+1<=i,r=t.yMax+1>=i&&t.yMin-1<=i;return r&&(n=!1,s=!1),t.xMax-1>=o&&t.xMin+1<=o?n?(e.push(0),e.push(1)):s?(e.push(2),e.push(3)):r&&(e.push(0),e.push(1),e.push(2),e.push(3)):t.xMin-1>=o?n?e.push(0):s?e.push(3):r&&(e.push(0),e.push(3)):t.xMax+1<=o?n?e.push(1):s?e.push(2):r&&(e.push(1),e.push(2)):e.push(-1),e},t.prototype._isInner=function(t,e){return t.xMin>=e.xMin&&t.xMax<=e.xMax&&t.yMin>=e.yMin&&t.yMax<=e.yMax},t}();i.QuadTree=o,cc._RF.pop()},{}],setting_ui:[function(t,e,i){"use strict";cc._RF.push(e,"0bd65OYHFtBrYmfnKtg1ecU","setting_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n,s,r=t("./base_ui"),a=t("./tip_ui"),h=t("../../util/audio_mgr"),l=t("../../util/event_mgr"),c=t("../../util/game_storage");(function(t){t[t.kLow=1]="kLow",t[t.kMid=2]="kMid",t[t.kHigh=3]="kHigh"})(n=i.VFXLevel||(i.VFXLevel={})),function(t){t[t.kBgm=0]="kBgm",t[t.kSfx=1]="kSfx",t[t.kHighFx=2]="kHighFx",t[t.kMidFx=3]="kMidFx",t[t.kLowFx=4]="kLowFx"}(s||(s={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bgmToggle_=null,e.sfxToggle_=null,e.highFxRadio_=null,e.midFxRadio_=null,e.lowFxRadio_=null,e.backBtn_=null,e.homeBtn_=null,e.openTrans_=null,e.closeTrans_=null,e.closeCb_=null,e.vfxLv_=n.kMid,e.bVfx_=!1,e.bGame_=!1,e}return o(e,t),Object.defineProperty(e.prototype,"VFXLvl",{get:function(){return this.vfxLv_},set:function(t){this.vfxLv_=t,this._save()},enumerable:!0,configurable:!0}),e.prototype.init=function(t){t&&(this.com_=t,t.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this.bgmToggle_=t.getChild("bgmToggle").asButton,this.sfxToggle_=t.getChild("sfxToggle").asButton,this.highFxRadio_=t.getChild("fxHighRadio").asButton,this.midFxRadio_=t.getChild("fxMidRadio").asButton,this.lowFxRadio_=t.getChild("fxLowRadio").asButton,this.backBtn_=t.getChild("backBtn").asButton,this.homeBtn_=t.getChild("homeBtn").asButton,this.openTrans_=t.getTransition("openTrans"),this.closeTrans_=t.getTransition("closeTrans"),this.bgmToggle_.selected=!h.AudioMgr.instance.isStopMusic(),this.sfxToggle_.selected=!h.AudioMgr.instance.isStopSound(),fgui.GRoot.inst.volumeScale=this.sfxToggle_.selected?1:0,this._read(),this.bgmToggle_.on(fgui.Event.STATUS_CHANGED,this._onToggleChange,this),this.sfxToggle_.on(fgui.Event.STATUS_CHANGED,this._onToggleChange,this),this.highFxRadio_.on(fgui.Event.STATUS_CHANGED,this._onToggleChange,this),this.midFxRadio_.on(fgui.Event.STATUS_CHANGED,this._onToggleChange,this),this.lowFxRadio_.on(fgui.Event.STATUS_CHANGED,this._onToggleChange,this),this.backBtn_.onClick(this._onClose,this),this.homeBtn_.onClick(this._onHome,this),t.sortingOrder=r.UIHierarchy.kSetting,t.visible=!1,r.BaseUI.root.addChild(t))},e.prototype.show=function(t,e,i){var o=this;if(void 0===i&&(i=!1),this.com_){this.com_.visible=!0,this.bVfx_=!1,this.homeBtn_.visible=i,this.bLock_=!0,this.openTrans_.play(function(){o.bLock_=!1,t&&t()});var n=this.com_.getController("FxRadioGroup");3===this.vfxLv_?n.selectedIndex=0:2===this.vfxLv_?n.selectedIndex=1:1===this.vfxLv_&&(n.selectedIndex=2),this.bGame_=i,this.closeCb_=e}},e.prototype._onToggleChange=function(t){if(!this.bLock_){var e=t;e==this.bgmToggle_?h.AudioMgr.instance.setIfMuteMusic(!this.bgmToggle_.selected):e==this.sfxToggle_?(h.AudioMgr.instance.setIfMuteSound(!this.sfxToggle_.selected),fgui.GRoot.inst.volumeScale=this.sfxToggle_.selected?1:0):e==this.highFxRadio_?(this.vfxLv_=n.kHigh,this.bVfx_=!0):e==this.midFxRadio_?(this.vfxLv_=n.kMid,this.bVfx_=!0):e==this.lowFxRadio_&&(this.vfxLv_=n.kLow,this.bVfx_=!0)}},e.prototype._onClose=function(){var t=this;this.bLock_||this.com_&&(this._save(),this.closeCb_&&this.closeCb_(),l.GameEventMgr.instance.addEvent(l.EventType.kAdjustVfxLv,null,{lv:this.vfxLv_}),this.bGame_?(this.bVfx_&&a.TipUI.instance.show("\u6e38\u620f\u4e2d\u4ec5\u90e8\u5206\u7279\u6548\u8bbe\u7f6e\u751f\u6548"),this.com_.visible=!1):this.closeTrans_.play(function(){t.com_.visible=!1}))},e.prototype._onHome=function(){this.bLock_||this._onClose()},e.prototype._save=function(){var t={effLv:this.vfxLv_};c.GameStorage.writeJSON(c.SaveDef.kSetting,t)},e.prototype._read=function(){var t=c.GameStorage.readJSON(c.SaveDef.kSetting);this.vfxLv_=t?t.effLv:n.kMid},e.instance=new e,e}(r.BaseUI);i.SettingUI=u,i.SettingUIInst=u.instance,cc._RF.pop()},{"../../util/audio_mgr":"audio_mgr","../../util/event_mgr":"event_mgr","../../util/game_storage":"game_storage","./base_ui":"base_ui","./tip_ui":"tip_ui"}],shaker:[function(t,e,i){"use strict";cc._RF.push(e,"5c35eQdXjlGo6erMxgnpZxs","shaker"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../global_def");(function(t){t[t.kHor=0]="kHor",t[t.kHorReg=1]="kHorReg",t[t.kVer=2]="kVer",t[t.kVerReg=3]="kVerReg",t[t.kRand=4]="kRand"})(o=i.ShakeType||(i.ShakeType={}));var s=function(){function t(){this.minRange_=0,this.maxRange_=0,this.attenuation_=0,this.atteFreq_=0,this.atteFreqVar_=0,this.atteFreqVarF_=0,this.freq_=0,this.freqVar_=0,this.freqVarF_=0,this.dura_=0,this.type_=0,this.shakeDura_=0,this.shakeTimer_=0,this.atteTimer_=0,this.atteFvTimer_=0,this.freqFvTimer_=0,this.attenuationCp_=0,this.atteFreqCp_=0,this.minRangeCp_=0,this.maxRangeCp_=0,this.freqCp_=0,this.horSign_=0,this.verSign_=0,this.origXs_=[],this.origYs_=[],this.nodes_=null,this.callback_=null,this.cbParams_=null,this.bRun_=!1}return t.prototype.init=function(t,e,i,n,s,r){void 0===r&&(r=o.kRand),this.nodes_=t,this.minRange_=e,this.maxRange_=i,this.freq_=n,this.dura_=s,this.type_=r,this.minRangeCp_=e,this.maxRangeCp_=i,this.freqCp_=n;for(var a=0;a<this.nodes_.length;++a)this.origXs_[a]=this.nodes_[a].x,this.origYs_[a]=this.nodes_[a].y},t.prototype.appendAttenuation=function(t,e,i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.attenuation_=t,this.atteFreq_=e,this.atteFreqVar_=i,this.atteFreqVarF_=o,this.attenuationCp_=t,this.atteFreqCp_=e},t.prototype.appendFreqVariable=function(t,e){this.freqVar_=t,this.freqVarF_=e},t.prototype.appendOverCallback=function(t,e){void 0===e&&(e=null),this.callback_=t,this.cbParams_=e},t.prototype.shake=function(){if(n.G.isExistObj(this.nodes_)){this.bRun_=!0,this.shakeDura_=0,this.horSign_=0,this.verSign_=0,this.attenuation_=this.attenuationCp_,this.atteFreq_=this.atteFreqCp_,this.minRange_=this.minRangeCp_,this.maxRange_=this.maxRangeCp_,this.freq_=this.freqCp_,this.shakeTimer_=0,this.atteFvTimer_=0,this.atteTimer_=0,this.freqFvTimer_=0;for(var t=0;t<this.nodes_.length;++t)this.nodes_[t].x=this.origXs_[t],this.nodes_[t].y=this.origYs_[t]}else n.G.log("[Shaker shake func] - There's no valid node specified",3)},t.prototype.stop=function(){this.shake(),this.bRun_=!1},t.prototype.update=function(t){if(this.bRun_){if(this.shakeDura_+=t,this.shakeDura_>=this.dura_){for(var e=0;e<this.nodes_.length;++e)this.nodes_[e].x=this.origXs_[e],this.nodes_[e].y=this.origYs_[e];return this.callback_&&this.callback_(this.cbParams_),void(this.bRun_=!1)}if(this.shakeTimer_-=t,this.shakeTimer_<=0){this.shakeTimer_=this.freq_;var i=this._calOffset();for(e=0;e<this.nodes_.length;++e)this.nodes_[e].x=this.origXs_[e]+i.x,this.nodes_[e].y=this.origYs_[e]+i.y}0!=this.freqVar_&&(this.freqFvTimer_-=t,this.freqFvTimer_<=0&&(this.freqFvTimer_=this.freqVarF_,this.freq_+=this.freqVar_)),0!=this.attenuation_&&(this.atteTimer_-=t,this.atteTimer_<=0&&(this.atteTimer_=this.atteFreq_,this.minRange_-=this.attenuation_,this.minRange_<=0&&(this.minRange_=0),this.maxRange_-=this.attenuation_,this.maxRange_<=0&&(this.maxRange_=0)),0!=this.atteFreqVar_&&(this.atteFvTimer_-=t,this.atteFvTimer_<=0&&(this.atteFvTimer_=this.atteFreqVarF_,this.atteFreq_+=this.atteFreqVar_)))}},t.prototype._calOffset=function(){var t=0,e=0;return this.type_==o.kHor?(t=n.G.randRangeF(this.minRange_,this.maxRange_),n.G.randRangeF(1,100)>50&&(t=-t)):this.type_==o.kHorReg?(t=n.G.randRangeF(this.minRange_,this.maxRange_)*this.horSign_,0==this.horSign_?n.G.randRangeF(1,100)>50?this.horSign_=1:this.horSign_=-1:this.horSign_=-this.horSign_):this.type_==o.kVer?(e=n.G.randRangeF(this.minRange_,this.maxRange_),n.G.randRangeF(1,100)>50&&(e=-e)):this.type_==o.kVerReg?(e=n.G.randRangeF(this.minRange_,this.maxRange_)*this.verSign_,0==this.verSign_?n.G.randRangeF(1,100)>50?this.verSign_=1:this.verSign_=-1:this.verSign_=-this.verSign_):(t=n.G.randRangeF(this.minRange_,this.maxRange_),n.G.randRangeF(1,100)>50&&(t=-t),e=n.G.randRangeF(this.minRange_,this.maxRange_),n.G.randRangeF(1,100)>50&&(e=-e)),{x:t,y:e}},t}();i.Shaker=s,cc._RF.pop()},{"../global_def":"global_def"}],sign_in_ui:[function(t,e,i){"use strict";cc._RF.push(e,"e6c12cLfxVFx6Ae9xW1pOhi","sign_in_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./base_ui"),s=t("./tip_ui"),r=t("./lucky_box_ui"),a=t("./popup_ui"),h=t("../../game/user_info"),l=t("../../util/global_def"),c=t("../../util/mgp_util"),u=t("../../util/event_mgr"),d=t("../../util/audio_mgr"),_=t("../../util/ad_tools"),p=function(){return function(){this.self=null,this.dayLbl=null,this.iconLoader=null,this.cntLbl=null,this.maskGrp=null}}(),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.awardBtn_=null,e.closeBtn_=null,e.awardCtrl_=null,e.box_=null,e.boxCom_=null,e.items_=[],e.showTrans_=null,e.closeTrans_=null,e.bInited_=!1,e.bAwarded_=!1,e}return o(e,t),e.prototype.init=function(t){if(t){this.com_=t,this.awardBtn_=t.getChild("awardBtn").asButton,this.closeBtn_=t.getChild("closeBtn").asButton,this.awardCtrl_=this.awardBtn_.getController("sh"),this.boxCom_=t.getChild("awardBox").asCom,this.boxCom_&&(this.box_=new r.LuckyBoxUI,this.box_.init(this.boxCom_)),this.showTrans_=t.getTransition("showTrans"),this.closeTrans_=t.getTransition("closeTrans");for(var e=0;e<7;++e){var i=new p,o=t.getChild("item"+(e+1)).asButton;o&&(i.self=o,i.dayLbl=o.getChild("dayLbl").asTextField,i.iconLoader=o.getChild("iconLoader").asLoader,i.cntLbl=o.getChild("cntLbl").asTextField,i.maskGrp=o.getChild("maskGrp").asGroup,this.items_.push(i))}this.com_.visible=!1}},e.prototype.show=function(){var t=this;this.com_&&(this.com_.visible=!0,h.GameUserInfo.isSignInAwarded?(this.awardBtn_.grayed=!0,this.bAwarded_=!0):(this.awardBtn_.grayed=!1,this.bAwarded_=!1),this.awardCtrl_&&(this.awardCtrl_.selectedIndex=h.GameUserInfo.isVideoLimited?1:0),this.bInited_&&!h.GameUserInfo.isSignIn7Days||(h.GameUserInfo.signInAwards.each(function(e,i,o){var n=t.items_[e];if(n){n.dayLbl.text=(e+1).toString();var s=o.type;s===h.BonusType.kCoin?n.iconLoader.url="ui://CommUI/coin":s>=h.BonusType.kBox1&&s<=h.BonusType.kBox3?n.iconLoader.url="ui://CommUI/box":s>=h.BonusType.kPiece1&&s<=h.BonusType.kPiece3&&(n.iconLoader.url="ui://CommUI/piece"+(s-h.BonusType.kPiece1+1)),n.cntLbl.text="x"+o.count,n.maskGrp.visible=e<h.GameUserInfo.dailyDat.signInAwardCnt,n.self.onClick(t._onItemClick,t)}}),this.bInited_=!0),this.awardBtn_.onClick(this._onAward,this),this.closeBtn_.onClick(this._onClose,this),this.bLock_=!0,this.showTrans_.stop(),this.showTrans_.play(function(){t.bLock_=!1,c.MgpUtil.showBanner(_.HDBannerAd.kB1)}))},e.prototype.reset=function(){this.com_.visible=!1,this.bLock_=!1,this.awardBtn_.offClick(this._onAward,this),this.closeBtn_.offClick(this._onClose,this),c.MgpUtil.hideBanner(_.HDBannerAd.kB1)},e.prototype._onItemClick=function(t){for(var e=null,i=0,o=0;o<this.items_.length;++o)if(this.items_[o].self==fgui.GObject.cast(t.currentTarget)){e=this.items_[o],i=o;break}if(e){var n=h.GameUserInfo.signInAwards.getByIndex(i);a.PopupUI.instance.show(n.desc)}},e.prototype._onAward=function(){this.bLock_||(this.bAwarded_?this._onClose():l.G.isWeChat?(_.HDVideoAd.watchOrShare(_.HDVideoAd.kSignIn,this._getAward.bind(this)),this.awardCtrl_&&(this.awardCtrl_.selectedIndex=h.GameUserInfo.isVideoLimited?1:0)):this._getAward())},e.prototype._onClose=function(){var t=this;this.bLock_||(u.GameEventMgr.instance.addEvent(u.EventType.kRedPoint,null,{type:1}),h.GameUserInfo.saveProp(),h.GameUserInfo.saveSignIn(),this.bLock_=!0,this.closeTrans_.play(function(){t.reset()}))},e.prototype._getAward=function(){this.bAwarded_=!0,this.awardBtn_.grayed=!0,d.AudioMgr.instance.playSound(d.SfxType.kGoodClick);var t=h.GameUserInfo.signInAwards.getByIndex(h.GameUserInfo.dailyDat.signInAwardCnt),e=t.type;e===h.BonusType.kCoin?s.TipUI.instance.show("\u83b7\u5f97\u91d1\u5e01\xd7"+t.count+"\uff01"):e>=h.BonusType.kBox1&&e<=h.BonusType.kBox3?this.box_.show(e-h.BonusType.kBox1+1,this._boxOpened.bind(this)):e>=h.BonusType.kPiece1&&e<=h.BonusType.kPiece3&&s.TipUI.instance.show("\u83b7\u5f97\u788e\u7247"+(e-h.BonusType.kPiece1+1)+"\xd7"+t.count),this.items_[h.GameUserInfo.dailyDat.signInAwardCnt].maskGrp.visible=!0,h.GameUserInfo.dailyDat.signInAwarded=1,++h.GameUserInfo.dailyDat.signInTotalCnt,++h.GameUserInfo.dailyDat.signInAwardCnt,h.GameUserInfo.saveSignIn(),h.GameUserInfo.saveProp()},e.prototype._boxOpened=function(){s.TipUI.instance.show("\u83b7\u5f97\u5b9d\u7bb1\u5956\u52b1\uff01"),h.GameUserInfo.saveProp()},e}(n.BaseUI);i.SignInUI=f,cc._RF.pop()},{"../../game/user_info":"user_info","../../util/ad_tools":"ad_tools","../../util/audio_mgr":"audio_mgr","../../util/event_mgr":"event_mgr","../../util/global_def":"global_def","../../util/mgp_util":"mgp_util","./base_ui":"base_ui","./lucky_box_ui":"lucky_box_ui","./popup_ui":"popup_ui","./tip_ui":"tip_ui"}],steering_vehicle:[function(t,e,i){"use strict";cc._RF.push(e,"f5cdfTBceJGIL5WxIASQMIX","steering_vehicle");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../structure/math_vec2"),r=cc.Enum({kWrap:0,kBounce:1}),a=cc._decorator,h=a.ccclass,l=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.edge_=new cc.Rect,e.velocity_=new cc.Vec2(0,0),e.edgeBehavior_=r.kWrap,e.mass_=1,e.maxSpeed_=10,e.maxForce_=1,e.arrivalThreshold_=100,e.wanderDist_=10,e.wanderRad_=5,e.wanderRange_=1,e.avoidDist_=100,e.avoidBuffer_=10,e.pathIdx_=0,e.pathThreshold_=20,e.sightDist_=200,e.safeDist_=60,e.bAuto_=!1,e.steeringForce_=new cc.Vec2(0,0),e.wanderAngle_=0,e.avoidVelocityRec_=null,e}return o(e,t),Object.defineProperty(e.prototype,"edgeBehavior",{get:function(){return this.edgeBehavior_},set:function(t){this.edgeBehavior_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this.mass_},set:function(t){this.mass_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxSpeed",{get:function(){return this.maxSpeed_},set:function(t){this.maxSpeed_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"velocity",{get:function(){return this.velocity_},set:function(t){this.velocity_.set(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxForce",{get:function(){return this.maxForce_},set:function(t){this.maxForce_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arrivalThreshold",{set:function(t){this.arrivalThreshold_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arrivalThrehold",{get:function(){return this.arrivalThreshold_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wanderDistance",{get:function(){return this.wanderDist_},set:function(t){this.wanderDist_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wanderRadius",{get:function(){return this.wanderRad_},set:function(t){this.wanderRad_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wanderRange",{get:function(){return this.wanderRange_},set:function(t){this.wanderRange_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avoidDistance",{get:function(){return this.avoidDist_},set:function(t){this.avoidDist_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avoidBuffer",{get:function(){return this.avoidBuffer_},set:function(t){this.avoidBuffer_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathIndex",{get:function(){return this.pathIdx_},set:function(t){this.pathIdx_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathThrehold",{get:function(){return this.pathThreshold_},set:function(t){this.pathThreshold_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sightDistance",{get:function(){return this.sightDist_},set:function(t){this.sightDist_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"safeDistance",{get:function(){return this.safeDist_},set:function(t){this.safeDist_=t},enumerable:!0,configurable:!0}),e.prototype.seek=function(t){var e=t.sub(this.node.position),i=(e=(e=e.normalize()).mul(this.maxSpeed_)).sub(this.velocity_);this.steeringForce_=this.steeringForce_.add(i)},e.prototype.flee=function(t){var e=t.sub(this.node.position),i=(e=(e=e.normalize()).mul(this.maxSpeed_)).sub(this.velocity_);this.steeringForce_=this.steeringForce_.sub(i)},e.prototype.arrive=function(t){var e=t.sub(this.node.position);e=e.normalize();var i=s.default.distance(this.node.position,t),o=(e=i>this.arrivalThreshold_?e.mul(this.maxSpeed_):e.mul(this.maxSpeed_*i/this.arrivalThreshold_)).sub(this.velocity_);this.steeringForce_=this.steeringForce_.add(o)},e.prototype.pursue=function(t){var e=s.default.distance(this.node.position,t.node.position)/this.maxSpeed_,i=t.node.position.add(t.velocity.mul(e));this.seek(i)},e.prototype.evade=function(t){var e=s.default.distance(this.node.position,t.node.position)/this.maxSpeed_,i=t.node.position.add(t.velocity.mul(e));this.flee(i)},e.prototype.wander=function(){var t=this.velocity_.normalize().mul(this.wanderDist_),e=new cc.Vec2(0,0);s.default.setLength(e,this.wanderRad_),s.default.setAngle(e,this.wanderAngle_),this.wanderAngle_+=(Math.random()-.5)*this.wanderRange_;var i=t.add(e);this.steeringForce_=this.steeringForce_.add(i)},e.prototype.avoid=function(t){for(var e=0;e<t.length;++e){var i=t[e],o=this.velocity_.normalize(),n=i.position.sub(this.node.position),r=n.dot(o);if(r>0){null===this.avoidVelocityRec_&&(this.avoidVelocityRec_=cc.v2(this.velocity_));var a=o.mul(this.avoidDist_),h=o.mul(r),l=h.sub(n).mag(),c=i.getComponent(cc.CircleCollider);if(c&&l<c.radius+this.avoidBuffer_&&h.mag()<a.mag()){var u=o.mul(this.maxSpeed_),d=s.default.getAngle(u);s.default.setAngle(u,d+s.default.sign(n,this.velocity_)*Math.PI/2);var _=h.mag()/a.mag();u=u.mul(1-_),this.steeringForce_=this.steeringForce_.add(u),this.velocity_=this.velocity_.mul(_)}}else this.avoidVelocityRec_&&s.default.distance(this.node.position,i.position)>this.avoidDist_&&(this.velocity_.set(this.avoidVelocityRec_),this.avoidVelocityRec_=null)}},e.prototype.followPath=function(t,e){if(void 0===e&&(e=!1),this.pathIdx_>=0&&this.pathIdx_<t.length){var i=t[this.pathIdx_];s.default.distance(this.node.position,i)<this.pathThreshold_&&(this.pathIdx_>=t.length-1?e&&(this.pathIdx_=0):++this.pathIdx_),this.pathIdx_>=t.length-1&&!e?this.arrive(i):this.seek(i)}},e.prototype.flock=function(t){for(var e=this.velocity_.clone(),i=cc.v2(0,0),o=0,n=0;n<t.length;++n){var s=t[n];s!==this&&this._isInSight(s)&&(e=e.add(s.velocity),i=i.add(s.node.position),this._isNotSafeDist(s)&&this.flee(s.node.position),++o)}o>0&&(e=e.div(o),i=i.div(o),this.seek(i),this.steeringForce_=this.steeringForce_.add(e.sub(this.velocity_)))},e.prototype._isInSight=function(t){var e=!0;s.default.distance(this.node.position,t.node.position)>this.sightDist_&&(e=!1);var i=this.velocity_.normalize();return t.node.position.sub(this.node.position).dot(i)<0&&(e=!1),e},e.prototype._isNotSafeDist=function(t){return s.default.distance(this.node.position,t.node.position)<this.safeDist_},e.prototype.update=function(t){this.bAuto_&&this.updateBehavior()},e.prototype.updateBehavior=function(){this._updateSteering(),s.default.truncate(this.velocity_,this.maxSpeed_),this.node.position=this.node.position.add(this.velocity_),this.edgeBehavior_===r.kWrap?this._wrap():this.edgeBehavior_===r.kBounce&&this._bounce(),this.node.rotation=s.default.getAngleToCocosDegree(this.velocity_)},e.prototype._updateSteering=function(){s.default.truncate(this.steeringForce_,this.maxForce_),this.steeringForce_=this.steeringForce_.div(this.mass_),this.velocity_=this.velocity_.add(this.steeringForce_),this.steeringForce_.set(cc.v2(0,0))},e.prototype._bounce=function(){this.node.x>this.edge_.xMax?(this.node.x=this.edge_.xMax,this.velocity_.x*=-1):this.node.x<this.edge_.xMin&&(this.node.x=this.edge_.xMin,this.velocity_.x*=-1),this.node.y>this.edge_.yMax?(this.node.y=this.edge_.yMax,this.velocity_.y*=-1):this.node.y<this.edge_.yMin&&(this.node.y=this.edge_.yMin,this.velocity_.y*=-1)},e.prototype._wrap=function(){this.node.x>this.edge_.xMax?this.node.x=this.edge_.xMin:this.node.x<this.edge_.xMin&&(this.node.x=this.edge_.xMax),this.node.y>this.edge_.yMax?this.node.y=this.edge_.yMin:this.node.y<this.edge_.yMin&&(this.node.y=this.edge_.yMax)},n([l({type:cc.Rect,displayName:"Edge",tooltip:"\u8fb9\u754c"})],e.prototype,"edge_",void 0),n([l({type:cc.Vec2,displayName:"Velocity",tooltip:"\u901f\u5ea6"})],e.prototype,"velocity_",void 0),n([l({type:r,displayName:"Edge Behavior",tooltip:"\u7248\u8fb9\u884c\u4e3a\uff0c\u53ef\u4ee5\u81ea\u884c\u7ee7\u627f\u4fee\u6539"})],e.prototype,"edgeBehavior_",void 0),n([l({type:cc.Float,displayName:"Mass",tooltip:"\u8d28\u91cf"})],e.prototype,"mass_",void 0),n([l({type:cc.Float,displayName:"MaxSpeed",tooltip:"\u6700\u5927\u79fb\u52a8\u901f\u5ea6"})],e.prototype,"maxSpeed_",void 0),n([l({type:cc.Float,displayName:"MaxForce",tooltip:"\u6700\u5927\u7275\u5f15\u529b"})],e.prototype,"maxForce_",void 0),n([l({type:cc.Float,displayName:"ArrivalThreshold",tooltip:"\u5230\u8fbe\u9608\u503c\uff0c\u5230\u8fbe\u884c\u4e3a\u4e13\u7528\uff0c\u8ddd\u79bb\u76ee\u6807\u591a\u8fdc\u5f00\u59cb\u51cf\u901f"})],e.prototype,"arrivalThreshold_",void 0),n([l({type:cc.Float,displayName:"WanderDistance",tooltip:"\u6f2b\u6e38\u76ee\u6807\u8ddd\u79bb\uff0c\u6f2b\u6e38\u884c\u4e3a\u4e13\u7528\uff0c\u7528\u4e8e\u63a8\u7b97\u5f53\u524d\u7684\u6f2b\u6e38\u76ee\u6807\u70b9\u4e0e\u81ea\u8eab\u53ef\u80fd\u5b58\u5728\u7684\u8ddd\u79bb"})],e.prototype,"wanderDist_",void 0),n([l({type:cc.Float,displayName:"WanderRadius",tooltip:"\u6f2b\u6e38\u63a8\u7b97\u534a\u5f84\uff0c\u6f2b\u6e38\u884c\u4e3a\u4e13\u7528\uff0c\u7528\u4e8e\u63a8\u7b97\u76ee\u6807\u70b9\u5728\u6f2b\u6e38\u76ee\u6807\u533a\u57df\u4e2d\u53ef\u80fd\u5b58\u5728\u7684\u4f4d\u7f6e\u8303\u56f4"})],e.prototype,"wanderRad_",void 0),n([l({type:cc.Float,displayName:"WanderRange",tooltip:"\u6f2b\u6e38\u8303\u56f4\uff0c\u6f2b\u6e38\u884c\u4e3a\u4e13\u7528\uff0c\u7528\u4e8e\u63a8\u7b97\u672c\u6b21\u6f2b\u6e38\u7684\u53ef\u80fd\u504f\u79fb\u8ddd\u79bb"})],e.prototype,"wanderRange_",void 0),n([l({type:cc.Float,displayName:"AvoidDistance",tooltip:"\u56de\u907f\u68c0\u6d4b\u8ddd\u79bb\uff0c\u56de\u907f\u884c\u4e3a\u4e13\u7528\uff0c\u8ba1\u7b97\u63d0\u524d\u591a\u8fdc\u56de\u907f\u969c\u788d\u7269"})],e.prototype,"avoidDist_",void 0),n([l({type:cc.Float,displayName:"AvoidBuffer",tooltip:"\u56de\u907f\u7f13\u51b2\u8ddd\u79bb\uff0c\u56de\u907f\u884c\u4e3a\u4e13\u7528\uff0c\u5728\u51c6\u5907\u907f\u5f00\u65f6\uff0c\u81ea\u8eab\u548c\u969c\u788d\u7269\u95f4\u7684\u9884\u7559\u8ddd\u79bb"})],e.prototype,"avoidBuffer_",void 0),n([l({type:cc.Integer,displayName:"PathIndex",tooltip:"\u8def\u5f84\u7d22\u5f15\uff0c\u8def\u5f84\u8ddf\u968f\u884c\u4e3a\u4e13\u7528\uff0c\u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u8def\u5f84\u6570\u7ec4\u4e2d\u7684\u67d0\u4e2a\u8def\u70b9"})],e.prototype,"pathIdx_",void 0),n([l({type:cc.Float,displayName:"PathThreshold",tooltip:"\u8def\u5f84\u8ddd\u79bb\u9608\u503c\uff0c\u8def\u5f84\u8ddf\u968f\u884c\u4e3a\u4e13\u7528\uff0c\u7528\u4e8e\u68c0\u67e5\u662f\u5426\u9760\u8fd1\u4e86\u67d0\u4e2a\u8def\u70b9\u4ee5\u4fbf\u5bfb\u627e\u4e0b\u4e00\u4e2a"})],e.prototype,"pathThreshold_",void 0),n([l({type:cc.Float,displayName:"SightDist",tooltip:"\u89c6\u91ce\u8ddd\u79bb\uff0c\u7fa4\u843d\u884c\u4e3a\u4e13\u7528\uff0c\u7528\u4e8e\u7fa4\u843d\u4e2d\u4e2a\u4f53\u80fd\u591f\u68c0\u6d4b\u5230\u6709\u6548\u5b9e\u4f53\u7684\u8303\u56f4"})],e.prototype,"sightDist_",void 0),n([l({type:cc.Float,displayName:"SafeDist",tooltip:"\u5b89\u5168\u8ddd\u79bb\uff0c\u7fa4\u843d\u884c\u4e3a\u4e13\u7528\uff0c\u7528\u4e8e\u7fa4\u843d\u4e2d\u4e2a\u4f53\u95f4\u4fdd\u6709\u7684\u95f4\u8ddd"})],e.prototype,"safeDist_",void 0),n([l({type:cc.Boolean,displayName:"bAuto",tooltip:"\u81ea\u52a8\u8fd0\u52a8"})],e.prototype,"bAuto_",void 0),e=n([h],e)}(cc.Component);i.SteeringVehicleBase=c,cc._RF.pop()},{"../structure/math_vec2":void 0}],test_astar:[function(t,e,i){"use strict";cc._RF.push(e,"9889fRLxTpNzaf32taO94Ad","test_astar");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s,r=t("../util/algorithm/AStar"),a=t("../util/global_def"),h=t("../util/structure/math_vec2"),l=t("../game_logic"),c=cc._decorator,u=c.ccclass,d=c.property;(function(t){t[t.kGrass=0]="kGrass",t[t.kDesert=1]="kDesert",t[t.kWater=2]="kWater",t[t.kAbyss=3]="kAbyss"})(s||(s={}));var _=[new cc.Color(79,155,20,255),new cc.Color(248,170,86,255),new cc.Color(0,143,255,255),new cc.Color(0,0,0,255)],p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gridLayer_=null,e.gridCpy_=null,e.role_=null,e.roleShape_=null,e.lbl_=null,e.gridRefArr_=null,e.astarGrid_=null,e.astar_=null,e.currGrid_=null,e.lastClr_=null,e.pathArr_=[],e.visitedArr_=[],e.pathClrRec_=[],e.visitedClrRec_=[],e.hIdx_=0,e.bLocked_=!1,e}return o(e,t),e.prototype.onLoad=function(){this.astarGrid_=new r.AStarGrid(28,18),this.astar_=new r.AStar(r.DirectionNum.kEight),this.gridRefArr_=new Array(28);var t=a.G.randRange(0,27),e=a.G.randRange(0,17);this.astarGrid_.setStartNode(t,e);for(var i=0;i<28;++i){this.gridRefArr_[i]=new Array(18);for(var o=0;o<18;++o){var n=cc.instantiate(this.gridCpy_),h=a.G.randRange(0,_.length-1);h===s.kAbyss&&i===t&&o===e&&(h=a.G.randRange(0,s.kWater)),n.color=_[h],h===s.kAbyss?this.astarGrid_.setNodeProp(i,o,1,!1):this.astarGrid_.setNodeProp(i,o,1+.5*h,!0),n.x=40*o,n.y=40*i,this.gridRefArr_[i][o]=n,this.gridLayer_.addChild(n),i===t&&o===e&&(this.role_.position=n.position)}}this.gridCpy_.destroy(),this.node.on(cc.Node.EventType.TOUCH_START,this._touchBegin,this)},e.prototype.onSwitch=function(){++this.hIdx_,this.hIdx_>r.HeuristicType.kDiagonal&&(this.hIdx_=r.HeuristicType.kMahattan),this.astar_.heuristicType=this.hIdx_;var t="";0===this.hIdx_?t="\u4f30\u4ef7\u7b97\u6cd5\uff1a\u66fc\u54c8\u987f":1===this.hIdx_?t="\u4f30\u4ef7\u7b97\u6cd5\uff1a\u51e0\u4f55":2===this.hIdx_&&(t="\u4f30\u4ef7\u7b97\u6cd5\uff1a\u659c\u89d2"),this.lbl_.string=t},e.prototype.onExit=function(){l.GameLogic.instance.changeScene("load")},e.prototype._touchBegin=function(t){if(!this.bLocked_){var e=t.touch.getLocationInView(),i=this.gridLayer_.convertToNodeSpaceAR(e),o=cc.v2(i.x,this.gridLayer_.height-i.y),n=Math.floor(o.x/40),r=Math.floor(o.y/40);if(console.log("touch",e,o,r,n),r>=0&&r<28&&n>=0&&n<18)if(this.currGrid_=this.gridRefArr_[r][n],this.currGrid_&&!this.currGrid_.color.equals(_[s.kAbyss]))if(this.astarGrid_.setEndNode(r,n),this.astar_.findPath(this.astarGrid_))this._showPath();else{var a=cc.find("Canvas/toast");a&&a.getComponent("tips").display("\u65e0\u6cd5\u62b5\u8fbe")}else this.currGrid_=null}},e.prototype._showVisited=function(){for(var t=0;t<this.visitedArr_.length;++t)this.visitedArr_[t].color=this.visitedClrRec_[t];this.visitedArr_=[],this.visitedClrRec_=[];var e=this.astar_.getVisitedNodes();for(t=0;t<e.length;++t){var i=e[t],o=this.gridRefArr_[i.r][i.c];o&&!i.bPath&&(this.visitedClrRec_.push(o.color.clone()),o.color=cc.Color.GRAY,this.visitedArr_.push(o))}},e.prototype._showPath=function(){for(var t=0;t<this.pathArr_.length;++t)this.pathArr_[t].color=this.pathClrRec_[t];this.pathArr_=[],this.pathClrRec_=[];var e=this.astar_.path;for(t=0;t<e.length;++t){var i=e[t],o=this.gridRefArr_[i.r][i.c];o&&(this.pathClrRec_.push(o.color.clone()),o.color=cc.Color.CYAN,this.pathArr_.push(o))}var n=0;this.schedule(function(){var t=e[n],i=this.gridRefArr_[t.r][t.c];i&&(this.roleShape_.rotation=h.default.getAngleToCocosDegree(i.position.sub(this.role_.position)),this.role_.position=i.position),++n===e.length&&(this.astarGrid_.setStartNode(t.r,t.c),this.bLocked_=!1)}.bind(this),.2,e.length-1,0),this.bLocked_=!0},n([d(cc.Node)],e.prototype,"gridLayer_",void 0),n([d(cc.Node)],e.prototype,"gridCpy_",void 0),n([d(cc.Node)],e.prototype,"role_",void 0),n([d(cc.Node)],e.prototype,"roleShape_",void 0),n([d(cc.Label)],e.prototype,"lbl_",void 0),e=n([u],e)}(cc.Component);i.default=p,cc._RF.pop()},{"../game_logic":"game_logic","../util/algorithm/AStar":"AStar","../util/global_def":"global_def","../util/structure/math_vec2":void 0}],test_entry:[function(t,e,i){"use strict";cc._RF.push(e,"c1850JMnClNhY2BoO8hes7o","test_entry");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../game_logic"),r=t("../game_ui/common/trans_ui"),a=t("../util/global_def"),h=cc._decorator,l=h.ccclass,c=(h.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.start=function(){a.G.log("test entry"),r.TransUIInst.over()},e.prototype.onTestSDk=function(){s.GameLogic.instance.changeScene("test_sdk")},e.prototype.onTestQuadTree=function(){s.GameLogic.instance.changeScene("test_quadtree")},e.prototype.onTestSteering=function(){s.GameLogic.instance.changeScene("test_steering")},e.prototype.onTestAStar=function(){s.GameLogic.instance.changeScene("test_astar")},e=n([l],e)}(cc.Component));i.TestEntry=c,cc._RF.pop()},{"../game_logic":"game_logic","../game_ui/common/trans_ui":"trans_ui","../util/global_def":"global_def"}],test_quadtree:[function(t,e,i){"use strict";cc._RF.push(e,"0284eU0Tn1JJITntBjYlxjL","test_quadtree");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../util/algorithm/quad_tree"),r=t("../game_logic"),a=t("../util/global_def"),h=cc._decorator,l=h.ccclass,c=h.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layer_=null,e.plane_=null,e.slider_=null,e.sliderLbl_=null,e.collisionElapseLbl_=null,e.treeElapseLbl_=null,e.planePool_=null,e.planes_=[],e.collisionGroup_=[],e.quadTree_=null,e.slideCnt_=0,e.minTreeElapse_=0,e.maxTreeElapse_=0,e.minCollisionElapse_=0,e.maxCollisionElapse_=0,e.elapseRefreshTimer_=0,e}return o(e,t),e.prototype.onLoad=function(){this.planePool_=new cc.NodePool;for(var t=0;t<1e3;++t){var e=cc.instantiate(this.plane_);this.planePool_.put(e)}this.plane_.destroy(),this.slideCnt_=Math.ceil(1e3*this.slider_.progress),0==this.slideCnt_&&(this.slideCnt_=1),this._genPlane(),this.quadTree_=new s.QuadTree(0,new cc.Rect(0,0,720,1e3)),this._quadTreeInit()},e.prototype.onSlide=function(){var t=Math.ceil(1e3*this.slider_.progress);0==t&&(t=1),this.sliderLbl_.string="\u6570\u91cf "+t,this.slideCnt_=t},e.prototype.onGen=function(){this._genPlane()},e.prototype.onExit=function(){r.GameLogic.instance.changeScene("load")},e.prototype.update=function(t){if(this.quadTree_){var e=Date.now(),i=!1;this.elapseRefreshTimer_-=t,this.elapseRefreshTimer_<=0&&(i=!0,this.elapseRefreshTimer_=1),this.quadTree_.clear(),this._quadTreeInit();var o=Date.now()-e;(o<this.minTreeElapse_||0===this.minTreeElapse_)&&(this.minTreeElapse_=o),o>this.maxTreeElapse_&&(this.maxTreeElapse_=o),i&&(this.treeElapseLbl_.string="\u6784\u5efa\u6811\u8017\u65f6:\nMin-"+this.minTreeElapse_+"ms Max-"+this.maxTreeElapse_+"ms Curr-"+o+"ms"),e=Date.now(),this._collision(),((o=Date.now()-e)<this.minCollisionElapse_||0===this.minCollisionElapse_)&&(this.minCollisionElapse_=o),o>this.maxCollisionElapse_&&(this.maxCollisionElapse_=o),i&&(this.collisionElapseLbl_.string="\u78b0\u649e\u8017\u65f6:\nMin-"+this.minCollisionElapse_+"ms Max-"+this.maxCollisionElapse_+"ms Curr-"+o+"ms"),this._showQuadTree()}},e.prototype._genPlane=function(){this.layer_.removeAllChildren();for(var t=0;t<this.planes_.length;++t)this.planePool_.put(this.planes_[t].node);this.planes_=[];for(t=0;t<this.slideCnt_;++t)if(this.planePool_.size()>0){var e=this.planePool_.get(t),i=e.getComponent("steering_vehicle");i.velocity=cc.v2(a.G.randRange(-5,5),a.G.randRange(-5,5)),i.maxSpeed=a.G.randRange(1,10),i.maxForce=a.G.randRange(1,3),e.position=cc.v2(a.G.randRange(20,700),a.G.randRange(20,980)),this.planes_.push(i),this.layer_.addChild(e);var o=cc.find("num",e);o&&(o.getComponent(cc.Label).string=this.layer_.children.length.toString())}this.minTreeElapse_=0,this.maxTreeElapse_=0,this.minCollisionElapse_=0,this.maxCollisionElapse_=0,this.quadTree_&&this.quadTree_.clear(),this._quadTreeInit()},e.prototype._quadTreeInit=function(){if(this.quadTree_){for(var t=this.layer_.children,e=0;e<t.length;++e)this.quadTree_.insert(t[e]);this._showQuadTree()}},e.prototype._collision=function(){if(this.quadTree_)for(var t=this.layer_.children,e=0;e<t.length;++e){t[e].color=cc.Color.WHITE,this.collisionGroup_=[];var i=t[e].getBoundingBox();this.collisionGroup_=this.quadTree_.retrieve(this.collisionGroup_,i);for(var o=0;o<this.collisionGroup_.length;++o){var n=this.collisionGroup_[o].getBoundingBox();t[e]!==this.collisionGroup_[o]&&n.intersects(i)&&(this.collisionGroup_[o].color=cc.Color.RED,t[e].color=cc.Color.RED)}}},e.prototype._showQuadTree=function(){this.layer_.getComponent(cc.Graphics).clear(),this.quadTree_.draw(this.layer_)},n([c(cc.Node)],e.prototype,"layer_",void 0),n([c(cc.Node)],e.prototype,"plane_",void 0),n([c(cc.Slider)],e.prototype,"slider_",void 0),n([c(cc.Label)],e.prototype,"sliderLbl_",void 0),n([c(cc.Label)],e.prototype,"collisionElapseLbl_",void 0),n([c(cc.Label)],e.prototype,"treeElapseLbl_",void 0),e=n([l],e)}(cc.Component);i.TestQuadTree=u,cc._RF.pop()},{"../game_logic":"game_logic","../util/algorithm/quad_tree":"quad_tree","../util/global_def":"global_def"}],test_sdk:[function(t,e,i){"use strict";cc._RF.push(e,"5ba2ens0/BGTZWHU8Q8Ggj8","test_sdk");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../game_ui/common/fgui_root"),r=t("../game_ui/common/setting_ui"),a=t("../game_ui/common/sign_in_ui"),h=t("../game_ui/common/lucky_box_ui"),l=t("../util/mgp_util"),c=t("../util/ad_tools"),u=t("../data/data_hub"),d=t("../game_ui/common/export_ui"),_=t("../game/user_info"),p=t("../util/global_def"),f=t("../game_ui/common/tip_ui"),g=t("../util/audio_mgr"),m=cc._decorator,v=m.ccclass,y=(m.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.homePnl_=null,e.startBtn_=null,e.signInBtn_=null,e.settingBtn_=null,e.boxBtn_=null,e.settingUI_=null,e.signInUI_=null,e.box_=null,e.videoBonus_=null,e.bLocked_=!1,e.bPreload_=!1,e}return o(e,t),e.prototype.start=function(){fgui.UIPackage.loadPackage(s.FGUIRoot.nativePath+"HomeHUD",this._onLoadedUI.bind(this))},e.prototype.update=function(t){this.videoBonus_&&this.videoBonus_.updateCounter(t)},e.prototype._onLoadedUI=function(){var t=fgui.GRoot.inst,e=fgui.UIPackage;if(e.addPackage(s.FGUIRoot.nativePath+"HomeHUD"),this.homePnl_=e.createObject("HomeHUD","HomePnl").asCom,this.homePnl_.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this.homePnl_){t.addChild(this.homePnl_),this.startBtn_=this.homePnl_.getChild("startBtn").asButton,this.signInBtn_=this.homePnl_.getChild("signInBtn").asButton,this.settingBtn_=this.homePnl_.getChild("settingBtn").asButton,this.boxBtn_=this.homePnl_.getChild("freeBoxBtn").asButton,this.startBtn_.onClick(this._onClick,this),this.signInBtn_.onClick(this._onClick,this),this.settingBtn_.onClick(this._onClick,this),this.boxBtn_.onClick(this._onClick,this),this.settingUI_=r.SettingUI.instance,this.signInUI_=new a.SignInUI,this.signInUI_.init(this.homePnl_.getChild("signInPnl").asCom),this.box_=new h.LuckyBoxUI,this.box_.init(this.homePnl_.getChild("awardBox").asCom),this.videoBonus_=new b(this.boxBtn_),this.videoBonus_.refresh(),this.homePnl_.visible=!1;var i=this.homePnl_.getChild("bnrBaseLine");i&&(this.bPreload_=!0,l.MgpUtil.preloadBanner(c.HDBannerAd.kB1,i,300,u.DataHub.config.bnrGap,this._bnrLoaded.bind(this),this._bnrLoadError.bind(this),1,u.DataHub.config.bnrRefresh))}},e.prototype._bnrLoaded=function(){d.ExportUIInst.initPage();var t=[d.ExportUIName.kSL1,d.ExportUIName.kSL2,d.ExportUIName.kSR1,d.ExportUIName.kSR2];d.ExportGroup.addMembers(d.ExportGroupName.kHS4,t);for(var e=0;e<t.length;++e)d.ExportUIInst.bindSingleEx(t[e],this.homePnl_,d.ExportTransType.kPop);d.ExportUIInst.bindRCScroll(d.ExportUIName.kHT,this.homePnl_,0,10,d.ExportUIInst.normNavDataIndex),d.ExportUIInst.bindFoldPageEx(d.ExportUIName.kFP,this.homePnl_,3,-5,-5,"#000000",this._hideFoldBnr.bind(this),this._showFoldBnr.bind(this)),d.ExportUIInst.bindPop4x3Ex(d.ExportUIName.kPop,this.homePnl_,5,-15,"#ffffff"),d.ExportUIInst.bindGuessLike(d.ExportUIName.kLike,this.homePnl_),d.ExportUIInst.bindMoreGameButton(d.ExportUIName.kHomeNS,this.homePnl_,0,!1),d.ExportUIInst.bindFakeCloseButton(d.ExportUIName.kFake,this.homePnl_);var i=[d.ExportUIName.kFP,d.ExportUIName.kHT,d.ExportUIName.kPop,d.ExportUIName.kFake];i=i.concat(t),d.ExportGroup.addMembers(d.ExportGroupName.kHomeAll,i),this._enter()},e.prototype._bnrLoadError=function(){this.bPreload_&&this._bnrLoaded()},e.prototype._enter=function(){this.homePnl_&&(this.bPreload_=!1,this.node.active=!0,this.homePnl_.visible=!0,p.G.isTMSDK?(d.ExportUIInst.defaultPageTmID=d.ExportTmID.kCancel,d.ExportGroup.showMembersTM(d.ExportGroupName.kHS4,d.ExportTmID.kSingles),d.ExportUIInst.showTM(d.ExportUIName.kHT,d.ExportTmID.kHT),d.ExportUIInst.showTM(d.ExportUIName.kFake,d.ExportTmID.kPage),d.ExportUIInst.showTM(d.ExportUIName.kHomeNS,d.ExportTmID.kPage),d.ExportUIInst.showTM(d.ExportUIName.kLike,d.ExportTmID.kLike),d.ExportUIInst.showTM(d.ExportUIName.kFP,d.ExportTmID.kFold),d.ExportUIInst.autoPopFoldPage(d.ExportUIName.kFP),d.ExportUIInst.showTM(d.ExportUIName.kPop,d.ExportTmID.kForce)):(d.ExportGroup.showMembers(d.ExportGroupName.kHomeAll),d.ExportUIInst.show(d.ExportUIName.kHomeNS),d.ExportUIInst.show(d.ExportUIName.kLike),d.ExportUIInst.autoPopFoldPage(d.ExportUIName.kFP)),d.ExportUIInst.addPageCallback(this._hideBnr,this._showBnr))},e.prototype._leave=function(){},e.prototype._onClick=function(t){if(!this.bLocked_)if(fgui.GObject.cast(t.currentTarget)==this.startBtn_)g.AudioMgrInst.playMusic(g.BgmType.kMenu),p.G.isTMSDK,d.ExportUIInst.showInvitePage("",d.ExportTmID.kPage);else if(fgui.GObject.cast(t.currentTarget)==this.signInBtn_)this.signInUI_&&this.signInUI_.show();else if(fgui.GObject.cast(t.currentTarget)==this.settingBtn_)this.settingUI_&&this.settingUI_.show();else if(fgui.GObject.cast(t.currentTarget)==this.boxBtn_)if(this.box_&&_.GameUserInfo.isVideoBoxBonus){var e=3;e=p.G.randRange(1,100)>70?1:2,p.G.isWeChat?c.HDVideoAd.watchOrShare(c.HDVideoAd.kBox,this._awardFunc.bind(this),e):this._awardFunc(e)}else if(_.GameUserInfo.isVideoBoxBonusExisted){var i=p.G.formatSecond(_.GameUserInfo.videoBoxBounsTime);f.TipUI.instance.show("\u514d\u8d39\u5b9d\u7bb1\u8fd8\u9700"+i+"\u624d\u80fd\u5f00\u542f")}else f.TipUI.instance.show("\u4eca\u65e5\u514d\u8d39\u5b9d\u7bb1\u5df2\u9886\u53d6\u5b8c\u6bd5")},e.prototype._awardFunc=function(t){this.box_.show(t,this._bonusGet.bind(this)),l.MgpUtil.showBanner(c.HDBannerAd.kB1)},e.prototype._bonusGet=function(){this.videoBonus_&&(this.videoBonus_.reset(),l.MgpUtil.hideBanner(c.HDBannerAd.kB1))},e.prototype._showBnr=function(){l.MgpUtil.showLastOne()},e.prototype._hideBnr=function(){l.MgpUtil.hideLastOne()},e.prototype._showFoldBnr=function(){l.MgpUtil.showBanner(c.HDBannerAd.kB1)},e.prototype._hideFoldBnr=function(){l.MgpUtil.hideBanner(c.HDBannerAd.kB1)},e=n([v],e)}(cc.Component));i.default=y;var b=function(){function t(t){this.lbl_=null,this.waggleTrans_=null,this.com_=null,this.ctrl_=null,this.adCtrl_=null,this.saveTimer_=0,this.bBonus_=!1,t&&(this.com_=t,this.lbl_=t.getChild("counterLbl").asTextField,this.ctrl_=t.getController("tipCtrl"),this.adCtrl_=t.getController("sh"),this.waggleTrans_=t.getTransition("waggleTrans"))}return t.prototype.refresh=function(){_.GameUserInfo.isVideoBoxBonusExisted?(this.bBonus_=!1,this.com_.grayed=!1,this.lbl_.text=Math.ceil(_.GameUserInfo.videoBoxBounsTime).toString()):(this.bBonus_=!0,this.com_.grayed=!0,this.lbl_.text="0")},t.prototype.updateCounter=function(t){this.bBonus_||(_.GameUserInfo.isVideoBoxBonus?(this.waggleTrans_.play(null,-1),this.ctrl_.selectedIndex=0,this.adCtrl_&&(this.adCtrl_.selectedIndex=_.GameUserInfo.isVideoLimited?1:0),this.bBonus_=!0):(_.GameUserInfo.calVideoBonusTime(t),this.lbl_.text=Math.ceil(_.GameUserInfo.videoBoxBounsTime).toString()),++this.saveTimer_,this.saveTimer_>=60&&(_.GameUserInfo.setOfflineTimestamp(),_.GameUserInfo.saveSignIn(),this.saveTimer_=0))},t.prototype.reset=function(){this.waggleTrans_.stop(),this.ctrl_.selectedIndex=1,_.GameUserInfo.resetVideoBonusTime(),_.GameUserInfo.countVideoBonus(),_.GameUserInfo.setOfflineTimestamp(),_.GameUserInfo.saveSignIn(),_.GameUserInfo.isVideoBoxBonusExisted?(this.bBonus_=!1,this.com_.grayed=!1):this.com_.grayed=!0},t}();cc._RF.pop()},{"../data/data_hub":"data_hub","../game/user_info":"user_info","../game_ui/common/export_ui":"export_ui","../game_ui/common/fgui_root":"fgui_root","../game_ui/common/lucky_box_ui":"lucky_box_ui","../game_ui/common/setting_ui":"setting_ui","../game_ui/common/sign_in_ui":"sign_in_ui","../game_ui/common/tip_ui":"tip_ui","../util/ad_tools":"ad_tools","../util/audio_mgr":"audio_mgr","../util/global_def":"global_def","../util/mgp_util":"mgp_util"}],test_steering:[function(t,e,i){"use strict";cc._RF.push(e,"da6b6omGn1O5ropw6B66Qj0","test_steering");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),n=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var s=t("../util/structure/hd_map"),r=t("../game_logic"),a=cc._decorator,h=a.ccclass,l=a.property,c=["\u5bfb\u627e","\u8eb2\u907f","\u5230\u8fbe","\u8ffd\u51fb\u4e0e\u9003\u79bb","\u6f2b\u6e38","\u56de\u907f","\u8def\u5f84\u5de1\u903b","\u7fa4\u843d"],u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vehicle1_=null,e.vehicle2_=null,e.vehicle3_=null,e.targetCpy_=null,e.lbl_=null,e.targetPool_=null,e.targets_=null,e.path_=[],e.group_=[],e.target_=null,e.behaviorIdx_=0,e}return o(e,t),e.prototype.onLoad=function(){this.targetPool_=new cc.NodePool;for(var t=0;t<5;++t){var e=cc.instantiate(this.targetCpy_);this.targetPool_.put(e)}this.targetCpy_.destroy(),this.targets_=new s.HDMap,this.group_.push(this.vehicle1_.getComponent("steering_vehicle")),this.group_.push(this.vehicle2_.getComponent("steering_vehicle")),this.group_.push(this.vehicle3_.getComponent("steering_vehicle")),this.lbl_.string=c[this.behaviorIdx_],this.node.on(cc.Node.EventType.TOUCH_START,this._touchBegin,this)},e.prototype.onDestroy=function(){this.targetPool_.clear()},e.prototype._touchBegin=function(t){var e=t.touch.getLocationInView(),i=this.node.convertToNodeSpaceAR(e),o=cc.v2(i.x,this.node.height-i.y);if(this.targetPool_.size()>0){var n=this.targetPool_.get();n.position=o,this.node.addChild(n),this.targets_.put(n.uuid,n),this.target_=this.targets_.get(n.uuid),this.path_.push(o)}},e.prototype.update=function(){var t=!0;if(0===this.behaviorIdx_)this.target_&&(this.vehicle1_.getComponent("steering_vehicle").seek(this.target_.position),this.vehicle2_.getComponent("steering_vehicle").seek(this.target_.position),this.vehicle3_.getComponent("steering_vehicle").seek(this.target_.position));else if(1===this.behaviorIdx_)this.target_&&this.vehicle1_.getComponent("steering_vehicle").seek(this.target_.position),this.vehicle2_.getComponent("steering_vehicle").flee(this.vehicle1_.position),this.vehicle3_.getComponent("steering_vehicle").flee(this.vehicle1_.position);else if(2===this.behaviorIdx_)this.target_&&(this.vehicle1_.getComponent("steering_vehicle").arrive(this.target_.position),this.vehicle2_.getComponent("steering_vehicle").arrive(this.target_.position),this.vehicle3_.getComponent("steering_vehicle").arrive(this.target_.position));else if(3===this.behaviorIdx_)this.vehicle1_.getComponent("steering_vehicle").pursue(this.vehicle2_.getComponent("steering_vehicle")),this.vehicle2_.getComponent("steering_vehicle").pursue(this.vehicle3_.getComponent("steering_vehicle")),this.vehicle3_.getComponent("steering_vehicle").pursue(this.vehicle1_.getComponent("steering_vehicle")),this.vehicle1_.getComponent("steering_vehicle").evade(this.vehicle3_.getComponent("steering_vehicle")),this.vehicle2_.getComponent("steering_vehicle").evade(this.vehicle1_.getComponent("steering_vehicle")),this.vehicle3_.getComponent("steering_vehicle").evade(this.vehicle2_.getComponent("steering_vehicle"));else if(4===this.behaviorIdx_)this.vehicle1_.getComponent("steering_vehicle").wander(),this.vehicle2_.getComponent("steering_vehicle").wander(),this.vehicle3_.getComponent("steering_vehicle").wander();else if(5===this.behaviorIdx_)this.vehicle1_.getComponent("steering_vehicle").avoid(this.targets_.values()),this.vehicle2_.getComponent("steering_vehicle").avoid(this.targets_.values()),this.vehicle3_.getComponent("steering_vehicle").avoid(this.targets_.values());else if(6===this.behaviorIdx_)this.vehicle1_.getComponent("steering_vehicle").followPath(this.path_,!0),this.vehicle2_.getComponent("steering_vehicle").followPath(this.path_,!0),this.vehicle3_.getComponent("steering_vehicle").followPath(this.path_,!0),t=!1;else if(7===this.behaviorIdx_){this.target_&&this.vehicle1_.getComponent("steering_vehicle").seek(this.target_.position);for(var e=0;e<this.group_.length;++e)this.group_[e].flock(this.group_)}t&&this.target_&&this.vehicle1_.getBoundingBox().contains(this.target_.position)&&(this.targets_.remove(this.target_.uuid),this.targetPool_.put(this.target_),this.targets_.size()>0?this.target_=this.targets_.getFirst():this.target_=null)},e.prototype.onSwitch=function(){++this.behaviorIdx_,this.behaviorIdx_>=c.length&&(this.behaviorIdx_=0),this.lbl_.string=c[this.behaviorIdx_]},e.prototype.onExit=function(){r.GameLogic.instance.changeScene("load")},n([l(cc.Node)],e.prototype,"vehicle1_",void 0),n([l(cc.Node)],e.prototype,"vehicle2_",void 0),n([l(cc.Node)],e.prototype,"vehicle3_",void 0),n([l(cc.Node)],e.prototype,"targetCpy_",void 0),n([l(cc.Label)],e.prototype,"lbl_",void 0),e=n([h],e)}(cc.Component);i.TestSteering=u,cc._RF.pop()},{"../game_logic":"game_logic","../util/structure/hd_map":"hd_map"}],timed_task:[function(t,e,i){"use strict";cc._RF.push(e,"a21f90VLa1Hqo8OR1ttbYLp","timed_task"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("./structure/hd_map");(function(t){t[t.kNone=0]="kNone"})(o=i.TimedTaskType||(i.TimedTaskType={})),i.kInfinitedRepeat=-2;var s=function(){function t(){this.id=0,this.type=o.kNone,this.callback_=null,this.param_=null,this.timer_=0,this.repeat_=1,this.delay_=0,this.interval_=0,this.bFrame_=!1,this.bPause_=!1}return Object.defineProperty(t.prototype,"pause",{set:function(t){this.bPause_=t},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,n,s,r,a,h,l){void 0===n&&(n=0),void 0===s&&(s=1),void 0===r&&(r=0),void 0===a&&(a=null),void 0===h&&(h=o.kNone),void 0===l&&(l=!1),this.id=t,this.callback_=e,this.repeat_=s<i.kInfinitedRepeat?i.kInfinitedRepeat:s,this.delay_=n,this.interval_=r,this.timer_=r,this.type=h,this.bFrame_=l,this.bPause_=!1},t.prototype.excute=function(t){if(!this.bPause_){var e=!1;if(!(this.delay_>0))return this.repeat_>0||this.repeat_===i.kInfinitedRepeat?(this.bFrame_?++this.timer_:this.timer_+=t,this.timer_>=this.interval_&&(this.repeat_>0&&--this.repeat_,this.callback_&&this.callback_(this.param_),this.timer_=0)):0===this.repeat_&&(e=!0),e;this.bFrame_?--this.delay_:this.delay_-=t}},t}(),r=function(){function t(){this.baseId_=0,this.noneTypeMap_=new n.HDMap,this.specTypeMap_=new n.HDMap}return t.prototype.add=function(t,e,i,n,r,a,h){void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=null),void 0===a&&(a=o.kNone),void 0===h&&(h=!1),++this.baseId_;var l,c=new s;(c.init(this.baseId_,t,e,i,n,r,a,h),a===o.kNone)?this.noneTypeMap_.put(this.baseId_,c):this.specTypeMap_.containsKey(c)?null!=(l=this.specTypeMap_.get(c))&&l.push(c):((l=new Array).push(c),this.specTypeMap_.put(c,l));return this.baseId_},t.prototype.addWithFrame=function(t,e,i,n,s,r){void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===r&&(r=o.kNone),this.add(t,e,i,n,s,r,!0)},t.prototype.pause=function(t,e,i){var n;if(void 0===i&&(i=o.kNone),i===o.kNone)this.noneTypeMap_.containsKey(e)?this.noneTypeMap_.get(e).pause=t:console.warn("[TimedTask] not valid id in type <TimedTaskType.kNone>");else if(this.specTypeMap_.containsKey(i)){if(-1===e){if(n=this.specTypeMap_.get(i))for(var s=0;s<n.length;++s)n[s].pause=t}else if(null!=(n=this.specTypeMap_.get(i)))for(s=0;s<n.length;++s)if(n[s].id===e){n[s].pause=t;break}}else console.warn("[TimedTask] not valid type: ",i)},t.prototype.pauseAll=function(t,e){this.noneTypeMap_.each(function(i,o,n){if(e){for(var s=!1,r=0;r<e.length;++r)if(e[r]==n.id){e.splice(r,1),s=!0;break}s||(n.pause=t)}else n.pause=t}),this.specTypeMap_.each(function(i,o,n){if(e)for(var s=0;s<n.length;++s){for(var r=!1,a=0;a<e.length;++a)if(e[a]==n[s].id){e.splice(a,1),r=!0;break}r||(n[s].pause=t)}else for(var h=0;h<n.length;++h)n[h].pause=t})},t.prototype.remove=function(t,e){if(void 0===e&&(e=o.kNone),e===o.kNone)this.noneTypeMap_.containsKey(t)&&this.noneTypeMap_.remove(t);else if(this.specTypeMap_.containsKey(e))if(-1===t)this.specTypeMap_.remove(e);else{var i=this.specTypeMap_.get(e);if(null!=i){for(var n=0;n<i.length;++n)if(i[n].id===t){i.splice(n,1);break}0==i.length&&this.specTypeMap_.remove(e)}}else console.warn("[TimedTask] not valid type: ",e)},t.prototype.clear=function(){this.baseId_=0,this.noneTypeMap_.clear(),this.specTypeMap_.clear()},t.prototype.excuteTasks=function(t){if(this.noneTypeMap_.size()>0){var e=[];this.noneTypeMap_.each(function(i,o,n){n.excute(t)&&e.push(n.id)});for(var i=0;i<e.length;++i)this.remove(e[i])}if(this.specTypeMap_.size()>0){var o=[],n=[];this.specTypeMap_.each(function(e,i,s){if(s){o.push(i);for(var r=0;r<s.length;++r)s[r].excute(t)&&n.push(s[r].id)}});for(i=0;i<o.length;++i)for(var s=0;s<n.length;++s)this.remove(n[s],o[i])}},t.instance=new t,t}();i.TimedTaskMgr=r,i.TimedTaskInst=r.instance,cc._RF.pop()},{"./structure/hd_map":"hd_map"}],tip_ui:[function(t,e,i){"use strict";cc._RF.push(e,"67c7csJ865MkKNEu+S9kVUm","tip_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./base_ui"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lbl_=null,e.showTrans_=null,e}return o(e,t),e.prototype.init=function(t){t&&(this.com_=t,t.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this.lbl_=t.getChild("tipLbl").asTextField,this.showTrans_=t.getTransition("showTrans"),t.sortingOrder=n.UIHierarchy.kTip,t.visible=!1,n.BaseUI.root.addChild(t))},e.prototype.show=function(t){var e=this;this.com_&&(this.com_.visible=!0,this.lbl_.text=t,this.showTrans_.stop(),this.showTrans_.play(function(){e.com_.visible=!1}))},e.instance=new e,e}(n.BaseUI);i.TipUI=s,i.TipUIInst=s.instance,cc._RF.pop()},{"./base_ui":"base_ui"}],trans_ui:[function(t,e,i){"use strict";cc._RF.push(e,"7ebe6vyvUpNvZJWJ2JHNuPW","trans_ui");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./base_ui"),s=t("../../util/audio_mgr"),r=t("../../util/global_def"),a=t("../../util/timed_task"),h=["\u5c0f\u5fc3\u4e0d\u8981\u78b0\u5230\u7901\u77f3","\u52a0\u901f\u6ed1\u677f\u80fd\u8ba9\u4f60\u53d8\u5f97\u66f4\u5feb","\u5c3d\u91cf\u907f\u5f00\u969c\u788d","\u4e0d\u8981\u5728\u80cc\u540e\u649e\u5230\u5bf9\u624b","\u7a7a\u4e2d\u8c03\u6574\u65b9\u5411\u5f88\u56f0\u96be","\u51b2\u523a\u72b6\u6001\u4e0b\u649e\u5230\u969c\u788d\u4e0d\u4f1a\u51cf\u901f","\u590d\u6d3b\u540e\u80fd\u591f\u65e0\u654c\u4e00\u5c0f\u6bb5\u65f6\u95f4"],l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lbl_=null,e.loader_=null,e.showTrans_=null,e.closeTrans_=null,e.rotTrans_=null,e.callbackOver_=null,e.taskId_=0,e.bTrans_=!1,e}return o(e,t),e.prototype.init=function(t){t&&(this.com_=t,t.setSize(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this.lbl_=t.getChild("txtLbl").asTextField,this.loader_=t.getChild("imgLoader").asLoader,this.showTrans_=t.getTransition("showTrans"),this.closeTrans_=t.getTransition("closeTrans"),this.rotTrans_=t.getTransition("rotTrans"),t.sortingOrder=n.UIHierarchy.kTrans,t.visible=!1,n.BaseUI.root.addChild(t))},e.prototype.show=function(t,e){void 0===e&&(e=!1),this.com_&&(this.com_.visible=!0,s.AudioMgr.instance.stopMusic(),this.callbackOver_=t,e?(this.loader_.visible=!1,this.lbl_.visible=!1):(this.loader_.visible=!0,this.lbl_.visible=!0,this.lbl_.text=h[r.G.randRange(0,h.length-1)],this.taskId_>0&&(a.TimedTaskMgr.instance.remove(this.taskId_),this.taskId_=0)),this.showTrans_.play(this._showOver.bind(this)),this.rotTrans_.play(null,-1),this.bTrans_=!0)},e.prototype.over=function(t,e){var i=this;void 0===t&&(t=0),void 0===e&&(e=null),this.bTrans_?t>0?this.taskId_=a.TimedTaskMgr.instance.add(function(){e&&e(),i._close()},t):(e&&e(),this._close()):e&&e()},e.prototype.reset=function(){this.com_&&(this.rotTrans_.stop(),this.com_.visible=!1,this.bTrans_=!1)},e.prototype._showOver=function(){this.callbackOver_&&(this.callbackOver_(),this.callbackOver_=null)},e.prototype._close=function(){this.closeTrans_.play(this.reset.bind(this))},e.instance=new e,e}(n.BaseUI);i.TransUI=l,i.TransUIInst=l.instance,cc._RF.pop()},{"../../util/audio_mgr":"audio_mgr","../../util/global_def":"global_def","../../util/timed_task":"timed_task","./base_ui":"base_ui"}],tt_util:[function(t,e,i){"use strict";cc._RF.push(e,"ea20fPv9htOkJoJSEBSFZTR","tt_util");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("../game_setting"),s=t("./game_storage"),r=t("./global_def"),a=t("./network/http_req"),h=t("./event_mgr"),l=t("./timed_task"),c=t("../data/data_hub"),u=t("../game_ui/common/ad_sim_ui"),d=t("./mgp_def"),_=t("../game/user_info");i.kPortToutiao="Toutiao",i.kPortDouyin="douyin",i.kPortPPX="PPX",i.kPortXiGua="XiGua";var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultLaunchOptions_=[{appId:"tt90b7e60a0f9d5a88"},{appId:"tte77191cc785b3fdb"},{appId:"tt826ff4d21d455943"},{appId:"tt3f5449e9a07efb4d"},{appId:"tt1794612988becef1"},{appId:"tt4eff3842d1d593ee"},{appId:"tted059bb8722fc13c"},{appId:"tt5327259acc0d91e5"},{appId:"ttb698c02529b27ff9"},{appId:"tte25794ea7d7d28fb"}],e.bListenMGModalClose_=!1,e.moreGameBtn_=null,e.gameRecorderMgr_=null,e.gameRecTimstamp_=0,e.bGameRecording_=!1,e.shRecTimeIdForDY_=0,e}return o(e,t),e.prototype.saveData=function(){var t={openId:n.GameSetting.openId};s.GameStorage.writeJSON(s.SaveDef.kWxStatus,t)},e.prototype.readData=function(){var t=s.GameStorage.readJSON(s.SaveDef.kWxStatus);t&&(n.GameSetting.openId=t.openId)},e.prototype.fetchSdkInfo=function(){this.sdkInfo=tt.getSystemInfoSync(),console.log("[TtUitl SDK info]",this.sdkInfo.screenWidth,this.sdkInfo.screenHeight,this.sdkInfo.platform,this.sdkInfo.SDKVersion,this.sdkInfo.appName),1==n.GameSetting.testServer&&(this.domain_="http://119.23.108.126:8900/comLogin")},e.prototype.compareVersion=function(t,e){for(var i=t.split("."),o=e.split("."),n=Math.max(i.length,o.length);i.length<n;)i.push("0");for(;o.length<n;)o.push("0");for(var s=0;s<n;s++){var r=parseInt(i[s]),a=parseInt(o[s]);if(r>a)return 1;if(r<a)return-1}return 0},e.prototype.convertMenuButtonRect=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i={x:0,y:0,w:0,h:0},o=this.sdkInfo;if(-1!=this.compareVersion(o.SDKVersion,"1.4.0")){var n=tt.getMenuButtonLayout(),s=cc.view.getVisibleSize().width,r=cc.view.getVisibleSize().height,a=s/o.screenWidth,h=r/o.screenHeight;i.x=n.left*a+t,i.y=n.top*h+e,i.w=n.width*a,i.h=n.height*h}return i},e.prototype.login=function(t,e,i,o,s){var r=this;void 0===o&&(o=!1),void 0===s&&(s=!1),o?this._login(t,e,i,s):tt.checkSession({success:function(t){console.log("check session succ",t),r.readData(),console.log("read session key",n.GameSetting.sessionKey)},fail:function(o){console.log("check session fail",o),r._login(t,e,i,s)},complete:function(t){}})},e.prototype._login=function(t,e,i,o){var s=this;void 0===o&&(o=!1),tt.login({success:function(a){r.G.log("login succ",1,a,o),a.isLogin?a.code&&(s.loginCode_=a.code,o?t&&t():tt.request({url:s.domain_+"/user/getSessionKey/tt",data:{code:a.code,proName:n.GameSetting.proName,choose:"1"},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(i){i.statusCode>=200&&i.statusCode<=400?(console.log("login request succ",i),t&&t(JSON.parse(i.data.res))):(console.log("login request fail",i),e&&e(i))},fail:function(t){console.log("login request complete fail",t),i&&i(t)}})):t&&t()},fail:function(t){console.log("login fail",t),i&&i(t)},complete:function(t){}})},e.prototype.fetchUserInfo=function(t,e,i,o,n,s){var a=this;-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.3.0")?tt.getSetting({success:function(h){if(h.authSetting["scope.userInfo"])tt.getUserInfo({withCredentials:!0,lang:"zh_CN",success:function(t){e&&e(t.userInfo),a._authLogin(t,i,o)},fail:function(t){r.G.log("get setting scope userInfo failed",1,t)},complete:function(t){}});else if(-1!=a.compareVersion(a.sdkInfo.SDKVersion,"1.3.0")){var l=tt.createImage();l.src="res/raw-assets/resources/"+t+".png",l.onload=function(){var t=s;if(r.G.isEmptyObj(t)){var a=l.width,h=l.height;t={left:.5*this.sdkInfo.screenWidth-.5*a,top:.5*this.sdkInfo.screenHeight,width:a,height:h,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(e,t,l.src,n,i,o)}.bind(a)}else a.modalDialog("\u5fae\u4fe1\u66f4\u65b0\u63d0\u793a","\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8f83\u4f4e\uff0c\u5efa\u8bae\u5347\u7ea7\u4ee5\u4fdd\u969c\u6e38\u620f\u4f53\u9a8c",function(){tt.exitMiniProgram({})},null,!1)},fail:function(t){},complete:function(t){}}):this.modalDialog("\u5fae\u4fe1\u66f4\u65b0\u63d0\u793a","\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u8bf7\u5347\u7ea7\u5df2\u4fdd\u969c\u6b63\u5e38\u6e38\u620f\u4f53\u9a8c",function(){tt.exitMiniProgram({})},null,!1)},e.prototype._authLogin=function(t,e,i){tt.request({url:this.domain_+"/user/auth",data:{encryptedData:t.encryptedData,iv:t.iv,code:this.loginCode_,proName:n.GameSetting.proName},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){t.statusCode>=200&&t.statusCode<=400?(console.log("_authLogin request succ",t),e&&e(t.data.res)):(console.log("_authLogin request fail",t),i&&i())},fail:function(t){console.log("_authLogin request complete fail",t)}})},e.prototype._authentication=function(t,i,o,n,s,a){var h=tt.createUserInfoButton({type:"image",text:"txt",image:o,style:i,withCredentials:!0,lang:"zh_CN"});h.show(),r.G.log("create button",1,h);var l=function(e){if(r.G.log("_authentication onTap",1,e),null==e.iv||null==e.encryptedData){r.G.log("cancel auth");var c=tt.createImage();c.src=o,c.onload=function(){var e=i;if(r.G.isEmptyObj(e)){var o=c.width,h=c.height;e={left:.5*this.sdkInfo.screenWidth-.5*o,top:.5*this.sdkInfo.screenHeight,width:o,height:h,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(t,i,c.src,n,s,a)}.bind(this)}else t&&t(e.userInfo),this._authLogin(e,s,a),n&&n();h.offTap(l),h.destroy()}.bind(e);h.onTap(l)},e.prototype.uploadUserInfo=function(t,e,i,o,s,r){tt.request({url:this.domain_+"/user/updUser",data:{proName:n.GameSetting.proName,openid:n.GameSetting.openId,unionid:n.GameSetting.unionId,nickname:t,gender:i,avatarurl:e,city:o,province:s,country:r},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){},fail:function(t){}})},e.prototype.showForward=function(t){tt.showShareMenu({withShareTicket:!1,success:function(t){},fail:function(){},complete:function(){}}),tt.onShareAppMessage(function(){var e=null;return t&&(e=t()),e})},e.prototype.shareNorm=function(t,e,i,o){var s=this,r=e.lastIndexOf("Shared/"),h=n.GameSetting.proName,l="";-1!=r&&(l=e.substring(r+h.length+8)),a.HttpRequest.shareOut(l),tt.shareAppMessage({title:t,imageUrl:e,query:"hdimg="+l,cancel:function(){console.log("norm share cancel"),s.bNormShareCancel=!0,s.normShareFailCallback&&(s.normShareFailCallback(),s.normShareFailCallback=null)}}),this.normShareTimestamp=Date.now(),this.normShareSuccCallback=i,this.normShareFailCallback=o,this.bNormShareCancel=!1},e.prototype.normShareResult=function(){var t=this;this.normShareTimestamp>0&&(Date.now()-this.normShareTimestamp>=2400?setTimeout(function(){t.bNormShareCancel||(t.normShareSuccCallback&&(t.normShareSuccCallback(),t.normShareSuccCallback=null),r.G.log("norm share succ"))},100):(this.normShareFailCallback&&(this.normShareFailCallback(),this.normShareFailCallback=null),r.G.log("norm share fail")),this.normShareTimestamp=0)},e.prototype.launchInvitationCheck=function(t,e){void 0===e&&(e=!1);var i=tt.getLaunchOptionsSync();i&&r.G.isExistObj(i.query)&&i.query.hdimg&&a.HttpRequest.shareClick(i.query.hdimg)},e.prototype.onShowInvitationCheck=function(t,e,i){void 0===i&&(i=!1),r.G.isExistObj(t)&&t.hdimg&&a.HttpRequest.shareClick(t.hdimg)},e.prototype.reqTimerReset=function(t,i,o){var s=function(){var e=this;tt.request({url:this.domain_+"/user/reqTimerReset",data:{proName:n.GameSetting.proName,sysName:t,openId:n.GameSetting.openId,choose:i.toString()},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){if(t.statusCode>=200&&t.statusCode<=400){console.log("reqTimerReset request succ",t);var i=parseInt(t.data.res);o&&o(i)}else console.log("reqTimerReset request fail",t),e.modalDialog("\u7f51\u7edc\u62a5\u544a","\u5f53\u524d\u7f51\u7edc\u73af\u5883\u4e0d\u4f73\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u91cd\u8bd5")},fail:function(t){console.log("reqTimerReset request fail",t)}})}.bind(e);""==n.GameSetting.openId?this.login(function(t){n.GameSetting.sessionKey=t.sessionKey,n.GameSetting.openId=t.openId,s(),r.G.log("reqTimerReset relogin",1,t)},null,null,!0):s()},e.prototype.reqTimerResetUnion=function(t,i,o,s){var r=function(){tt.request({url:this.domain_+"/user/reqTimerResetU",data:{proName:n.GameSetting.proName,sysName:t,unionId:n.GameSetting.unionId,choose:i.toString()},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){if(t.statusCode>=200&&t.statusCode<=400){console.log("reqTimerResetUnion request succ",t);var e=parseInt(t.data.res);o&&o(e)}else console.log("reqTimerResetUnion request fail",t)},fail:function(t){console.log("reqTimerResetUnion request complete fail",t)}})}.bind(e);""==n.GameSetting.unionId?s&&s():r()},e.prototype._getVideoBonus=function(){this.videoBonusCallback_&&(this.videoBonusCallback_(),this.videoBonusCallback_=null)},e.prototype.watchVideoAds=function(t,e,i,o,n,s,a){var u=this;void 0===a&&(a="");var d=this.sdkInfo;if(-1!=this.compareVersion(d.SDKVersion,"1.3.0")){var _=function(o){if(u.videoAdsProtectFlags_.containsKey(t)&&1===u.videoAdsProtectFlags_.get(t))return;console.log("Ads Close callback",o.isEnded),h.GameEventMgrInst.addEvent(h.EventType.kAudioResume,null,{pauseType:1}),o&&o.isEnded||void 0===o?(e&&e(),u.videoAdsProtectFlags_.put(t,1)):(i&&i(),u.toast("\u8bf7\u89c2\u770b\u5b8c\u6574\u89c6\u9891\u4ee5\u83b7\u53d6\u5956\u52b1"),u.videoAdsProtectFlags_.put(t,0)),u.videoTimeId_>0&&(l.TimedTaskInst.remove(u.videoTimeId_),u.videoTimeId_=0),u.videoBonusCallback_=null},p=function(t){console.log("Ads error callback",t.errMsg),h.GameEventMgrInst.addEvent(h.EventType.kAudioResume,null,{pauseType:1}),o&&o(t),u.videoBonusCallback_=null};if(this.videoAd_=tt.createRewardedVideoAd({adUnitId:t}),this.videoAd_.load().then(function(){u.videoAd_.show().then(function(){console.log("video show"),h.GameEventMgrInst.addEvent(h.EventType.kAudioPause,null,{pauseType:1}),r.G.randRange(0,100)<=c.DataHub.config.videoBonus&&(u.videoTimeId_>0&&(l.TimedTaskInst.remove(u.videoTimeId_),u.videoTimeId_=0),u.videoBonusCallback_=s,u.videoTimeId_=l.TimedTaskInst.add(function(){var t=a||"\u70b9\u51fb\u5e95\u90e8\u6761\u5e45\u53ef\u83b7\u5f97\u5956\u52b1";u.toast(t,5e3)},5))}).catch(function(t){return console.log("video err",t)}),u.videoAdsProtectFlags_.put(t,0)}).catch(function(t){return console.log(t.errMsg)}),this.videoAdsCallbackMap_.containsKey(t)){var f=this.videoAdsCallbackMap_.get(t);this.videoAd_.offClose(f.closeCallback),this.videoAd_.offError(f.errCallback),this.videoAdsCallbackMap_.remove(t)}this.videoAd_.onClose(_),this.videoAd_.onError(p);var m=new g(_,p);this.videoAdsCallbackMap_.put(t,m),n&&n()}else this.modalDialog("\u63d0\u793a","\u5fae\u4fe1\u7248\u672c\u8f83\u4f4e\uff0c\u6682\u4e0d\u652f\u6301\u89c6\u9891\u89c2\u770b",null,null,!1)},e.prototype.bannerStat=function(t){if(t&&t.mode&&t.targetAction){if("back"==t.mode&&3==t.targetAction||"hide"==t.mode&&-1==t.targetAction)return;this._getVideoBonus()}},e.prototype._calBannerXYWZ=function(t,e,i,o){void 0===i&&(i=1),void 0===o&&(o=15);var n=Math.max(Math.min(t,208),128),s=n/16*9,r=0,a=0;if(e){var h=cc.view.getVisibleSize().height,l=e.localToGlobal().y,c=(l+o)/h;a=this.sdkInfo.screenHeight*c,console.log("_calBannerXYWZ node",c,l,o,h-l,h,a,this.sdkInfo.screenHeight)}else r=.5*(this.sdkInfo.screenWidth-n),a=this.sdkInfo.screenHeight-s-25,0==i&&(a=0),console.log("_calBannerXYWZ norm",n,s,r,a);return{x:r,y:a,w:n,h:s}},e.prototype.preloadBanner=function(t,e,i,o,n,s,a,h){var l=this;if(void 0===i&&(i=208),void 0===o&&(o=15),void 0===n&&(n=null),void 0===s&&(s=null),void 0===a&&(a=1),void 0===h&&(h=4),!r.G.isByteDance)return u.BannerSimUI.addTestBannerHolder(t,e?e.asCom:null,a),void(n&&n());if(-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.3.0")){if(h>1e3&&this.bnrItemMap_.containsKey(t))this.bnrItemMap_.get(t).refreshCnt>=h&&this.destroyBanner(t);var c=null;if(!this.bnrItemMap_.containsKey(t)){c=new m;var d=this._calBannerXYWZ(i,e,a,o);c.obj=tt.createBannerAd({adUnitId:t,style:{left:d.x,top:d.y,width:d.w}}),c.id=t,c.refreshCnt=0,c.refreshRule=h,c.errCb=s,c.x=d.x,c.y=d.y,c.w=d.w,c.h=d.h,c.adErrCallback=function(t){r.G.log("Banner Ads pull failed",t),++c.refreshCnt,-1!=l.compareVersion(l.sdkInfo.SDKVersion,"1.3.0")&&t.errCode&&(1e3==t.errCode||1003==t.errCode||(c.bLimited=!0)),c.errCb&&c.errCb()},c.obj.onError(c.adErrCallback.bind(c));var _=function(t){c.obj.style.top=l.sdkInfo.screenHeight-t.height-25,c.obj.style.left=(l.sdkInfo.screenWidth-t.width)/2,c.obj.offResize(_)};c.obj.onResize(_);var p=function(){r.G.log("Banner pull success"),n&&n(),c.obj.offLoad(p)};c.obj.onLoad(p),this.bnrItemMap_.put(t,c)}}},e.prototype.isBannerShowed=function(t){if(!r.G.isByteDance)return u.BannerSimUI.isTestBannerHolderShowed(t);var e=!1;this.bnrItemMap_.containsKey(t)&&(e=this.bnrItemMap_.get(t).bShow);return e},e.prototype.isBannerLimited=function(t){if(!r.G.isByteDance)return u.BannerSimUI.isTestBannerLimited(t);var e=!1;this.bnrItemMap_.containsKey(t)&&(e=this.bnrItemMap_.get(t).bLimited);return e},e.prototype.showBanner=function(t){var e=this;if(r.G.isByteDance){if(-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.3.0")&&(this.hideLastOne(),this.bnrItemMap_.containsKey(t))){var i=this.bnrItemMap_.get(t);if(i.refreshRule<1e3&&i.refreshCnt>=i.refreshRule){var o=new m;o.obj=tt.createBannerAd({adUnitId:t,style:{left:i.x,top:i.y,width:i.w}}),o.id=t,o.refreshCnt=0,o.refreshRule=i.refreshRule,o.errCb=i.errCb,o.adErrCallback=function(t){r.G.log("Banner Ads pull failed",t),++o.refreshCnt,-1!=e.compareVersion(e.sdkInfo.SDKVersion,"1.3.0")&&t.errCode&&(1e3==t.errCode||1003==t.errCode||(o.bLimited=!0)),o.errCb&&o.errCb()},o.obj.onError(o.adErrCallback.bind(o));var n=function(t){console.log(t.width,t.height),i.obj.style.top=e.sdkInfo.screenHeight-t.height-25,i.obj.style.left=(e.sdkInfo.screenWidth-t.width)/2,i.obj.offResize(n)};i.obj.onResize(n),o.x=i.x,o.y=i.y,o.w=i.w,o.h=i.h,i.del(),this.bnrItemMap_.remove(t),this.bnrItemMap_.put(t,o),i=o}i.show(),this.lastBnrItemStack_.push(i)}}else u.BannerSimUI.showTestBannerHolder(t)},e.prototype.hideBanner=function(t){r.G.isByteDance?this.bnrItemMap_.containsKey(t)&&(this.bnrItemMap_.get(t).hide(),this.lastBnrItemStack_.pop(),this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].show()):u.BannerSimUI.hideTestBannerHolder(t)},e.prototype.showLastOne=function(){r.G.isByteDance?this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].show():u.BannerSimUI.showLastTestBanner()},e.prototype.hideLastOne=function(){r.G.isByteDance?this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].hide():u.BannerSimUI.hideLastTestBanner()},e.prototype.destroyBanner=function(t){if(this.bnrItemMap_.containsKey(t)){this.bnrItemMap_.get(t).del();for(var e=0;e<this.lastBnrItemStack_.length;++e)if(this.lastBnrItemStack_[e].id===t){this.lastBnrItemStack_.splice(e,1);break}this.bnrItemMap_.remove(t)}},e.prototype.hideAllBanners=function(){var t=this;r.G.isByteDance?(this.hideLastOne(),this.bnrItemMap_.each(function(e,i,o){t.hideBanner(i)})):u.BannerSimUI.hideAllTestBanner()},e.prototype.checkVersionUpdate=function(t,e){var i=this,o=this.sdkInfo;if(-1!=this.compareVersion(o.SDKVersion,"1.9.0")){var n=o.system;if(-1!==n.indexOf("Android")){var s=n.substr(7).trim();if(-1==this.compareVersion(s,"6.6.7"))return r.G.log("skip update cause the system version is too low",1,s),void(e&&e())}r.G.log("check version update",o.system);var a=tt.getUpdateManager();a.onCheckForUpdate(function(i){console.log(i.hasUpdate),i.hasUpdate?t&&t():e&&e()}),a.onUpdateReady(function(){i.modalDialog("\u66f4\u65b0\u63d0\u793a","\u65b0\u7248\u672c\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u8bf7\u91cd\u542f\u6e38\u620f",function(){a.applyUpdate()},null,!1)}),a.onUpdateFailed(function(){i.modalDialog("\u66f4\u65b0\u63d0\u793a","\u65b0\u7248\u672c\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u7f51\u7edc\u73af\u5883\u662f\u5426\u826f\u597d\u6216\u8005\u91cd\u542f\u5fae\u4fe1",null,null,!1)})}else this.modalDialog("\u66f4\u65b0\u63d0\u793a","\u5f53\u524dapp\u7248\u672c\u8f83\u4f4e\uff0c\u5efa\u8bae\u5347\u7ea7\u4ee5\u4fdd\u969c\u6e38\u620f\u4f53\u9a8c",null,null,!1),e&&e()},e.prototype.modalDialog=function(t,e,i,o,n,s,r,a,h){void 0===n&&(n=!0),void 0===s&&(s="\u53d6\u6d88"),void 0===r&&(r="#000000"),void 0===a&&(a="\u786e\u5b9a"),void 0===h&&(h="#3cc51f"),tt.showModal({title:t,content:e,showCancel:n,cancelText:s,cancelColor:r,confirmText:a,confirmColor:h,success:function(t){t.confirm?i&&i():t.cancel&&o&&o()}})},e.prototype.toast=function(t,e){void 0===e&&(e=1500),tt.showToast({title:t,duration:e,icon:"none"})},e.prototype.vibrateShort=function(){-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.0.0")&&tt.vibrateShort()},e.prototype.vibrateLong=function(){-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.0.0")&&tt.vibrateLong()},e.prototype.popMoreGamesDialog=function(t,e,i,o){var n=this.sdkInfo;if("ios"!==n.platform&&-1!==this.compareVersion(n.SDKVersion,"1.33.0")){var s=t||this.defaultLaunchOptions_;tt.showMoreGamesModal({appLaunchOptions:s}),this.bListenMGModalClose_||(tt.onMoreGamesModalClose(function(){o&&o()}),this.bListenMGModalClose_=!0),tt.offNavigateToMiniProgram(),tt.onNavigateToMiniProgram(function(t){0===t.errCode?e&&e():i&&i()})}},e.prototype.createMoreGamesButton=function(t,e,o,n,s,r,a,h,l,c,u){if(void 0===u&&(u=0),!this.moreGameBtn_){var d=this.sdkInfo;if(d.appName!==i.kPortPPX&&"ios"!==d.platform&&-1!==this.compareVersion(d.SDKVersion,"1.23.0")){var _=cc.view.getVisibleSize().height>cc.view.getVisibleSize().width,p=d.screenWidth/cc.view.getVisibleSize().width,f=d.screenHeight/cc.view.getVisibleSize().height,g=_?p:f,m=t*p,v=e*f,y=o*g,b=n*g;console.log("createMoreGamesButton",t,e,o,n,m,v,y,b,g,p,f);var C=0,w=0;d.appName===i.kPortXiGua&&(u=1,r="\u66f4\u591a\u6e38\u620f",C=2,w=10),this.moreGameBtn_=tt.createMoreGamesButton({type:0===u?"image":"text",image:s,text:r,style:{left:m,top:v,width:y,height:b,lineHeight:24,backgroundColor:"#e5e4f1",textColor:"#413f59",textAlign:"center",fontSize:20,borderRadius:w,borderWidth:C,borderColor:"#413f59"},appLaunchOptions:a||this.defaultLaunchOptions_,onNavigateToMiniGame:function(t){0===t.errCode?h&&h():l&&l()}}),this.moreGameBtn_.onTap(c),this.moreGameBtn_.hide()}}},e.prototype.showMoreGamesButton=function(){this.moreGameBtn_&&this.moreGameBtn_.show()},e.prototype.hideMoreGamesButton=function(){this.moreGameBtn_&&this.moreGameBtn_.hide()},e.prototype.prepareGameRecord=function(t,e,i,o,n){var s=this,r=this.sdkInfo;-1!==this.compareVersion(r.SDKVersion,"1.4.1")&&(this.gameRecorderMgr_||(this.gameRecorderMgr_=tt.getGameRecorderManager(),this.gameRecorderMgr_.onStart(function(){t&&t(),s.gameRecordVideoTempPath="",s.gameRecTimstamp_=Date.now(),s.bGameRecording_=!0,s.gameRecordClipIndexList=[],console.log("[TtUtil prepareGameRecord] on start",s.gameRecTimstamp_)}),this.gameRecorderMgr_.onStop(function(t){var i=Date.now()-s.gameRecTimstamp_;i>=3e3?s.gameRecordVideoTempPath=t.videoPath:(s.gameRecordVideoTempPath="",s.bGameRecording_&&s.toast("\u5f55\u5c4f\u65f6\u95f4\u4e0d\u8db33\u79d2",2e3)),e&&e(s.gameRecordVideoTempPath),s.bGameRecording_=!1,console.log("[TtUtil prepareGameRecord] on stop",s.gameRecTimstamp_,i)}),this.gameRecorderMgr_.onError(function(t){i&&i(),console.log("[TtUtil prepareGameRecord] on error",t)}),this.gameRecorderMgr_.onPause(function(){o&&o(),console.log("[TtUtil prepareGameRecord] on pause")}),this.gameRecorderMgr_.onResume(function(){n&&n(),console.log("[TtUtil prepareGameRecord] on resume")}),-1!==this.compareVersion(r.SDKVersion,"1.6.1")&&(this.gameRecorderMgr_.onInterruptionBegin(function(){s.gameRecorderMgr_.pause()}),this.gameRecorderMgr_.onInterruptionEnd(function(){s.gameRecorderMgr_.resume()}))))},e.prototype.startGameRecord=function(t){void 0===t&&(t=300),this.gameRecorderMgr_&&(this.gameRecorderMgr_.start({duration:t}),console.log("[TtUtil startGameRecord]",t))},e.prototype.stopGameRecord=function(){this.gameRecorderMgr_&&(this.gameRecorderMgr_.stop(),console.log("[TtUtil stopGameRecord]"))},e.prototype.pauseGameRecord=function(){this.gameRecorderMgr_&&this.gameRecorderMgr_.pause()},e.prototype.resumeGameRecord=function(){this.gameRecorderMgr_&&this.gameRecorderMgr_.resume()},e.prototype.clearGameRecord=function(){this.gameRecordVideoTempPath="",this.gameRecordClipIndexList=[],this.bGameRecording_=!1},e.prototype.cutGameRecordClip=function(t,e,i,o){var n=this;if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===o&&(o=null),this.gameRecorderMgr_&&this.bGameRecording_){var s=this.sdkInfo;-1!==this.compareVersion(s.SDKVersion,"1.20.0")&&this.gameRecorderMgr_.recordClip({timeRange:[t,e],success:function(t){n.gameRecordClipIndexList.push(t.index),i&&i(t)},fail:function(){o&&o()}})}},e.prototype.clipGameRecord=function(t,e,i,o){var n=this;if(void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=null),void 0===o&&(o=null),this.gameRecorderMgr_&&this.gameRecordClipIndexList.length>0){var s=this.sdkInfo;-1!==this.compareVersion(s.SDKVersion,"1.20.0")&&this.gameRecorderMgr_.clipVideo({path:this.gameRecordVideoTempPath,timeRange:[t,0],clipRange:e||this.gameRecordClipIndexList,success:function(t){console.log("[TtUtil clipGameRecord] path",t.videoPath),i&&i(t.videoPath),n.gameRecordVideoTempPath=t.videoPath},fail:function(t){console.log("[TtUtil clipGameRecord] error",t),o&&o()}})}},e.prototype.shareRecordVideo=function(t,e,o,n,s,r){var a=this;(console.log("shareRecordVideo",this.gameRecordVideoTempPath),""==this.gameRecordVideoTempPath)?this.toast("\u4e0d\u5b58\u5728\u5f55\u5236\u89c6\u9891"):(tt.shareAppMessage({channel:"video",title:t||"",desc:e||"",query:o||"",extra:{videoPath:this.gameRecordVideoTempPath},success:function(){console.log("\u5206\u4eab\u89c6\u9891\u6210\u529f"),s&&s()},fail:function(t){console.log("\u5206\u4eab\u89c6\u9891\u5931\u8d25"),t&&t.errMsg&&-1===t.errMsg.indexOf("cancel")?a.toast("\u6682\u65e0\u53ef\u4ee5\u5206\u4eab\u7684\u89c6\u9891"):a.toast("\u8bf7\u5206\u4eab\u89c6\u9891\u83b7\u53d6\u5956\u52b1"),r&&r()}}),this.sdkInfo.appName===i.kPortDouyin&&(console.log("[TtUitl shareRecordVideo] for douyin"),this.shRecTimeIdForDY_>0&&(l.TimedTaskInst.remove(this.shRecTimeIdForDY_),this.shRecTimeIdForDY_=0),this.shRecTimeIdForDY_=l.TimedTaskInst.add(function(){s&&s()},5)))},e.prototype.playAudio=function(t,e,i,o,n){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=!1);var s=null;if(this.audioInfoMap_.containsKey(t)?s=this.audioInfoMap_.get(t):(s=new f(t),this.audioInfoMap_.put(t,s)),s){var r=s.obj;r&&(r.src=t,r.startTime=i,r.volume=o,r.loop=e,r.autoplay=n,r.play())}},e.prototype.addAudioCallback=function(t,e){if(this.audioInfoMap_.containsKey(t)){var i=this.audioInfoMap_.get(t);i.endCallback&&i.obj.offEnded(i.endCallback),i.endCallback=e,i.obj.onEnded(i.endCallback)}},e.prototype.resumeAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.play()},e.prototype.pauseAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.pause()},e.prototype.stopAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.stop()},e.prototype.destroyAudio=function(t){if(this.audioInfoMap_.containsKey(t)){var e=this.audioInfoMap_.get(t);e.endCallback&&e.obj.offEnded(e.endCallback),e.obj.destroy(),this.audioInfoMap_.remove(t)}},e.prototype.onAudioInterruptionEnd=function(){tt.onAudioInterruptionEnd(function(){h.GameEventMgrInst.addEvent(h.EventType.kAudioResume)})},e.prototype.onShow=function(t){var e=this;void 0===t&&(t=!1),tt.onShow(function(i){h.GameEventMgrInst.addEvent(h.EventType.kAudioResume,null,{pauseType:2}),r.G.log("onShow"),e.onShowQueryCheck(i.query,t),e.normShareResult(),cc.director.resume(),_.GameUserInfo.calOfflineTime(),e.decideBannerClickSuc()})},e.prototype.onHide=function(){var t=this;tt.onHide(function(e){cc.director.pause(),h.GameEventMgrInst.addEvent(h.EventType.kAudioPause,null,{pauseType:2}),t.bannerStat(e),_.GameUserInfo.setOfflineTimestamp(),_.GameUserInfo.saveSignIn()})},e.prototype.triggerGC=function(){tt.triggerGC()},e.prototype.exitGame=function(){tt.exitMiniProgram({})},e}(d.MinigamePlatDef);i.TtUtil=p;var f=function(){return function(t){this.obj=null,this.endCallback=null,this.obj=tt.createInnerAudioContext()}}(),g=function(){return function(t,e){this.closeCallback=null,this.errCallback=null,this.closeCallback=t,this.errCallback=e}}(),m=function(){function t(){this.id="",this.obj=null,this.errCb=null,this.adErrCallback=null,this.refreshRule=4,this.refreshCnt=0,this.x=0,this.y=0,this.w=0,this.h=0,this.bShow=!1,this.bLimited=!1}return t.prototype.show=function(){var t=this;this.obj&&(++this.refreshCnt,this.obj.show().then(function(e){console.log("banner show",t.id)}).catch(function(e){console.log("banner show err",e),++t.refreshCnt}),this.bShow=!0)},t.prototype.hide=function(){this.obj&&(this.obj.hide(),this.bShow=!1)},t.prototype.del=function(){this.obj&&(this.adErrCallback&&(this.obj.offError(this.adErrCallback),this.adErrCallback=null),this.obj.destroy())},t}();cc._RF.pop()},{"../data/data_hub":"data_hub","../game/user_info":"user_info","../game_setting":"game_setting","../game_ui/common/ad_sim_ui":"ad_sim_ui","./event_mgr":"event_mgr","./game_storage":"game_storage","./global_def":"global_def","./mgp_def":"mgp_def","./network/http_req":"http_req","./timed_task":"timed_task"}],user_info:[function(t,e,i){"use strict";cc._RF.push(e,"13b53RuRKtGV7yiLupVLPJM","user_info"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=t("../util/game_storage"),s=t("../util/structure/hd_map"),r=t("../data/bonus_data"),a=t("../data/data_hub");i.kSpdConversionFac=2e3,function(t){t[t.kCoin=1]="kCoin",t[t.kBox1=2]="kBox1",t[t.kBox2=3]="kBox2",t[t.kBox3=4]="kBox3",t[t.kPiece1=5]="kPiece1",t[t.kPiece2=6]="kPiece2",t[t.kPiece3=7]="kPiece3"}(o=i.BonusType||(i.BonusType={}));var h=function(){return function(t,e,i){void 0===i&&(i=""),this.type=o.kCoin,this.count=0,this.desc="",this.type=t,this.count=e,this.desc=i}}();i.BonusInfo=h;var l=function(){return function(){this.signInBonusMap=new s.HDMap,this.lastSignInDay=0,this.signInAwarded=0,this.signInAwardCnt=0,this.signInTotalCnt=0,this.videoLimited=0,this.signAutoPopCnt=2,this.videoBonusCnt=5,this.bnrClickCnt=0,this.videoBonusTime=3600,this.offlineTimestamp=0}}();i.DailyData=l;var c=function(){return function(){this.lv=1,this.coin=0,this.ownRoles=[1],this.itemMap=new s.HDMap}}();i.PlayerProp=c;var u=function(){function t(){}return Object.defineProperty(t,"signInAwards",{get:function(){var e=this;if(0===t.dailyDat.signInBonusMap.size()||t.dailyDat.signInAwardCnt>=7){t.dailyDat.signInBonusMap.clear(),t.dailyDat.signInAwardCnt=0;for(var i=function(t){return t*e.prop.lv},o=Math.floor((t.dailyDat.signInTotalCnt+1)/7),n=r.BonusData.getSignInDataGroup(o),s=0;s<n.length;++s){var a=n[s],l=r.BonusData.getSignInBonusID(a.id),c=r.BonusData.getSignInBonusAmount(a.id,i),u=a.desc,d=r.BonusData.getBonusCategoryData(l);""==u&&(u=d?"\u53ef\u83b7\u5f97"+d.name:"\u53ef\u83b7\u5f97\u5956\u52b1"),t.dailyDat.signInBonusMap.put(a.day,new h(l,c,u))}}return t.dailyDat.signInBonusMap},enumerable:!0,configurable:!0}),t.genBoxAwards=function(t,e){var i=this;if(e){e.clear(),t<1?t=1:t>3&&(t=3);for(var o=function(t){return t},n=function(t){return t*i.prop.lv},s=r.BonusData.getBoxDataGroup(0),a=0;a<s.length;++a)if(s[a].count===t){for(var l=0;l<s[a].items.length;++l){var c=s[a].items[l],u=r.BonusData.getBoxBonusID(c,o),d=r.BonusData.getBoxBonusAmount(c,n);e.put(l+1,new h(u,d))}break}}},Object.defineProperty(t,"isVideoLimited",{get:function(){return 1===t.dailyDat.videoLimited},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isVideoBoxBonus",{get:function(){return t.dailyDat.videoBonusTime<=0&&t.dailyDat.videoBonusCnt>0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isVideoBoxBonusExisted",{get:function(){return t.dailyDat.videoBonusCnt>0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isSignInAutoPopout",{get:function(){return t.dailyDat.signAutoPopCnt>0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isSignInAwarded",{get:function(){return 1===t.dailyDat.signInAwarded},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isSignIn7Days",{get:function(){return t.dailyDat.signInAwardCnt>=7},enumerable:!0,configurable:!0}),Object.defineProperty(t,"videoBoxBounsTime",{get:function(){return t.dailyDat.videoBonusTime},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isBannerClickAvailable",{get:function(){return this.dailyDat.bnrClickCnt<a.DataHub.config.bnrClickCnt},enumerable:!0,configurable:!0}),t.resetLastClickTimestamp=function(){this.lastClickTimestamp=0},t.calBannerJumpInterval=function(){if(this.lastClickTimestamp>0){var t=(Date.now()-this.lastClickTimestamp)/1e3;t>1.5&&(t=1.5),this.lastClickTimestamp=0,this.bnrJumpInterval=t}else this.lastClickTimestamp=Date.now()},t.addBannerClickCnt=function(){++this.dailyDat.bnrClickCnt,this.saveSignIn()},t.limitVideo=function(){t.dailyDat.videoLimited=1},t.countSignInPop=function(e){void 0===e&&(e=!1),e?t.dailyDat.signAutoPopCnt=-1:--t.dailyDat.signAutoPopCnt},t.calVideoBonusTime=function(e){t.dailyDat.videoBonusTime-=e},t.countVideoBonus=function(){--t.dailyDat.videoBonusCnt},t.resetVideoBonusTime=function(){t.dailyDat.videoBonusTime=300*(5-t.dailyDat.videoBonusCnt+1)},t.setOfflineTimestamp=function(){t.dailyDat.offlineTimestamp=Date.now()},t.calOfflineTime=function(){if(t.dailyDat.offlineTimestamp>0){var e=Date.now()-t.dailyDat.offlineTimestamp,i=e/1e3;t.calVideoBonusTime(i),t.dailyDat.offlineTimestamp+=e}},t.isCoinAfford=function(e){return t.prop.coin>=e},t.saveProp=function(){n.GameStorage.writeJSON(n.SaveDef.kPlayer,t.prop)},t.saveSignIn=function(){n.GameStorage.writeJSON(n.SaveDef.kDaily,t.dailyDat)},t.read=function(){var e=n.GameStorage.readJSON(n.SaveDef.kPlayer);e?(t.prop.coin=e.coin,t.prop.ownRoles=e.ownRoles,t.prop.itemMap.copy(e.itemMap)):(t.prop.itemMap.put(1,1),t.saveProp());var i=n.GameStorage.readJSON(n.SaveDef.kDaily);if(i){t.dailyDat.signInAwardCnt=i.signInAwardCnt,t.dailyDat.lastSignInDay=i.lastSignInDay,t.dailyDat.signInTotalCnt=i.signInTotalCnt,(o=new Date).getDate()==t.dailyDat.lastSignInDay?(t.dailyDat.videoLimited=i.videoLimited,t.dailyDat.signAutoPopCnt=i.signAutoPopCnt,t.dailyDat.videoBonusCnt=i.videoBonusCnt,t.dailyDat.videoBonusTime=i.videoBonusTime,t.dailyDat.signInAwarded=i.signInAwarded,t.dailyDat.bnrClickCnt=i.bnrClickCnt||0):(t.dailyDat.videoLimited=0,t.dailyDat.signAutoPopCnt=3,t.dailyDat.videoBonusCnt=5,t.dailyDat.videoBonusTime=300,t.dailyDat.signInAwarded=0,t.dailyDat.bnrClickCnt=0,t.dailyDat.lastSignInDay=o.getDate()),t.dailyDat.offlineTimestamp=i.lastTimestamp,t.calOfflineTime(),t.dailyDat.signInAwardCnt>=7||!i.signInBonusMap?(t.dailyDat.signInBonusMap.clear(),t.dailyDat.signInAwardCnt=0):t.dailyDat.signInBonusMap.copy(i.signInBonusMap),t.saveSignIn()}else{t.dailyDat.lastSignInDay=0,t.dailyDat.signInAwardCnt=0,t.dailyDat.signInAwarded=0,t.dailyDat.signInTotalCnt=0,t.dailyDat.bnrClickCnt=0,t.dailyDat.videoLimited=0,t.dailyDat.signAutoPopCnt=3,t.dailyDat.videoBonusCnt=5,t.dailyDat.videoBonusTime=300;var o=new Date;t.dailyDat.lastSignInDay=o.getDate(),t.saveSignIn()}},t.prop=new c,t.dailyDat=new l,t.bnrJumpInterval=1,t.lastClickTimestamp=0,t}();i.GameUserInfo=u,cc._RF.pop()},{"../data/bonus_data":"bonus_data","../data/data_hub":"data_hub","../util/game_storage":"game_storage","../util/structure/hd_map":"hd_map"}],wx_util:[function(t,e,i){"use strict";cc._RF.push(e,"ddd35rF9ldDko6TQsndGHNu","wx_util");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./global_def"),s=t("./network/http_req"),r=t("../game_setting"),a=t("./game_storage"),h=t("./event_mgr"),l=t("../game_ui/common/ad_sim_ui"),c=t("./timed_task"),u=t("../data/data_hub"),d=t("../game/user_info"),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.saveData=function(){var t={openId:r.GameSetting.openId};a.GameStorage.writeJSON(a.SaveDef.kWxStatus,t)},e.prototype.readData=function(){var t=a.GameStorage.readJSON(a.SaveDef.kWxStatus);t&&(r.GameSetting.openId=t.openId)},e.prototype.fetchSdkInfo=function(){this.sdkInfo=wx.getSystemInfoSync(),console.log("[WxUtil SDK info]",this.sdkInfo.screenWidth,this.sdkInfo.screenHeight,this.sdkInfo.platform,this.sdkInfo.SDKVersion),1==r.GameSetting.testServer&&(this.domain_="http://119.23.108.126:8900/comLogin")},e.prototype.compareVersion=function(t,e){for(var i=t.split("."),o=e.split("."),n=Math.max(i.length,o.length);i.length<n;)i.push("0");for(;o.length<n;)o.push("0");for(var s=0;s<n;s++){var r=parseInt(i[s]),a=parseInt(o[s]);if(r>a)return 1;if(r<a)return-1}return 0},e.prototype.convertMenuButtonRect=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i={x:0,y:0,w:0,h:0},o=this.sdkInfo;if(-1!=this.compareVersion(o.SDKVersion,"2.1.0")){var n=wx.getMenuButtonBoundingClientRect(),s=cc.view.getVisibleSize().width,r=cc.view.getVisibleSize().height,a=s/o.screenWidth,h=r/o.screenHeight;i.x=n.left*a+t,i.y=n.top*h+e,i.w=n.width*a,i.h=n.height*h}return i},e.prototype.login=function(t,e,i,o,n){var s=this;void 0===o&&(o=!1),void 0===n&&(n=!1),o?this._login(t,e,i,n):wx.checkSession({success:function(t){console.log("check session succ",t),s.readData()},fail:function(o){console.log("check session fail",o),s._login(t,e,i,n)},complete:function(t){}})},e.prototype._login=function(t,e,i,o){var s=this;void 0===o&&(o=!1),wx.login({success:function(a){n.G.log("login succ",1,a,o),a.code&&(s.loginCode_=a.code,o?t&&t():wx.request({url:s.domain_+"/user/getSessionKey",data:{code:a.code,proName:r.GameSetting.proName,choose:"1"},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(i){i.statusCode>=200&&i.statusCode<=400?(console.log("login request succ",i),t&&t(JSON.parse(i.data.res))):(console.log("login request fail",i),e&&e(i))},fail:function(t){console.log("login request complete fail",t),i&&i(t)}}))},fail:function(t){console.log("login fail",t),i&&i(t)},complete:function(t){}})},e.prototype.fetchUserInfo=function(t,e,i,o,s,r){var a=this;-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.2.0")?wx.getSetting({success:function(h){if(h.authSetting["scope.userInfo"])wx.getUserInfo({withCredentials:!0,lang:"zh_CN",success:function(t){e&&e(t.userInfo),a._authLogin(t,i,o)},fail:function(t){n.G.log("get setting scope userInfo failed",1,t)},complete:function(t){}});else if(-1!=a.compareVersion(a.sdkInfo.SDKVersion,"2.0.1")){var l=wx.createImage();l.src="res/raw-assets/resources/"+t+".png",l.onload=function(){var t=r;if(n.G.isEmptyObj(t)){var a=l.width,h=l.height;t={left:.5*this.sdkInfo.screenWidth-.5*a,top:.5*this.sdkInfo.screenHeight,width:a,height:h,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(e,t,l.src,s,i,o)}.bind(a)}else a.modalDialog("\u5fae\u4fe1\u66f4\u65b0\u63d0\u793a","\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8f83\u4f4e\uff0c\u5efa\u8bae\u5347\u7ea7\u4ee5\u4fdd\u969c\u6e38\u620f\u4f53\u9a8c",function(){wx.exitMiniProgram({})},null,!1)},fail:function(t){},complete:function(t){}}):this.modalDialog("\u5fae\u4fe1\u66f4\u65b0\u63d0\u793a","\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u8bf7\u5347\u7ea7\u5df2\u4fdd\u969c\u6b63\u5e38\u6e38\u620f\u4f53\u9a8c",function(){wx.exitMiniProgram({})},null,!1)},e.prototype._authLogin=function(t,e,i){wx.request({url:this.domain_+"/user/auth",data:{encryptedData:t.encryptedData,iv:t.iv,code:this.loginCode_,proName:r.GameSetting.proName},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){t.statusCode>=200&&t.statusCode<=400?(console.log("_authLogin request succ",t),e&&e(t.data.res)):(console.log("_authLogin request fail",t),i&&i())},fail:function(t){console.log("_authLogin request complete fail",t)}})},e.prototype._authentication=function(t,e,i,o,s,r){var a=wx.createUserInfoButton({type:"image",text:"txt",image:i,style:e,withCredentials:!0,lang:"zh_CN"});a.show(),n.G.log("create button",1,a);var h=function(l){if(n.G.log("_authentication onTap",1,l),null==l.iv||null==l.encryptedData){n.G.log("cancel auth");var c=wx.createImage();c.src=i,c.onload=function(){var i=e;if(n.G.isEmptyObj(i)){var a=c.width,h=c.height;i={left:.5*this.sdkInfo.screenWidth-.5*a,top:.5*this.sdkInfo.screenHeight,width:a,height:h,color:"#ffffff",lineHeight:40,backgroundColor:"#ff0000",borderColor:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4}}this._authentication(t,e,c.src,o,s,r)}.bind(this)}else t&&t(l.userInfo),this._authLogin(l,s,r),o&&o();a.offTap(h),a.destroy()}.bind(this);a.onTap(h)},e.prototype.uploadUserInfo=function(t,e,i,o,n,s){wx.request({url:this.domain_+"/user/updUser",data:{proName:r.GameSetting.proName,openid:r.GameSetting.openId,unionid:r.GameSetting.unionId,nickname:t,gender:i,avatarurl:e,city:o,province:n,country:s},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){},fail:function(t){}})},e.prototype.showForward=function(t){wx.showShareMenu({withShareTicket:!1,success:function(t){},fail:function(){},complete:function(){}}),wx.onShareAppMessage(function(){var e=null;return t&&(e=t()),e})},e.prototype.shareNorm=function(t,e,i,o){var n=this,a=e.lastIndexOf("Shared/"),h=r.GameSetting.proName,l="";-1!=a&&(l=e.substring(a+h.length+8)),s.HttpRequest.shareOut(l),wx.shareAppMessage({title:t,imageUrl:e,query:"hdimg="+l,cancel:function(){console.log("norm share cancel"),n.bNormShareCancel=!0,n.normShareFailCallback&&(n.normShareFailCallback(),n.normShareFailCallback=null)}}),this.normShareTimestamp=Date.now(),this.normShareSuccCallback=i,this.normShareFailCallback=o,this.bNormShareCancel=!1},e.prototype.shareForTMSDK=function(t,e,i,o){void 0===o&&(o=""),n.G.isTMSDK?wx.tmSDK.shareAppMessage({scene:t,success:function(){e&&e()},cancel:function(){i&&i()},query:o}):n.G.log("tmSdk is not active,share for tmSdk can not be invoking")},e.prototype.normShareResult=function(){var t=this;this.normShareTimestamp>0&&(Date.now()-this.normShareTimestamp>=2400?setTimeout(function(){t.bNormShareCancel||(t.normShareSuccCallback&&(t.normShareSuccCallback(),t.normShareSuccCallback=null),n.G.log("norm share succ"))},100):(this.normShareFailCallback&&(this.normShareFailCallback(),this.normShareFailCallback=null),n.G.log("norm share fail")),this.normShareTimestamp=0)},e.prototype.launchQueryCheck=function(t){void 0===t&&(t=!1);var e=wx.getLaunchOptionsSync();e&&n.G.isExistObj(e.query)&&e.query.hdimg&&s.HttpRequest.shareClick(e.query.hdimg)},e.prototype.onShowQueryCheck=function(t,e){void 0===e&&(e=!1),n.G.isExistObj(t)&&t.hdimg&&s.HttpRequest.shareClick(t.hdimg)},e.prototype.reqTimerReset=function(t,e,i){var o=function(){var o=this;wx.request({url:this.domain_+"/user/reqTimerReset",data:{proName:r.GameSetting.proName,sysName:t,openId:r.GameSetting.openId,choose:e.toString()},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){if(t.statusCode>=200&&t.statusCode<=400){console.log("reqTimerReset request succ",t);var e=parseInt(t.data.res);i&&i(e)}else console.log("reqTimerReset request fail",t),o.modalDialog("\u7f51\u7edc\u62a5\u544a","\u5f53\u524d\u7f51\u7edc\u73af\u5883\u4e0d\u4f73\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u91cd\u8bd5")},fail:function(t){console.log("reqTimerReset request fail",t)}})}.bind(this);""==r.GameSetting.openId?this.login(function(t){r.GameSetting.sessionKey=t.sessionKey,r.GameSetting.openId=t.openId,o(),n.G.log("reqTimerReset relogin",1,t)},null,null,!0):o()},e.prototype.reqTimerResetUnion=function(t,e,i,o){var n=function(){wx.request({url:this.domain_+"/user/reqTimerResetU",data:{proName:r.GameSetting.proName,sysName:t,unionId:r.GameSetting.unionId,choose:e.toString()},header:{"content-type":"application/json"},method:"GET",dataType:"json",success:function(t){if(t.statusCode>=200&&t.statusCode<=400){console.log("reqTimerResetUnion request succ",t);var e=parseInt(t.data.res);i&&i(e)}else console.log("reqTimerResetUnion request fail",t)},fail:function(t){console.log("reqTimerResetUnion request complete fail",t)}})}.bind(this);""==r.GameSetting.unionId?o&&o():n()},e.prototype._getVideoBonus=function(){this.videoBonusCallback_&&(this.videoBonusCallback_(),this.videoBonusCallback_=null)},e.prototype.watchVideoAds=function(t,e,i,o,s,r,a){var l=this;void 0===a&&(a="");var _=this.sdkInfo;if(-1!=this.compareVersion(_.SDKVersion,"2.1.0")){var p=function(o){if(l.videoAdsProtectFlags_.containsKey(t)&&1===l.videoAdsProtectFlags_.get(t))return;console.log("Ads Close callback",o.isEnded),h.GameEventMgrInst.addEvent(h.EventType.kAudioResume,null,{pauseType:1}),o&&o.isEnded||void 0===o?(e&&e(),l.videoAdsProtectFlags_.put(t,1)):(i&&i(),l.videoAdsProtectFlags_.put(t,0)),l.videoTimeId_>0&&(c.TimedTaskInst.remove(l.videoTimeId_),l.videoTimeId_=0),l.videoBonusCallback_=null},g=function(t){console.log("Ads error callback",t.errMsg),h.GameEventMgrInst.addEvent(h.EventType.kAudioResume,null,{pauseType:1}),o&&o(t),l.videoBonusCallback_=null,-1!=l.compareVersion(_.SDKVersion,"2.2.2")&&t.errCode&&(console.log("video err code",t.errCode),1e3!=t.errCode&&1003!=t.errCode&&1004!=t.errCode&&d.GameUserInfo.limitVideo())};if(this.videoAd_=wx.createRewardedVideoAd({adUnitId:t}),this.videoAd_.load().then(function(){l.videoAd_.show().then(function(){console.log("video show"),h.GameEventMgrInst.addEvent(h.EventType.kAudioPause,null,{pauseType:1}),n.G.randRange(0,100)<=u.DataHub.config.videoBonus&&(l.videoTimeId_>0&&(c.TimedTaskInst.remove(l.videoTimeId_),l.videoTimeId_=0),l.videoBonusCallback_=r,l.videoTimeId_=c.TimedTaskInst.add(function(){var t=a||"\u70b9\u51fb\u5e95\u90e8\u6761\u5e45\u53ef\u83b7\u5f97\u5956\u52b1";l.toast(t,5e3)},5))}).catch(function(t){return console.log("video err",t)}),l.videoAdsProtectFlags_.put(t,0)}).catch(function(t){return console.log(t.errMsg)}),this.videoAdsCallbackMap_.containsKey(t)){var m=this.videoAdsCallbackMap_.get(t);this.videoAd_.offClose(m.closeCallback),this.videoAd_.offError(m.errCallback),this.videoAdsCallbackMap_.remove(t)}this.videoAd_.onClose(p),this.videoAd_.onError(g);var v=new f(p,g);this.videoAdsCallbackMap_.put(t,v),s&&s()}else this.modalDialog("\u63d0\u793a","\u5fae\u4fe1\u7248\u672c\u8f83\u4f4e\uff0c\u6682\u4e0d\u652f\u6301\u89c6\u9891\u89c2\u770b",null,null,!1)},e.prototype.bannerStat=function(t){if(this.bBnrShowed_&&this.recordBannerClickSucTimestamp(),t&&t.mode&&t.targetAction){if("back"==t.mode&&3==t.targetAction||"hide"==t.mode&&-1==t.targetAction)return;this._getVideoBonus()}},e.prototype.recordBannerCDTimestamp=function(){this.bnrClickCDTimestamp_=Date.now()},e.prototype.isBannerClickCD=function(){var t=!1;this.bnrClickCDTimestamp_>0&&(t=(Date.now()-this.bnrClickCDTimestamp_)/1e3<u.DataHub.config.bnrClickCD,n.G.log("isBannerClickCD",t));return t},e.prototype.recordBannerClickSucTimestamp=function(){this.bnrClickSucTimestamp_=Date.now(),n.G.log("recordBannerClickSucTimestamp",this.bnrClickSucTimestamp_)},e.prototype.decideBannerClickSuc=function(){if(this.bnrClickSucTimestamp_>0){var t=Date.now()-this.bnrClickSucTimestamp_;t/1e3<u.DataHub.config.bnrClickSucTime&&(n.G.log("decideBannerClickSuc",t),d.GameUserInfo.addBannerClickCnt(),this.recordBannerCDTimestamp(),this.bnrClickSucTimestamp_=0)}},e.prototype.showBannerWithRule=function(t,e,i,o){var s=this;void 0===o&&(o=""),this.isBannerLimited(t)?(n.G.log("showBannerWithRule limited",t,o),e&&e()):0!==u.DataHub.config.adChk||d.GameUserInfo.isBannerClickAvailable?(n.G.log("showBannerWithRule orig banner",t),this.bBnrShowed_=!0,this.showBanner(t,o)):(n.G.log("showBannerWithRule cd enter",t,o),this.bnrRefreshTaskId_>0&&(c.TimedTaskInst.remove(this.bnrRefreshTaskId_),this.bnrRefreshTaskId_=0),this.showBanner(t,o),this.bnrRefreshTaskId_=c.TimedTaskInst.add(function(){s.bnrRefreshTaskId_=0,n.G.log("showBannerWithRule cd hide",t,o),s.hideBanner(t,o),e&&e()},1)),i&&this.bnrHideCbMap_.put(t+o,i)},e.prototype.hideBannerWithRule=function(t,e){void 0===e&&(e=""),this.hideBanner(t,e),this.bBnrShowed_=!1;var i=t+e;this.bnrHideCbMap_.containsKey(i)&&(this.bnrHideCbMap_.get(i)(),this.bnrHideCbMap_.remove(i))},e.prototype._calBannerXYWZ=function(t,e,i,o){void 0===i&&(i=1),void 0===o&&(o=15);var n=this.sdkInfo.screenWidth;t&&(n=t);var s=120*(n/300),r=0;if(e){var a=cc.view.getVisibleSize().height,h=e.localToGlobal().y,l=(h+o)/a;r=this.sdkInfo.screenHeight*l,console.log("addBanner node",l,h,o,a-h,a,r,this.sdkInfo.screenHeight)}else r=this.sdkInfo.screenHeight-s,0==i&&(r=0);return{x:.5*this.sdkInfo.screenWidth-.5*n,y:r,w:n,h:s}},e.prototype.preloadBanner=function(t,e,i,o,s,r,a,h,c){var u=this;void 0===o&&(o=15),void 0===s&&(s=null),void 0===r&&(r=null),void 0===a&&(a=1),void 0===h&&(h=4),void 0===c&&(c="");var d=t;if(t+=c,!n.G.isWeChat)return l.BannerSimUI.addTestBannerHolder(t,e?e.asCom:null,a),void(s&&s());if(-1!=this.compareVersion(this.sdkInfo.SDKVersion,"2.0.4")){if(h>1e3&&this.bnrItemMap_.containsKey(t))this.bnrItemMap_.get(t).refreshCnt>=h&&this.destroyBanner(t);var _=null;if(!this.bnrItemMap_.containsKey(t)){_=new g;var p=this._calBannerXYWZ(i,e,a,o);_.obj=wx.createBannerAd({adUnitId:d,style:{left:p.x,top:p.y,width:p.w,height:p.h}}),_.id=t,_.refreshCnt=0,_.refreshRule=h,_.errCb=r,_.x=p.x,_.y=p.y,_.w=p.w,_.h=p.h,_.adErrCallback=function(t){n.G.log("Banner Ads pull failed",t),++_.refreshCnt,-1!=u.compareVersion(u.sdkInfo.SDKVersion,"2.2.2")&&t.errCode&&(1e3==t.errCode||1003==t.errCode||(_.bLimited=!0)),_.errCb&&_.errCb()},_.obj.onError(_.adErrCallback.bind(_));var f=function(){n.G.log("Banner pull success"),s&&s(),_.obj.offLoad(f)};_.obj.onLoad(f),this.bnrItemMap_.put(t,_)}}},e.prototype.isBannerShowed=function(t,e){if(void 0===e&&(e=""),t+=e,!n.G.isWeChat)return l.BannerSimUI.isTestBannerHolderShowed(t);var i=!1;this.bnrItemMap_.containsKey(t)&&(i=this.bnrItemMap_.get(t).bShow);return i},e.prototype.isBannerLimited=function(t,e){if(void 0===e&&(e=""),t+=e,!n.G.isWeChat)return l.BannerSimUI.isTestBannerLimited(t);var i=!1;this.bnrItemMap_.containsKey(t)&&(i=this.bnrItemMap_.get(t).bLimited);return i},e.prototype.showBanner=function(t,e){var i=this;void 0===e&&(e="");var o=t;if(t+=e,n.G.isWeChat){if(-1!=this.compareVersion(this.sdkInfo.SDKVersion,"2.0.4")&&(this.hideLastOne(),this.bnrItemMap_.containsKey(t))){var s=this.bnrItemMap_.get(t);if(s.refreshRule<1e3&&s.refreshCnt>=s.refreshRule){var r=new g;r.obj=wx.createBannerAd({adUnitId:o,style:{left:s.x,top:s.y,width:s.w,height:s.h}}),r.id=t,r.refreshCnt=0,r.refreshRule=s.refreshRule,r.errCb=s.errCb,r.adErrCallback=function(t){n.G.log("Banner Ads pull failed",t),++r.refreshCnt,-1!=i.compareVersion(i.sdkInfo.SDKVersion,"2.2.2")&&t.errCode&&(1e3==t.errCode||1003==t.errCode||(r.bLimited=!0)),r.errCb&&r.errCb()},r.obj.onError(r.adErrCallback.bind(r)),r.x=s.x,r.y=s.y,r.w=s.w,r.h=s.h,s.del(),this.bnrItemMap_.remove(t),this.bnrItemMap_.put(t,r),s=r}s.show(),this.lastBnrItemStack_.push(s)}}else l.BannerSimUI.showTestBannerHolder(t)},e.prototype.hideBanner=function(t,e){(void 0===e&&(e=""),t+=e,n.G.isWeChat)?this.bnrItemMap_.containsKey(t)&&(this.bnrItemMap_.get(t).hide(),this.lastBnrItemStack_.pop(),this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].show()):l.BannerSimUI.hideTestBannerHolder(t)},e.prototype.showLastOne=function(){n.G.isWeChat?this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].show():l.BannerSimUI.showLastTestBanner()},e.prototype.hideLastOne=function(){n.G.isWeChat?this.lastBnrItemStack_.length>0&&this.lastBnrItemStack_[this.lastBnrItemStack_.length-1].hide():l.BannerSimUI.hideLastTestBanner()},e.prototype.destroyBanner=function(t,e){if(void 0===e&&(e=""),t+=e,this.bnrItemMap_.containsKey(t)){this.bnrItemMap_.get(t).del();for(var i=0;i<this.lastBnrItemStack_.length;++i)if(this.lastBnrItemStack_[i].id===t){this.lastBnrItemStack_.splice(i,1);break}this.bnrItemMap_.remove(t)}},e.prototype.hideAllBanners=function(){var t=this;n.G.isWeChat?(this.hideLastOne(),this.bnrItemMap_.each(function(e,i,o){t.hideBanner(i)})):l.BannerSimUI.hideAllTestBanner()},e.prototype.addInterstitialAd=function(t){var e=this.sdkInfo;if(-1!=this.compareVersion(e.SDKVersion,"2.6.0"))try{this.interAd_=wx.createInterstitialAd({adUnitId:t})}catch(t){console.log("addInterstitialAd",t)}},e.prototype.showInterstitialAd=function(){var t=this.sdkInfo;if(-1!=this.compareVersion(t.SDKVersion,"2.6.0")&&this.interAd_)try{this.interAd_.show()}catch(t){console.log("showInterstitialAd",t)}},e.prototype.checkVersionUpdate=function(t,e){var i=this,o=this.sdkInfo;if(-1!=this.compareVersion(o.SDKVersion,"1.9.90")){var s=o.system;if(-1!==s.indexOf("Android")){var r=s.substr(7).trim();if(-1==this.compareVersion(r,"6.6.7"))return n.G.log("skip update cause the system version is too low",1,r),void(e&&e())}n.G.log("check version update",o.system);var a=wx.getUpdateManager();a.onCheckForUpdate(function(i){console.log(i.hasUpdate),i.hasUpdate?t&&t():e&&e()}),a.onUpdateReady(function(){i.modalDialog("\u66f4\u65b0\u63d0\u793a","\u65b0\u7248\u672c\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u8bf7\u91cd\u542f\u6e38\u620f",function(){a.applyUpdate()},null,!1)}),a.onUpdateFailed(function(){i.modalDialog("\u66f4\u65b0\u63d0\u793a","\u65b0\u7248\u672c\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u7f51\u7edc\u73af\u5883\u662f\u5426\u826f\u597d\u6216\u8005\u91cd\u542f\u5fae\u4fe1",null,null,!1)})}else this.modalDialog("\u5fae\u4fe1\u66f4\u65b0\u63d0\u793a","\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8f83\u4f4e\uff0c\u5efa\u8bae\u5347\u7ea7\u4ee5\u4fdd\u969c\u6e38\u620f\u4f53\u9a8c",null,null,!1),e&&e()},e.prototype.modalDialog=function(t,e,i,o,n,s,r,a,h){void 0===n&&(n=!0),void 0===s&&(s="\u53d6\u6d88"),void 0===r&&(r="#000000"),void 0===a&&(a="\u786e\u5b9a"),void 0===h&&(h="#3cc51f"),wx.showModal({title:t,content:e,showCancel:n,cancelText:s,cancelColor:r,confirmText:a,confirmColor:h,success:function(t){t.confirm?i&&i():t.cancel&&o&&o()}})},e.prototype.toast=function(t,e){void 0===e&&(e=1500),wx.showToast({title:t,duration:e,icon:"none"})},e.prototype.showGameClub=function(t,e,i,o){-1!=this.compareVersion(this.sdkInfo.SDKVersion,"2.0.3")&&(null==this.gameClub_&&(this.gameClub_=wx.createGameClubButton({type:"image",text:"",image:"",style:{left:t,top:e,width:i,height:o},icon:"dark"})),this.gameClub_.show())},e.prototype.hideGameClub=function(){n.G.isExistObj(this.gameClub_)&&this.gameClub_.hide()},e.prototype.removeGameClub=function(){n.G.isExistObj(this.gameClub_)&&(this.gameClub_.destroy(),this.gameClub_=null)},e.prototype.vibrateShort=function(){-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.2.0")&&wx.vibrateShort()},e.prototype.vibrateLong=function(){-1!=this.compareVersion(this.sdkInfo.SDKVersion,"1.2.0")&&wx.vibrateLong()},e.prototype.setAudioOption=function(t,e){-1!=this.compareVersion(this.sdkInfo.SDKVersion,"2.3.0")&&wx.setInnerAudioOption({mixWithOther:t,obeyMuteSwitch:e})},e.prototype.playAudio=function(t,e,i,o,n){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=!1);var s=null;if(this.audioInfoMap_.containsKey(t)?s=this.audioInfoMap_.get(t):(s=new p(t),this.audioInfoMap_.put(t,s)),s){var r=s.obj;r&&(r.src=t,r.startTime=i,r.volume=o,r.loop=e,r.autoplay=n,r.play())}},e.prototype.addAudioCallback=function(t,e){if(this.audioInfoMap_.containsKey(t)){var i=this.audioInfoMap_.get(t);i.endCallback&&i.obj.offEnded(i.endCallback),i.endCallback=e,i.obj.onEnded(i.endCallback)}},e.prototype.resumeAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.play()},e.prototype.pauseAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.pause()},e.prototype.stopAudio=function(t){this.audioInfoMap_.containsKey(t)&&this.audioInfoMap_.get(t).obj.stop()},e.prototype.destroyAudio=function(t){if(this.audioInfoMap_.containsKey(t)){var e=this.audioInfoMap_.get(t);e.endCallback&&e.obj.offEnded(e.endCallback),e.obj.destroy(),this.audioInfoMap_.remove(t)}},e.prototype.onAudioInterruptionEnd=function(){wx.onAudioInterruptionEnd(function(){h.GameEventMgrInst.addEvent(h.EventType.kAudioResume)})},e.prototype.onShow=function(t){var e=this;void 0===t&&(t=!1),wx.onShow(function(i){h.GameEventMgrInst.addEvent(h.EventType.kAudioResume,null,{pauseType:2}),n.G.log("onShow"),e.onShowQueryCheck(i.query,t),e.normShareResult(),cc.director.resume(),d.GameUserInfo.calOfflineTime(),e.decideBannerClickSuc()})},e.prototype.onHide=function(){var t=this;wx.onHide(function(e){cc.director.pause(),h.GameEventMgrInst.addEvent(h.EventType.kAudioPause,null,{pauseType:2}),t.bannerStat(e),d.GameUserInfo.setOfflineTimestamp(),d.GameUserInfo.saveSignIn()})},e.prototype.triggerGC=function(){wx.triggerGC()},e.prototype.exitGame=function(){wx.exitMiniProgram({})},e.prototype.checkFileAccess=function(t,e,i){wx.getFileSystemManager().access({path:t,success:function(){e&&e()},fail:function(){i&&i()}})},e}(t("./mgp_def").MinigamePlatDef);i.WxUtil=_;var p=function(){return function(t){this.obj=null,this.endCallback=null,this.obj=wx.createInnerAudioContext()}}(),f=function(){return function(t,e){this.closeCallback=null,this.errCallback=null,this.closeCallback=t,this.errCallback=e}}(),g=function(){function t(){this.id="",this.obj=null,this.errCb=null,this.adErrCallback=null,this.refreshRule=4,this.refreshCnt=0,this.x=0,this.y=0,this.w=0,this.h=0,this.bShow=!1,this.bLimited=!1}return t.prototype.show=function(){var t=this;this.obj&&(++this.refreshCnt,this.obj.show().then(function(e){console.log("banner show",t.id)}).catch(function(e){console.log("banner show err",e),++t.refreshCnt}),this.bShow=!0)},t.prototype.hide=function(){this.obj&&(this.obj.hide(),this.bShow=!1)},t.prototype.del=function(){this.obj&&(this.adErrCallback&&(this.obj.offError(this.adErrCallback),this.adErrCallback=null),this.obj.destroy())},t}();cc._RF.pop()},{"../data/data_hub":"data_hub","../game/user_info":"user_info","../game_setting":"game_setting","../game_ui/common/ad_sim_ui":"ad_sim_ui","./event_mgr":"event_mgr","./game_storage":"game_storage","./global_def":"global_def","./mgp_def":"mgp_def","./network/http_req":"http_req","./timed_task":"timed_task"}]},{},["HDSDK","bonus_data","buff_data","data_hub","buff","fsm","user_info","game_logic","game_setting","ad_sim_ui","base_ui","blocker_ui","dialog_ui","export_ui","fgui_root","lucky_box_ui","popup_ui","setting_ui","sign_in_ui","tip_ui","trans_ui","load","test_astar","test_entry","test_quadtree","test_sdk","test_steering","ad_tools","AStar","bezier","math_helper","math_vec2","quad_tree","steering_vehicle","audio_mgr","bd_util","shaker","event_mgr","fairygui","game_storage","global_def","language","mgp_def","mgp_util","http_req","qg_util","hd_map","timed_task","tt_util","wx_util"]);